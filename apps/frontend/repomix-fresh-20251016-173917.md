This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
__tests__/repairs/bookingForm.test.jsx
__tests__/repairs/dashboards.test.jsx
.env.example
.github/PULL_REQUEST_TEMPLATE.md
.gitignore
.lfsconfig
AGENTS.md
eslint.config.js
index.html
jsdoc.config.json
lighthouserc.json
package.json
postcss.config.js
prettier.config.js
public/favicon.svg
public/vite.svg
README.md
setupTests.js
src/api/__tests__/baseQuery.test.js
src/api/baseQuery.js
src/api/erpApi.js
src/api/store.js
src/api/user.js
src/App.jsx
src/assets/images/loader.gif
src/assets/images/NoDataFound.png
src/assets/logo trnsp svg.svg
src/assets/logo.png
src/assets/logo.svg
src/assets/phone-illustration.png
src/assets/react.svg
src/components/__tests__/invoiceForm.test.jsx
src/components/__tests__/myBookings.test.jsx
src/components/__tests__/notificationsPanel.test.jsx
src/components/__tests__/receiptForm.test.jsx
src/components/common/Button.jsx
src/components/common/Loader.jsx
src/components/common/Logo.jsx
src/components/common/NotificationsPanel.jsx
src/components/common/PageSection.jsx
src/components/common/ReCaptchaWrapper.jsx
src/components/dashboard/components/CardItem.jsx
src/components/dashboard/layout/DashboardBottomNav.jsx
src/components/dashboard/layout/DashboardLayout.jsx
src/components/dashboard/layout/DashboardNavbar.jsx
src/components/DeleteConfirmationModal.jsx
src/components/ecommerce/Cart.jsx
src/components/ecommerce/Payment.jsx
src/components/inventory/ConfigDashboard.jsx
src/components/inventory/PriceLogView.jsx
src/components/inventory/SaleEntryForm.jsx
src/components/inventory/SerialManager.jsx
src/components/inventory/SerialTable.jsx
src/components/inventory/StockEntryForm.jsx
src/components/inventory/StockTable.jsx
src/components/InvoiceForm.jsx
src/components/InvoiceTable.jsx
src/components/layout/__tests__/ReelLayout.test.jsx.backup
src/components/layout/__tests__/ScrollModeContext.test.jsx
src/components/layout/BottomNav.jsx
src/components/layout/FocusLayout.jsx
src/components/layout/Footer.jsx
src/components/layout/MainNav.jsx
src/components/layout/PublicLayout.jsx
src/components/layout/ScrollModeContext.jsx
src/components/layout/TopBar.jsx
src/components/MyBookings.jsx
src/components/navigation/SectionSlider.jsx
src/components/navigation/SwipeHint.jsx
src/components/Pagination.jsx
src/components/PaymentsTable.jsx
src/components/qr/QRScanSection.jsx
src/components/ReceiptForm.jsx
src/components/reels/__tests__/QuickActionsReel.test.jsx
src/components/reels/__tests__/TestimonialsReel.test.jsx
src/components/reels/HeroReel.jsx
src/components/reels/QuickActionsReel.jsx
src/components/reels/TestimonialsReel.jsx
src/components/repairs/MultiSelectIssues.jsx
src/components/repairs/Questionnaire.jsx
src/components/ResponsivePaginationHandler.jsx
src/components/Sales/CreateSaleInvoice.jsx
src/components/Store/BranchHeadModal.jsx
src/components/Store/StoreAssignModal.jsx
src/components/Store/StoreFilters.jsx
src/components/ToggleStatusModal.jsx
src/hooks/useDevice.js
src/hooks/useViewportHeight.js
src/index.css
src/main.jsx
src/pages/__tests__/bookingsDashboard.test.jsx
src/pages/__tests__/brandDashboard.test.jsx
src/pages/__tests__/forms.test.jsx
src/pages/__tests__/inventoryDashboard.test.jsx
src/pages/__tests__/logsDashboard.test.jsx
src/pages/__tests__/productDetail.test.jsx
src/pages/__tests__/productsDashboard.test.jsx
src/pages/__tests__/qualitiesDashboard.test.jsx
src/pages/__tests__/seo.test.jsx
src/pages/__tests__/shop.test.jsx
src/pages/__tests__/spares.test.jsx
src/pages/__tests__/store.test.jsx
src/pages/__tests__/taxonomy.test.jsx
src/pages/__tests__/taxonomyDashboard.test.jsx
src/pages/__tests__/unitsDashboard.test.jsx
src/pages/__tests__/variantsDashboard.test.jsx
src/pages/AboutSection.jsx
src/pages/customers/Account.jsx
src/pages/customers/Login.jsx
src/pages/customers/Orders.jsx
src/pages/customers/Signup.jsx
src/pages/ecommerce/CartPage.jsx
src/pages/ecommerce/CategoryPage.jsx
src/pages/ecommerce/categoryPageMeta.js
src/pages/ecommerce/DepartmentCategoriesPage.jsx
src/pages/ecommerce/departmentCategoriesPageMeta.js
src/pages/ecommerce/DepartmentsPage.jsx
src/pages/ecommerce/departmentsPageMeta.js
src/pages/ecommerce/HelpCentre.jsx
src/pages/ecommerce/Partners.jsx
src/pages/ecommerce/ProductDetail.jsx
src/pages/ecommerce/productDetailMeta.js
src/pages/ecommerce/Shop.jsx
src/pages/Index.jsx
src/pages/IndexMeta.js
src/pages/internal/AdminDashboard.jsx
src/pages/internal/AdvisorDashboard.jsx
src/pages/internal/Bookings.jsx
src/pages/internal/BookingsDashboard.jsx
src/pages/internal/BranchHeadDashboard.jsx
src/pages/internal/BrandDashboard.jsx
src/pages/internal/GenericDashboard.jsx
src/pages/internal/GiveawayRedemption.jsx
src/pages/internal/InventoryDashboard.jsx
src/pages/internal/InvoicesDashboard.jsx
src/pages/internal/IssuesDashboard.jsx
src/pages/internal/LogsDashboard.jsx
src/pages/internal/OtherIssuesDashboard.jsx
src/pages/internal/PaymentsDashboard.jsx
src/pages/internal/ProductsDashboard.jsx
src/pages/internal/QualitiesDashboard.jsx
src/pages/internal/QuestionsDashboard.jsx
src/pages/internal/ScheduleCall.jsx
src/pages/internal/Settings.jsx
src/pages/internal/Spares.jsx
src/pages/internal/Store.jsx
src/pages/internal/StoreDetails.jsx
src/pages/internal/Stores.jsx
src/pages/internal/TaxonomyDashboard.jsx
src/pages/internal/TeamLogin.jsx
src/pages/internal/UnitsDashboard.jsx
src/pages/internal/User.jsx
src/pages/internal/VariantsDashboard.jsx
src/pages/internal/Workledger.jsx
src/pages/internal/WorkledgerDetails.jsx
src/pages/public/About.jsx
src/pages/public/Careers.jsx
src/pages/public/Contact.jsx
src/pages/public/Legal.jsx
src/pages/public/Locate.jsx
src/pages/public/Offers.jsx
src/pages/public/Repair.jsx
src/pages/public/Search.jsx
src/pages/public/Support.jsx
src/params/LayoutContext.jsx
src/redux/__tests__/notificationsSlice.test.js
src/redux/hook.js
src/redux/slice/authSlice.js
src/redux/slice/cartSlice.js
src/redux/slice/dashboardSlice.js
src/redux/slice/notificationsSlice.js
src/redux/slice/storeSlice.js
src/redux/slice/userSlice.js
src/redux/store.js
src/utils/animation.js
src/utils/Constants.js
src/utils/debugLog.js
src/utils/devLog.js
src/utils/Endpoints.js
src/utils/gst.js
src/utils/math.test.js
src/utils/mockData.js
src/utils/viewport.js
tailwind.config.js
vercel.json
vite.config.js
vitest.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="__tests__/repairs/bookingForm.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent, act } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import { useEffect } from 'react';
import Bookings from '../../src/pages/internal/Bookings';

const submitMock = vi.fn().mockReturnValue({
  unwrap: () => Promise.resolve({ id: 1, status: 'pending' }),
});

vi.mock('../../src/api/erpApi', () => ({
  useCreateBookingMutation: () => [submitMock],
  useGetBookingsQuery: () => ({ data: { content: [] }, refetch: vi.fn() }),
  useGetIssuesQuery: () => ({ data: [{ id: 1, name: 'Screen' }] }),
  useGetQuestionsQuery: () => ({
    data: [{ id: 1, text: 'Device?', type: 'text' }],
  }),
}));

vi.mock('../../src/components/common/ReCaptchaWrapper', () => ({
  __esModule: true,
  default: function MockReCaptcha({ onChange }) {
    useEffect(() => {
      onChange('token');
    }, [onChange]);
    return null;
  },
}));

test('booking form renders dynamic issues/questions', () => {
  render(<Bookings />);
  expect(screen.getByText('Select issues')).toBeTruthy();
  expect(screen.getByText('Device?')).toBeTruthy();
});

test.skip('booking form submits and calls useCreateBookingMutation', async () => {
  const { container } = render(<Bookings />);
  fireEvent.change(screen.getAllByPlaceholderText('Name')[0], {
    target: { value: 'John' },
  });
  fireEvent.change(screen.getAllByPlaceholderText('Email (optional)')[0], {
    target: { value: 'a@b.com' },
  });
  container.querySelector('input[type="date"]').value = '2024-01-01';
  fireEvent.change(container.querySelector('input[type="date"]'));
  container.querySelector('input[type="time"]').value = '10:00';
  fireEvent.change(container.querySelector('input[type="time"]'));
  fireEvent.click(screen.getAllByText('Select issues')[0]);
  fireEvent.click(await screen.findByText('Screen'));
  fireEvent.change(
    screen.getAllByText('Device?')[0].parentElement.querySelector('input'),
    {
      target: { value: 'Phone' },
    }
  );
  await act(async () => {
    fireEvent.click(screen.getAllByText('Submit')[0]);
  });
  expect(submitMock).toHaveBeenCalled();
});
</file>

<file path="__tests__/repairs/dashboards.test.jsx">
// @vitest-environment jsdom
import { render, screen } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import IssuesDashboard from '../../src/pages/internal/IssuesDashboard';
import OtherIssuesDashboard from '../../src/pages/internal/OtherIssuesDashboard';
import QuestionsDashboard from '../../src/pages/internal/QuestionsDashboard';

vi.mock('../../src/api/erpApi', () => ({
  useGetIssuesQuery: () => ({
    data: [{ id: 1, name: 'Screen' }],
    isLoading: false,
  }),
  useCreateIssueMutation: () => [vi.fn()],
  useUpdateIssueMutation: () => [vi.fn()],
  useDeleteIssueMutation: () => [vi.fn()],
  useGetOtherIssuesQuery: () => ({
    data: [{ id: 1, name: 'Battery' }],
    isLoading: false,
  }),
  useCreateOtherIssueMutation: () => [vi.fn()],
  useUpdateOtherIssueMutation: () => [vi.fn()],
  useDeleteOtherIssueMutation: () => [vi.fn()],
  useGetQuestionsQuery: () => ({
    data: [{ id: 1, text: 'Q1' }],
    isLoading: false,
  }),
  useCreateQuestionMutation: () => [vi.fn()],
  useUpdateQuestionMutation: () => [vi.fn()],
  useDeleteQuestionMutation: () => [vi.fn()],
}));

test('dashboard pages render fetched entities', () => {
  render(<IssuesDashboard />);
  expect(screen.getByText('Screen')).toBeTruthy();
  render(<OtherIssuesDashboard />);
  expect(screen.getByText('Battery')).toBeTruthy();
  render(<QuestionsDashboard />);
  expect(screen.getByText('Q1')).toBeTruthy();
});
</file>

<file path=".env.example">
# API Configuration
VITE_API_BASE_URL=https://finetunetechcrafterp-dev.up.railway.app

# Environment
NODE_ENV=production
</file>

<file path=".github/PULL_REQUEST_TEMPLATE.md">
## Summary

- _fill in summary_

## Checklist

- [ ] Docs updated
- [ ] Environment variables documented
- [ ] Added/updated tests
- [ ] Included screenshots for UI changes
- [ ] E2E tests adjusted (if applicable)
</file>

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local
.env

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# JSDoc generated documentation
docs-generated/
</file>

<file path=".lfsconfig">
[lfs]
    url = https://github.com/krishamaze/fe-be-alignment-analysis.git/info/lfs
</file>

<file path="AGENTS.md">
# AI Agent Guide

## Project Overview

Finetune ERP Frontend is a React-based web application that provides administrative dashboards and e-commerce interfaces for the Finetune ERP system. It interacts with a backend REST service to manage users, stores and other business resources.

## Architecture Summary

- **React 19** for UI components
- **Vite 6** for development and build tooling
- **Redux Toolkit** for state management
- **Tailwind CSS** for utility-first styling
- **React Router** for client-side routing
- **Axios** and `fetchBaseQuery` for HTTP requests

## File Structure

```text
/
├─ docs/                # In-depth documentation
├─ public/              # Static assets served as-is
├─ src/                 # Application source
│  ├─ api/              # REST helpers and base query with reauth
│  ├─ assets/           # Images and other media
│  ├─ components/       # Reusable UI components
│  ├─ pages/            # Route-level components
│  ├─ redux/            # Redux slices and store setup
│  ├─ utils/            # Utility helpers and constants
│  └─ params/           # Route and query parameter helpers
├─ index.html           # Vite entry point
├─ tailwind.config.js   # Tailwind configuration
└─ vite.config.js       # Vite configuration
```

## Role-Based Access

- **system_admin** – full access to dashboard features including settings, stores, users and giveaway pages
- **admin** – same dashboard access as `system_admin`
- **branch_head** – dashboard access to settings and stores only
- **advisor** – limited dashboard with access to stores overview

See [docs/AUTH.md](docs/AUTH.md) for detailed route protection rules.

## Development Guidelines

- Use functional React components and hooks
- Style elements with Tailwind CSS utility classes
- Organize code using Redux Toolkit slices and thunks
- Follow camelCase for filenames and variables
- Keep components accessible (semantic HTML, labels, keyboard focus)
- Run lint and tests before committing

```bash
npm run lint
npm test
```

## API Integration

Frontend API calls use a `fetchBaseQuery` wrapper (`src/api/baseQuery.js`) that attaches JWT tokens from cookies and automatically refreshes them on 401 responses. Redux async thunks dispatch these calls and update slices.

```js
// Example store fetch
import { baseQueryWithReauth } from './api/baseQuery';

await baseQueryWithReauth({ url: '/stores' }, { dispatch, getState });
```

## Common Tasks

- **Start development server:** `npm run dev`
- **Build for production:** `npm run build`
- **Run tests:** `npm test`
- **Run linter:** `npm run lint`
- **Debug API calls:** check network tab, inspect Redux state, and verify cookie tokens
- **Add components:** follow patterns in `docs/UI_GUIDE.md`
</file>

<file path="eslint.config.js">
import js from '@eslint/js';
import globals from 'globals';
import reactHooks from 'eslint-plugin-react-hooks';
import reactRefresh from 'eslint-plugin-react-refresh';
import prettierPlugin from 'eslint-plugin-prettier';
import eslintConfigPrettier from 'eslint-config-prettier';

export default [
  { ignores: ['dist'] },
  {
    files: ['**/*.{js,jsx}'],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    plugins: {
      'react-hooks': reactHooks,
      'react-refresh': reactRefresh,
      prettier: prettierPlugin,
    },
    rules: {
      ...js.configs.recommended.rules,
      ...reactHooks.configs.recommended.rules,
      ...eslintConfigPrettier.rules,
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
      'react-refresh/only-export-components': [
        'warn',
        { allowConstantExport: true },
      ],
      'prettier/prettier': 'error',
    },
  },
];
</file>

<file path="index.html">
<!doctype html>
<html lang="en" class="h-full">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>Welcome to finetune.store | Your Trusted Tech Partner</title>
  </head>
  <body class="font-[Poppins] bg-white h-full overflow-hidden">
    <div id="root" class="h-full"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="jsdoc.config.json">
{
  "source": {
    "include": ["src"],
    "includePattern": "\\.(jsx?|tsx?)$",
    "excludePattern": "(node_modules|__tests__|dist)"
  },
  "plugins": ["node_modules/jsdoc-plugin-typescript", "node_modules/better-docs/category"],
  "opts": {
    "template": "node_modules/better-docs",
    "destination": "./docs-generated",
    "recurse": true,
    "readme": "./README.md"
  },
  "templates": {
    "better-docs": {
      "name": "Finetune ERP Frontend",
      "navigation": [
        {
          "label": "Components",
          "href": "module-components.html"
        },
        {
          "label": "Hooks",
          "href": "module-hooks.html"
        },
        {
          "label": "Utils",
          "href": "module-utils.html"
        }
      ]
    }
  }
}
</file>

<file path="lighthouserc.json">
{
  "ci": {
    "collect": {
      "staticDistDir": "./dist",
      "url": ["/", "/about/", "/dashboard"]
    }
  }
}
</file>

<file path="package.json">
{
  "name": "finetune-erp-frontend-new",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "format": "prettier . --write",
    "format:check": "prettier . --check",
    "preview": "vite preview",
    "test": "vitest run",
    "docs:generate": "jsdoc -c jsdoc.config.json"
  },
  "dependencies": {
    "@headlessui/react": "^2.2.7",
    "@reduxjs/toolkit": "^2.8.2",
    "axios": "^1.9.0",
    "html5-qrcode": "^2.3.8",
    "js-cookie": "^3.0.5",
    "lucide-react": "^0.541.0",
    "prop-types": "^15.8.1",
    "react": "^19.0.0",
    "react-dom": "^19.0.0",
    "react-google-recaptcha": "^3.1.0",
    "react-hot-toast": "^2.5.2",
    "react-icons": "^5.5.0",
    "react-redux": "^9.2.0",
    "react-router-dom": "^7.6.0",
    "redux-persist": "^6.0.0",
    "styled-components": "^6.1.18",
    "swiper": "^11.2.10",
    "use-debounce": "^10.0.6"
  },
  "devDependencies": {
    "@eslint/js": "^9.22.0",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@types/react": "^19.0.10",
    "@types/react-dom": "^19.0.4",
    "@vitejs/plugin-react": "^4.3.4",
    "autoprefixer": "^10.4.21",
    "better-docs": "^2.7.3",
    "eslint": "^9.22.0",
    "eslint-config-prettier": "^10.1.8",
    "eslint-plugin-prettier": "^5.5.4",
    "eslint-plugin-react-hooks": "^5.2.0",
    "eslint-plugin-react-refresh": "^0.4.19",
    "globals": "^16.0.0",
    "jsdoc": "^4.0.4",
    "jsdoc-plugin-typescript": "^3.2.0",
    "jsdom": "^26.1.0",
    "postcss": "^8.5.3",
    "prettier": "^3.6.2",
    "tailwindcss": "^3.4.1",
    "vite": "^6.3.1",
    "vitest": "^3.2.4"
  },
  "overrides": {
    "rimraf": "^5.0.5",
    "glob": "^10.3.10"
  }
}
</file>

<file path="postcss.config.js">
export default {
  plugins: {
    tailwindcss: {},
    autoprefixer: {},
  },
};
</file>

<file path="prettier.config.js">
/** @type {import('prettier').Config} */
export default {
  tabWidth: 2,
  singleQuote: true,
  trailingComma: 'es5',
};
</file>

<file path="public/favicon.svg">
version https://git-lfs.github.com/spec/v1
oid sha256:ec4c2efbb9b457301620371d0d10d3796e7714c27069e15a8e0cac61c3ade79b
size 123
</file>

<file path="public/vite.svg">
version https://git-lfs.github.com/spec/v1
oid sha256:4a748afd443918bb16591c834c401dae33e87861ab5dbad0811c3a3b4a9214fb
size 1497
</file>

<file path="README.md">
# finetune ERP Frontend

React + Vite application providing ERP and e‑commerce interfaces for finetune.store.

![React](https://img.shields.io/badge/React-20232A?logo=react&logoColor=61DAFB)
![Vite](https://img.shields.io/badge/Vite-646CFF?logo=vite&logoColor=FFD62E)
![Redux Toolkit](https://img.shields.io/badge/Redux%20Toolkit-593D88?logo=redux&logoColor=white)
![Tailwind CSS](https://img.shields.io/badge/Tailwind-38B2AC?logo=tailwind-css&logoColor=white)

## Quick start

1. **Prerequisites**: Node.js ≥ 18 and npm.
2. **Install**: `npm install`
3. **Develop**: `npm run dev` → http://localhost:5173
4. **Build**: `npm run build`
5. **Preview build**: `npm run preview`

### Marketing pages

| Route        | Component            |
| ------------ | -------------------- |
| `/`          | `Index.jsx`          |
| `/about`     | `public/About.jsx`   |
| `/contact`   | `public/Contact.jsx` |
| `/locate`    | `public/Locate.jsx`  |
| `/legal`     | `public/Legal.jsx`   |
| `/offers`    | `public/Offers.jsx`  |
| `/careers`   | `public/Careers.jsx` |

## Environment

| Variable                  | Description                                                                      | Example                                           |
| ------------------------- | -------------------------------------------------------------------------------- | ------------------------------------------------- |
| _none_                    | API base URL is hard coded in [`src/utils/Endpoints.js`](src/utils/Endpoints.js) | `https://api.finetune.store` |
| `VITE_RECAPTCHA_SITE_KEY` | Google reCAPTCHA site key used by `ReCaptchaWrapper` in public forms             | `test-site-key`             |

Backend API runs on Railway at `https://api.finetune.store`.

## Scripts

| Script            | Purpose                 |
| ----------------- | ----------------------- |
| `npm run dev`     | start local dev server  |
| `npm run build`   | build production bundle |
| `npm run preview` | preview built assets    |
| `npm run lint`    | run ESLint              |
| `npm test`        | run Vitest suite        |

## Folder structure

```
├── public/               static assets
├── src/                  application source
│   ├── api/              async thunks for API calls
│   ├── components/       reusable UI components
│   ├── pages/            route pages
│   ├── redux/            slices and store
│   └── utils/            constants and helpers
└── docs/                 project documentation
```

### Import aliases

The `@` prefix resolves to the `src` directory. For example:

```js
import Loader from '@/components/common/Loader';
import END_POINTS from '@/utils/Endpoints';
```

## Troubleshooting

1. **Port 5173 already in use** → stop the conflicting process or change the `server.port` in `vite.config.js`.
2. **`npm install` fails** → ensure Node.js ≥ 18.
3. **API requests fail** → confirm the backend at `https://api.finetune.store` is reachable.
4. **Immediate redirect to login** → clear invalid tokens from cookies.
5. **Missing styles** → ensure `src/index.css` imports external CSS (e.g., Swiper) before Tailwind directives and restart Vite after editing config.

## Roadmap

Planned for v1.1:

- Invoice PDF generation
- Lighthouse performance checks
- Updated UI screenshots
- Expanded deployment matrix
</file>

<file path="setupTests.js">
import { vi } from 'vitest';

Object.defineProperty(window, 'matchMedia', {
  writable: true,
  value: vi.fn().mockImplementation((query) => ({
    matches: false,
    media: query,
    onchange: null,
    addListener: vi.fn(),
    removeListener: vi.fn(),
    addEventListener: vi.fn(),
    removeEventListener: vi.fn(),
    dispatchEvent: vi.fn(),
  })),
});

class ResizeObserverMock {
  observe() {}
  unobserve() {}
  disconnect() {}
}
window.ResizeObserver = ResizeObserverMock;
globalThis.ResizeObserver = ResizeObserverMock;

vi.mock('@headlessui/react', async () => {
  const actual = await vi.importActual('@headlessui/react');
  return {
    ...actual,
    Portal: ({ children }) => children,
  };
});
</file>

<file path="src/api/__tests__/baseQuery.test.js">
import { vi, describe, it, expect } from 'vitest';

vi.mock('@reduxjs/toolkit/query/react', () => {
  const fn = vi.fn();
  return { fetchBaseQuery: () => fn, mock: fn };
});
import { mock as mockRaw } from '@reduxjs/toolkit/query/react';

vi.mock('react-hot-toast', () => ({
  __esModule: true,
  default: { error: vi.fn() },
}));
import toast from 'react-hot-toast';

vi.mock('@/redux/slice/authSlice', () => ({
  logout: () => ({ type: 'auth/logout' }),
  setCredentials: (payload) => ({ type: 'auth/setCredentials', payload }),
}));

import { baseQueryWithReauth } from '../baseQuery';

describe('baseQueryWithReauth', () => {
  it('logs out and toasts on refresh failure', async () => {
    mockRaw
      .mockResolvedValueOnce({ error: { status: 401 } })
      .mockResolvedValueOnce({ error: { status: 401 } });
    const dispatch = vi.fn();
    await baseQueryWithReauth(
      { url: '/x' },
      {
        dispatch,
        getState: () => ({ auth: { refreshToken: 'r', user: null } }),
      }
    );
    expect(dispatch).toHaveBeenCalledWith({ type: 'auth/logout' });
    expect(toast.error).toHaveBeenCalledWith(
      'Session expired. Please log in again.'
    );
  });

  it('shows throttle toast on 429', async () => {
    mockRaw.mockResolvedValueOnce({ error: { status: 429 } });
    const dispatch = vi.fn();
    await baseQueryWithReauth(
      { url: '/x' },
      { dispatch, getState: () => ({ auth: {} }) }
    );
    expect(toast.error).toHaveBeenCalledWith(
      'Too many requests. Please try again later.'
    );
  });
});
</file>

<file path="src/api/baseQuery.js">
import { fetchBaseQuery } from '@reduxjs/toolkit/query/react';
import Cookies from 'js-cookie';
import toast from 'react-hot-toast';
import END_POINTS from '@/utils/Endpoints';
import { logout, setCredentials } from '@/redux/slice/authSlice';

const getCookieJSON = (key) => {
  try {
    const value = Cookies.get(key);
    return value ? JSON.parse(value) : null;
  } catch {
    return null;
  }
};

const rawBaseQuery = fetchBaseQuery({
  baseUrl: END_POINTS.API_BASE_URL,
  prepareHeaders: (headers, { getState }) => {
    const token = getState().auth.token || Cookies.get('token');
    if (token) {
      headers.set('authorization', `Bearer ${token}`);
    }
    return headers;
  },
});

export const baseQueryWithReauth = async (args, api, extraOptions) => {
  let result = await rawBaseQuery(args, api, extraOptions);

  if (result.error && result.error.status === 401) {
    const refreshToken =
      api.getState().auth.refreshToken || Cookies.get('refreshToken');
    if (refreshToken) {
      const refreshResult = await rawBaseQuery(
        {
          url: END_POINTS.REFRESH_TOKEN,
          method: 'POST',
          body: { refresh: refreshToken },
        },
        api,
        extraOptions
      );
      if (refreshResult.data?.access) {
        api.dispatch(
          setCredentials({
            user: api.getState().auth.user || getCookieJSON('user'),
            token: refreshResult.data.access,
            refreshToken,
          })
        );
        result = await rawBaseQuery(args, api, extraOptions);
      } else {
        api.dispatch(logout());
        toast.error('Session expired. Please log in again.');
      }
    } else {
      api.dispatch(logout());
      toast.error('Session expired. Please log in again.');
    }
  }
  if (result.error?.status === 429) {
    toast.error('Too many requests. Please try again later.');
  }
  return result;
};

export default rawBaseQuery;
</file>

<file path="src/api/erpApi.js">
import { createApi } from '@reduxjs/toolkit/query/react';
import { baseQueryWithReauth } from './baseQuery';
import END_POINTS from '@/utils/Endpoints';

export const erpApi = createApi({
  reducerPath: 'erpApi',
  baseQuery: baseQueryWithReauth,
  tagTypes: [
    'Brand',
    'Store',
    'Spare',
    'Booking',
    'Product',
    'Variant',
    'Department',
    'Category',
    'SubCategory',
    'Unit',
    'Quality',
    'Log',
    'Issue',
    'OtherIssue',
    'Question',
    'Invoice',
    'Payment',
    'StockLedger',
    'StockEntry',
    'Serial',
    'PriceLog',
    'InventoryConfig',
    'User',
    'SaleInvoice',
  ],
  endpoints: (builder) => ({
    getBrands: builder.query({
      query: () => ({ url: END_POINTS.GET_BRANDS }),
      providesTags: ['Brand'],
    }),
    createBrand: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_BRAND,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Brand'],
    }),
    updateBrand: builder.mutation({
      query: ({ id, body }) => ({
        url: `${END_POINTS.MODIFY_BRAND}/${id}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Brand'],
    }),
    deleteBrand: builder.mutation({
      query: (id) => ({
        url: `${END_POINTS.MODIFY_BRAND}/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Brand'],
    }),
    getStores: builder.query({
      query: (params) => ({ url: END_POINTS.GET_STORES, params }),
      providesTags: ['Store'],
    }),
    createStore: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_STORE,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Store'],
    }),
    updateStore: builder.mutation({
      query: ({ id, ...patch }) => ({
        url: `${END_POINTS.MODIFY_STORE}/${id}`,
        method: 'PUT',
        body: patch,
      }),
      invalidatesTags: ['Store'],
    }),
    deleteStore: builder.mutation({
      query: (id) => ({
        url: `${END_POINTS.MODIFY_STORE}/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Store'],
    }),
    getUsers: builder.query({
      query: (params) => ({ url: END_POINTS.GET_USERS, params }),
      providesTags: ['User'],
    }),
    getSpares: builder.query({
      query: () => ({ url: END_POINTS.GET_SPARES }),
      providesTags: ['Spare'],
    }),
    createSpare: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_SPARE,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Spare'],
    }),
    updateSpare: builder.mutation({
      query: ({ id, ...patch }) => ({
        url: `${END_POINTS.MODIFY_SPARE}/${id}`,
        method: 'PUT',
        body: patch,
      }),
      invalidatesTags: ['Spare'],
    }),
    deleteSpare: builder.mutation({
      query: (id) => ({
        url: `${END_POINTS.MODIFY_SPARE}/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Spare'],
    }),
    getDepartments: builder.query({
      query: () => ({ url: END_POINTS.GET_DEPARTMENTS }),
      providesTags: ['Department'],
    }),
    createDepartment: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_DEPARTMENT,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Department'],
    }),
    updateDepartment: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.MODIFY_DEPARTMENT}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Department'],
    }),
    deleteDepartment: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.MODIFY_DEPARTMENT}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Department'],
    }),
    getCategories: builder.query({
      query: (params) => ({ url: END_POINTS.GET_CATEGORIES, params }),
      providesTags: ['Category'],
    }),
    createCategory: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_CATEGORY,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Category'],
    }),
    updateCategory: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.MODIFY_CATEGORY}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Category'],
    }),
    deleteCategory: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.MODIFY_CATEGORY}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Category'],
    }),
    getSubCategories: builder.query({
      query: (params) => ({ url: END_POINTS.GET_SUBCATEGORIES, params }),
      providesTags: ['SubCategory'],
    }),
    createSubCategory: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_SUBCATEGORY,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['SubCategory'],
    }),
    updateSubCategory: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.MODIFY_SUBCATEGORY}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['SubCategory'],
    }),
    deleteSubCategory: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.MODIFY_SUBCATEGORY}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['SubCategory'],
    }),
    getUnits: builder.query({
      query: () => ({ url: END_POINTS.GET_UNITS }),
      providesTags: ['Unit'],
    }),
    createUnit: builder.mutation({
      query: (body) => ({
        url: END_POINTS.GET_UNITS,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Unit'],
    }),
    updateUnit: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.GET_UNITS}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Unit'],
    }),
    deleteUnit: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.GET_UNITS}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Unit'],
    }),
    getQualities: builder.query({
      query: () => ({ url: END_POINTS.GET_QUALITIES }),
      providesTags: ['Quality'],
    }),
    createQuality: builder.mutation({
      query: (body) => ({
        url: END_POINTS.GET_QUALITIES,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Quality'],
    }),
    updateQuality: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.GET_QUALITIES}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Quality'],
    }),
    deleteQuality: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.GET_QUALITIES}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Quality'],
    }),
    getProducts: builder.query({
      query: (params) => ({ url: END_POINTS.GET_PRODUCTS, params }),
      providesTags: ['Product'],
    }),
    getProductBySlug: builder.query({
      query: (slug) => ({ url: `${END_POINTS.GET_PRODUCTS}/${slug}` }),
      providesTags: ['Product'],
    }),
    createProduct: builder.mutation({
      query: (body) => ({
        url: END_POINTS.GET_PRODUCTS,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Product'],
    }),
    updateProduct: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.GET_PRODUCTS}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Product'],
    }),
    deleteProduct: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.GET_PRODUCTS}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Product'],
    }),
    getVariants: builder.query({
      query: (params) => ({ url: END_POINTS.GET_VARIANTS, params }),
      providesTags: ['Variant'],
    }),
    getVariantBySlug: builder.query({
      query: (slug) => ({ url: `${END_POINTS.GET_VARIANTS}/${slug}` }),
      providesTags: ['Variant'],
    }),
    createVariant: builder.mutation({
      query: (body) => ({
        url: END_POINTS.GET_VARIANTS,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Variant'],
    }),
    updateVariant: builder.mutation({
      query: ({ slug, body }) => ({
        url: `${END_POINTS.GET_VARIANTS}/${slug}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Variant'],
    }),
    deleteVariant: builder.mutation({
      query: (slug) => ({
        url: `${END_POINTS.GET_VARIANTS}/${slug}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Variant'],
    }),

    getBookings: builder.query({
      query: (params) => ({ url: END_POINTS.GET_BOOKINGS, params }),
      providesTags: ['Booking'],
    }),
    createBooking: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_BOOKING,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Booking'],
    }),
    cancelBooking: builder.mutation({
      query: ({ id, reason }) => ({
        url: `${END_POINTS.MODIFY_BOOKING}/${id}`,
        method: 'PATCH',
        body: { status: 'cancelled', reason },
      }),
      invalidatesTags: ['Booking'],
    }),
    updateBookingStatus: builder.mutation({
      query: ({ id, status, reason }) => ({
        url: `${END_POINTS.MODIFY_BOOKING}/${id}`,
        method: 'PATCH',
        body: { status, reason },
      }),
      invalidatesTags: ['Booking'],
    }),
    getIssues: builder.query({
      query: () => ({ url: END_POINTS.GET_ISSUES }),
      providesTags: ['Issue'],
    }),
    createIssue: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_ISSUE,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Issue'],
    }),
    updateIssue: builder.mutation({
      query: ({ id, body }) => ({
        url: `${END_POINTS.MODIFY_ISSUE}/${id}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Issue'],
    }),
    deleteIssue: builder.mutation({
      query: (id) => ({
        url: `${END_POINTS.MODIFY_ISSUE}/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Issue'],
    }),
    getOtherIssues: builder.query({
      query: () => ({ url: END_POINTS.GET_OTHER_ISSUES }),
      providesTags: ['OtherIssue'],
    }),
    createOtherIssue: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_OTHER_ISSUE,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['OtherIssue'],
    }),
    updateOtherIssue: builder.mutation({
      query: ({ id, body }) => ({
        url: `${END_POINTS.MODIFY_OTHER_ISSUE}/${id}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['OtherIssue'],
    }),
    deleteOtherIssue: builder.mutation({
      query: (id) => ({
        url: `${END_POINTS.MODIFY_OTHER_ISSUE}/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['OtherIssue'],
    }),
    getQuestions: builder.query({
      query: (params) => ({ url: END_POINTS.GET_QUESTIONS, params }),
      providesTags: ['Question'],
    }),
    createQuestion: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_QUESTION,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Question'],
    }),
    updateQuestion: builder.mutation({
      query: ({ id, body }) => ({
        url: `${END_POINTS.MODIFY_QUESTION}/${id}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['Question'],
    }),
    deleteQuestion: builder.mutation({
      query: (id) => ({
        url: `${END_POINTS.MODIFY_QUESTION}/${id}`,
        method: 'DELETE',
      }),
      invalidatesTags: ['Question'],
    }),
    getInvoices: builder.query({
      query: () => ({ url: '/api/invoices/' }),
      providesTags: ['Invoice'],
    }),
    createInvoice: builder.mutation({
      query: (body) => ({
        url: '/api/invoices/',
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Invoice'],
    }),
    // TODO(v1.1): Enable invoice PDF once Railway system libraries available
    // getInvoicePdf: builder.query({
    //   query: (id) => ({
    //     url: `/api/invoices/${id}/pdf/`,
    //     responseHandler: (response) => response.blob(),
    //   }),
    // }),
    getPayments: builder.query({
      query: () => ({ url: '/api/payments/' }),
      providesTags: ['Payment'],
    }),
    createPayment: builder.mutation({
      query: (body) => ({
        url: '/api/payments/',
        method: 'POST',
        body,
      }),
      invalidatesTags: ['Payment', 'Invoice'],
    }),
    getLogs: builder.query({
      query: (params) => ({ url: '/api/logs/', params }),
      providesTags: ['Log'],
    }),

    getStockLedgers: builder.query({
      query: (params) => ({ url: END_POINTS.GET_STOCK_LEDGERS, params }),
      providesTags: ['StockLedger'],
    }),
    getStockEntries: builder.query({
      query: (params) => ({ url: END_POINTS.GET_STOCK_ENTRIES, params }),
      providesTags: ['StockEntry'],
    }),
    createStockEntry: builder.mutation({
      query: (body) => ({
        url: END_POINTS.MODIFY_STOCK_ENTRY,
        method: 'POST',
        body,
      }),
      invalidatesTags: ['StockLedger', 'StockEntry'],
    }),
    getSerials: builder.query({
      query: (params) => ({ url: END_POINTS.GET_SERIALS, params }),
      providesTags: ['Serial'],
    }),
    updateSerial: builder.mutation({
      query: ({ id, ...patch }) => ({
        url: `${END_POINTS.MODIFY_SERIAL}/${id}`,
        method: 'PUT',
        body: patch,
      }),
      invalidatesTags: ['Serial'],
    }),
    getPriceLogs: builder.query({
      query: (params) => ({ url: END_POINTS.GET_PRICE_LOGS, params }),
      providesTags: ['PriceLog'],
    }),
    getInventoryConfig: builder.query({
      query: () => ({ url: END_POINTS.GET_INVENTORY_CONFIG }),
      providesTags: ['InventoryConfig'],
    }),
    updateInventoryConfig: builder.mutation({
      query: ({ id, ...body }) => ({
        url: `${END_POINTS.MODIFY_INVENTORY_CONFIG}/${id}`,
        method: 'PUT',
        body,
      }),
      invalidatesTags: ['InventoryConfig'],
    }),

    getSaleInvoices: builder.query({
      query: (params) => ({ url: END_POINTS.GET_SALE_INVOICES, params }),
      providesTags: ['SaleInvoice']
    }),
    createSaleInvoice: builder.mutation({
      query: (body) => ({
        url: END_POINTS.CREATE_SALE_INVOICE,
        method: 'POST',
        body
      }),
      invalidatesTags: ['SaleInvoice']
    }),
    getSaleInvoicePdf: builder.query({
      query: (id) => ({
        url: `${END_POINTS.GET_SALE_INVOICE_PDF}/${id}/pdf/`,
        responseHandler: (response) => response.blob()
      })
    }),
    searchSaleProducts: builder.query({
      query: (params) => ({ url: END_POINTS.SEARCH_SALE_PRODUCTS, params })
    })
  })
});

export const {
  useGetBrandsQuery,
  useCreateBrandMutation,
  useUpdateBrandMutation,
  useDeleteBrandMutation,
  useGetUsersQuery,
  useGetStoresQuery,
  useCreateStoreMutation,
  useUpdateStoreMutation,
  useDeleteStoreMutation,
  useGetSparesQuery,
  useCreateSpareMutation,
  useUpdateSpareMutation,
  useDeleteSpareMutation,
  useGetDepartmentsQuery,
  useCreateDepartmentMutation,
  useUpdateDepartmentMutation,
  useDeleteDepartmentMutation,
  useGetCategoriesQuery,
  useCreateCategoryMutation,
  useUpdateCategoryMutation,
  useDeleteCategoryMutation,
  useGetSubCategoriesQuery,
  useCreateSubCategoryMutation,
  useUpdateSubCategoryMutation,
  useDeleteSubCategoryMutation,
  useGetUnitsQuery,
  useCreateUnitMutation,
  useUpdateUnitMutation,
  useDeleteUnitMutation,
  useGetQualitiesQuery,
  useCreateQualityMutation,
  useUpdateQualityMutation,
  useDeleteQualityMutation,
  useGetProductsQuery,
  useGetProductBySlugQuery,
  useCreateProductMutation,
  useUpdateProductMutation,
  useDeleteProductMutation,
  useGetVariantsQuery,
  useGetVariantBySlugQuery,
  useCreateVariantMutation,
  useUpdateVariantMutation,
  useDeleteVariantMutation,
  useGetBookingsQuery,
  useCreateBookingMutation,
  useCancelBookingMutation,
  useUpdateBookingStatusMutation,
  useGetIssuesQuery,
  useCreateIssueMutation,
  useUpdateIssueMutation,
  useDeleteIssueMutation,
  useGetOtherIssuesQuery,
  useCreateOtherIssueMutation,
  useUpdateOtherIssueMutation,
  useDeleteOtherIssueMutation,
  useGetQuestionsQuery,
  useCreateQuestionMutation,
  useUpdateQuestionMutation,
  useDeleteQuestionMutation,
  useGetInvoicesQuery,
  useCreateInvoiceMutation,
  useGetInvoicePdfQuery,
  useGetPaymentsQuery,
  useCreatePaymentMutation,
  useGetLogsQuery,
  useGetStockLedgersQuery,
  useGetStockEntriesQuery,
  useCreateStockEntryMutation,
  useGetSerialsQuery,
  useUpdateSerialMutation,
  useGetPriceLogsQuery,
  useGetInventoryConfigQuery,
  useUpdateInventoryConfigMutation,
  useGetSaleInvoicesQuery,
  useCreateSaleInvoiceMutation,
  useGetSaleInvoicePdfQuery,
  useSearchSaleProductsQuery,
} = erpApi;
</file>

<file path="src/api/store.js">
import { createAsyncThunk } from '@reduxjs/toolkit';
import { baseQueryWithReauth } from './baseQuery';
import END_POINTS from '@/utils/Endpoints';

export const createStore = createAsyncThunk(
  'store/createStore',
  async (requestBody, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: `${END_POINTS.MODIFY_STORE}`, method: 'POST', body: requestBody },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const updateStore = createAsyncThunk(
  'store/updateStore',
  async (requestBody, thunkAPI) => {
    const { id } = requestBody;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_STORE}/${id}`,
        method: 'PUT',
        body: requestBody,
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const getStores = createAsyncThunk(
  'store/getStores',
  async (params, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: `${END_POINTS.GET_STORES}`, method: 'GET', params },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const modifyStoreStatus = createAsyncThunk(
  'store/modifyStoreStatus',
  async (requestBody, thunkAPI) => {
    const { id } = requestBody;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_STORE}/${id}`,
        method: 'PATCH',
        body: requestBody,
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const softDeleteStore = createAsyncThunk(
  'store/softDeleteStore',
  async (id, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: `${END_POINTS.MODIFY_STORE}/${id}`, method: 'DELETE' },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const assignBranchHeadToStore = createAsyncThunk(
  'store/assignBranchHeadToStore',
  async (data, thunkAPI) => {
    const { storeId, userId } = data;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_STORE}/${storeId}/assign-branch-head`,
        method: 'POST',
        body: { user_id: userId },
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const unassignBranchHeadFromStore = createAsyncThunk(
  'store/unassignBranchHeadFromStore',
  async (data, thunkAPI) => {
    const { storeId, userId } = data;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_STORE}/${storeId}/unassign-branch-head`,
        method: 'POST',
        body: { user_id: userId },
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);
</file>

<file path="src/api/user.js">
import { createAsyncThunk } from '@reduxjs/toolkit';
import { baseQueryWithReauth } from './baseQuery';
import END_POINTS from '@/utils/Endpoints';

export const createUser = createAsyncThunk(
  'user/createUser',
  async (requestBody, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: `${END_POINTS.MODIFY_USER}`, method: 'POST', body: requestBody },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const updateUser = createAsyncThunk(
  'user/updateUser',
  async (requestBody, thunkAPI) => {
    const { id } = requestBody;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_USER}/${id}`,
        method: 'PUT',
        body: requestBody,
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const modifyUserStatus = createAsyncThunk(
  'store/modifyUserStatus',
  async (requestBody, thunkAPI) => {
    const { id } = requestBody;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_USER}/${id}`,
        method: 'PATCH',
        body: requestBody,
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const softDeleteUser = createAsyncThunk(
  'store/softDeleteUser',
  async (id, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: `${END_POINTS.MODIFY_USER}/${id}`, method: 'DELETE' },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const assignStoreToUser = createAsyncThunk(
  'user/assignStoreToUser',
  async (data, thunkAPI) => {
    const { userId, store } = data;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_USER}/${userId}`,
        method: 'PATCH',
        body: { store },
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);

export const unassignStoreFromUser = createAsyncThunk(
  'user/unassignStoreFromUser',
  async (data, thunkAPI) => {
    const { userId } = data;
    const result = await baseQueryWithReauth(
      {
        url: `${END_POINTS.MODIFY_USER}/${userId}`,
        method: 'PATCH',
        body: { store: null },
      },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(result.error.data || result.error.status);
    }
    return result.data;
  }
);
</file>

<file path="src/App.jsx">
import { BrowserRouter, Routes, Route, Navigate } from 'react-router-dom';
import { lazy, Suspense } from 'react';
import { useAppSelector } from './redux/hook';
import { selectAuthToken, selectAuthRole } from './redux/slice/authSlice';
import { useLocation } from 'react-router-dom';
import { Toaster } from 'react-hot-toast';

const PublicLayout = lazy(() => import('./components/layout/PublicLayout'));
const TeamLogin = lazy(() => import('./pages/internal/TeamLogin'));
const Signup = lazy(() => import('./pages/customers/Signup'));
const Login = lazy(() => import('./pages/customers/Login'));
const Account = lazy(() => import('./pages/customers/Account'));
const Orders = lazy(() => import('./pages/customers/Orders'));
const Dashboard = lazy(
  () => import('./components/dashboard/layout/DashboardLayout')
);
const User = lazy(() => import('./pages/internal/User'));
const GiveawayRedemption = lazy(
  () => import('./pages/internal/GiveawayRedemption')
);
const Store = lazy(() => import('./pages/internal/Store'));
const BrandDashboard = lazy(() => import('./pages/internal/BrandDashboard'));
const BookingsDashboard = lazy(
  () => import('./pages/internal/BookingsDashboard')
);
const Settings = lazy(() => import('./pages/internal/Settings'));
const ProductsDashboard = lazy(
  () => import('./pages/internal/ProductsDashboard')
);
const VariantsDashboard = lazy(
  () => import('./pages/internal/VariantsDashboard')
);
const TaxonomyDashboard = lazy(
  () => import('./pages/internal/TaxonomyDashboard')
);
const UnitsDashboard = lazy(() => import('./pages/internal/UnitsDashboard'));
const QualitiesDashboard = lazy(
  () => import('./pages/internal/QualitiesDashboard')
);
const LogsDashboard = lazy(() => import('./pages/internal/LogsDashboard'));
const FocusLayout = lazy(() => import('./components/layout/FocusLayout'));
const Workledger = lazy(() => import('./pages/internal/Workledger'));
const WorkledgerDetails = lazy(
  () => import('./pages/internal/WorkledgerDetails')
);
const IndexPage = lazy(() => import('./pages/Index'));
const About = lazy(() => import('./pages/public/About'));
const Contact = lazy(() => import('./pages/public/Contact'));
const Locate = lazy(() => import('./pages/public/Locate'));
const Legal = lazy(() => import('./pages/public/Legal'));
const Careers = lazy(() => import('./pages/public/Careers'));
const Offers = lazy(() => import('./pages/public/Offers'));
const Repair = lazy(() => import('./pages/public/Repair'));
const Support = lazy(() => import('./pages/public/Support'));
const SearchPage = lazy(() => import('./pages/public/Search'));
const ScheduleCall = lazy(() => import('./pages/internal/ScheduleCall'));
const Stores = lazy(() => import('./pages/internal/Stores'));
const StoreDetails = lazy(() => import('./pages/internal/StoreDetails'));
const Spares = lazy(() => import('./pages/internal/Spares'));
const Bookings = lazy(() => import('./pages/internal/Bookings'));
const IssuesDashboard = lazy(() => import('./pages/internal/IssuesDashboard'));
const OtherIssuesDashboard = lazy(
  () => import('./pages/internal/OtherIssuesDashboard')
);
const QuestionsDashboard = lazy(
  () => import('./pages/internal/QuestionsDashboard')
);
const Shop = lazy(() => import('./pages/ecommerce/Shop'));
const DepartmentsPage = lazy(() => import('./pages/ecommerce/DepartmentsPage'));
const DepartmentCategoriesPage = lazy(
  () => import('./pages/ecommerce/DepartmentCategoriesPage')
);
const CategoryPage = lazy(() => import('./pages/ecommerce/CategoryPage'));
const ProductDetail = lazy(() => import('./pages/ecommerce/ProductDetail'));
const CartPage = lazy(() => import('./pages/ecommerce/CartPage'));
const Partners = lazy(() => import('./pages/ecommerce/Partners'));
import CreateSaleInvoice from './components/Sales/CreateSaleInvoice';
const HelpCentre = lazy(() => import('./pages/ecommerce/HelpCentre'));

function AppContent() {
  const token = useAppSelector(selectAuthToken);
  const role = useAppSelector(selectAuthRole);
  const location = useLocation();
  const isDashboard = location.pathname.startsWith('/dashboard');

  const routes = (
    <Suspense fallback={<div className="p-4 text-center">Loading...</div>}>
      <Routes>
        {/* Public layout wrapper */}
        <Route element={<PublicLayout />}>
          <Route index element={<IndexPage />} />
          <Route path="shop" element={<Shop />} />
          <Route path="repair" element={<Repair />} />
          <Route path="support" element={<Support />} />
          <Route path="search" element={<SearchPage />} />
          <Route path="product/:slug" element={<ProductDetail />} />
          <Route path="departments" element={<DepartmentsPage />} />
          <Route
            path="departments/:deptSlug/categories"
            element={<DepartmentCategoriesPage />}
          />
          <Route
            path="departments/:deptSlug/:catSlug/:subcatSlug/products"
            element={<CategoryPage />}
          />
          <Route path="cart" element={<CartPage />} />
          <Route path="partners" element={<Partners />} />
          <Route path="help" element={<HelpCentre />} />
          <Route path="legal" element={<Legal />} />
          <Route path="about" element={<About />} />
          <Route path="contact" element={<Contact />} />
          <Route path="locate" element={<Locate />} />
          <Route path="offers" element={<Offers />} />
          <Route path="careers" element={<Careers />} />
          <Route path="stores" element={<Stores />} />
          <Route path="stores/:id" element={<StoreDetails />} />
          <Route path="spares" element={<Spares />} />
          <Route path="bookings" element={<Bookings />} />
          <Route path="schedule-call" element={<ScheduleCall />} />
          <Route
            path="account"
            element={token ? <Account /> : <Navigate to="/login" replace />}
          />
          <Route
            path="orders"
            element={token ? <Orders /> : <Navigate to="/login" replace />}
          />
        </Route>

        {/* Auth routes (outside PublicLayout) */}
        <Route
          path="/teamlogin"
          element={token ? <Navigate to="/dashboard" /> : <TeamLogin />}
        />
        <Route path="/signup" element={<Signup />} />
        <Route path="/login" element={<Login />} />

        {/* Dashboard & internal routes */}
        <Route
          path="/workledger/*"
          element={
            token &&
            ['system_admin', 'branch_head', 'advisor'].includes(role) ? (
              <FocusLayout title="Workledger" />
            ) : (
              <Navigate to="/teamlogin" />
            )
          }
        >
          <Route index element={<Workledger />} />
          <Route path="details/:id" element={<WorkledgerDetails />} />
        </Route>

        <Route
          path="/giveaway-redemption"
          element={
            token &&
            ['system_admin', 'branch_head', 'advisor'].includes(role) ? (
              <FocusLayout title="Giveaway Redemption" />
            ) : (
              <Navigate to="/teamlogin" />
            )
          }
        >
          <Route index element={<GiveawayRedemption />} />
        </Route>

        <Route
          path="/dashboard"
          element={token ? <Dashboard /> : <Navigate to="/teamlogin" />}
        >
          {['system_admin'].includes(role) && (
            <>
              <Route path="users" element={<User />} />
              <Route path="stores" element={<Store />} />
              <Route path="brands" element={<BrandDashboard />} />
              <Route path="products" element={<ProductsDashboard />} />
              <Route path="variants" element={<VariantsDashboard />} />
              <Route path="taxonomy" element={<TaxonomyDashboard />} />
              <Route path="units" element={<UnitsDashboard />} />
              <Route path="qualities" element={<QualitiesDashboard />} />
              <Route path="bookings" element={<BookingsDashboard />} />
              <Route path="repairs">
                <Route path="issues" element={<IssuesDashboard />} />
                <Route path="other-issues" element={<OtherIssuesDashboard />} />
                <Route path="questions" element={<QuestionsDashboard />} />
              </Route>
              <Route path="settings" element={<Settings />} />
              <Route path="logs" element={<LogsDashboard />} />
              <Route path="sales/create" element={<CreateSaleInvoice />} />
            </>
          )}
        </Route>
      </Routes>
    </Suspense>
  );

  return isDashboard ? routes : routes;
}

export default function App() {
  return (
    <BrowserRouter>
      <Toaster
        toastOptions={{
          className:
            'bg-surface dark:bg-primary text-primary dark:text-surface',
        }}
      />
      <AppContent />
    </BrowserRouter>
  );
}
</file>

<file path="src/assets/logo trnsp svg.svg">
version https://git-lfs.github.com/spec/v1
oid sha256:20d0fb930f9429bea906adb5a79a988819bd3ca4b0d5f4b7b726ab7ed0b8856a
size 1616048
</file>

<file path="src/assets/logo.svg">
version https://git-lfs.github.com/spec/v1
oid sha256:7dd8d65af6201ee7532cb53c5aec12a4b8b31095da976c181347c06f5d6781c8
size 151304
</file>

<file path="src/assets/react.svg">
version https://git-lfs.github.com/spec/v1
oid sha256:35ef61ed53b323ae94a16a8ec659b3d0af3880698791133f23b084085ab1c2e5
size 4126
</file>

<file path="src/components/__tests__/invoiceForm.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import InvoiceForm from '../InvoiceForm';

const createMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));
vi.mock('../../api/erpApi', () => ({
  useCreateInvoiceMutation: () => [createMock],
}));

test('calculates total and submits', () => {
  render(<InvoiceForm bookingId={1} />);
  fireEvent.change(screen.getByPlaceholderText('Description'), {
    target: { value: 'Item' },
  });
  fireEvent.change(screen.getByPlaceholderText('HSN'), {
    target: { value: '1234' },
  });
  const numberInputs = screen.getAllByRole('spinbutton');
  fireEvent.change(numberInputs[1], { target: { value: '100' } });
  expect(screen.getByText('Total: 118.00')).toBeTruthy();
  fireEvent.click(screen.getByText('Save Invoice'));
  expect(createMock).toHaveBeenCalled();
});
</file>

<file path="src/components/__tests__/myBookings.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import MyBookings from '../MyBookings';

const cancelMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });

vi.mock('../../api/erpApi', () => ({
  useCancelBookingMutation: () => [cancelMock],
}));

test('cancel modal requires reason', () => {
  render(<MyBookings bookings={[{ id: 1, status: 'pending' }]} />);
  fireEvent.click(screen.getByText('Cancel'));
  fireEvent.click(screen.getByText('Submit'));
  expect(cancelMock).not.toHaveBeenCalled();
  fireEvent.change(screen.getByPlaceholderText('Reason'), {
    target: { value: 'cannot attend' },
  });
  fireEvent.click(screen.getByText('Submit'));
  expect(cancelMock).toHaveBeenCalledWith({ id: 1, reason: 'cannot attend' });
});
</file>

<file path="src/components/__tests__/notificationsPanel.test.jsx">
import { render, screen } from '@testing-library/react';
import { configureStore } from '@reduxjs/toolkit';
import { Provider } from 'react-redux';
import NotificationsPanel from '../common/NotificationsPanel';
import notificationsReducer, {
  addNotification,
} from '@/redux/slice/notificationsSlice';
import { describe, it, expect } from 'vitest';

describe('NotificationsPanel', () => {
  it('renders notifications from store', () => {
    const store = configureStore({
      reducer: { notifications: notificationsReducer },
    });
    store.dispatch(
      addNotification({
        id: 1,
        message: 'hello',
        read: false,
        timestamp: 'now',
      })
    );
    render(
      <Provider store={store}>
        <NotificationsPanel />
      </Provider>
    );
    expect(screen.getByText('hello')).toBeTruthy();
  });
});
</file>

<file path="src/components/__tests__/receiptForm.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import ReceiptForm from '../ReceiptForm';

const payMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));
vi.mock('../../api/erpApi', () => ({
  useCreatePaymentMutation: () => [payMock],
}));

test('submits payment', () => {
  render(<ReceiptForm invoiceId={1} />);
  fireEvent.change(screen.getByPlaceholderText('Amount'), {
    target: { value: '50' },
  });
  fireEvent.click(screen.getByText('Record Payment'));
  expect(payMock).toHaveBeenCalled();
});
</file>

<file path="src/components/common/Button.jsx">
import { forwardRef } from 'react';
import { Link } from 'react-router-dom';
import PropTypes from 'prop-types';

/**
 * Reusable Button component with consistent styling and accessibility
 * 
 * @component
 * @example
 * // Primary button
 * <Button variant="primary" size="lg">Get Started</Button>
 * 
 * // Secondary button as link
 * <Button variant="secondary" to="/shop">Shop Now</Button>
 * 
 * // Small outline button
 * <Button variant="outline" size="sm" onClick={handleClick}>Learn More</Button>
 */
const Button = forwardRef(({ 
  children, 
  variant = 'primary', 
  size = 'md', 
  to,
  href,
  className = '',
  disabled = false,
  ...props 
}, ref) => {
  // Size variants with 44px minimum touch target
  const sizeClasses = {
    sm: 'px-4 py-2 text-sm min-h-[44px]',
    md: 'px-6 py-3 text-base min-h-[44px]',
    lg: 'px-8 py-4 text-lg min-h-[44px]',
  };

  // Style variants
  const variantClasses = {
    primary: 'bg-primary text-surface hover:bg-secondary hover:text-primary',
    secondary: 'border border-surface/30 text-surface hover:bg-surface/10',
    outline: 'border-2 border-primary text-primary hover:bg-primary hover:text-surface',
  };

  // Base classes
  const baseClasses = `
    inline-flex items-center justify-center
    rounded-lg font-semibold
    transition-colors duration-200
    focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2
    disabled:opacity-50 disabled:cursor-not-allowed
    ${sizeClasses[size]}
    ${variantClasses[variant]}
    ${className}
  `.trim().replace(/\s+/g, ' ');

  // Render as Link if 'to' prop is provided
  if (to) {
    return (
      <Link
        ref={ref}
        to={to}
        className={baseClasses}
        {...props}
      >
        {children}
      </Link>
    );
  }

  // Render as anchor if 'href' prop is provided
  if (href) {
    return (
      <a
        ref={ref}
        href={href}
        className={baseClasses}
        {...props}
      >
        {children}
      </a>
    );
  }

  // Render as button
  return (
    <button
      ref={ref}
      className={baseClasses}
      disabled={disabled}
      {...props}
    >
      {children}
    </button>
  );
});

Button.displayName = 'Button';

Button.propTypes = {
  children: PropTypes.node.isRequired,
  variant: PropTypes.oneOf(['primary', 'secondary', 'outline']),
  size: PropTypes.oneOf(['sm', 'md', 'lg']),
  to: PropTypes.string,
  href: PropTypes.string,
  className: PropTypes.string,
  disabled: PropTypes.bool,
};

export default Button;
</file>

<file path="src/components/common/Loader.jsx">
import loader from '@/assets/images/loader.gif';

/**
 * Loader component displays a centered loading spinner with animation.
 *
 * @component
 * @description Renders a full-screen overlay with a loading GIF and text.
 * Used throughout the application to indicate async operations in progress.
 * Supports dark mode with theme-aware background and text colors.
 *
 * @returns {JSX.Element} A centered loading indicator overlay
 *
 * @example
 * // Display loader during data fetching
 * {isLoading && <Loader />}
 */
export default function Loader() {
  return (
    <div className="absolute inset-0 z-10 flex items-center justify-center bg-surface/60 dark:bg-primary/60">
      <div className="text-center">
        <img src={loader} alt="loading..." className="w-20 h-20" />
        <h2 className="mt-2 text-primary dark:text-surface">Loading...</h2>
      </div>
    </div>
  );
}
</file>

<file path="src/components/common/Logo.jsx">
import { Link } from 'react-router-dom';

function Logo() {
  return (
    <Link to="/" className="flex items-center">
      <span className="text-heading-lg font-bold text-primary/70 dark:text-surface/70">
        fine
      </span>
      <span className="text-heading-lg font-bold text-secondary ml-[-2px]">
        tune
      </span>
      <span className="text-body-sm text-primary/50 dark:text-surface/50 ml-[-1px]">
        .store
      </span>
    </Link>
  );
}

export default Logo;
</file>

<file path="src/components/common/NotificationsPanel.jsx">
import { useAppSelector } from '@/redux/hook';

function NotificationsPanel() {
  const items = useAppSelector((state) => state.notifications.items);
  return (
    <div className="absolute right-0 mt-2 w-64 bg-white border border-keyline rounded shadow-md max-h-64 overflow-y-auto">
      {items.length === 0 && (
        <div className="p-4 text-sm text-gray-500">No notifications</div>
      )}
      {items.map((n) => (
        <div
          key={n.id}
          className="p-2 text-sm border-b border-keyline last:border-none"
        >
          {n.message}
        </div>
      ))}
    </div>
  );
}

export default NotificationsPanel;
</file>

<file path="src/components/common/PageSection.jsx">
import {
  useScrollMode,
  SECTION_SLIDER_MODE,
} from '@/components/layout/ScrollModeContext';
import useDevice from '@/hooks/useDevice';

export default function PageSection({
  children,
  className = '',
  style = {},
  ...props
}) {
  const { mode } = useScrollMode();
  const { isMobile } = useDevice();

  const isSliderMode = mode === SECTION_SLIDER_MODE;
  const height = isSliderMode ? 'h-full' : 'min-h-screen';

  const reelPadding =
    isSliderMode && isMobile ? 'pb-[var(--bottomnav-h,0px)]' : '';

  return (
    <section
      className={`w-full ${height} ${reelPadding} ${className}`}
      style={style}
      {...props}
    >
      {children}
    </section>
  );
}
</file>

<file path="src/components/common/ReCaptchaWrapper.jsx">
import { forwardRef } from 'react';
import ReCAPTCHA from 'react-google-recaptcha';

const ReCaptchaWrapper = forwardRef(function ReCaptchaWrapper(props, ref) {
  const sitekey = import.meta.env.VITE_RECAPTCHA_SITE_KEY;
  if (!sitekey) {
    console.error('Missing reCAPTCHA sitekey');
    return null;
  }
  return <ReCAPTCHA ref={ref} sitekey={sitekey} {...props} />;
});

export default ReCaptchaWrapper;
</file>

<file path="src/components/dashboard/components/CardItem.jsx">
import { Link } from 'react-router-dom';
import { Lock } from 'lucide-react';
import toast from 'react-hot-toast';

function CardItem({ title = 'Feature', icon, disabled = false, to }) {
  const content = (
    <div
      role="button"
      tabIndex={0}
      aria-disabled={disabled}
      onClick={disabled ? () => toast('Coming soon') : undefined}
      onKeyDown={
        disabled
          ? (e) => {
              if (e.key === 'Enter') toast('Coming soon');
            }
          : undefined
      }
      className={`rounded-2xl p-4 shadow-sm flex items-center justify-between bg-surface dark:bg-primary transition duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-keyline ${disabled ? 'opacity-70 cursor-not-allowed' : 'hover:scale-[1.01]'}`}
    >
      <h3 className="text-body-lg font-semibold text-primary dark:text-surface">
        {title}
      </h3>
      <div className="text-primary/40 dark:text-surface/40">
        {icon || <Lock size={28} />}
      </div>
    </div>
  );

  if (!disabled && to) {
    return <Link to={to}>{content}</Link>;
  }

  return content;
}

export default CardItem;
</file>

<file path="src/components/dashboard/layout/DashboardBottomNav.jsx">
import React, { useState } from 'react';
import { Link, useLocation, useNavigate } from 'react-router-dom';
import {
  HiOutlineComputerDesktop,
  HiOutlineCog,
  HiOutlineBuildingStorefront,
  HiOutlineUsers,
  HiOutlineGift,
  HiOutlineTag,
  HiOutlineCube,
  HiOutlineSquares2X2,
  HiOutlineArrowRightOnRectangle,
  HiOutlineBars3,
  HiOutlineXMark,
  HiOutlineEllipsisHorizontal,
} from 'react-icons/hi2';
import { useAppDispatch } from '@/redux/hook';
import { logoutUser } from '@/redux/slice/authSlice';

export default function DashboardBottomNav({ role, navOpen, setNavOpen }) {
  const { pathname } = useLocation();
  const dispatch = useAppDispatch();
  const navigate = useNavigate();
  const [moreOpen, setMoreOpen] = useState(false);

  const handleLogout = () => {
    dispatch(logoutUser()).finally(() => {
      navigate('/teamlogin');
    });
  };

  const adminNavItems = [
    {
      to: '/dashboard',
      icon: <HiOutlineComputerDesktop size={18} />,
      label: 'Dashboard',
    },
    {
      to: '/dashboard/settings',
      icon: <HiOutlineCog size={18} />,
      label: 'Settings',
    },
    {
      to: '/dashboard/stores',
      icon: <HiOutlineBuildingStorefront size={18} />,
      label: 'Stores',
    },
    {
      to: '/dashboard/brands',
      icon: <HiOutlineTag size={18} />,
      label: 'Brands',
    },
    {
      to: '/dashboard/products',
      icon: <HiOutlineCube size={18} />,
      label: 'Products',
    },
    {
      to: '/dashboard/variants',
      icon: <HiOutlineSquares2X2 size={18} />,
      label: 'Variants',
    },
    {
      to: '/dashboard/users',
      icon: <HiOutlineUsers size={18} />,
      label: 'Users',
    },
    {
      to: '/giveaway-redemption',
      icon: <HiOutlineGift size={18} />,
      label: 'Giveaway',
    },
  ];

  const allNavItems = {
    system_admin: adminNavItems,
    branch_head: [
      {
        to: '/dashboard',
        icon: <HiOutlineComputerDesktop size={18} />,
        label: 'Dashboard',
      },
      {
        to: '/dashboard/settings',
        icon: <HiOutlineCog size={18} />,
        label: 'Settings',
      },
      {
        to: '/dashboard/stores',
        icon: <HiOutlineBuildingStorefront size={18} />,
        label: 'Stores',
      },
    ],
    advisor: [
      {
        to: '/dashboard',
        icon: <HiOutlineComputerDesktop size={18} />,
        label: 'Dashboard',
      },
      {
        to: '/dashboard/stores',
        icon: <HiOutlineBuildingStorefront size={18} />,
        label: 'Stores',
      },
    ],
  };

  const navItems = allNavItems[role] || [];
  const visibleItems = navItems.slice(0, 5);
  const extraItems = navItems.slice(5);

  return (
    <>
      <nav
        aria-label="Dashboard navigation"
        className={`fixed bottom-0 left-0 right-0 z-40 bg-white border-t border-keyline transition-transform duration-300 ${
          navOpen ? 'translate-y-0' : 'translate-y-full'
        }`}
      >
        <div className="grid grid-cols-3 md:grid-cols-6 gap-2 p-2">
          {visibleItems.map(({ to, icon, label }) => (
            <Link
              key={to}
              to={to}
              aria-label={label}
              className={`flex flex-col items-center justify-center h-16 rounded text-xs font-medium ${
                pathname === to ? 'text-keyline' : 'text-gray-700'
              } hover:text-keyline`}
              onClick={() => setMoreOpen(false)}
            >
              {icon}
              <span className="mt-1">{label}</span>
            </Link>
          ))}
          {extraItems.length > 0 && (
            <button
              type="button"
              aria-label="More"
              onClick={() => setMoreOpen(!moreOpen)}
              className="flex flex-col items-center justify-center h-16 rounded text-xs font-medium text-gray-700 hover:text-keyline"
            >
              <HiOutlineEllipsisHorizontal size={18} />
              <span className="mt-1">More</span>
            </button>
          )}
          <button
            type="button"
            onClick={handleLogout}
            aria-label="Logout"
            className="flex flex-col items-center justify-center h-16 rounded text-xs font-medium text-gray-700 hover:text-keyline"
          >
            <HiOutlineArrowRightOnRectangle size={18} />
            <span className="mt-1">Logout</span>
          </button>
        </div>
        {moreOpen && (
          <div className="absolute bottom-20 left-0 right-0 mx-auto max-w-xs bg-white border border-keyline rounded shadow p-2">
            {extraItems.map(({ to, icon, label }) => (
              <Link
                key={to}
                to={to}
                className={`flex items-center gap-2 p-2 rounded ${
                  pathname === to ? 'text-keyline' : 'text-gray-700'
                } hover:text-keyline`}
                onClick={() => setMoreOpen(false)}
              >
                {icon}
                <span>{label}</span>
              </Link>
            ))}
          </div>
        )}
      </nav>

      <button
        type="button"
        onClick={() => setNavOpen(!navOpen)}
        aria-label="Toggle navigation"
        aria-expanded={navOpen}
        className="fixed bottom-4 right-4 z-50 p-3 bg-white border border-keyline rounded-full shadow focus:outline-none focus:ring-2 focus:ring-keyline"
      >
        {navOpen ? <HiOutlineXMark size={20} /> : <HiOutlineBars3 size={20} />}
      </button>
    </>
  );
}
</file>

<file path="src/components/dashboard/layout/DashboardLayout.jsx">
import React, { useState } from 'react';
import { Outlet, useLocation } from 'react-router-dom';
import DashboardBottomNav from './DashboardBottomNav';
import AdminDashboard from '../../../pages/internal/AdminDashboard';
import BranchHeadDashboard from '../../../pages/internal/BranchHeadDashboard';
import AdvisorDashboard from '../../../pages/internal/AdvisorDashboard';
import DashboardNavbar from './DashboardNavbar';
import { useAppSelector } from '@/redux/hook';
import { selectAuthRole, selectAuthStatus } from '@/redux/slice/authSlice';

function Dashboard() {
  const role = useAppSelector(selectAuthRole);
  const status = useAppSelector(selectAuthStatus);
  const location = useLocation();
  const isExactDashboard = location.pathname === '/dashboard';
  const [navOpen, setNavOpen] = useState(true);

  // Show spinner if token is not yet loaded from storage
  const isLoading = status === 'loading';

  const renderDashboard = () => {
    switch (role) {
      case 'system_admin':
        return <AdminDashboard />;
      case 'branch_head':
        return <BranchHeadDashboard />;
      case 'advisor':
        return <AdvisorDashboard />;
      default:
        return (
          <p className="text-center text-red-500">
            Invalid role: {role || 'none'}
          </p>
        );
    }
  };

  return (
    <>
      <DashboardNavbar />
      <main className="min-h-screen p-6 bg-gray-50 mt-16 pb-[92px]">
        {isLoading ? (
          <div className="flex justify-center items-center h-full">
            <div className="animate-spin rounded-full h-6 w-6 border-t-2 border-gray-500"></div>
            <p className="ml-2">Loading...</p>
          </div>
        ) : (
          <>
            {isExactDashboard && renderDashboard()}
            <Outlet />
          </>
        )}
      </main>
      <DashboardBottomNav
        role={role || 'guest'}
        navOpen={navOpen}
        setNavOpen={setNavOpen}
      />
    </>
  );
}

export default Dashboard;
</file>

<file path="src/components/dashboard/layout/DashboardNavbar.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import {
  HiOutlineUserCircle,
  HiOutlineArrowRightOnRectangle,
  HiOutlineBell,
} from 'react-icons/hi2';
import { useAppDispatch, useAppSelector } from '@/redux/hook';
import {
  selectAuthUser,
  selectAuthRole,
  logoutUser,
} from '@/redux/slice/authSlice';
import Logo from '../../common/Logo';
import NotificationsPanel from '../../common/NotificationsPanel';

function DashboardNavbar() {
  const user = useAppSelector(selectAuthUser);
  const role = useAppSelector(selectAuthRole);
  const first_name = user?.first_name;
  const dispatch = useAppDispatch();
  const navigate = useNavigate();
  const [menuOpen, setMenuOpen] = useState(false);
  const [notifOpen, setNotifOpen] = useState(false);

  const handleLogout = () => {
    dispatch(logoutUser()).finally(() => {
      navigate('/teamlogin');
    });
  };

  return (
    <nav
      id="dashboard-navbar"
      className="bg-white shadow-md fixed top-0 w-full z-20"
    >
      <div className="max-w-[1200px] mx-auto px-6 flex justify-between items-center h-16">
        {/* Left: Logo */}
        <div className="flex items-center gap-4">
          <Logo />
        </div>

        {/* Center: Welcome & Role */}
        <div className="hidden md:flex flex-col text-center">
          <span className="text-lg font-semibold text-gray-800">
            Welcome, {first_name || 'User'}
          </span>
          <span className="text-sm text-gray-600">
            Logged in as <strong>{role}</strong>
          </span>
        </div>

        {/* Right: Notifications and Profile menu */}
        <div className="flex items-center gap-4 relative">
          <button
            type="button"
            aria-label="Notifications"
            onClick={() => setNotifOpen(!notifOpen)}
            className="focus:outline-none"
          >
            <HiOutlineBell className="text-2xl text-gray-600" />
          </button>
          {notifOpen && <NotificationsPanel />}

          <div className="relative">
            <button
              type="button"
              aria-label="Profile menu"
              aria-expanded={menuOpen}
              onClick={() => setMenuOpen(!menuOpen)}
              className="flex items-center focus:outline-none"
            >
              <HiOutlineUserCircle className="text-2xl text-gray-600" />
            </button>
            {menuOpen && (
              <div className="absolute right-0 mt-2 w-32 bg-white border border-keyline rounded shadow-md">
                <button
                  type="button"
                  onClick={handleLogout}
                  className="flex items-center w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-100"
                >
                  <HiOutlineArrowRightOnRectangle className="mr-2" />
                  Logout
                </button>
              </div>
            )}
          </div>
        </div>
      </div>
    </nav>
  );
}

export default DashboardNavbar;
</file>

<file path="src/components/DeleteConfirmationModal.jsx">
const DeleteConfirmationModal = ({
  isOpen,
  onClose,
  handleDeleteAction,
  value,
}) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4">
      <div className="w-full max-w-sm rounded-lg bg-white p-6 shadow-md sm:max-w-md">
        <h2 className="text-lg font-semibold text-gray-800 mb-4">
          Confirm Deletion
        </h2>
        <p className="text-sm text-gray-600 mb-6">
          Are you sure you want to delete this item? This action cannot be
          undone.
        </p>
        <div className="flex justify-end space-x-2">
          <button
            onClick={onClose}
            className="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300"
          >
            Cancel
          </button>
          <button
            onClick={() => handleDeleteAction(value.id)}
            className="px-4 py-2 rounded bg-red-600 text-white hover:bg-red-700"
          >
            Delete
          </button>
        </div>
      </div>
    </div>
  );
};

export default DeleteConfirmationModal;
</file>

<file path="src/components/ecommerce/Cart.jsx">
import { useSelector, useDispatch } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import {
  removeFromCart,
  updateQuantity,
  clearCart,
  closeCart,
} from '@/redux/slice/cartSlice';
import {
  HiOutlineX,
  HiOutlineTrash,
  HiOutlineShoppingBag,
  HiOutlineArrowRight,
} from 'react-icons/hi';
import Payment from './Payment';
import { useState } from 'react';

function Cart() {
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const { items, total, itemCount, isOpen } = useSelector(
    (state) => state.cart
  );
  const [showPayment, setShowPayment] = useState(false);
  const [orderId, setOrderId] = useState('');

  const formatPrice = (price) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      maximumFractionDigits: 0,
    }).format(price);
  };

  const handleRemoveItem = (productId) => {
    dispatch(removeFromCart(productId));
  };

  const handleUpdateQuantity = (productId, quantity) => {
    dispatch(updateQuantity({ productId, quantity }));
  };

  const handleClearCart = () => {
    dispatch(clearCart());
  };

  const handleCloseCart = () => {
    dispatch(closeCart());
  };

  const handleCheckout = () => {
    if (items.length === 0) return;

    setOrderId(
      'ORD' + Date.now() + Math.random().toString(36).substr(2, 5).toUpperCase()
    );
    setShowPayment(true);
  };

  const handlePaymentSuccess = (transactionId) => {
    console.log('Payment successful:', transactionId);
    alert('Payment successful! Your order has been placed.');
    dispatch(clearCart());
    setShowPayment(false);
    handleCloseCart();
    navigate('/shop');
  };

  const handlePaymentFailure = (error) => {
    console.log('Payment failed:', error);
    alert('Payment failed: ' + error);
    setShowPayment(false);
  };

  if (!isOpen) return null;

  if (showPayment) {
    return (
      <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div className="bg-white rounded-lg max-w-md w-full max-h-[90vh] overflow-y-auto">
          <div className="p-4 border-b border-gray-200">
            <div className="flex items-center justify-between">
              <h2 className="text-lg font-semibold">Complete Payment</h2>
              <button
                onClick={() => setShowPayment(false)}
                className="text-gray-500 hover:text-gray-700"
              >
                <HiOutlineX className="w-6 h-6" />
              </button>
            </div>
          </div>
          <Payment
            amount={total}
            orderId={orderId}
            onSuccess={handlePaymentSuccess}
            onFailure={handlePaymentFailure}
          />
        </div>
      </div>
    );
  }

  return (
    <div className="fixed inset-0 bg-black bg-opacity-50 z-50">
      <div className="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-xl">
        {/* Header */}
        <div className="flex items-center justify-between p-4 border-b border-gray-200">
          <div className="flex items-center gap-2">
            <HiOutlineShoppingBag className="w-6 h-6 text-keyline" />
            <h2 className="text-lg font-semibold">Shopping Cart</h2>
            <span className="bg-gray-100 text-gray-700 text-xs font-medium px-2 py-1 rounded-full border border-keyline">
              {itemCount}
            </span>
          </div>
          <button
            onClick={handleCloseCart}
            className="text-gray-500 hover:text-gray-700"
          >
            <HiOutlineX className="w-6 h-6" />
          </button>
        </div>

        {/* Cart Items */}
        <div className="flex-1 overflow-y-auto p-4">
          {items.length === 0 ? (
            <div className="text-center py-12">
              <HiOutlineShoppingBag className="w-16 h-16 text-gray-300 mx-auto mb-4" />
              <h3 className="text-lg font-medium text-gray-900 mb-2">
                Your cart is empty
              </h3>
              <p className="text-gray-600 mb-6">
                Add some products to get started!
              </p>
              <button
                onClick={() => {
                  handleCloseCart();
                  navigate('/shop');
                }}
                className="bg-black text-white px-6 py-2 rounded-lg hover:bg-gray-900 transition-colors"
              >
                Continue Shopping
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              {items.map((item) => (
                <div
                  key={item.id}
                  className="flex gap-4 p-4 border border-gray-200 rounded-lg"
                >
                  {/* Product Image */}
                  <div className="w-20 h-20 flex-shrink-0">
                    <img
                      src={item.image}
                      alt={item.name}
                      className="w-full h-full object-cover rounded-lg"
                    />
                  </div>

                  {/* Product Details */}
                  <div className="flex-1 min-w-0">
                    <h3 className="font-medium text-gray-900 truncate">
                      {item.name}
                    </h3>
                    <p className="text-sm text-gray-600 mb-2">
                      {item.category}
                    </p>
                    <p className="font-semibold text-gray-900">
                      {formatPrice(item.price)}
                    </p>

                    {/* Quantity Controls */}
                    <div className="flex items-center gap-2 mt-3">
                      <button
                        onClick={() =>
                          handleUpdateQuantity(item.id, item.quantity - 1)
                        }
                        className="w-6 h-6 border border-gray-300 rounded flex items-center justify-center hover:bg-gray-50"
                      >
                        -
                      </button>
                      <span className="w-8 text-center text-sm font-medium">
                        {item.quantity}
                      </span>
                      <div className="flex items-center space-x-2">
                        <button
                          onClick={() =>
                            handleUpdateQuantity(item.id, item.quantity + 1)
                          }
                          disabled={item.quantity >= item.stockCount}
                          className={`w-6 h-6 border border-gray-300 rounded flex items-center justify-center hover:bg-gray-50
                            ${item.quantity >= item.stockCount ? 'opacity-50 cursor-not-allowed' : ''}`}
                        >
                          +
                        </button>
                        {item.quantity >= item.stockCount && (
                          <div className="text-red-500 text-sm">
                            Stock reached max limit
                          </div>
                        )}
                      </div>
                    </div>
                  </div>

                  {/* Remove Button */}
                  <button
                    onClick={() => handleRemoveItem(item.id)}
                    className="text-red-500 hover:text-red-700 p-1"
                  >
                    <HiOutlineTrash className="w-5 h-5" />
                  </button>
                </div>
              ))}
            </div>
          )}
        </div>

        {/* Footer */}
        {items.length > 0 && (
          <div className="border-t border-gray-200 p-4 space-y-4">
            {/* Summary */}
            <div className="space-y-2">
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">
                  Subtotal ({itemCount} items):
                </span>
                <span className="font-medium">{formatPrice(total)}</span>
              </div>
              <div className="flex justify-between text-sm">
                <span className="text-gray-600">Shipping:</span>
                <span className="text-green-600 font-medium">Free</span>
              </div>
              <div className="border-t border-gray-200 pt-2">
                <div className="flex justify-between text-lg font-semibold">
                  <span>Total:</span>
                  <span>{formatPrice(total)}</span>
                </div>
              </div>
            </div>

            {/* Action Buttons */}
            <div className="space-y-3">
              <button
                onClick={handleCheckout}
                className="w-full bg-black text-white py-3 px-4 rounded-lg font-semibold hover:bg-gray-900 transition-colors flex items-center justify-center gap-2"
              >
                <span>Proceed to Checkout</span>
                <HiOutlineArrowRight className="w-5 h-5" />
              </button>

              <button
                onClick={handleClearCart}
                className="w-full border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors"
              >
                Clear Cart
              </button>

              <button
                onClick={() => {
                  handleCloseCart();
                  navigate('/shop');
                }}
                className="w-full text-gray-700 hover:text-keyline font-medium"
              >
                Continue Shopping
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

export default Cart;
</file>

<file path="src/components/ecommerce/Payment.jsx">
import { useState } from 'react';
import {
  HiOutlineCreditCard,
  HiOutlinePhone,
  HiOutlineQrcode,
  HiOutlineCheckCircle,
} from 'react-icons/hi';

function Payment({ amount, orderId, onSuccess, onFailure }) {
  const [paymentMethod, setPaymentMethod] = useState('upi');
  const [upiId, setUpiId] = useState('');
  const [phoneNumber, setPhoneNumber] = useState('');
  const [isProcessing, setIsProcessing] = useState(false);
  const [paymentStatus, setPaymentStatus] = useState('pending');

  // Mock PhonePe API configuration placeholder (unused)

  const handlePayment = async () => {
    if (!validateForm()) return;

    setIsProcessing(true);
    setPaymentStatus('processing');

    try {
      // Simulate PhonePe API call
      const response = await simulatePhonePePayment();

      if (response.success) {
        setPaymentStatus('success');
        setTimeout(() => {
          onSuccess(response.transactionId);
        }, 2000);
      } else {
        setPaymentStatus('failed');
        setTimeout(() => {
          onFailure(response.error);
        }, 2000);
      }
    } catch {
      setPaymentStatus('failed');
      onFailure('Payment failed. Please try again.');
    } finally {
      setIsProcessing(false);
    }
  };

  const simulatePhonePePayment = () => {
    return new Promise((resolve) => {
      setTimeout(() => {
        // Simulate 90% success rate
        const isSuccess = Math.random() > 0.1;
        resolve({
          success: isSuccess,
          transactionId: isSuccess ? 'TXN' + Date.now() : null,
          error: isSuccess ? null : 'Payment declined by bank',
        });
      }, 3000);
    });
  };

  const validateForm = () => {
    if (paymentMethod === 'upi' && !upiId) {
      alert('Please enter UPI ID');
      return false;
    }
    if (paymentMethod === 'phone' && !phoneNumber) {
      alert('Please enter phone number');
      return false;
    }
    return true;
  };

  const formatAmount = (amount) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      maximumFractionDigits: 0,
    }).format(amount);
  };

  const renderPaymentStatus = () => {
    switch (paymentStatus) {
      case 'processing':
        return (
          <div className="text-center py-8">
            <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-keyline mx-auto mb-4"></div>
            <p className="text-gray-600">Processing payment...</p>
            <p className="text-sm text-gray-500 mt-2">
              Please don't close this window
            </p>
          </div>
        );
      case 'success':
        return (
          <div className="text-center py-8">
            <HiOutlineCheckCircle className="w-16 h-16 text-green-500 mx-auto mb-4" />
            <h3 className="text-xl font-semibold text-green-600 mb-2">
              Payment Successful!
            </h3>
            <p className="text-gray-600">Your order has been confirmed</p>
          </div>
        );
      case 'failed':
        return (
          <div className="text-center py-8">
            <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <span className="text-red-600 text-2xl">✕</span>
            </div>
            <h3 className="text-xl font-semibold text-red-600 mb-2">
              Payment Failed
            </h3>
            <p className="text-gray-600">
              Please try again with a different method
            </p>
          </div>
        );
      default:
        return null;
    }
  };

  if (paymentStatus !== 'pending') {
    return (
      <div className="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
        {renderPaymentStatus()}
      </div>
    );
  }

  return (
    <div className="max-w-md mx-auto bg-white rounded-lg shadow-lg p-6">
      {/* Header */}
      <div className="text-center mb-6">
        <div className="flex items-center justify-center gap-2 mb-2">
          <div className="w-8 h-8 bg-black rounded-lg flex items-center justify-center">
            <HiOutlineCreditCard className="w-5 h-5 text-white" />
          </div>
          <h2 className="text-xl font-bold text-gray-900">PhonePe Payment</h2>
        </div>
        <p className="text-gray-600">Complete your payment securely</p>
      </div>

      {/* Order Summary */}
      <div className="bg-gray-50 rounded-lg p-4 mb-6">
        <div className="flex justify-between items-center">
          <span className="text-gray-600">Order ID:</span>
          <span className="font-mono text-sm">{orderId}</span>
        </div>
        <div className="flex justify-between items-center mt-2">
          <span className="text-gray-600">Amount:</span>
          <span className="text-xl font-bold text-gray-900">
            {formatAmount(amount)}
          </span>
        </div>
      </div>

      {/* Payment Methods */}
      <div className="mb-6">
        <h3 className="text-lg font-semibold text-gray-900 mb-4">
          Choose Payment Method
        </h3>

        <div className="space-y-3">
          <label className="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
            <input
              type="radio"
              name="paymentMethod"
              value="upi"
              checked={paymentMethod === 'upi'}
              onChange={(e) => setPaymentMethod(e.target.value)}
              className="mr-3"
            />
            <div className="flex items-center gap-3">
              <HiOutlineQrcode className="w-6 h-6 text-keyline" />
              <div>
                <div className="font-medium">UPI Payment</div>
                <div className="text-sm text-gray-500">
                  Pay using any UPI app
                </div>
              </div>
            </div>
          </label>

          <label className="flex items-center p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
            <input
              type="radio"
              name="paymentMethod"
              value="phone"
              checked={paymentMethod === 'phone'}
              onChange={(e) => setPaymentMethod(e.target.value)}
              className="mr-3"
            />
            <div className="flex items-center gap-3">
              <HiOutlinePhone className="w-6 h-6 text-keyline" />
              <div>
                <div className="font-medium">Phone Number</div>
                <div className="text-sm text-gray-500">
                  Pay using phone number
                </div>
              </div>
            </div>
          </label>
        </div>
      </div>

      {/* Payment Details */}
      <div className="mb-6">
        {paymentMethod === 'upi' && (
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              UPI ID
            </label>
            <input
              type="text"
              value={upiId}
              onChange={(e) => setUpiId(e.target.value)}
              placeholder="example@upi"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-keyline focus:border-transparent"
            />
            <p className="text-xs text-gray-500 mt-1">
              Enter your UPI ID (e.g., name@bank, phone@upi)
            </p>
          </div>
        )}

        {paymentMethod === 'phone' && (
          <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
              Phone Number
            </label>
            <input
              type="tel"
              value={phoneNumber}
              onChange={(e) => setPhoneNumber(e.target.value)}
              placeholder="Enter 10-digit mobile number"
              maxLength="10"
              className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-keyline focus:border-transparent"
            />
          </div>
        )}
      </div>

      {/* Payment Button */}
      <button
        onClick={handlePayment}
        disabled={isProcessing}
        className="w-full bg-black text-white py-3 px-4 rounded-lg font-semibold hover:bg-gray-900 disabled:opacity-50 disabled:cursor-not-allowed transition-colors"
      >
        {isProcessing ? 'Processing...' : `Pay ${formatAmount(amount)}`}
      </button>

      {/* Security Notice */}
      <div className="mt-4 text-center">
        <p className="text-xs text-gray-500">
          🔒 Your payment is secured by PhonePe's advanced encryption
        </p>
      </div>

      {/* Payment Methods Info */}
      <div className="mt-6 pt-4 border-t border-gray-200">
        <h4 className="text-sm font-medium text-gray-900 mb-2">
          Supported UPI Apps:
        </h4>
        <div className="flex items-center gap-2 text-xs text-gray-600">
          <span>PhonePe</span>
          <span>•</span>
          <span>Google Pay</span>
          <span>•</span>
          <span>Paytm</span>
          <span>•</span>
          <span>BHIM</span>
        </div>
      </div>
    </div>
  );
}

export default Payment;
</file>

<file path="src/components/inventory/ConfigDashboard.jsx">
import React from 'react';
import {
  useGetInventoryConfigQuery,
  useUpdateInventoryConfigMutation,
} from '../../api/erpApi';

export default function ConfigDashboard() {
  const { data } = useGetInventoryConfigQuery();
  const [updateConfig] = useUpdateInventoryConfigMutation();

  if (!data) return null;

  return (
    <div className="space-y-2">
      {data.map((cfg) => (
        <div key={cfg.id} className="flex items-center space-x-2">
          <span className="flex-1">{cfg.category}</span>
          <button
            type="button"
            className="px-2 py-1 bg-gray-200"
            onClick={() =>
              updateConfig({ id: cfg.id, track_serials: !cfg.track_serials })
            }
          >
            {cfg.track_serials ? 'Serials On' : 'Serials Off'}
          </button>
        </div>
      ))}
    </div>
  );
}
</file>

<file path="src/components/inventory/PriceLogView.jsx">
import React from 'react';
import { useGetPriceLogsQuery } from '../../api/erpApi';

export default function PriceLogView() {
  const { data } = useGetPriceLogsQuery();
  return (
    <ul className="text-sm list-disc pl-4">
      {(data ?? []).map((log) => (
        <li key={log.id}>
          {log.product_variant}: {log.old_price} → {log.new_price}
        </li>
      ))}
    </ul>
  );
}
</file>

<file path="src/components/inventory/SaleEntryForm.jsx">
import React from 'react';
import StockEntryForm from './StockEntryForm';

export default function SaleEntryForm({ bookingId }) {
  return <StockEntryForm defaultType="sale" bookingId={bookingId} />;
}
</file>

<file path="src/components/inventory/SerialManager.jsx">
import React from 'react';
import { useGetSerialsQuery } from '../../api/erpApi';
import SerialTable from './SerialTable';

export default function SerialManager() {
  const { data } = useGetSerialsQuery();
  return <SerialTable serials={data ?? []} />;
}
</file>

<file path="src/components/inventory/SerialTable.jsx">
import React from 'react';

export default function SerialTable({ serials = [] }) {
  return (
    <table className="min-w-full text-sm">
      <thead>
        <tr>
          <th className="px-2">Serial</th>
          <th className="px-2">Status</th>
        </tr>
      </thead>
      <tbody>
        {serials.map((s) => (
          <tr key={s.id}>
            <td className="border px-2">{s.serial_no}</td>
            <td className="border px-2">{s.status}</td>
          </tr>
        ))}
      </tbody>
    </table>
  );
}
</file>

<file path="src/components/inventory/StockEntryForm.jsx">
import React, { useState } from 'react';
import { useCreateStockEntryMutation } from '../../api/erpApi';

export default function StockEntryForm({
  defaultType = 'purchase',
  bookingId,
}) {
  const [form, setForm] = useState({
    entry_type: defaultType,
    store: '',
    product_variant: '',
    quantity: 0,
    unit_price: 0,
    booking: bookingId || '',
  });
  const [createEntry] = useCreateStockEntryMutation();

  const handleChange = (e) => {
    setForm({ ...form, [e.target.name]: e.target.value });
  };

  const handleSubmit = (e) => {
    e.preventDefault();
    createEntry(form);
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-2">
      <input
        name="store"
        value={form.store}
        onChange={handleChange}
        placeholder="Store ID"
        className="border p-1 w-full"
      />
      <input
        name="product_variant"
        value={form.product_variant}
        onChange={handleChange}
        placeholder="Variant ID"
        className="border p-1 w-full"
      />
      <input
        type="number"
        name="quantity"
        value={form.quantity}
        onChange={handleChange}
        className="border p-1 w-full"
      />
      <input
        type="number"
        name="unit_price"
        value={form.unit_price}
        onChange={handleChange}
        className="border p-1 w-full"
      />
      {form.entry_type === 'sale' && !bookingId && (
        <input
          name="booking"
          value={form.booking}
          onChange={handleChange}
          placeholder="Booking ID"
          className="border p-1 w-full"
        />
      )}
      <button type="submit" className="px-2 py-1 bg-blue-500 text-white">
        Save
      </button>
    </form>
  );
}
</file>

<file path="src/components/inventory/StockTable.jsx">
import React from 'react';

export default function StockTable({ ledgers = [] }) {
  return (
    <table className="min-w-full text-sm">
      <thead>
        <tr>
          <th className="px-2">Variant</th>
          <th className="px-2">Store</th>
          <th className="px-2">Qty</th>
        </tr>
      </thead>
      <tbody>
        {ledgers.map((l) => (
          <tr key={`${l.store}-${l.product_variant}`}>
            <td className="border px-2">{l.product_variant}</td>
            <td className="border px-2">{l.store}</td>
            <td className="border px-2">{l.quantity}</td>
          </tr>
        ))}
      </tbody>
    </table>
  );
}
</file>

<file path="src/components/InvoiceForm.jsx">
import { useState } from 'react';
import { useCreateInvoiceMutation } from '../api/erpApi';
import { computeGST } from '@/utils/gst';

export default function InvoiceForm({ bookingId, onSuccess }) {
  const [items, setItems] = useState([
    { description: '', hsn_code: '', quantity: 1, unit_price: 0 },
  ]);
  const [rates, setRates] = useState({ cgst: 9, sgst: 9, igst: 0 });
  const [createInvoice] = useCreateInvoiceMutation();

  const subtotal = items.reduce(
    (sum, i) => sum + Number(i.quantity) * Number(i.unit_price),
    0
  );
  const totals = computeGST(subtotal, rates);

  const updateItem = (idx, field, value) => {
    const next = items.slice();
    next[idx][field] = value;
    setItems(next);
  };

  const addItem = () =>
    setItems([
      ...items,
      { description: '', hsn_code: '', quantity: 1, unit_price: 0 },
    ]);

  const handleSubmit = async (e) => {
    e.preventDefault();
    await createInvoice({
      booking: bookingId,
      cgst: rates.cgst,
      sgst: rates.sgst,
      igst: rates.igst,
      line_items: items,
    }).unwrap();
    onSuccess?.();
  };

  return (
    <form onSubmit={handleSubmit} className="p-4 bg-white rounded space-y-4">
      {items.map((item, idx) => (
        <div key={idx} className="grid grid-cols-5 gap-2">
          <input
            placeholder="Description"
            value={item.description}
            onChange={(e) => updateItem(idx, 'description', e.target.value)}
            className="input col-span-2"
          />
          <input
            placeholder="HSN"
            value={item.hsn_code}
            onChange={(e) => updateItem(idx, 'hsn_code', e.target.value)}
            className="input"
          />
          <input
            type="number"
            min="1"
            value={item.quantity}
            onChange={(e) => updateItem(idx, 'quantity', e.target.value)}
            className="input"
          />
          <input
            type="number"
            value={item.unit_price}
            onChange={(e) => updateItem(idx, 'unit_price', e.target.value)}
            className="input"
          />
        </div>
      ))}
      <button type="button" onClick={addItem} className="text-sm text-blue-600">
        + Line Item
      </button>

      <div className="grid grid-cols-3 gap-2">
        {['cgst', 'sgst', 'igst'].map((key) => (
          <input
            key={key}
            type="number"
            value={rates[key]}
            onChange={(e) =>
              setRates({ ...rates, [key]: Number(e.target.value) })
            }
            className="input"
            placeholder={`${key.toUpperCase()} %`}
          />
        ))}
      </div>

      <div className="text-right">
        <div>Subtotal: {subtotal.toFixed(2)}</div>
        <div>CGST: {totals.cgst.toFixed(2)}</div>
        <div>SGST: {totals.sgst.toFixed(2)}</div>
        <div>IGST: {totals.igst.toFixed(2)}</div>
        <div className="font-bold">Total: {totals.total.toFixed(2)}</div>
      </div>

      <button
        className="bg-blue-600 text-white px-4 py-2 rounded"
        type="submit"
      >
        Save Invoice
      </button>
    </form>
  );
}
</file>

<file path="src/components/InvoiceTable.jsx">
export default function InvoiceTable({ invoices = [] }) {
  return (
    <table className="w-full text-left border mt-4">
      <thead>
        <tr>
          <th className="p-2 border">Invoice No</th>
          <th className="p-2 border">Total</th>
          <th className="p-2 border">Status</th>
          <th className="p-2 border">Actions</th>
        </tr>
      </thead>
      <tbody>
        {invoices.map((inv) => (
          <tr key={inv.id} className="border-t">
            <td className="p-2 border">{inv.invoice_no}</td>
            <td className="p-2 border">{inv.total}</td>
            <td className="p-2 border">{inv.status}</td>
            <td className="p-2 border">
              {/* TODO(v1.1): Enable invoice PDF once Railway system libraries available */}
            </td>
          </tr>
        ))}
      </tbody>
    </table>
  );
}
</file>

<file path="src/components/layout/__tests__/ReelLayout.test.jsx.backup">
// @vitest-environment jsdom
import { render, waitFor } from '@testing-library/react';
import { beforeEach, expect, test, vi } from 'vitest';
import ReelLayout from '@/components/layout/ReelLayout';
import {
  ScrollModeProvider,
  useScrollMode,
} from '@/components/layout/ScrollModeContext';

let swiperProps = {};
vi.mock('swiper/react', () => ({
  Swiper: (props) => {
    swiperProps = props;
    return <div>{props.children}</div>;
  },
  SwiperSlide: ({ children }) => <div>{children}</div>,
}));
vi.mock('swiper/modules', () => ({
  Navigation: {},
  Autoplay: {},
  Keyboard: {},
}));

beforeEach(() => {
  swiperProps = {};
});

function ModeReader() {
  const { mode } = useScrollMode();
  return <span data-testid="mode">{mode}</span>;
}

test('ReelLayout toggles scroll mode', () => {
  const Wrapper = ({ children }) => (
    <ScrollModeProvider>{children}</ScrollModeProvider>
  );
  const { rerender, getByTestId } = render(
    <Wrapper>
      <ReelLayout>
        <div>slide</div>
      </ReelLayout>
      <ModeReader />
    </Wrapper>
  );
  expect(getByTestId('mode').textContent).toBe('reel');
  rerender(
    <Wrapper>
      <ModeReader />
    </Wrapper>
  );
  expect(getByTestId('mode').textContent).toBe('scroll');
});

test('ReelLayout disables autoplay when single slide', async () => {
  const Wrapper = ({ children }) => (
    <ScrollModeProvider>{children}</ScrollModeProvider>
  );

  render(
    <Wrapper>
      <ReelLayout autoplay>
        <div>one</div>
      </ReelLayout>
    </Wrapper>
  );
  expect(swiperProps.autoplay).toBe(false);

  render(
    <Wrapper>
      <ReelLayout autoplay>
        <div>one</div>
        <div>two</div>
      </ReelLayout>
    </Wrapper>
  );
  await waitFor(() =>
    expect(swiperProps.autoplay).toEqual({
      delay: 5000,
      disableOnInteraction: false,
    })
  );
});
</file>

<file path="src/components/layout/__tests__/ScrollModeContext.test.jsx">
// @vitest-environment jsdom
import { renderHook, act } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import {
  ScrollModeProvider,
  useScrollMode,
  SECTION_SLIDER_MODE,
} from '@/components/layout/ScrollModeContext';

vi.stubGlobal('requestAnimationFrame', (cb) => cb());

test('mode change resets bottom nav visibility', () => {
  const wrapper = ({ children }) => (
    <ScrollModeProvider>{children}</ScrollModeProvider>
  );
  const { result } = renderHook(() => useScrollMode(), { wrapper });
  act(() => result.current.setMode(SECTION_SLIDER_MODE));
  expect(result.current.bottomNavVisible).toBe(true);
  act(() => result.current.setMode('scroll'));
  expect(result.current.mode).toBe('scroll');
});

test('scrolling hides and shows bottom nav', () => {
  const wrapper = ({ children }) => (
    <ScrollModeProvider>{children}</ScrollModeProvider>
  );
  const { result } = renderHook(() => useScrollMode(), { wrapper });
  const el = document.createElement('div');
  act(() => {
    result.current.registerScrollElement(el);
  });
  act(() => {
    el.scrollTop = 250;
    el.dispatchEvent(new Event('scroll'));
  });
  expect(result.current.bottomNavVisible).toBe(false);
  act(() => {
    el.scrollTop = 0;
    el.dispatchEvent(new Event('scroll'));
  });
  expect(result.current.bottomNavVisible).toBe(true);
});
</file>

<file path="src/components/layout/BottomNav.jsx">
import { useEffect, useRef, useState } from 'react';
import { NavLink, useLocation } from 'react-router-dom';
import { useScrollMode } from '@/components/layout/ScrollModeContext';
import { Home, Wrench, ShoppingBag, ShoppingCart, User } from 'lucide-react';

const ROOT_PATHS = ['/', '/shop', '/repair', '/cart', '/account'];

export default function BottomNav() {
  const location = useLocation();
  const [accountOpen, setAccountOpen] = useState(false);
  const { bottomNavVisible } = useScrollMode();
  const ref = useRef(null);
  // Close account dropdown on route change
  useEffect(() => {
    setAccountOpen(false);
  }, [location.pathname]);

  useEffect(() => {
    if (!ref.current) return;

    const updateHeight = () => {
      document.documentElement.style.setProperty(
        '--bottomnav-h',
        `${ref.current.offsetHeight}px`
      );
    };

    updateHeight();

    const observer = new ResizeObserver(updateHeight);
    observer.observe(ref.current);
    return () => observer.disconnect();
  }, []);

  // Only show nav on allowed root paths
  if (!ROOT_PATHS.some((p) => location.pathname.startsWith(p))) {
    return null;
  }

  const tabs = [
    { to: '/', label: 'Home', icon: Home },
    { to: '/repair', label: 'Repair', icon: Wrench },
    { to: '/shop', label: 'Shop', icon: ShoppingBag },
    { to: '/cart', label: 'Cart', icon: ShoppingCart },
    { to: '/account', label: 'Account', icon: User, custom: true },
  ];

  return (
    <>
      <nav
        ref={ref}
        role="navigation"
        aria-label="Primary bottom navigation"
        className={`
          bottom-nav
          fixed bottom-0 inset-x-0 z-50
          md:hidden
          flex justify-around items-center
          border-t border-outline bg-surface
          h-14
          flex-shrink-0
          transition-transform duration-300
          ${bottomNavVisible ? '' : 'translate-y-full'}
        `}
        style={{
          paddingBottom: 'env(safe-area-inset-bottom, 0)',
        }}
      >
        {tabs.map(({ to, label, icon, custom }) => {
          const Icon = icon;
          return custom ? (
            <button
              key={label}
              type="button"
              aria-haspopup="menu"
              aria-expanded={accountOpen}
              onClick={() => setAccountOpen((o) => !o)}
              className="flex flex-col items-center gap-0.5 text-xs text-onSurface outline-none focus:opacity-90"
            >
              <Icon className="w-5 h-5" aria-hidden />
              <span>{label}</span>
            </button>
          ) : (
            <NavLink
              key={label}
              to={to}
              className={({ isActive }) =>
                `flex flex-col items-center gap-0.5 text-xs outline-none focus:opacity-90 ${
                  isActive ? 'text-secondary' : 'text-onSurface'
                }`
              }
              aria-label={label}
            >
              <Icon className="w-5 h-5" aria-hidden />
              <span>{label}</span>
            </NavLink>
          );
        })}
      </nav>

      {accountOpen && (
        <div
          className="
            md:hidden absolute left-0 right-0 mx-4
            bg-surface border border-outline rounded-lg shadow-lg
            z-[60]
          "
          // Position the menu just above the nav, respecting safe area.
          style={{
            bottom: 'calc(56px + env(safe-area-inset-bottom, 0) + 8px)',
          }}
        >
          <ul className="p-4 text-sm space-y-2">
            {[
              { to: '/account', label: 'Profile' },
              { to: '/orders', label: 'Orders' },
              { to: '/wishlist', label: 'Wishlist' },
              { to: '/partners', label: 'Partners' },
              { to: '/careers', label: 'Careers' },
              { to: '/privacy', label: 'Privacy' },
              { to: '/terms', label: 'Terms' },
              { to: '/legal', label: 'Legal' },
            ].map(({ to, label }) => (
              <li key={to}>
                <NavLink
                  to={to}
                  className="block hover:text-secondary"
                  onClick={() => setAccountOpen(false)}
                >
                  {label}
                </NavLink>
              </li>
            ))}
          </ul>
        </div>
      )}
    </>
  );
}
</file>

<file path="src/components/layout/FocusLayout.jsx">
import { Outlet, useNavigate } from 'react-router-dom';
import { HiOutlineArrowLeft } from 'react-icons/hi';
import DashboardNavbar from '../dashboard/layout/DashboardNavbar';

function FocusLayout({ title = '' }) {
  const navigate = useNavigate();

  return (
    <div className="bg-surface min-h-screen">
      <DashboardNavbar />
      <div className="mt-16">
        <header className="flex items-center gap-2 p-4 border-b border-keyline bg-white">
          <button
            onClick={() =>
              window.history.length > 1 ? navigate(-1) : navigate('/dashboard')
            }
            className="p-1"
          >
            <HiOutlineArrowLeft className="w-6 h-6 text-gray-700" />
          </button>
          <h1 className="text-lg font-semibold text-gray-800">{title}</h1>
        </header>
        <main className="p-4">
          <Outlet />
        </main>
      </div>
    </div>
  );
}

export default FocusLayout;
</file>

<file path="src/components/layout/Footer.jsx">
import { Link } from 'react-router-dom';
import Logo from '../common/Logo';
import { Instagram, MessageCircle } from 'lucide-react';

export default function Footer({ isVisible = false }) {
  return (
    <footer
      className={`
        fixed bottom-0 left-0 right-0 z-50
        bg-white/95 backdrop-blur-sm border-t border-gray-200
        transition-transform duration-300 ease-in-out
        hidden md:block
        ${isVisible ? 'translate-y-0' : 'translate-y-full'}
      `}
    >
      <div className="max-w-screen-lg mx-auto flex items-center justify-between px-6 py-3">
        {/* Left: Brand + Links */}
        <div className="flex items-center gap-6">
          <Logo />
          <div className="flex items-center gap-4 text-xs text-gray-500">
            <Link
              to="/privacy"
              className="hover:text-gray-700 transition-colors"
            >
              Privacy
            </Link>
            <Link to="/terms" className="hover:text-gray-700 transition-colors">
              Terms
            </Link>
            <Link
              to="/sitemap"
              className="hover:text-gray-700 transition-colors"
            >
              Sitemap
            </Link>
            <span>© 2025 Finetune Store</span>
          </div>
        </div>

        {/* Right: Social Media */}
        <div className="flex items-center gap-3">
          <a
            href="https://instagram.com"
            target="_blank"
            rel="noopener noreferrer"
            className="text-gray-500 hover:text-secondary transition-colors"
            aria-label="Instagram"
          >
            <Instagram className="w-5 h-5" />
          </a>
          <a
            href="https://wa.me/"
            target="_blank"
            rel="noopener noreferrer"
            className="text-gray-500 hover:text-secondary transition-colors"
            aria-label="WhatsApp"
          >
            <MessageCircle className="w-5 h-5" />
          </a>
        </div>
      </div>
    </footer>
  );
}
</file>

<file path="src/components/layout/MainNav.jsx">
import { useEffect, useRef } from 'react';
import { NavLink, Link } from 'react-router-dom';
import Logo from '../common/Logo';
import { User, Search, ShoppingCart } from 'lucide-react';

export default function MainNav() {
  const ref = useRef(null);

  useEffect(() => {
    if (ref.current) {
      const height = `${ref.current.offsetHeight}px`;
      document.documentElement.style.setProperty(
        '--mainnav-h',
        height
      );
      document.documentElement.style.setProperty(
        '--navbar-h',
        height
      );
    }
  }, []);

  const navLinkClasses =
    'relative px-3 py-2 text-sm text-primary after:absolute after:left-0 after:-bottom-0.5 after:h-0.5 after:bg-secondary after:w-0 after:transition-all hover:after:w-full';

  const iconClasses =
    'w-5 h-5 transition transform hover:opacity-80 hover:scale-110';

  return (
    <nav
      id="mainnav"
      ref={ref}
      className="main-nav flex-shrink-0 bg-white shadow-sm flex items-center justify-between px-4 md:px-8 z-50 h-14"
    >
      {/* Left: Logo */}
      <Logo />

      {/* Center: Nav links (desktop only) */}
      <ul className="hidden md:flex gap-6 mx-auto">
        <li>
          <NavLink to="/shop" className={navLinkClasses}>
            Shop
          </NavLink>
        </li>
        <li>
          <NavLink to="/repair" className={navLinkClasses}>
            Repair
          </NavLink>
        </li>
        <li>
          <NavLink to="/support" className={navLinkClasses}>
            Support
          </NavLink>
        </li>
      </ul>

      {/* Right: Icons + CTA */}
      <div className="flex items-center gap-4">
        {/* Mobile: only Search */}
        <NavLink to="/search" className="flex md:hidden" aria-label="Search">
          <Search className="w-5 h-5" />
        </NavLink>

        {/* Desktop: full icon set + CTA */}
        <div className="hidden md:flex items-center gap-4">
          <NavLink to="/account" className="flex" aria-label="Account">
            <User className={iconClasses} />
          </NavLink>
          <NavLink to="/search" className="flex" aria-label="Search">
            <Search className={iconClasses} />
          </NavLink>
          <NavLink to="/cart" className="flex" aria-label="Cart">
            <ShoppingCart className={iconClasses} />
          </NavLink>
          <Link
            to="/repair"
            className="border border-secondary text-secondary px-4 py-1.5 rounded-full text-sm transition-colors hover:bg-secondary hover:text-white"
          >
            Book Now
          </Link>
        </div>
      </div>
    </nav>
  );
}
</file>

<file path="src/components/layout/PublicLayout.jsx">
import { Outlet } from 'react-router-dom';
import { useEffect, useMemo, useState } from 'react';
import TopBar from '@/components/layout/TopBar';
import MainNav from '@/components/layout/MainNav';
import BottomNav from '@/components/layout/BottomNav';
import Footer from '@/components/layout/Footer';
import useDevice from '@/hooks/useDevice';
import { useViewportHeight } from '@/hooks/useViewportHeight';
import {
  ScrollModeProvider,
  useScrollMode,
  SECTION_SLIDER_MODE,
} from '@/components/layout/ScrollModeContext';

function PublicLayoutInner() {
  const { mode, registerScrollElement, scrollElement } = useScrollMode();
  const { isDesktop, isMobile } = useDevice();
  const [isFooterVisible, setIsFooterVisible] = useState(false);
  
  // Update viewport height for mobile devices
  useViewportHeight();

  useEffect(() => {
    if (!scrollElement) {
      setIsFooterVisible(false);
      return undefined;
    }

    const handleScroll = () => {
      const { scrollTop, scrollHeight, clientHeight } = scrollElement;
      const scrollPercentage = (scrollTop + clientHeight) / scrollHeight;

      setIsFooterVisible(scrollPercentage >= 0.85);
    };

    handleScroll();

    scrollElement.addEventListener('scroll', handleScroll, { passive: true });
    return () => scrollElement.removeEventListener('scroll', handleScroll);
  }, [scrollElement]);

  const navOffset =
    'calc(var(--topbar-h, 0px) + var(--navbar-h, var(--mainnav-h, 0px)))';

  const mainStyles = useMemo(
    () => ({
      paddingBottom: isMobile ? 'var(--bottomnav-h, 56px)' : '0',
      scrollPaddingTop: navOffset,
      ...(mode === SECTION_SLIDER_MODE
        ? {
            paddingTop: 0,
            scrollBehavior: 'auto',
            scrollSnapStop: 'always',
          }
        : {
            paddingTop: navOffset,
          }),
    }),
    [isMobile, mode, navOffset],
  );

  return (
    <div className="h-[100dvh] bg-surface text-onSurface overflow-hidden">
      <div className="h-full relative flex flex-col">
        {/* Skip to main content link for keyboard users */}
        <a 
          href="#main-content" 
          className="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:bg-primary focus:text-surface focus:px-4 focus:py-2 focus:rounded focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2"
        >
          Skip to main content
        </a>
        
        <TopBar />
        <MainNav />

        <main
          id="main-content"
          ref={registerScrollElement}
          data-scroll-container="true"
          className={`flex-1 min-h-0 ${
            mode === SECTION_SLIDER_MODE
              ? // Disable native scroll snapping when SectionSlider is active
                // to allow its custom JS-based scroll logic to take over.
                'overflow-y-auto fullpage-scrolling'
              : 'overflow-y-auto'
          }`}
          style={mainStyles}
        >
          <Outlet />
        </main>

        {isMobile && <BottomNav />}
      </div>

      {isDesktop && <Footer isVisible={isFooterVisible} />}
    </div>
  );
}

export default function PublicLayout() {
  return (
    <ScrollModeProvider>
      <PublicLayoutInner />
    </ScrollModeProvider>
  );
}
</file>

<file path="src/components/layout/ScrollModeContext.jsx">
import {
  createContext,
  useCallback,
  useContext,
  useMemo,
  useRef,
  useState,
  useEffect,
} from 'react';
import useDevice from '@/hooks/useDevice';

export const SECTION_SLIDER_MODE = 'section-slider';

// eslint-disable-next-line react-refresh/only-export-components
export const ScrollModeContext = createContext({
  mode: 'scroll',
  setMode: () => {},
  bottomNavVisible: true,
  scrollDirection: 'down',
  registerScrollElement: () => {},
  scrollElement: null,
});

export const ScrollModeProvider = ({ children }) => {
  const [mode, setInternalMode] = useState('scroll');
  const [bottomNavVisible, setBottomNavVisible] = useState(true);
  const [scrollDirection, setScrollDirection] = useState('down');
  const [scrollEl, setScrollEl] = useState(null);
  const { isMobile, isDesktop } = useDevice();
  const lastY = useRef(0);
  const lastDirection = useRef('down');
  const distance = useRef(0);
  const ticking = useRef(false);
  const hideThreshold = useMemo(() => (isDesktop ? 200 : 100), [isDesktop]);
  const showThreshold = useMemo(() => (isMobile ? 0 : 100), [isMobile]);
  // TODO: detect mouse movement near bottom to reveal nav on desktop

  const setMode = useCallback((nextMode) => {
    setInternalMode(nextMode === 'reel' ? SECTION_SLIDER_MODE : nextMode);
  }, []);

  const handleScroll = useCallback(
    (e) => {
      // 🔥 KEY FIX: Don't interfere with fullpage scroll in section slider mode
      if (mode === SECTION_SLIDER_MODE) {
        // Allow fullpage scroll logic to work
        return;
      }
      const current = e.target.scrollTop;
      const delta = current - lastY.current;
      const direction = delta > 0 ? 'down' : 'up';

      if (direction !== lastDirection.current) {
        distance.current = 0;
      }
      distance.current += Math.abs(delta);
      setScrollDirection(direction);

      if (current < 10) {
        setBottomNavVisible(true);
        distance.current = 0;
      } else if (
        direction === 'down' &&
        bottomNavVisible &&
        distance.current > hideThreshold
      ) {
        setBottomNavVisible(false);
        distance.current = 0;
      } else if (
        direction === 'up' &&
        !bottomNavVisible &&
        distance.current > showThreshold
      ) {
        setBottomNavVisible(true);
        distance.current = 0;
      }

      lastY.current = current;
      lastDirection.current = direction;
    },
    [mode, bottomNavVisible, hideThreshold, showThreshold]
  );

  // Keep nav visible in section slider mode
  useEffect(() => {
    if (mode === SECTION_SLIDER_MODE) {
      setBottomNavVisible(true);
    }
    distance.current = 0;
    lastDirection.current = 'down';
    lastY.current = 0;
  }, [mode]);

  useEffect(() => {
    if (!scrollEl) return;
    const onScroll = (e) => {
      if (ticking.current) return;
      ticking.current = true;
      requestAnimationFrame(() => {
        handleScroll(e);
        ticking.current = false;
      });
    };

    scrollEl.addEventListener('scroll', onScroll, { passive: true });
    return () => scrollEl.removeEventListener('scroll', onScroll);
  }, [scrollEl, handleScroll]);

  const value = useMemo(
    () => ({
      mode,
      setMode,
      bottomNavVisible,
      scrollDirection,
      registerScrollElement: setScrollEl,
      scrollElement: scrollEl,
    }),
    [mode, bottomNavVisible, scrollDirection, scrollEl, setMode]
  );

  return (
    <ScrollModeContext.Provider value={value}>
      {children}
    </ScrollModeContext.Provider>
  );
};

export const useScrollMode = () => useContext(ScrollModeContext);
</file>

<file path="src/components/layout/TopBar.jsx">
import { useEffect, useRef } from 'react';

export default function TopBar() {
  const ref = useRef(null);

  useEffect(() => {
    if (ref.current) {
      document.documentElement.style.setProperty(
        '--topbar-h',
        `${ref.current.offsetHeight}px`
      );
    }
  }, []);

  return (
    <div
      id="topbar"
      ref={ref}
      className="top-bar bg-secondary text-white flex items-center justify-center py-0.5"
    >
      <span className="topbar-text text-xs leading-none">🔥 Free Shipping</span>
    </div>
  );
}
</file>

<file path="src/components/MyBookings.jsx">
import { useState } from 'react';
import toast from 'react-hot-toast';
import { useCancelBookingMutation } from '../api/erpApi';

export default function MyBookings({ bookings = [], refetch }) {
  const [cancelBooking] = useCancelBookingMutation();
  const [modal, setModal] = useState(null); // {id, reason}

  const openModal = (id) => setModal({ id, reason: '' });
  const closeModal = () => setModal(null);

  const submit = async () => {
    if (!modal.reason.trim()) {
      toast.error('Reason required');
      return;
    }
    try {
      await cancelBooking({ id: modal.id, reason: modal.reason }).unwrap();
      toast.success('Booking cancelled');
      closeModal();
      refetch?.();
    } catch {
      toast.error('Cancellation failed');
    }
  };

  return (
    <div className="mt-6">
      <h2 className="text-xl font-bold mb-2">My Bookings</h2>
      <table className="w-full text-left border">
        <thead>
          <tr>
            <th className="p-2 border">ID</th>
            <th className="p-2 border">Status</th>
            <th className="p-2 border">Reason</th>
            <th className="p-2 border">Actions</th>
          </tr>
        </thead>
        <tbody>
          {bookings.map((b) => (
            <tr key={b.id} className="border-t">
              <td className="p-2 border">{b.id}</td>
              <td className="p-2 border">{b.status}</td>
              <td className="p-2 border">{b.reason || '-'}</td>
              <td className="p-2 border">
                {['pending', 'approved'].includes(b.status) && (
                  <button
                    onClick={() => openModal(b.id)}
                    className="text-red-600"
                  >
                    Cancel
                  </button>
                )}
              </td>
            </tr>
          ))}
        </tbody>
      </table>

      {modal && (
        <div className="fixed inset-0 flex items-center justify-center bg-black/50">
          <div className="bg-white p-4 rounded w-80">
            <h3 className="text-lg font-bold mb-2">Cancel Booking</h3>
            <textarea
              placeholder="Reason"
              className="input w-full mb-2"
              value={modal.reason}
              onChange={(e) => setModal({ ...modal, reason: e.target.value })}
            />
            <div className="text-right space-x-2">
              <button onClick={closeModal} className="px-3 py-1">
                Close
              </button>
              <button
                onClick={submit}
                className="bg-red-600 text-white px-3 py-1 rounded"
              >
                Submit
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/navigation/SectionSlider.jsx">
import { useState, useEffect, useRef, useCallback, Children } from 'react';
import {
  useScrollMode,
  SECTION_SLIDER_MODE,
} from '../layout/ScrollModeContext';
import { animateScroll } from '@/utils/animation';
import { devLog } from '@/utils/devLog';

import SwipeHint from './SwipeHint';

/**
 * @typedef {Object} SectionSliderProps
 * @property {import('react').ReactNode} children
 * @property {string} [sectionId]
 * @property {string} [reelId]
 * @property {boolean} [showHint]
 * @property {string} [className]
 * @property {import('react').CSSProperties} [style]
 * @property {'horizontal' | 'vertical'} [mode]
 * @property {Object} [slidesPerView] - Slides per view configuration for different breakpoints
 * @property {boolean} [autoAdvanceGroup]
 */

const safeSessionStorage = {
  getItem: (key) => {
    try {
      return typeof window !== 'undefined' ? sessionStorage.getItem(key) : null;
    } catch {
      return null;
    }
  },
  setItem: (key, value) => {
    try {
      if (typeof window !== 'undefined') {
        sessionStorage.setItem(key, value);
      }
    } catch {
      /* noop */
    }
  },
};

/**
 * @param {SectionSliderProps} props
 */
export default function SectionSlider({
  children,
  sectionId,
  reelId,
  showHint = true,
  className = '',
  style = {},
  mode = 'horizontal',
  slidesPerView,
  autoAdvanceGroup = false,
}) {
  const { setMode } = useScrollMode();
  const [currentSlide, setCurrentSlide] = useState(0);
  const prevSlideRef = useRef(0);
  const [showHintOverlay, setShowHintOverlay] = useState(false);

  const containerRef = useRef(null);
  const slideRefs = useRef([]);

  // Refs for managing timers, touch events, and animations
  const animationRef = useRef(null);
  const scrollTimeoutRef = useRef(null);
  const touchStartRef = useRef({ x: 0, y: 0, time: 0 });
  const slidesPerGroupRef = useRef(1);
  const slidesLengthRef = useRef(0);
  const autoAdvanceTimerRef = useRef(null);

  const baseSlidesPerView = slidesPerView
    ? slidesPerView.mobile ?? slidesPerView.tablet ?? slidesPerView.desktop ?? 1
    : 1;
  const [visibleSlides, setVisibleSlides] = useState(baseSlidesPerView);

  const sliderId = sectionId ?? reelId ?? 'section-slider';

  const resolveSlidesPerView = useCallback(() => {
    if (!slidesPerView) return 1;
    const { mobile, tablet, desktop } = slidesPerView;
    const mobileFallback = mobile ?? tablet ?? desktop ?? 1;

    if (typeof window === 'undefined') {
      return mobileFallback;
    }

    const width = window.innerWidth;
    if (width >= 1024) {
      return desktop ?? tablet ?? mobile ?? 1;
    }
    if (width >= 768) {
      return tablet ?? desktop ?? mobile ?? 1;
    }
    return mobileFallback;
  }, [slidesPerView]);

  useEffect(() => {
    slidesPerGroupRef.current = Math.max(1, visibleSlides);
  }, [visibleSlides]);

  useEffect(
    () => () => {
      clearTimeout(scrollTimeoutRef.current);
      if (autoAdvanceTimerRef.current) {
        clearInterval(autoAdvanceTimerRef.current);
      }
    },
    []
  );

  const slides = Children.toArray(children);
  slidesLengthRef.current = slides.length;
  const hasMultipleSlides = slides.length > 1;
  const isVertical = mode === 'vertical';
  const hintStorageKey = `sectionHintShown-${mode}-${sliderId}`;

  const scrollToSlide = useCallback(
    (index, smooth = true) => {
      if (!containerRef.current || !slideRefs.current[index]) {
        return;
      }

      const fromIndex = currentSlide;

      // Cancel any ongoing animation before starting a new one
      if (animationRef.current) {
        devLog('[SectionSlider]:', {
          mode,
          action: 'cancel',
          fromIndex,
          toIndex: index,
          timestamp: Date.now(),
        });
        animationRef.current.cancel();
      }

      devLog('[SectionSlider]:', {
        mode,
        action: 'start',
        fromIndex,
        toIndex: index,
        timestamp: Date.now(),
      });

      const target = slideRefs.current[index];
      const to = isVertical ? target.offsetTop : target.offsetLeft;
      const axis = isVertical ? 'y' : 'x';

      if (!smooth) {
        if (axis === 'y') {
          containerRef.current.scrollTop = to;
        } else {
          containerRef.current.scrollLeft = to;
        }
        setCurrentSlide(index);
        devLog('[SectionSlider]:', {
          mode,
          action: 'end',
          fromIndex,
          toIndex: index,
          timestamp: Date.now(),
        });
        return;
      }

      // Use the custom animation utility to scroll smoothly
      animationRef.current = animateScroll({
        element: containerRef.current,
        to,
        duration: 600,
        axis,
        onComplete: () => {
          devLog('[SectionSlider]:', {
            mode,
            action: 'end',
            fromIndex,
            toIndex: index,
            timestamp: Date.now(),
          });
          animationRef.current = null;
        },
      });

      setCurrentSlide(index);
    },
    [isVertical, currentSlide, mode]
  );

  useEffect(() => {
    if (!slidesPerView) {
      setVisibleSlides(1);
      return undefined;
    }

    const updateSlidesPerView = () => {
      setVisibleSlides(resolveSlidesPerView());
    };

    updateSlidesPerView();

    if (typeof window === 'undefined') return undefined;

    window.addEventListener('resize', updateSlidesPerView);
    window.addEventListener('orientationchange', updateSlidesPerView);

    return () => {
      window.removeEventListener('resize', updateSlidesPerView);
      window.removeEventListener('orientationchange', updateSlidesPerView);
    };
  }, [slidesPerView, resolveSlidesPerView]);

  useEffect(() => {
    setMode(SECTION_SLIDER_MODE);
    return () => setMode('scroll');
  }, [setMode]);

  useEffect(() => {
    if (!autoAdvanceGroup || isVertical || !slidesPerView) return undefined;

    const groupSize = Math.max(1, slidesPerGroupRef.current);
    if (!containerRef.current || slides.length <= groupSize) return undefined;

    const advance = () => {
      const totalSlides = slidesLengthRef.current;
      if (!containerRef.current || !totalSlides) return;

      const maxIndex = Math.max(0, totalSlides - groupSize);
      let nextIndex = currentSlide + groupSize;
      if (nextIndex > maxIndex) {
        nextIndex = 0;
      }
      scrollToSlide(nextIndex);
    };

    const interval = setInterval(advance, 6000);
    autoAdvanceTimerRef.current = interval;

    return () => {
      clearInterval(interval);
      autoAdvanceTimerRef.current = null;
    };
  }, [
    autoAdvanceGroup,
    isVertical,
    slides.length,
    slidesPerView,
    visibleSlides,
    scrollToSlide,
    currentSlide,
  ]);

  useEffect(() => {
    if (prevSlideRef.current !== currentSlide) {
      devLog('[SectionSlider]:', {
        mode,
        action: 'index-change',
        fromIndex: prevSlideRef.current,
        toIndex: currentSlide,
        timestamp: Date.now(),
      });
      prevSlideRef.current = currentSlide;
    }
  }, [currentSlide, mode]);

  // Effect for handling custom scroll and swipe logic
  useEffect(() => {
    const container = containerRef.current;
    if (!container) return undefined;

    let swipeInProgress = false;

    // Touch event handlers for swipe gestures
    const handleTouchStart = (e) => {
      swipeInProgress = false; // Reset on new touch
      touchStartRef.current = {
        x: e.touches[0].clientX,
        y: e.touches[0].clientY,
        time: Date.now(),
      };
    };

    const handleTouchMove = (e) => {
      if (swipeInProgress || !touchStartRef.current.time) return;

      const deltaX = e.touches[0].clientX - touchStartRef.current.x;
      const deltaY = e.touches[0].clientY - touchStartRef.current.y;

      // Determine swipe direction only once per gesture
      if (Math.abs(deltaX) > 10 || Math.abs(deltaY) > 10) {
        swipeInProgress = true; // Mark this swipe as handled for this gesture

        // Vertical swipe logic
        if (isVertical && Math.abs(deltaY) > Math.abs(deltaX)) {
          devLog('[SectionSlider]:', {
            mode,
            action: 'direction-detected',
            direction: 'vertical',
            timestamp: Date.now(),
          });

          if (Math.abs(deltaY) > 50) {
            const direction = deltaY > 0 ? -1 : 1;
            const nextSlide = Math.max(
              0,
              Math.min(currentSlide + direction, slides.length - 1)
            );

            if (nextSlide !== currentSlide) {
              if (animationRef.current) {
                animationRef.current.cancel();
              }
              scrollToSlide(nextSlide);
            }
          }
        } else if (!isVertical && Math.abs(deltaX) > Math.abs(deltaY)) {
          // Horizontal swipe logic - prevent vertical page scroll
          e.preventDefault();
          devLog('[SectionSlider]:', {
            mode,
            action: 'direction-detected',
            direction: 'horizontal',
            timestamp: Date.now(),
          });
        }
      }
    };

    // Prevents default scroll and implements custom snap logic for vertical mode
    const handleWheel = (e) => {
      if (!isVertical) return;
      e.preventDefault();
      if (animationRef.current) {
        animationRef.current.cancel();
      }

      const direction = e.deltaY > 0 ? 1 : -1;
      const nextSlide = Math.max(
        0,
        Math.min(currentSlide + direction, slides.length - 1)
      );

      if (nextSlide !== currentSlide) {
        scrollToSlide(nextSlide);
      }
    };

    container.addEventListener('wheel', handleWheel, { passive: false });
    container.addEventListener('touchstart', handleTouchStart, {
      passive: true,
    });
    container.addEventListener('touchmove', handleTouchMove, { passive: false });

    return () => {
      container.removeEventListener('wheel', handleWheel);
      container.removeEventListener('touchstart', handleTouchStart);
      container.removeEventListener('touchmove', handleTouchMove);
    };
  }, [isVertical, currentSlide, slides.length, scrollToSlide, mode]);

  useEffect(() => {
    if (!showHint || !hasMultipleSlides) return;
    const hintShown = safeSessionStorage.getItem(hintStorageKey);
    if (!hintShown) setShowHintOverlay(true);
  }, [showHint, hasMultipleSlides, hintStorageKey]);

  const containerClasses = ['relative', 'h-full', className]
    .filter(Boolean)
    .join(' ');

  return (
    <div className={containerClasses} style={style}>
      <div
        ref={containerRef}
        className={
          isVertical
            ? 'reel-vertical h-full overflow-y-hidden'
            : 'overflow-x-auto flex snap-x snap-mandatory is-horizontal-scroll-container'
        }
        style={
          isVertical
            ? {
                overscrollBehavior: 'contain',
              }
            : {
                scrollbarWidth: 'none',
                msOverflowStyle: 'none',
              }
        }
      >
        {slides.map((slide, index) => {
          const slidesInView = Math.max(1, visibleSlides);
          const slideWidth = `${100 / slidesInView}%`;
          return (
            <div
              key={index}
              ref={(el) => (slideRefs.current[index] = el)}
              className={
                isVertical
                  ? 'reel-section'
                  : 'reel-section flex-shrink-0 snap-start-x'
              }
              style={
                !isVertical && slidesPerView
                  ? {
                      width: slideWidth,
                      flexBasis: slideWidth,
                    }
                  : undefined
              }
              data-slide-index={index}
            >
              {slide}
            </div>
          );
        })}
      </div>

      {showHint && hasMultipleSlides && (
        <SwipeHint
          show={showHintOverlay}
          mode={mode}
          onDismiss={() => {
            setShowHintOverlay(false);
            safeSessionStorage.setItem(hintStorageKey, 'true');
          }}
        />
      )}

      {hasMultipleSlides && (
        <div
          className="absolute bottom-8 left-1/2 transform -translate-x-1/2 flex gap-1"
          role="tablist"
          aria-label={`${sliderId} slides`}
        >
          {(slidesPerView
            ? Array.from(
                {
                  length: Math.ceil(slides.length / Math.max(1, visibleSlides)),
                },
                (_, groupIndex) => groupIndex * Math.max(1, visibleSlides)
              )
            : slides.map((_, index) => index)
          ).map((startIndex, indicatorIndex) => {
            const groupSize = Math.max(1, visibleSlides);
            const isActive = slidesPerView
              ? currentSlide >= startIndex &&
                currentSlide < startIndex + groupSize
              : currentSlide === startIndex;
            return (
              <button
                key={startIndex}
                role="tab"
                aria-selected={isActive}
                className={`min-w-[44px] min-h-[44px] rounded-full transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-secondary focus:ring-offset-2 flex items-center justify-center`}
                onClick={() => scrollToSlide(startIndex)}
                aria-label={`Go to slide ${indicatorIndex + 1} of ${
                  slidesPerView
                    ? Math.ceil(slides.length / Math.max(1, visibleSlides))
                    : slides.length
                }`}
              >
                <span
                  className={`h-2 w-2 rounded-full transition-all duration-300 ${
                    isActive
                      ? 'bg-secondary scale-125'
                      : 'bg-gray-300 group-hover:bg-gray-400'
                  }`}
                />
                <span className="sr-only">Slide {indicatorIndex + 1}</span>
              </button>
            );
          })}
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/components/navigation/SwipeHint.jsx">
import { useEffect } from 'react';

const HINT_MESSAGES = {
  vertical: '↑ Swipe up / down ↓',
  horizontal: '← Swipe for more →',
};

export default function SwipeHint({ show, mode = 'horizontal', onDismiss }) {
  useEffect(() => {
    if (!show) return undefined;

    const timer = setTimeout(() => {
      if (onDismiss) onDismiss();
    }, 3000);

    return () => clearTimeout(timer);
  }, [show, onDismiss]);

  if (!show) return null;

  const message = HINT_MESSAGES[mode] ?? HINT_MESSAGES.horizontal;

  return (
    <div className="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 z-20 bg-black/70 text-white px-6 py-3 rounded-full text-sm font-medium animate-pulse">
      {message}
    </div>
  );
}
</file>

<file path="src/components/Pagination.jsx">
const Pagination = ({ currentPage, totalPages, onPageChange }) => {
  const getPageNumbers = () => {
    const pages = [];

    if (totalPages <= 7) {
      for (let i = 1; i <= totalPages; i++) {
        pages.push(i);
      }
    } else {
      if (currentPage <= 4) {
        pages.push(1, 2, 3, 4, 5, '...', totalPages);
      } else if (currentPage >= totalPages - 3) {
        pages.push(
          1,
          '...',
          totalPages - 4,
          totalPages - 3,
          totalPages - 2,
          totalPages - 1,
          totalPages
        );
      } else {
        pages.push(
          1,
          '...',
          currentPage - 1,
          currentPage,
          currentPage + 1,
          '...',
          totalPages
        );
      }
    }

    return pages;
  };

  return (
    <div className="flex flex-wrap justify-center items-center space-x-1 mt-4 text-sm sm:text-base">
      <button
        disabled={currentPage === 1}
        onClick={() => onPageChange(currentPage - 2)}
        className="px-2 py-1 border rounded disabled:opacity-50"
      >
        Prev
      </button>

      {getPageNumbers().map((page, idx) =>
        page === '...' ? (
          <span key={idx} className="px-2 py-1 text-gray-500">
            ...
          </span>
        ) : (
          <button
            key={page}
            onClick={() => onPageChange(page - 1)}
            className={`px-2 py-1 border rounded ${
              currentPage === page
                ? 'border-keyline text-gray-800'
                : 'bg-white text-gray-800'
            }`}
          >
            {page}
          </button>
        )
      )}

      <button
        disabled={currentPage === totalPages}
        onClick={() => onPageChange(currentPage)}
        className="px-2 py-1 border rounded disabled:opacity-50"
      >
        Next
      </button>
    </div>
  );
};

export default Pagination;
</file>

<file path="src/components/PaymentsTable.jsx">
export default function PaymentsTable({ payments = [] }) {
  return (
    <table className="w-full text-left border mt-4">
      <thead>
        <tr>
          <th className="p-2 border">Mode</th>
          <th className="p-2 border">Amount</th>
          <th className="p-2 border">Ref</th>
          <th className="p-2 border">Date</th>
        </tr>
      </thead>
      <tbody>
        {payments.map((p) => (
          <tr key={p.id} className="border-t">
            <td className="p-2 border">{p.mode}</td>
            <td className="p-2 border">{p.amount}</td>
            <td className="p-2 border">{p.ref_no || '-'}</td>
            <td className="p-2 border">{p.date}</td>
          </tr>
        ))}
      </tbody>
    </table>
  );
}
</file>

<file path="src/components/qr/QRScanSection.jsx">
import { useEffect, useRef, useState } from 'react';
import { Html5Qrcode, Html5QrcodeScannerState } from 'html5-qrcode';

const QRScanSection = ({ onScanComplete, status, setStatus }) => {
  const [scanning, setScanning] = useState(false);
  const [cameraFacing, setCameraFacing] = useState('environment');
  const [progress, setProgress] = useState(100);
  const timerRef = useRef(null);
  const scannerInstance = useRef(null);
  const scannerStateRef = useRef(Html5QrcodeScannerState.UNKNOWN);

  // Scanner lifecycle management
  useEffect(() => {
    startScanner();
    return () => {
      stopScanner();
      scannerInstance.current = null;
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [cameraFacing]);

  const startScanner = () => {
    if (scanning) return;

    // Clear existing scanner
    if (scannerInstance.current) {
      stopScannerInstance();
    }

    const scanner = new Html5Qrcode('qr-reader');
    scannerInstance.current = scanner;
    setStatus('init');
    setScanning(true);
    setProgress(100);

    // Track scanner state
    scannerStateRef.current = Html5QrcodeScannerState.STARTING;

    // 30-second timeout
    let countdown = 30;
    timerRef.current = setInterval(() => {
      countdown--;
      setProgress((countdown / 30) * 100);
      if (countdown === 0) {
        stopScanner();
        setStatus('timeout');
      }
    }, 1000);

    scanner
      .start(
        { facingMode: cameraFacing },
        { fps: 10, qrbox: 250 },
        (decodedText) => {
          stopScanner();

          // Validate QR format
          const qrData = decodedText.split(',');
          if (qrData.length !== 2 || !qrData[0] || !qrData[1]) {
            setStatus('invalid');
            return;
          }

          const [instagram_id, enrollment_no] = qrData;
          onScanComplete({ instagram_id, enrollment_no });
        },
        (error) => {
          if (error.name === 'NotAllowedError') {
            setStatus('camera-permission-denied');
            scannerStateRef.current = Html5QrcodeScannerState.UNKNOWN;
          } else if (error.name === 'NotFoundError') {
            setStatus('camera-error');
            scannerStateRef.current = Html5QrcodeScannerState.UNKNOWN;
          }
        }
      )
      .then(() => {
        scannerStateRef.current = Html5QrcodeScannerState.SCANNING;
      })
      .catch((error) => {
        if (error.name === 'NotAllowedError') {
          setStatus('camera-permission-denied');
          scannerStateRef.current = Html5QrcodeScannerState.UNKNOWN;
        } else {
          setStatus('camera-error');
          scannerStateRef.current = Html5QrcodeScannerState.UNKNOWN;
        }
      });
  };

  const stopScannerInstance = () => {
    const scanner = scannerInstance.current;
    if (scanner && typeof scanner.stop === 'function') {
      // Only stop if scanner is in a stoppable state
      if (
        scannerStateRef.current === Html5QrcodeScannerState.SCANNING ||
        scannerStateRef.current === Html5QrcodeScannerState.PAUSED
      ) {
        scanner
          .stop()
          .then(() => {
            scannerStateRef.current = Html5QrcodeScannerState.STOPPED;
          })
          .catch((error) => {
            console.warn('Scanner stop error:', error.message);
            scannerStateRef.current = Html5QrcodeScannerState.UNKNOWN;
          });
      }
    }
  };

  const stopScanner = () => {
    clearInterval(timerRef.current);
    setScanning(false);
    setProgress(0);
    stopScannerInstance();
  };

  const renderStatus = () => {
    switch (status) {
      case 'fetching':
        return (
          <p className="text-gray-700 animate-pulse">
            Fetching user details...
          </p>
        );
      case 'invalid':
        return <p className="text-red-500">Invalid or mismatched QR code.</p>;
      case 'redeemed':
        return (
          <p className="text-green-600">This code has already been redeemed.</p>
        );
      case 'timeout':
        return (
          <p className="text-yellow-500">⏳ Time's up! Please scan again.</p>
        );
      case 'camera-error':
        return <p className="text-red-600">📷 Camera not found</p>;
      case 'camera-permission-denied':
        return (
          <p className="text-red-600">
            📷 Camera permission denied. Please allow access.
          </p>
        );
      default:
        return (
          <p className="text-gray-600">
            📷 Align the QR inside the frame to scan
          </p>
        );
    }
  };

  return (
    <div className="w-full max-w-sm mx-auto text-center">
      {renderStatus()}

      <div className="relative w-full aspect-square bg-black rounded-xl shadow-lg overflow-hidden my-4">
        <div id="qr-reader" className="absolute inset-0"></div>

        {/* Scan animation */}
        {scanning && (
          <div className="absolute inset-x-10 top-0 h-1 bg-red-500 animate-ping rounded-full"></div>
        )}

        {/* Corner markers */}
        {[
          'top-5 left-5',
          'top-5 right-5',
          'bottom-5 left-5',
          'bottom-5 right-5',
        ].map((pos, i) => (
          <div
            key={i}
            className={`absolute w-5 h-5 border-2 border-white ${pos}`}
          ></div>
        ))}
      </div>

      {/* Progress Bar */}
      {scanning && (
        <div className="h-1 w-full bg-gray-200 rounded overflow-hidden">
          <div
            className="h-full bg-gray-500 transition-all duration-1000"
            style={{ width: `${progress}%` }}
          ></div>
        </div>
      )}

      {/* Camera Controls */}
      <div className="mt-6 space-y-3">
        <button
          onClick={() =>
            setCameraFacing((prev) =>
              prev === 'environment' ? 'user' : 'environment'
            )
          }
          className="px-4 py-2 rounded-full text-white bg-gray-700 hover:bg-gray-900 transition"
        >
          Switch Camera
        </button>

        {!scanning && (
          <button
            onClick={startScanner}
            className="block w-full py-3 bg-gray-500 text-white font-semibold rounded-lg shadow hover:bg-black"
          >
            Scan Again
          </button>
        )}
      </div>
    </div>
  );
};

export default QRScanSection;
</file>

<file path="src/components/ReceiptForm.jsx">
import { useState } from 'react';
import { useCreatePaymentMutation } from '../api/erpApi';

export default function ReceiptForm({ invoiceId, onSuccess }) {
  const [form, setForm] = useState({ mode: 'cash', amount: '', ref_no: '' });
  const [createPayment] = useCreatePaymentMutation();

  const handleSubmit = async (e) => {
    e.preventDefault();
    await createPayment({
      invoice: invoiceId,
      ...form,
      date: new Date().toISOString().slice(0, 10),
    }).unwrap();
    onSuccess?.();
  };

  return (
    <form onSubmit={handleSubmit} className="p-4 bg-white rounded space-y-2">
      <select
        value={form.mode}
        onChange={(e) => setForm({ ...form, mode: e.target.value })}
        className="input w-full"
      >
        <option value="cash">Cash</option>
        <option value="card">Card</option>
        <option value="upi">UPI</option>
        <option value="emi">EMI</option>
      </select>
      <input
        placeholder="Amount"
        type="number"
        value={form.amount}
        onChange={(e) => setForm({ ...form, amount: e.target.value })}
        className="input w-full"
      />
      <input
        placeholder="Reference"
        value={form.ref_no}
        onChange={(e) => setForm({ ...form, ref_no: e.target.value })}
        className="input w-full"
      />
      <button
        className="bg-green-600 text-white px-4 py-2 rounded"
        type="submit"
      >
        Record Payment
      </button>
    </form>
  );
}
</file>

<file path="src/components/reels/__tests__/QuickActionsReel.test.jsx">
import { render, screen } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import { describe, expect, it } from 'vitest';
import QuickActionsReel from '../QuickActionsReel';

describe('QuickActionsReel', () => {
  it('renders header, three repair cards and CTA link', () => {
    render(
      <MemoryRouter>
        <QuickActionsReel />
      </MemoryRouter>
    );

    expect(screen.getByText('Most Popular Repairs')).toBeTruthy();
    expect(screen.getAllByText(/Book Now/i).length).toBe(3);
    const firstLink = screen.getAllByRole('link', { name: /Book Now/i })[0];
    expect(firstLink.getAttribute('href')).toBe('/repair?service=screen');
    const ctaLink = screen.getByRole('link', {
      name: /View all repair services/i,
    });
    expect(ctaLink.getAttribute('href')).toBe('/repair');
  });
});
</file>

<file path="src/components/reels/__tests__/TestimonialsReel.test.jsx">
// @vitest-environment jsdom
import { render, screen } from '@testing-library/react';
import { describe, expect, it } from 'vitest';
import TestimonialsReel from '../TestimonialsReel';

describe('TestimonialsReel', () => {
  it('renders testimonials content', () => {
    render(<TestimonialsReel />);

    expect(screen.getAllByText('What Our Customers Say')[0]).toBeTruthy();
    [
      'Sachin Ramg',
      'Rathikamns Ganesha',
      'Shamili Krishnaraj',
      'Sahan Farooqui',
    ].forEach((name) => {
      expect(screen.getAllByText(name)[0]).toBeTruthy();
    });
  });
});
</file>

<file path="src/components/reels/HeroReel.jsx">
import SectionSlider from '@/components/navigation/SectionSlider';
import useDevice from '@/hooks/useDevice';
import phoneIllustration from '@/assets/phone-illustration.png';
import Button from '@/components/common/Button';

/**
 * Statistics displayed in the hero section
 */
const stats = [
  {
    id: 'rating',
    content: (
      <span className="inline-flex items-center gap-1">
        <span aria-hidden className="text-secondary">
          ★
        </span>
        <span>4.6/5 rating</span>
      </span>
    ),
  },
  { id: 'repairs', content: '10,000+ devices repaired' },
  { id: 'locations', content: '4 locations' },
];

/**
 * Desktop layout for hero section
 * Uses 12-column grid: 7 cols content, 5 cols image
 */
function DesktopLayout() {
  return (
    <div className="grid h-full w-full grid-cols-12 items-center gap-8">
      <div className="col-span-7 flex h-full flex-col justify-center gap-8 text-surface">
        <div className="space-y-4">
          <p className="text-body-md font-medium text-surface/90 break-words">
            Serving Coimbatore & Palakkad • 10+ Years Trusted
          </p>
          <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold leading-tight break-words">
            Expert Mobile & Laptop Repairs
          </h1>
          <p className="text-lg lg:text-xl text-surface/100 break-words">
            Same-day repairs • Free pickup & delivery • 90-day warranty
          </p>
        </div>

        <div className="flex flex-wrap gap-4">
          <Button to="/repair" variant="primary" size="lg">
            Get Instant Quote
          </Button>
          <Button to="/shop" variant="secondary" size="lg">
            Shop Accessories
          </Button>
        </div>

        <div className="flex flex-wrap items-center gap-6 text-body-sm text-surface/90">
          {stats.map((item) => (
            <div key={item.id}>{item.content}</div>
          ))}
        </div>
      </div>

      <div className="col-span-5 h-full overflow-hidden">
        <div className="relative flex h-full w-full items-center justify-center">
          <div
            aria-hidden
            className="absolute -top-24 -right-20 h-64 w-64 rounded-full bg-secondary/20 blur-3xl"
          />
          <div
            aria-hidden
            className="absolute bottom-0 left-8 h-48 w-48 rounded-full bg-secondary/10 blur-3xl"
          />
          <img
            src={phoneIllustration}
            alt="Smartphone undergoing repair"
            className="relative z-10 max-h-full w-auto drop-shadow-[0_30px_60px_rgba(0,0,0,0.45)]"
            loading="lazy"
          />
        </div>
      </div>
    </div>
  );
}

/**
 * Mobile layout for hero section
 * Centered content with background image overlay
 */
function MobileLayout() {
  return (
    <div className="relative flex h-full w-full flex-col justify-center">
      <div className="absolute inset-0 flex items-center justify-center">
        <img
          src={phoneIllustration}
          alt="Smartphone undergoing repair"
          className="max-h-[75%] max-w-full w-auto opacity-40 blur-sm"
          loading="lazy"
        />
      </div>

      <div className="relative z-10 flex flex-col items-center gap-6 text-center text-surface">
        <p className="text-body-sm font-medium text-surface/90 break-words px-4">
          Serving Coimbatore & Palakkad • 10+ Years Trusted
        </p>
        <h1 className="text-3xl sm:text-4xl font-bold leading-tight break-words px-4">
          Expert Mobile & Laptop Repairs
        </h1>
        <p className="text-base sm:text-lg text-surface/100 break-words px-4">
          Same-day repairs • Free pickup & delivery • 90-day warranty
        </p>

        <div className="flex w-full flex-col items-center gap-4 px-4">
          <Button to="/repair" variant="primary" size="md" className="w-full max-w-xs">
            Get Instant Quote
          </Button>
          <Button to="/shop" variant="secondary" size="md" className="w-full max-w-xs">
            Shop Accessories
          </Button>
        </div>
      </div>

      <div className="relative z-10 mt-8 flex flex-wrap items-center justify-center gap-4 px-4 text-center text-body-sm text-surface/90">
        {stats.map((item) => (
          <div key={item.id}>{item.content}</div>
        ))}
      </div>
    </div>
  );
}

/**
 * Hero Section Component
 * 
 * Main landing page hero with company value proposition, CTA buttons,
 * and key statistics. Renders different layouts for mobile vs desktop.
 * 
 * @component
 * @returns {React.Element} Hero section with responsive layout
 */
export default function HeroReel() {
  const { isMobile } = useDevice();

  const slides = [
    <div
      key="hero"
      className="relative w-full h-full overflow-hidden bg-gradient-to-br from-gray-800 via-gray-900 to-gray-950"
    >
      <div className="relative z-10 mx-auto flex h-full w-full items-center px-4 sm:px-6 lg:px-8">
        {isMobile ? <MobileLayout /> : <DesktopLayout />}
      </div>
    </div>,
  ];

  return (
    <section className="snap-start fullpage-section overflow-hidden">
      <SectionSlider mode="horizontal" sectionId="hero" showHint={false}>
        {slides}
      </SectionSlider>
    </section>
  );
}
</file>

<file path="src/components/reels/QuickActionsReel.jsx">
import SectionSlider from '@/components/navigation/SectionSlider';
import { Smartphone, Battery, PlugZap } from 'lucide-react';
import Button from '@/components/common/Button';

/**
 * Quick Actions Section Component
 * 
 * Displays popular repair services in a horizontal scrolling carousel.
 * Shows 1 slide on mobile, 2 on tablet, 3 on desktop.
 * 
 * Features:
 * - Service cards with pricing
 * - Direct booking links with service context
 * - Icon-based visual representation
 * 
 * @component
 * @returns {React.Element} Quick actions carousel section
 */
export default function QuickActionsReel() {
  const repairs = [
    {
      icon: Smartphone,
      title: 'Screen Repair',
      price: 'from ₹800',
      description: 'Cracked or damaged display',
      link: '/repair?service=screen',
      color: 'text-secondary',
    },
    {
      icon: Battery,
      title: 'Battery Replacement',
      price: 'from ₹600',
      description: 'Fast draining or dead battery',
      link: '/repair?service=battery',
      color: 'text-success',
    },
    {
      icon: PlugZap,
      title: 'Charging Port Fix',
      price: 'from ₹500',
      description: 'Loose or faulty charging port',
      link: '/repair?service=charging',
      color: 'text-secondary',
    },
  ];

  const slides = repairs.map(
    ({ icon, title, price, description, link, color }) => {
      const Icon = icon;
      return (
        <div
          key={title}
          className="flex h-full items-stretch px-2"
          aria-label={`${title} repair option`}
        >
          <article 
            className="flex w-full flex-col items-center justify-between space-y-4 rounded-2xl bg-surface p-6 text-center shadow-sm transition-all duration-300 hover:scale-105 hover:shadow-lg focus-within:ring-2 focus-within:ring-secondary focus-within:ring-offset-2"
            tabIndex="0"
          >
            <Icon className={`h-12 w-12 ${color}`} aria-hidden="true" />
            <div className="space-y-3">
              <h3 className="text-heading-md font-semibold text-primary">
                {title}
              </h3>
              <p className="text-display-md font-bold text-primary">{price}</p>
              <p className="text-body-md text-primary/60">{description}</p>
            </div>
            <Button to={link} variant="primary" size="md">
              Book Now
            </Button>
          </article>
        </div>
      );
    }
  );

  return (
    <section className="snap-start fullpage-section overflow-hidden bg-gradient-to-b from-secondary/40 to-surface">
      <div className="h-full flex flex-col items-center justify-center gap-6 px-4">
        <div className="text-center space-y-2">
          <h2 className="text-heading-xl font-bold text-primary">
            Most Popular Repairs
          </h2>
          <p className="text-body-lg text-primary/60">
            Transparent pricing • Same-day service • 90-day warranty
          </p>
        </div>

        <SectionSlider
          sectionId="quickActions"
          showHint
          mode="horizontal"
          className="w-full flex-1"
          slidesPerView={{ mobile: 1, tablet: 2, desktop: 3 }}
        >
          {slides}
        </SectionSlider>
      </div>
    </section>
  );
}
</file>

<file path="src/components/reels/TestimonialsReel.jsx">
import SectionSlider from '@/components/navigation/SectionSlider';
import PropTypes from 'prop-types';

/**
 * Testimonial data
 * TODO: Replace with API call to backend /api/landing/testimonials/
 */
const testimonials = [
  {
    id: 1,
    author: 'Sachin Ramg',
    time: '6 months ago',
    text: 'Fine tune is a good shop with good quality service and accessories.',
    service: 'Purchase & Accessories',
  },
  {
    id: 2,
    author: 'Rathikamns Ganesha',
    time: '2 years ago',
    text: 'Mobile not charging—fixed in 10 minutes.',
    service: 'Charging Port Repair',
  },
  {
    id: 3,
    author: 'Shamili Krishnaraj',
    time: '4 years ago',
    text: "Didn't think I'd get my phone back after a car ran over it… now it looks brand new with all my data back. Very happy.",
    service: 'Damage Recovery',
  },
  {
    id: 4,
    author: 'Sahan Farooqui',
    time: '6 months ago',
    text: 'Good shop with a wide range of mobile phones. Staff was very helpful, prices competitive, and service quick.',
    service: 'Phone Purchase',
  },
];

/**
 * Individual testimonial slide component
 * @param {Object} props - Component props
 * @param {Object} props.testimonial - Testimonial data
 * @param {number} props.testimonial.id - Unique identifier
 * @param {string} props.testimonial.author - Customer name
 * @param {string} props.testimonial.text - Testimonial content
 * @param {string} props.testimonial.service - Service type
 * @param {string} props.testimonial.time - Time ago
 */
function TestimonialSlide({ testimonial }) {
  return (
    <div className="w-full h-full flex items-center justify-center px-2 md:px-3">
      <div className="max-w-2xl mx-auto w-full">
        <div 
          className="bg-surface rounded-2xl p-6 shadow-lg flex flex-col items-center text-center space-y-4 transition-all duration-300 hover:scale-105 hover:shadow-xl focus-within:ring-2 focus-within:ring-secondary focus-within:ring-offset-2"
          tabIndex="0"
          role="article"
          aria-label={`Testimonial from ${testimonial.author}`}
        >
          <div className="flex justify-center" aria-label="5 out of 5 stars">
            {[...Array(5)].map((_, i) => (
              <span key={i} className="text-secondary text-heading-md" aria-hidden="true">
                ★
              </span>
            ))}
          </div>
          <blockquote className="text-body-lg text-primary leading-relaxed">
            "{testimonial.text}"
          </blockquote>
          <div>
            <p className="font-semibold text-primary text-body-md">
              {testimonial.author}
            </p>
            <p className="text-primary/60 text-body-sm">
              {testimonial.service} • {testimonial.time}
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

TestimonialSlide.propTypes = {
  testimonial: PropTypes.shape({
    id: PropTypes.number.isRequired,
    author: PropTypes.string.isRequired,
    text: PropTypes.string.isRequired,
    service: PropTypes.string.isRequired,
    time: PropTypes.string.isRequired,
  }).isRequired,
};

/**
 * Testimonials Section Component
 * 
 * Displays customer testimonials in a horizontal scrolling carousel.
 * Shows 1 slide on mobile, 2 on tablet, 3 on desktop.
 * 
 * @component
 * @returns {React.Element} Testimonials carousel section
 */
export default function TestimonialsReel() {
  const slides = testimonials.map((testimonial) => (
    <TestimonialSlide key={testimonial.id} testimonial={testimonial} />
  ));

  return (
    <section className="snap-start fullpage-section overflow-hidden bg-gradient-to-b from-surface/80 to-surface">
      <div className="h-full flex flex-col items-center justify-center gap-6 px-4">
        <div className="text-center space-y-2">
          <h2 className="text-heading-xl font-bold text-primary">
            What Our Customers Say
          </h2>
          <p className="text-body-md text-primary/60">
            Real feedback from customers across Coimbatore & Palakkad
          </p>
        </div>

        <SectionSlider
          sectionId="testimonials"
          showHint
          mode="horizontal"
          className="w-full flex-1"
          slidesPerView={{ mobile: 1, tablet: 2, desktop: 3 }}
        >
          {slides}
        </SectionSlider>
      </div>
    </section>
  );
}
</file>

<file path="src/components/repairs/MultiSelectIssues.jsx">
import { Fragment } from 'react';
import { Listbox, Transition } from '@headlessui/react';

export default function MultiSelectIssues({
  issues = [],
  value = [],
  onChange,
}) {
  const selectedLabels = value
    .map((id) => issues.find((i) => i.id === id)?.name)
    .filter(Boolean);
  return (
    <Listbox value={value} onChange={onChange} multiple>
      <Listbox.Label className="label">Issues</Listbox.Label>
      <div className="relative mt-1">
        <Listbox.Button className="input">
          {selectedLabels.length ? selectedLabels.join(', ') : 'Select issues'}
        </Listbox.Button>
        <Transition
          as={Fragment}
          leave="transition ease-in duration-100"
          leaveFrom="opacity-100"
          leaveTo="opacity-0"
        >
          <Listbox.Options className="absolute z-10 mt-1 max-h-60 w-full overflow-auto rounded bg-white shadow">
            {issues.map((issue) => (
              <Listbox.Option
                key={issue.id}
                value={issue.id}
                className={({ active }) =>
                  `cursor-pointer select-none p-2 ${active ? 'bg-gray-100' : ''}`
                }
              >
                {({ selected }) => (
                  <span className={selected ? 'font-medium' : 'font-normal'}>
                    {issue.name}
                  </span>
                )}
              </Listbox.Option>
            ))}
          </Listbox.Options>
        </Transition>
      </div>
    </Listbox>
  );
}
</file>

<file path="src/components/repairs/Questionnaire.jsx">
export default function Questionnaire({
  questions = [],
  responses = {},
  onChange,
}) {
  const handle = (id, value) => onChange({ ...responses, [id]: value });
  return (
    <div className="space-y-4">
      {questions.map((q) => (
        <div key={q.id}>
          <label className="label mb-1 block">{q.text}</label>
          {q.type === 'choice' ? (
            <div className="flex gap-4">
              {q.options.map((opt) => (
                <label key={opt} className="flex items-center gap-1">
                  <input
                    type="radio"
                    name={q.id}
                    value={opt}
                    checked={responses[q.id] === opt}
                    onChange={() => handle(q.id, opt)}
                  />
                  {opt}
                </label>
              ))}
            </div>
          ) : (
            <input
              className="input"
              value={responses[q.id] || ''}
              onChange={(e) => handle(q.id, e.target.value)}
            />
          )}
        </div>
      ))}
    </div>
  );
}
</file>

<file path="src/components/ResponsivePaginationHandler.jsx">
import { useEffect, useState, useRef } from 'react';
import Pagination from './Pagination';

const ResponsivePaginationHandler = ({
  currentPage,
  totalPages,
  size,
  totalElements,
  onPageChange,
  onMobilePageChange,
}) => {
  const [isMobile, setIsMobile] = useState(false);
  const loadingRef = useRef(false);
  const sentinelRef = useRef(null);

  useEffect(() => {
    const checkMobile = () => setIsMobile(window.innerWidth < 768);
    checkMobile();
    window.addEventListener('resize', checkMobile);
    return () => window.removeEventListener('resize', checkMobile);
  }, []);

  useEffect(() => {
    if (!isMobile || !sentinelRef.current) return;

    const observer = new IntersectionObserver((entries) => {
      entries.forEach((entry) => {
        if (
          entry.isIntersecting &&
          !loadingRef.current &&
          size < totalElements
        ) {
          loadingRef.current = true;
          onMobilePageChange(size + 10);
        }
      });
    });

    observer.observe(sentinelRef.current);
    return () => observer.disconnect();
  }, [isMobile, size, totalElements, onMobilePageChange]);

  useEffect(() => {
    loadingRef.current = false;
  }, [size]);

  return (
    <>
      {isMobile ? (
        <div
          ref={sentinelRef}
          className="h-10 w-full flex justify-center items-center"
        >
          {size < totalElements ? (
            <span className="text-gray-400 text-sm">
              Scroll to load more...
            </span>
          ) : (
            <span className="text-gray-400 text-sm">No more results</span>
          )}
        </div>
      ) : (
        <Pagination
          currentPage={currentPage}
          totalPages={totalPages}
          onPageChange={onPageChange}
        />
      )}
    </>
  );
};

export default ResponsivePaginationHandler;
</file>

<file path="src/components/Sales/CreateSaleInvoice.jsx">
import { useState, useEffect, useMemo } from 'react';
import { useCreateSaleInvoiceMutation, useSearchSaleProductsQuery } from '../../api/erpApi';
import { toast } from 'react-hot-toast';
import { useDebounce } from 'use-debounce';

const CreateSaleInvoice = () => {
  const [customerName, setCustomerName] = useState('');
  const [mobile, setMobile] = useState('');
  const [invoiceDate, setInvoiceDate] = useState(new Date().toISOString().split('T')[0]);
  const [items, setItems] = useState([
    { productId: null, productName: '', quantity: 1, rate: 0, unit: '', amount: 0, searchTerm: '' },
  ]);
  const [discount, setDiscount] = useState(0);
  const [errors, setErrors] = useState({});
  const [activeSearchIndex, setActiveSearchIndex] = useState(null);

  const [debouncedSearchTerm] = useDebounce(
    activeSearchIndex !== null ? items[activeSearchIndex]?.searchTerm : '',
    300
  );

  const [createInvoice, { isLoading }] = useCreateSaleInvoiceMutation();
  const { data: products, isFetching } = useSearchSaleProductsQuery(
    { search: debouncedSearchTerm },
    { skip: !debouncedSearchTerm || activeSearchIndex === null }
  );

  const handleItemChange = (index, field, value) => {
    const newItems = [...items];
    newItems[index][field] = value;
    if (field === 'quantity' || field === 'rate') {
      newItems[index].amount = (newItems[index].quantity || 0) * (newItems[index].rate || 0);
    }
    if (field === 'searchTerm') {
      setActiveSearchIndex(index);
    }
    setItems(newItems);
  };

  const handleProductSelect = (index, product) => {
    const newItems = [...items];
    newItems[index] = {
      ...newItems[index],
      productId: product.id,
      productName: `${product.product_name} - ${product.quality}`,
      rate: product.rate,
      unit: product.unit,
      amount: newItems[index].quantity * product.rate,
      searchTerm: '',
    };
    setItems(newItems);
    setActiveSearchIndex(null);
  };

  const addRow = () => {
    setItems([...items, { productId: null, productName: '', quantity: 1, rate: 0, unit: '', amount: 0, searchTerm: '' }]);
  };

  const removeRow = (index) => {
    const newItems = items.filter((_, i) => i !== index);
    if (newItems.length === 0) {
      setItems([{ productId: null, productName: '', quantity: 1, rate: 0, unit: '', amount: 0, searchTerm: '' }]);
    } else {
      setItems(newItems);
    }
  };

  const totalAmount = useMemo(() => items.reduce((sum, item) => sum + item.amount, 0), [items]);
  const grandTotal = useMemo(() => totalAmount - discount, [totalAmount, discount]);

  const validate = () => {
    const newErrors = {};
    if (!customerName || customerName.length < 2) newErrors.customerName = 'Customer name is required (min 2 chars)';
    if (!mobile || !/^\d{10}$/.test(mobile)) newErrors.mobile = 'A valid 10-digit mobile number is required';
    if (items.some(item => !item.productId)) newErrors.items = 'All items must have a product selected';
    if (items.some(item => item.quantity < 1)) newErrors.items = 'Quantity must be at least 1 for all items';
    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validate()) {
      toast.error('Please fix the errors before submitting.');
      return;
    }

    const payload = {
      customer_name: customerName,
      mobile,
      invoice_date: invoiceDate,
      items: items.map(item => ({
        product: item.productId,
        quantity: item.quantity,
        rate: item.rate,
        amount: item.amount,
      })),
      total_amount: totalAmount,
      discount,
      grand_total: grandTotal,
    };

    try {
      await createInvoice(payload).unwrap();
      toast.success('Invoice created successfully!');
      // Reset form
      setCustomerName('');
      setMobile('');
      setInvoiceDate(new Date().toISOString().split('T')[0]);
      setItems([{ productId: null, productName: '', quantity: 1, rate: 0, unit: '', amount: 0, searchTerm: '' }]);
      setDiscount(0);
      setErrors({});
    } catch (error) {
      toast.error(error.data?.message || 'Failed to create invoice.');
    }
  };

  return (
    <div className="max-w-4xl mx-auto p-6 bg-white rounded-lg shadow">
      <h1 className="text-2xl font-bold mb-6">Create Sale Invoice</h1>
      <form onSubmit={handleSubmit} className="space-y-6">
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          <div>
            <label htmlFor="customer_name" className="block text-sm font-medium text-gray-700 mb-2">Customer Name</label>
            <input
              id="customer_name"
              type="text"
              value={customerName}
              onChange={(e) => setCustomerName(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md"
            />
            {errors.customerName && <p className="text-red-500 text-xs mt-1">{errors.customerName}</p>}
          </div>
          <div>
            <label htmlFor="mobile" className="block text-sm font-medium text-gray-700 mb-2">Mobile Number</label>
            <input
              id="mobile"
              type="text"
              value={mobile}
              onChange={(e) => setMobile(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md"
            />
            {errors.mobile && <p className="text-red-500 text-xs mt-1">{errors.mobile}</p>}
          </div>
          <div>
            <label htmlFor="invoice_date" className="block text-sm font-medium text-gray-700 mb-2">Invoice Date</label>
            <input
              id="invoice_date"
              type="date"
              value={invoiceDate}
              onChange={(e) => setInvoiceDate(e.target.value)}
              className="w-full px-3 py-2 border border-gray-300 rounded-md"
            />
          </div>
        </div>

        <div className="mt-6">
          <h2 className="text-lg font-medium text-gray-900 mb-4">Items</h2>
          <div className="overflow-x-auto">
            <table className="w-full border-collapse">
              <thead>
                <tr className="bg-gray-50">
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rate</th>
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Amount</th>
                  <th className="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                </tr>
              </thead>
              <tbody className="bg-white divide-y divide-gray-200">
                {items.map((item, index) => (
                  <tr key={index}>
                    <td className="px-4 py-2 whitespace-nowrap">
                      <div className="relative">
                        <input
                          type="text"
                          placeholder="Search for a product..."
                          value={item.searchTerm || item.productName || ''}
                          onChange={(e) => handleItemChange(index, 'searchTerm', e.target.value)}
                          onFocus={() => setActiveSearchIndex(index)}
                          className="w-full px-3 py-2 border border-gray-300 rounded-md"
                        />
                        {isFetching && activeSearchIndex === index && <p>Loading...</p>}
                        {products && activeSearchIndex === index && (
                          <ul className="absolute z-10 w-full bg-white border border-gray-300 rounded-md mt-1 max-h-60 overflow-auto">
                            {products.map(p => (
                              <li
                                key={p.id}
                                className="px-4 py-2 cursor-pointer hover:bg-gray-100"
                                onClick={() => handleProductSelect(index, p)}
                              >
                                {p.product_name} - {p.quality}
                              </li>
                            ))}
                          </ul>
                        )}
                      </div>
                    </td>
                    <td className="px-4 py-2 whitespace-nowrap">
                      <input
                        type="number"
                        min="1"
                        value={item.quantity}
                        onChange={(e) => handleItemChange(index, 'quantity', parseInt(e.target.value, 10))}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md"
                      />
                    </td>
                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-500">{item.unit}</td>
                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-500">{item.rate.toFixed(2)}</td>
                    <td className="px-4 py-2 whitespace-nowrap text-sm text-gray-500">{item.amount.toFixed(2)}</td>
                    <td className="px-4 py-2 whitespace-nowrap">
                      <button
                        type="button"
                        onClick={() => removeRow(index)}
                        className="text-red-600 hover:text-red-800"
                      >
                        Delete
                      </button>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
          {errors.items && <p className="text-red-500 text-xs mt-1">{errors.items}</p>}
          <button
            type="button"
            onClick={addRow}
            className="mt-4 px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700"
          >
            Add Row
          </button>
        </div>

        <div className="flex justify-end mt-6">
          <div className="w-full max-w-sm space-y-2">
            <div className="flex justify-between">
              <span className="text-gray-600">Total</span>
              <span>{totalAmount.toFixed(2)}</span>
            </div>
            <div className="flex justify-between items-center">
              <label htmlFor="discount" className="text-gray-600">Discount</label>
              <input
                id="discount"
                type="number"
                value={discount}
                onChange={(e) => setDiscount(parseFloat(e.target.value) || 0)}
                className="w-32 px-3 py-2 border border-gray-300 rounded-md"
              />
            </div>
            <div className="flex justify-between font-bold text-lg">
              <span>Grand Total</span>
              <span>{grandTotal.toFixed(2)}</span>
            </div>
          </div>
        </div>

        <div className="flex justify-end pt-6">
          <button
            type="submit"
            disabled={isLoading}
            className="px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:bg-blue-300"
          >
            {isLoading ? 'Creating...' : 'Create Invoice'}
          </button>
        </div>
      </form>
    </div>
  );
};

export default CreateSaleInvoice;
</file>

<file path="src/components/Store/BranchHeadModal.jsx">
import { useEffect, useState } from 'react';
import { useAppDispatch } from '@/redux/hook';
import { useGetUsersQuery } from '@/api/erpApi';
import {
  assignBranchHeadToStore,
  unassignBranchHeadFromStore,
} from '../../api/store';
import toast from 'react-hot-toast';

const BranchHeadModal = ({ isOpen, onClose, store }) => {
  const dispatch = useAppDispatch();
  const { data } = useGetUsersQuery({ role: 'branch_head' }, { skip: !isOpen });
  const userData = data?.content ?? [];
  const [selectedUserId, setSelectedUserId] = useState('');
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (isOpen) {
      setSelectedUserId(store?.branch_head || '');
    }
  }, [isOpen, store]);

  if (!isOpen) return null;

  const availableBranchHeads = userData.filter(
    (user) =>
      user.role === 'branch_head' &&
      user.is_active &&
      !user.deleted &&
      (!user.headed_store || user.headed_store === store?.id)
  );

  const handleAssign = async () => {
    if (!selectedUserId) return;
    setLoading(true);
    const response = await dispatch(
      assignBranchHeadToStore({ storeId: store.id, userId: selectedUserId })
    );
    setLoading(false);
    if (response.meta.requestStatus === 'fulfilled') {
      toast.success('Branch head assigned');
      onClose();
    } else {
      toast.error(response.payload?.message || 'BAD REQUEST');
    }
  };

  const handleUnassign = async () => {
    setLoading(true);
    const response = await dispatch(
      unassignBranchHeadFromStore({
        storeId: store.id,
        userId: store.branch_head,
      })
    );
    setLoading(false);
    if (response.meta.requestStatus === 'fulfilled') {
      toast.success('Branch head unassigned');
      onClose();
    } else {
      toast.error(response.payload?.message || 'BAD REQUEST');
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
      <div className="bg-white p-6 rounded shadow-md w-full max-w-md">
        <h2 className="text-xl font-bold mb-4">Assign Branch Head</h2>
        <select
          className="w-full border px-3 py-2 mb-4 rounded"
          value={selectedUserId}
          onChange={(e) => setSelectedUserId(e.target.value)}
        >
          <option value="">Select branch head</option>
          {availableBranchHeads.map((user) => (
            <option
              key={user.id}
              value={user.id}
              className={user.store ? 'bg-red-100' : 'bg-green-100'}
            >
              {`${user.first_name} ${user.last_name}`}
              {user.store_name ? ` | ${user.store_name}` : ' | Unassigned'}
            </option>
          ))}
        </select>
        <div className="flex justify-end gap-2">
          {store?.branch_head && (
            <button
              onClick={handleUnassign}
              disabled={loading}
              className="px-4 py-2 bg-red-500 text-white rounded"
            >
              {loading ? 'Processing...' : 'Unassign'}
            </button>
          )}
          <button
            onClick={handleAssign}
            disabled={loading || !selectedUserId}
            className="px-4 py-2 bg-black text-white rounded"
          >
            {loading ? 'Processing...' : 'Assign'}
          </button>
          <button onClick={onClose} className="px-4 py-2 border rounded">
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

export default BranchHeadModal;
</file>

<file path="src/components/Store/StoreAssignModal.jsx">
import { useEffect, useState } from 'react';
import { useAppDispatch, useAppSelector } from '@/redux/hook';
import { assignStoreToUser, unassignStoreFromUser } from '../../api/user';
import {
  assignBranchHeadToStore,
  unassignBranchHeadFromStore,
} from '../../api/store';
import toast from 'react-hot-toast';

const StoreAssignModal = ({ isOpen, onClose, user }) => {
  const dispatch = useAppDispatch();
  const { stores, loading } = useAppSelector((state) => state.store);
  const [selectedStoreId, setSelectedStoreId] = useState('');

  useEffect(() => {
    if (isOpen) {
      setSelectedStoreId(user.store || '');
    }
  }, [isOpen, dispatch, user]);

  if (!isOpen) return null;

  const handleAssign = async () => {
    if (!selectedStoreId) return;
    try {
      let response;
      if (user.role === 'branch_head') {
        response = await dispatch(
          assignBranchHeadToStore({
            storeId: Number(selectedStoreId),
            userId: user.id,
          })
        );
      } else {
        response = await dispatch(
          assignStoreToUser({ userId: user.id, store: Number(selectedStoreId) })
        );
      }
      if (response.meta.requestStatus === 'fulfilled') {
        toast.success('Store assigned');
        onClose();
      } else {
        toast.error(response.payload?.message || 'BAD REQUEST');
      }
    } catch (error) {
      toast.error(error?.message);
    }
  };

  const handleUnassign = async () => {
    try {
      let response;
      if (user.role === 'branch_head') {
        response = await dispatch(
          unassignBranchHeadFromStore({
            storeId: Number(selectedStoreId),
            userId: user.id,
          })
        );
      } else {
        response = await dispatch(unassignStoreFromUser({ userId: user.id }));
      }
      if (response.meta.requestStatus === 'fulfilled') {
        toast.success('Store unassigned');
        onClose();
      } else {
        toast.error(response.payload?.message || 'BAD REQUEST');
      }
    } catch (error) {
      toast.error(error?.message);
    }
  };

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
      <div className="bg-white p-6 rounded shadow-md w-full max-w-md">
        <h2 className="text-xl font-bold mb-4">Assign Store</h2>
        <select
          className="w-full border px-3 py-2 mb-4 rounded"
          value={selectedStoreId}
          onChange={(e) => setSelectedStoreId(e.target.value)}
        >
          <option value="">Select store</option>
          {stores.map((store) => (
            <option key={store.id} value={store.id}>
              {store.store_name || store.code}
            </option>
          ))}
        </select>
        <div className="flex justify-end gap-2">
          {user?.store && (
            <button
              onClick={handleUnassign}
              disabled={loading}
              className="px-4 py-2 bg-red-500 text-white rounded"
            >
              {loading ? 'Processing...' : 'Unassign'}
            </button>
          )}
          <button
            onClick={handleAssign}
            disabled={loading || !selectedStoreId}
            className="px-4 py-2 bg-black text-white rounded"
          >
            {loading ? 'Processing...' : 'Assign'}
          </button>
          <button onClick={onClose} className="px-4 py-2 border rounded">
            Cancel
          </button>
        </div>
      </div>
    </div>
  );
};

export default StoreAssignModal;
</file>

<file path="src/components/Store/StoreFilters.jsx">
const StoreFilters = ({
  search,
  status,
  branchHead,
  onSearchChange,
  onStatusChange,
  onBranchHeadChange,
}) => {
  return (
    <div className="flex flex-col sm:flex-row sm:items-center gap-4 mb-6">
      {/* Search Input */}
      <input
        type="text"
        placeholder="Search stores..."
        className="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline transition"
        value={search}
        onChange={(e) => onSearchChange(e.target.value)}
      />

      {/* Status Filter */}
      <div className="w-full sm:w-auto relative">
        <select
          className="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-keyline appearance-none transition"
          value={status}
          onChange={(e) => onStatusChange(e.target.value)}
        >
          <option value="">All Status</option>
          <option value="active">Active</option>
          <option value="inactive">Inactive</option>
        </select>
        {/* Dropdown Icon */}
        <div className="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500">
          <svg
            className="h-4 w-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </div>
      </div>

      {/* Branch Head Filter */}
      <div className="w-full sm:w-auto relative">
        <select
          className="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-700 focus:outline-none focus:ring-2 focus:ring-keyline appearance-none transition"
          value={branchHead}
          onChange={(e) => onBranchHeadChange(e.target.value)}
        >
          <option value="">All Stores</option>
          <option value="assigned">With Branch Head</option>
          <option value="unassigned">Without Branch Head</option>
        </select>
        {/* Dropdown Icon */}
        <div className="pointer-events-none absolute inset-y-0 right-3 flex items-center text-gray-500">
          <svg
            className="h-4 w-4"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              strokeLinecap="round"
              strokeLinejoin="round"
              strokeWidth="2"
              d="M19 9l-7 7-7-7"
            />
          </svg>
        </div>
      </div>
    </div>
  );
};

export default StoreFilters;
</file>

<file path="src/components/ToggleStatusModal.jsx">
const ToggleStatusModal = ({ isOpen, onClose, handleToggleStatus, value }) => {
  if (!isOpen) return null;

  return (
    <div className="fixed inset-0 z-50 flex items-center justify-center bg-black/50 px-4">
      <div className="w-full max-w-sm rounded-lg bg-white p-6 shadow-md sm:max-w-md">
        <h2 className="text-lg font-semibold text-gray-800 mb-4">
          {value.is_active ? 'Deactivate Item?' : 'Activate Item?'}
        </h2>
        <p className="text-sm text-gray-600 mb-6">
          Are you sure you want to {value.is_active ? 'deactivate' : 'activate'}{' '}
          this item?
        </p>
        <div className="flex justify-end space-x-2">
          <button
            onClick={onClose}
            className="px-4 py-2 rounded bg-gray-200 text-gray-700 hover:bg-gray-300"
          >
            Cancel
          </button>
          <button
            onClick={() => handleToggleStatus(value)}
            className={`px-4 py-2 rounded ${
              value.is_active
                ? 'bg-yellow-600 text-white hover:bg-yellow-700'
                : 'bg-green-600 text-white hover:bg-green-700'
            }`}
          >
            {value.is_active ? 'Deactivate' : 'Activate'}
          </button>
        </div>
      </div>
    </div>
  );
};

export default ToggleStatusModal;
</file>

<file path="src/hooks/useDevice.js">
import { useCallback, useEffect, useMemo, useState } from 'react';

export default function useDevice() {
  const queries = useMemo(() => {
    if (
      typeof window === 'undefined' ||
      typeof window.matchMedia !== 'function'
    ) {
      return null;
    }
    try {
      const mobile = window.matchMedia('(max-width: 767px)');
      const desktop = window.matchMedia('(min-width: 768px)');
      const touch = window.matchMedia('(pointer: coarse)');
      if (!mobile || !desktop || !touch) return null;
      return { mobile, desktop, touch };
    } catch (err) {
      console.warn('useDevice: matchMedia failed', err);
      return null;
    }
  }, []);

  const getInfo = useCallback(() => {
    if (!queries) {
      return { isMobile: false, isDesktop: true, hasTouch: false };
    }
    return {
      isMobile: queries.mobile.matches,
      isDesktop: queries.desktop.matches,
      hasTouch: queries.touch.matches,
    };
  }, [queries]);

  const [state, setState] = useState(getInfo);

  useEffect(() => {
    if (!queries) return;
    const handler = () => setState(getInfo());
    handler();
    queries.mobile.addEventListener('change', handler);
    queries.desktop.addEventListener('change', handler);
    queries.touch.addEventListener('change', handler);
    window.addEventListener('resize', handler);
    return () => {
      queries.mobile.removeEventListener('change', handler);
      queries.desktop.removeEventListener('change', handler);
      queries.touch.removeEventListener('change', handler);
      window.removeEventListener('resize', handler);
    };
  }, [queries, getInfo]);

  return state;
}
</file>

<file path="src/hooks/useViewportHeight.js">
import { useEffect } from 'react';

/**
 * Updates CSS custom property for accurate viewport height on mobile devices.
 * 
 * Mobile browsers have UI that appears/disappears (address bar, toolbars),
 * causing viewport height to change. This hook updates --vh property
 * to reflect the actual viewport height, preventing layout jumps.
 * 
 * @example
 * // In a layout component
 * useViewportHeight();
 * 
 * // Then in CSS, use:
 * // height: calc(var(--vh, 1vh) * 100);
 */
export function useViewportHeight() {
  useEffect(() => {
    function updateViewportHeight() {
      const vh = window.innerHeight * 0.01;
      document.documentElement.style.setProperty('--vh', `${vh}px`);
    }

    // Set initial value
    updateViewportHeight();

    // Update on resize and orientation change
    window.addEventListener('resize', updateViewportHeight);
    window.addEventListener('orientationchange', updateViewportHeight);

    // Cleanup
    return () => {
      window.removeEventListener('resize', updateViewportHeight);
      window.removeEventListener('orientationchange', updateViewportHeight);
    };
  }, []);
}
</file>

<file path="src/index.css">
@tailwind base;
@tailwind components;
@tailwind utilities;

/* App shell layout helpers */
html,
body,
#root {
  height: 100%;
  margin: 0;
  padding: 0;
  background: var(--surface, #fff);
  color: var(--onSurface, #000);
}

:root {
  --fullpage-section-h: calc(
    100vh - var(--topbar-h, 0px) - var(--navbar-h, var(--mainnav-h, 0px))
  );
}

@supports (height: 100dvh) {
  :root {
    --fullpage-section-h: calc(
      100dvh - var(--topbar-h, 0px) - var(--navbar-h, var(--mainnav-h, 0px))
    );
  }
}

/* Smooth scroll snap behavior */
html {
  scroll-behavior: smooth;
}

/* Optimize mobile scrolling performance */
@media (max-width: 768px) {
  * {
    -webkit-tap-highlight-color: transparent;
  }
  
  html, body {
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/* Fixed navigation positioning */
.top-bar,
#topbar,
.main-nav,
#mainnav {
  position: fixed;
  width: 100%;
  left: 0;
  z-index: 1000;
}

.top-bar,
#topbar {
  top: 0;
}

.main-nav,
#mainnav {
  top: var(--topbar-h, 0px);
}

.fullpage-scrolling {
  user-select: none;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  scroll-snap-type: y proximity;
  scroll-padding-top: 0;
  scroll-padding-bottom: 0;
  overscroll-behavior: none;
  /* GPU acceleration for smooth performance */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* Better scroll snap support */
.snap-y {
  scroll-snap-type: y proximity;
  scroll-padding-top: 0;
  scroll-padding-bottom: 0;
  overscroll-behavior: none;
}

.snap-mandatory {
  scroll-snap-type: y proximity;
}

.snap-start {
  scroll-snap-align: start;
}

/* Force snap stops - helps with Chrome issues */
.snap-always {
  scroll-snap-stop: always;
}

/* Ensure scroll snap containers work properly */
/* Horizontal scroll snap for multi-slide reels */
.snap-x {
  scroll-snap-type: x mandatory;
  scroll-padding-left: 0;
  scroll-padding-right: 0;
  overscroll-behavior-x: contain;
  scroll-behavior: smooth;
  /* Optimize horizontal scrolling performance */
  -webkit-overflow-scrolling: touch;
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  /* Add small gap between slides on desktop */
  gap: 0.5rem;
}

@media (min-width: 768px) {
  .snap-x {
    gap: 1rem;
  }
}

.snap-start-x {
  scroll-snap-align: start;
}

[dir='rtl'] .snap-x {
  scroll-snap-type: x mandatory;
  direction: rtl;
}

[dir='rtl'] .snap-start-x {
  scroll-snap-align: end;
}

/* Hide horizontal scrollbars */
.snap-x::-webkit-scrollbar {
  display: none;
}

.snap-x {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

[style*='scroll-snap-type'] {
  -webkit-overflow-scrolling: touch;
}

/* Hide scrollbar for cleaner reels experience */
.snap-y::-webkit-scrollbar {
  width: 0;
  background: transparent;
}

.reel-vertical {
  height: var(--fullpage-section-h, 100%);
  max-height: var(--fullpage-section-h, 100%);
  overscroll-behavior-y: contain;
  scroll-behavior: smooth;
  padding-bottom: var(--bottomnav-h, 0px);
}

/* Fix horizontal reel section height for backgrounds */
.reel-section {
  min-height: var(
    --reel-section-min-h,
    var(--fullpage-section-h, 100vh)
  );
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.reel-vertical .reel-section {
  min-height: var(--fullpage-section-h, 100%);
  padding-block: clamp(1.5rem, 3vw, 3rem);
}

/* Smooth transitions for section indicators */
.section-indicator {
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
}

/* Optimize performance for fullpage scrolling */
.fullpage-section {
  height: var(--fullpage-section-h) !important;
  width: 100vw;
  overflow-x: hidden; /* Prevent horizontal overflow */
  will-change: transform;
  backface-visibility: hidden;
  transform-style: preserve-3d;
  flex-shrink: 0;
  /* GPU acceleration */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
}

/* Improve snap scrolling on mobile */
@media (max-width: 768px) {
  .fullpage-section {
    scroll-snap-align: start;
    scroll-snap-stop: always;
  }
  
  .snap-x {
    scroll-snap-type: x mandatory;
    /* Smoother scrolling on mobile */
    scroll-behavior: smooth;
  }
  
  .snap-start-x {
    scroll-snap-align: start;
    scroll-snap-stop: normal; /* Allow faster scrolling through multiple items */
  }
}

.fullpage-scrolling .fullpage-section {
  scroll-snap-align: start;
  scroll-snap-stop: always;
}

.fullpage-scrolling::-webkit-scrollbar {
  width: 0;
  background: transparent;
}

/* Bottom nav (default state) */
.bottom-nav {
  will-change: transform;
  /* GPU acceleration */
  transform: translateZ(0);
  -webkit-transform: translateZ(0);
  backface-visibility: hidden;
}

/* Safe area fix for iOS */
.bottom-nav {
  padding-bottom: env(safe-area-inset-bottom, 0);
  bottom: env(safe-area-inset-bottom, 0);
}

/* No additional spacing needed - fullpage-section height already accounts for nav */

@keyframes swipe-pulse {
  0%,
  100% {
    opacity: 0.8;
  }
  50% {
    opacity: 1;
  }
}

.animate-pulse {
  animation: swipe-pulse 2s infinite;
}
</file>

<file path="src/main.jsx">
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './index.css';
import { LayoutProvider } from './params/LayoutContext.jsx';
import { Provider } from 'react-redux';
import store from './redux/store.js';

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <Provider store={store}>
      <LayoutProvider>
        <App />
      </LayoutProvider>
    </Provider>
  </React.StrictMode>
);
</file>

<file path="src/pages/__tests__/bookingsDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import BookingsDashboard from '../internal/BookingsDashboard';

const updateMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });
const createMock = vi.fn();

vi.mock('../../api/erpApi', () => ({
  useGetBookingsQuery: () => ({
    data: {
      content: [{ id: 1, name: 'A', status: 'pending', reason: 'delay' }],
    },
    isLoading: false,
  }),
  useUpdateBookingStatusMutation: () => [updateMock],
  useGetInvoicesQuery: () => ({ data: [] }),
  useCreateStockEntryMutation: () => [createMock],
  useGetStockEntriesQuery: () => ({ data: [] }),
}));

test('reject requires reason', () => {
  render(<BookingsDashboard />);
  fireEvent.click(screen.getByText('Reject'));
  fireEvent.click(screen.getByText('Submit'));
  expect(updateMock).not.toHaveBeenCalled();
  fireEvent.change(screen.getByPlaceholderText('Reason'), {
    target: { value: 'not valid' },
  });
  fireEvent.click(screen.getByText('Submit'));
  expect(updateMock).toHaveBeenCalledWith({
    id: 1,
    status: 'rejected',
    reason: 'not valid',
  });
});

test('shows reason in table', () => {
  render(<BookingsDashboard />);
  expect(screen.getAllByText('delay').length).toBeGreaterThan(0);
});

test('sale entry includes booking id', () => {
  render(<BookingsDashboard />);
  fireEvent.change(screen.getAllByPlaceholderText('Store ID')[0], {
    target: { value: '1' },
  });
  fireEvent.change(screen.getAllByPlaceholderText('Variant ID')[0], {
    target: { value: '2' },
  });
  const [qtyInput, priceInput] = screen.getAllByRole('spinbutton');
  fireEvent.change(qtyInput, { target: { value: '1' } });
  fireEvent.change(priceInput, { target: { value: '10' } });
  fireEvent.click(screen.getAllByText('Save')[0]);
  expect(createMock).toHaveBeenCalledWith(
    expect.objectContaining({ booking: 1 })
  );
});
</file>

<file path="src/pages/__tests__/brandDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import BrandDashboard from '../internal/BrandDashboard';

const createMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });

vi.mock('../../api/erpApi', () => ({
  useGetBrandsQuery: () => ({ data: { content: [] }, isLoading: false }),
  useCreateBrandMutation: () => [createMock],
  useUpdateBrandMutation: () => [vi.fn()],
  useDeleteBrandMutation: () => [vi.fn()],
}));

test('submits new brand', async () => {
  render(<BrandDashboard />);
  fireEvent.change(screen.getByPlaceholderText('Name'), {
    target: { value: 'New', name: 'name' },
  });
  fireEvent.submit(
    screen.getByRole('button', { name: /create/i }).closest('form')
  );
  expect(createMock).toHaveBeenCalled();
});
</file>

<file path="src/pages/__tests__/forms.test.jsx">
// @vitest-environment jsdom
import { describe, it, expect, afterEach, vi } from 'vitest';
import { act } from 'react';
import { createRoot } from 'react-dom/client';
import Contact from '../public/Contact';
import ScheduleCall from '../internal/ScheduleCall';
import Bookings from '../internal/Bookings';
import END_POINTS from '@/utils/Endpoints';
import axios from 'axios';

import.meta.env.VITE_RECAPTCHA_SITE_KEY = 'test-site-key';

vi.mock('axios');
vi.mock('react-hot-toast', () => {
  const toast = () => {};
  toast.success = vi.fn();
  toast.error = vi.fn();
  return { default: toast };
});
vi.mock('react-google-recaptcha', () => ({
  __esModule: true,
  default: ({ onChange }) => {
    setTimeout(() => onChange('tok'), 0);
    return <div data-testid="recaptcha" />;
  },
}));
const bookingCreateMock = vi.fn().mockReturnValue({
  unwrap: () => Promise.resolve({ id: 1, status: 'pending' }),
});
vi.mock('../../api/erpApi', () => ({
  useCreateBookingMutation: () => [bookingCreateMock],
  useGetBookingsQuery: () => ({ data: { content: [] }, isLoading: false }),
  useGetIssuesQuery: () => ({
    data: [{ id: 1, name: 'Screen' }],
    isLoading: false,
  }),
  useGetQuestionsQuery: () => ({ data: [], isLoading: false }),
}));

globalThis.IS_REACT_ACT_ENVIRONMENT = true;

afterEach(() => {
  vi.resetAllMocks();
});

describe('Contact form', () => {
  it('posts form data to placeholder handler', async () => {
    globalThis.fetch = vi.fn().mockResolvedValue({ ok: true });
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Contact />);
    });
    const name = container.querySelector('input[name="name"]');
    const email = container.querySelector('input[name="email"]');
    const message = container.querySelector('textarea[name="message"]');
    await act(async () => {
      name.value = 'A';
      name.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      email.value = 'a@b.com';
      email.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      message.value = 'hi';
      message.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      container
        .querySelector('form')
        .dispatchEvent(
          new Event('submit', { bubbles: true, cancelable: true })
        );
    });
    expect(fetch).toHaveBeenCalledWith(
      '/api/contact',
      expect.objectContaining({ method: 'POST' })
    );
  });
});

describe('ScheduleCall form', () => {
  it('posts form data with captcha', async () => {
    axios.post.mockResolvedValue({});
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<ScheduleCall />);
    });
    const name = container.querySelector('input[name="name"]');
    const date = container.querySelector('input[name="date"]');
    const time = container.querySelector('input[name="time"]');
    const message = container.querySelector('textarea[name="message"]');
    await act(async () => {
      name.value = 'A';
      name.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      date.value = '2024-01-01';
      date.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      time.value = '10:00';
      time.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      message.value = 'hi';
      message.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      container
        .querySelector('form')
        .dispatchEvent(
          new Event('submit', { bubbles: true, cancelable: true })
        );
    });
    expect(axios.post).toHaveBeenCalledWith(
      `${END_POINTS.API_BASE_URL}/marketing/schedule-call/`,
      expect.objectContaining({ captcha_token: 'tok' })
    );
  });
});

describe('Bookings form', () => {
  it('posts form data with captcha', async () => {
    axios.post.mockResolvedValue({});
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Bookings />);
    });
    const name = container.querySelector('input[name="name"]');
    const email = container.querySelector('input[name="email"]');
    const date = container.querySelector('input[name="date"]');
    const time = container.querySelector('input[name="time"]');
    const message = container.querySelector('textarea[name="message"]');
    await act(async () => {
      name.value = 'A';
      name.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      email.value = 'a@b.com';
      email.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      date.value = '2024-01-01';
      date.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      time.value = '10:00';
      time.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      container.querySelector('button[aria-haspopup="listbox"]').click();
    });
    const option = document.querySelector('[role="option"]');
    await act(async () => {
      option?.dispatchEvent(new MouseEvent('click', { bubbles: true }));
    });
    await act(async () => {
      message.value = 'hi';
      message.dispatchEvent(new Event('input', { bubbles: true }));
    });
    await act(async () => {
      container
        .querySelector('form')
        .dispatchEvent(
          new Event('submit', { bubbles: true, cancelable: true })
        );
    });
    expect(bookingCreateMock).toHaveBeenCalledWith(
      expect.objectContaining({ captcha_token: 'tok' })
    );
  });
});
</file>

<file path="src/pages/__tests__/inventoryDashboard.test.jsx">
import { render, screen } from '@testing-library/react';
import { describe, it, vi, expect } from 'vitest';
import InventoryDashboard from '../internal/InventoryDashboard.jsx';

vi.mock('../../api/erpApi', () => ({
  useGetStockLedgersQuery: () => ({ data: [] }),
  useCreateStockEntryMutation: () => [vi.fn()],
  useGetSerialsQuery: () => ({ data: [] }),
  useGetPriceLogsQuery: () => ({ data: [] }),
  useGetInventoryConfigQuery: () => ({ data: [] }),
  useUpdateInventoryConfigMutation: () => [vi.fn()],
}));

describe('InventoryDashboard', () => {
  it('renders heading', () => {
    render(<InventoryDashboard />);
    expect(screen.getByText(/Inventory Dashboard/i)).toBeTruthy();
  });
});
</file>

<file path="src/pages/__tests__/logsDashboard.test.jsx">
import { render, screen } from '@testing-library/react';
import LogsDashboard from '../internal/LogsDashboard';
import { vi, describe, it, expect } from 'vitest';

vi.mock('../../api/erpApi', () => ({
  erpApi: {
    reducerPath: 'api',
    reducer: () => ({}),
    middleware: () => (next) => (action) => next(action),
  },
  useGetLogsQuery: () => ({
    data: [
      {
        id: 1,
        actor: 'user',
        entity_type: 'booking',
        action: 'created',
        reason: null,
        timestamp: '2024-01-01T00:00:00Z',
      },
    ],
  }),
}));

describe('LogsDashboard', () => {
  it('renders logs', () => {
    render(<LogsDashboard />);
    expect(screen.getByText('Event Logs')).toBeTruthy();
    expect(screen.getByPlaceholderText('Entity Type')).toBeTruthy();
    expect(screen.getByText('booking')).toBeTruthy();
    expect(screen.getByText('Export CSV')).toBeTruthy();
    expect(screen.getByText('Export JSON')).toBeTruthy();
  });
});
</file>

<file path="src/pages/__tests__/productDetail.test.jsx">
// @vitest-environment jsdom
import { render, screen, waitFor } from '@testing-library/react';
import { MemoryRouter, Routes, Route } from 'react-router-dom';
import { vi, test, expect } from 'vitest';
import ProductDetail from '../ecommerce/ProductDetail';
import { metadata } from '../ecommerce/productDetailMeta';

vi.mock('../../api/erpApi', () => ({
  useGetProductBySlugQuery: () => ({
    data: {
      id: 1,
      name: 'P1',
      brand: '1',
      brand_name: 'B',
      slug: 'p1',
      price: 10,
      availability: true,
      unit_name: 'Piece',
      unit_slug: 'piece',
      url: 'https://example.com/product/p1',
    },
    isLoading: false,
  }),
  useGetVariantsQuery: () => ({
    data: {
      content: [
        {
          id: 1,
          variant_name: 'V1',
          slug: 'p1-v1',
          price: 5,
          availability: true,
          unit_name: 'Piece',
          unit_slug: 'piece',
        },
      ],
    },
  }),
}));

test('renders product detail and SEO metadata', async () => {
  render(
    <MemoryRouter initialEntries={['/product/p1']}>
      <Routes>
        <Route path="/product/:slug" element={<ProductDetail />} />
      </Routes>
    </MemoryRouter>
  );
  expect(screen.getByText('P1')).toBeDefined();
  await waitFor(() => {
    expect(metadata.title).toBe('P1 - B');
    expect(metadata.openGraph.title).toBe('P1 - B');
  });
  expect(metadata.jsonLd['@type']).toBe('Product');
});
</file>

<file path="src/pages/__tests__/productsDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import ProductsDashboard from '../internal/ProductsDashboard';

const createMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });

vi.mock('../../api/erpApi', () => ({
  useGetProductsQuery: () => ({ data: { content: [] }, isLoading: false }),
  useCreateProductMutation: () => [createMock],
  useUpdateProductMutation: () => [vi.fn()],
  useDeleteProductMutation: () => [vi.fn()],
}));

test('creates product via form', async () => {
  render(<ProductsDashboard />);
  fireEvent.change(screen.getByPlaceholderText('Name'), {
    target: { value: 'P1', name: 'name' },
  });
  fireEvent.change(screen.getByPlaceholderText('Brand ID'), {
    target: { value: '1', name: 'brand' },
  });
  fireEvent.change(screen.getByPlaceholderText('Category ID'), {
    target: { value: '1', name: 'category' },
  });
  fireEvent.change(screen.getByPlaceholderText('Price'), {
    target: { value: '10', name: 'price' },
  });
  fireEvent.change(screen.getByPlaceholderText('Stock'), {
    target: { value: '5', name: 'stock' },
  });
  fireEvent.click(screen.getByLabelText('Available'));
  fireEvent.submit(
    screen.getByRole('button', { name: /create/i }).closest('form')
  );
  expect(createMock).toHaveBeenCalled();
});
</file>

<file path="src/pages/__tests__/qualitiesDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { vi, test, expect, beforeEach } from 'vitest';
import QualitiesDashboard from '../internal/QualitiesDashboard';
import toast from 'react-hot-toast';

vi.mock('react-hot-toast', () => {
  const fn = () => {};
  fn.success = vi.fn();
  fn.error = vi.fn();
  return { default: fn };
});

const getMock = vi.fn(() => ({ data: { content: [] }, isLoading: false }));
const createMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));
const updateMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));
const deleteMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));

vi.mock('../../api/erpApi', () => ({
  useGetQualitiesQuery: () => getMock(),
  useCreateQualityMutation: () => [createMock],
  useUpdateQualityMutation: () => [updateMock],
  useDeleteQualityMutation: () => [deleteMock],
}));

beforeEach(() => {
  vi.clearAllMocks();
});

test('updates quality and refreshes table', async () => {
  getMock.mockReturnValueOnce({
    data: { content: [{ id: 1, name: 'Old', slug: 'old' }] },
    isLoading: false,
  });
  render(<QualitiesDashboard />);
  const initial = getMock.mock.calls.length;
  fireEvent.click(screen.getByText('Edit'));
  fireEvent.change(screen.getByPlaceholderText('Name'), {
    target: { value: 'New', name: 'name' },
  });
  fireEvent.submit(
    screen.getByRole('button', { name: /update/i }).closest('form')
  );
  await waitFor(() => expect(updateMock).toHaveBeenCalled());
  expect(getMock.mock.calls.length).toBeGreaterThan(initial);
  expect(toast.success).toHaveBeenCalled();
});
</file>

<file path="src/pages/__tests__/seo.test.jsx">
// @vitest-environment jsdom
import { describe, it, expect, afterEach, vi } from 'vitest';
import { act } from 'react';
import { createRoot } from 'react-dom/client';
import { MemoryRouter, Route, Routes } from 'react-router-dom';
import About from '../public/About';
import Contact from '../public/Contact';
import Locate from '../public/Locate';
import Legal from '../public/Legal';
import { metadata as homeMeta } from '../IndexMeta';
import StoreDetails from '../internal/StoreDetails';
import Stores from '../internal/Stores';
import Spares from '../internal/Spares';
import Bookings from '../internal/Bookings';
import axios from 'axios';
import.meta.env.VITE_RECAPTCHA_SITE_KEY = 'test-site-key';
vi.mock('axios');
vi.mock('react-google-recaptcha', () => ({
  __esModule: true,
  default: () => <div data-testid="recaptcha" />,
}));
vi.mock('@/redux/hook', () => ({
  useAppSelector: () => 'system_admin',
}));
vi.mock('../../api/erpApi', () => ({
  useGetSparesQuery: () => ({ data: { content: [] }, isLoading: false }),
  useCreateSpareMutation: () => [() => {}],
  useUpdateSpareMutation: () => [() => {}],
  useDeleteSpareMutation: () => [() => {}],
  useGetBookingsQuery: () => ({ data: { content: [] }, isLoading: false }),
  useCreateBookingMutation: () => [() => {}],
  useGetIssuesQuery: () => ({ data: [], isLoading: false }),
  useGetQuestionsQuery: () => ({ data: [], isLoading: false }),
}));

globalThis.IS_REACT_ACT_ENVIRONMENT = true;

afterEach(async () => {
  await new Promise((r) => setTimeout(r, 0));
  document.head.innerHTML = '';
  document.title = '';
  vi.resetAllMocks();
});

describe('SEO meta tags', () => {
  it('sets title and description for About page', async () => {
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<About />);
    });
    expect(document.title).toBe('About – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain('Where we started');
  });

  it('sets title and description for Contact page', async () => {
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Contact />);
    });
    expect(document.title).toBe('Contact – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain('Reach out');
  });

  it('sets title and description for Locate page', async () => {
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Locate />);
    });
    expect(document.title).toBe('Locate – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain('service branches');
  });

  it('sets title and description for Legal page', async () => {
    const container = document.createElement('div');
    const root = createRoot(container);
    await act(async () => {
      root.render(<Legal />);
    });
    await act(async () => {});
    expect(document.title).toBe('Legal Information – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain(
      'Important legal information'
    );
    await act(async () => {
      root.unmount();
    });
  });

  it('provides metadata for Home page via module', () => {
    expect(homeMeta.title).toBe('Home – Finetune');
    expect(homeMeta.description).toContain(
      'Expert Mobile & Laptop Repairs in Coimbatore & Palakkad'
    );
  });

  it('sets title and description for Stores page', async () => {
    document.title = '';
    axios.get.mockResolvedValue({ data: { content: [] } });
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Stores />);
    });
    expect(document.title).toBe('Stores – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain(
      'Browse Finetune service branches'
    );
  });

  it('sets title and description for StoreDetails page', async () => {
    document.title = '';
    axios.get.mockResolvedValue({
      data: {
        id: 1,
        store_name: 'Alpha Store',
        code: 'ST1',
        address: '123 St',
      },
    });
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(
        <MemoryRouter initialEntries={['/stores/1']}>
          <Routes>
            <Route path="/stores/:id" element={<StoreDetails />} />
          </Routes>
        </MemoryRouter>
      );
    });
    expect(document.title).toBe('Alpha Store – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain('Details for Alpha Store');
  });
  it('sets title and description for Spares page', async () => {
    document.title = '';
    axios.get.mockResolvedValue({ data: { content: [] } });
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Spares />);
    });
    expect(document.title).toBe('Spares – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain('spare parts pricing');
  });
  it('sets title and description for Bookings page', async () => {
    document.title = '';
    const container = document.createElement('div');
    await act(async () => {
      createRoot(container).render(<Bookings />);
    });
    expect(document.title).toBe('Book a Service – Finetune');
    const desc = document.head.querySelector("meta[name='description']");
    expect(desc.getAttribute('content')).toContain(
      'Schedule a service booking'
    );
  });
});
</file>

<file path="src/pages/__tests__/shop.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { MemoryRouter } from 'react-router-dom';
import { vi, test, expect } from 'vitest';
import Shop from '../ecommerce/Shop';

const mockProducts = vi.fn().mockReturnValue({
  data: { content: [] },
  isLoading: false,
});

vi.mock('../../api/erpApi', () => ({
  useGetProductsQuery: (params) => {
    mockProducts(params || {});
    return { data: { content: [] }, isLoading: false };
  },
  useGetBrandsQuery: () => ({ data: [{ id: 1, name: 'B1' }] }),
  useGetDepartmentsQuery: () => ({ data: { content: [] } }),
  useGetCategoriesQuery: () => ({ data: { content: [] } }),
  useGetSubCategoriesQuery: () => ({ data: { content: [] } }),
}));

test('updates query params on filters and sorting', () => {
  render(
    <MemoryRouter>
      <Shop />
    </MemoryRouter>
  );
  expect(mockProducts).toHaveBeenLastCalledWith({ ordering: '-date_created' });
  fireEvent.click(screen.getByLabelText('B1'));
  expect(mockProducts).toHaveBeenLastCalledWith({
    ordering: '-date_created',
    brand: '1',
  });
  fireEvent.change(screen.getByDisplayValue('Newest'), {
    target: { value: 'price' },
  });
  expect(mockProducts).toHaveBeenLastCalledWith({
    brand: '1',
    ordering: 'price',
  });
});
</file>

<file path="src/pages/__tests__/spares.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import Spares from '../internal/Spares';

const createMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });

vi.mock('../../api/erpApi', () => ({
  useGetSparesQuery: () => ({
    data: {
      content: [
        { id: 1, name: 'S1', sku: 'SKU1', price: '5', quality_name: 'OEM' },
      ],
    },
    isLoading: false,
  }),
  useCreateSpareMutation: () => [createMock],
  useUpdateSpareMutation: () => [vi.fn()],
  useDeleteSpareMutation: () => [vi.fn()],
}));

vi.mock('@/redux/hook', () => ({
  useAppSelector: () => 'system_admin',
}));

test('renders quality label', () => {
  render(<Spares />);
  expect(screen.getByText('Quality: OEM')).toBeDefined();
});

test('creates spare via form', async () => {
  render(<Spares />);
  const [nameInput] = screen.getAllByPlaceholderText('Name');
  const [skuInput] = screen.getAllByPlaceholderText('SKU');
  const [priceInput] = screen.getAllByPlaceholderText('Price');
  fireEvent.change(nameInput, {
    target: { value: 'S1', name: 'name' },
  });
  fireEvent.change(skuInput, {
    target: { value: 'SKU1', name: 'sku' },
  });
  fireEvent.change(priceInput, {
    target: { value: '5', name: 'price' },
  });
  const [submitBtn] = screen.getAllByRole('button', { name: /add spare/i });
  fireEvent.submit(submitBtn.closest('form'));
  expect(createMock).toHaveBeenCalled();
});
</file>

<file path="src/pages/__tests__/store.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import Store from '../internal/Store';

const createMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });

vi.mock('../../api/erpApi', () => ({
  useGetStoresQuery: () => ({ data: { content: [] }, isLoading: false }),
  useCreateStoreMutation: () => [createMock],
  useUpdateStoreMutation: () => [vi.fn()],
  useDeleteStoreMutation: () => [vi.fn()],
}));

test('creates store via form', async () => {
  render(<Store />);
  fireEvent.change(screen.getByPlaceholderText('Name'), {
    target: { value: 'S1', name: 'store_name' },
  });
  fireEvent.change(screen.getByPlaceholderText('Code'), {
    target: { value: 'C1', name: 'code' },
  });
  fireEvent.submit(
    screen.getByRole('button', { name: /create/i }).closest('form')
  );
  expect(createMock).toHaveBeenCalled();
});
</file>

<file path="src/pages/__tests__/taxonomy.test.jsx">
// @vitest-environment jsdom
import { render, screen } from '@testing-library/react';
import { MemoryRouter, Routes, Route } from 'react-router-dom';
import { vi, test, expect } from 'vitest';
import DepartmentsPage from '../ecommerce/DepartmentsPage';
import CategoryPage from '../ecommerce/CategoryPage';

const getDepartmentsMock = vi.fn();
const getSubCategoriesMock = vi.fn();
const getProductsMock = vi.fn();

vi.mock('../../api/erpApi', () => ({
  useGetDepartmentsQuery: (...args) => getDepartmentsMock(...args),
  useGetSubCategoriesQuery: (...args) => getSubCategoriesMock(...args),
  useGetProductsQuery: (...args) => getProductsMock(...args),
}));

test('renders departments from API', () => {
  getDepartmentsMock.mockReturnValue({
    data: { content: [{ id: 1, name: 'Electronics', slug: 'electronics' }] },
    isLoading: false,
  });
  render(
    <MemoryRouter>
      <DepartmentsPage />
    </MemoryRouter>
  );
  expect(screen.getByText('Electronics')).toBeTruthy();
});

test('category page filters products by subcategory slug', () => {
  getSubCategoriesMock.mockReturnValue({
    data: {
      content: [
        {
          id: 1,
          name: 'Smartphones',
          slug: 'smartphones',
          category: { slug: 'phones' },
        },
      ],
    },
    isLoading: false,
  });
  getProductsMock.mockReturnValue({
    data: { content: [{ id: 1, name: 'P1', slug: 'p1' }] },
    isLoading: false,
  });
  render(
    <MemoryRouter
      initialEntries={['/departments/electronics/phones/smartphones/products']}
    >
      <Routes>
        <Route
          path="/departments/:deptSlug/:catSlug/:subcatSlug/products"
          element={<CategoryPage />}
        />
      </Routes>
    </MemoryRouter>
  );
  expect(getProductsMock).toHaveBeenCalledWith({ subcategory: 'smartphones' });
  expect(screen.getByText('P1')).toBeTruthy();
});
</file>

<file path="src/pages/__tests__/taxonomyDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import TaxonomyDashboard from '../internal/TaxonomyDashboard';

const departments = vi.hoisted(() => []);

vi.mock('../../api/erpApi', () => {
  const createDepartmentMock = vi
    .fn()
    .mockResolvedValue({ unwrap: () => Promise.resolve() });
  return {
    useGetDepartmentsQuery: () => ({
      data: { content: departments },
      isLoading: false,
    }),
    useCreateDepartmentMutation: () => [createDepartmentMock],
    useUpdateDepartmentMutation: () => [vi.fn()],
    useDeleteDepartmentMutation: () => [vi.fn()],
    useGetCategoriesQuery: () => ({ data: { content: [] }, isLoading: false }),
    useCreateCategoryMutation: () => [vi.fn()],
    useUpdateCategoryMutation: () => [vi.fn()],
    useDeleteCategoryMutation: () => [vi.fn()],
    useGetSubCategoriesQuery: () => ({
      data: { content: [] },
      isLoading: false,
    }),
    useCreateSubCategoryMutation: () => [vi.fn()],
    useUpdateSubCategoryMutation: () => [vi.fn()],
    useDeleteSubCategoryMutation: () => [vi.fn()],
    __esModule: true,
    createDepartmentMock,
  };
});

import { createDepartmentMock } from '../../api/erpApi';

test('creates department and refreshes list', async () => {
  const { rerender } = render(<TaxonomyDashboard />);
  fireEvent.change(screen.getAllByPlaceholderText('Name')[0], {
    target: { value: 'Electronics', name: 'name' },
  });
  fireEvent.submit(
    screen.getAllByRole('button', { name: /create/i })[0].closest('form')
  );
  expect(createDepartmentMock).toHaveBeenCalled();
  departments.push({ id: 1, name: 'Electronics', slug: 'electronics' });
  rerender(<TaxonomyDashboard />);
  expect(screen.getAllByText('Electronics')[0]).toBeTruthy();
});
</file>

<file path="src/pages/__tests__/unitsDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent, waitFor } from '@testing-library/react';
import { vi, test, expect, beforeEach } from 'vitest';
import UnitsDashboard from '../internal/UnitsDashboard';
import toast from 'react-hot-toast';

vi.mock('react-hot-toast', () => {
  const fn = () => {};
  fn.success = vi.fn();
  fn.error = vi.fn();
  return { default: fn };
});

const getMock = vi.fn(() => ({ data: { content: [] }, isLoading: false }));
const createMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));
const updateMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));
const deleteMock = vi.fn(() => ({ unwrap: () => Promise.resolve() }));

vi.mock('../../api/erpApi', () => ({
  useGetUnitsQuery: () => getMock(),
  useCreateUnitMutation: () => [createMock],
  useUpdateUnitMutation: () => [updateMock],
  useDeleteUnitMutation: () => [deleteMock],
}));

beforeEach(() => {
  vi.clearAllMocks();
});

test('creates unit and refreshes table', async () => {
  render(<UnitsDashboard />);
  const initial = getMock.mock.calls.length;
  fireEvent.change(screen.getByPlaceholderText('Name'), {
    target: { value: 'Piece', name: 'name' },
  });
  fireEvent.submit(
    screen.getByRole('button', { name: /create/i }).closest('form')
  );
  await waitFor(() => expect(createMock).toHaveBeenCalled());
  expect(getMock.mock.calls.length).toBeGreaterThan(initial);
  expect(toast.success).toHaveBeenCalled();
});

test('deletes unit and refreshes table', async () => {
  getMock.mockReturnValueOnce({
    data: { content: [{ id: 1, name: 'P', slug: 'p' }] },
    isLoading: false,
  });
  render(<UnitsDashboard />);
  fireEvent.click(screen.getByText('Delete'));
  await waitFor(() => expect(deleteMock).toHaveBeenCalled());
  expect(toast.success).toHaveBeenCalled();
});
</file>

<file path="src/pages/__tests__/variantsDashboard.test.jsx">
// @vitest-environment jsdom
import { render, screen, fireEvent } from '@testing-library/react';
import { vi, test, expect } from 'vitest';
import VariantsDashboard from '../internal/VariantsDashboard';

const createMock = vi
  .fn()
  .mockResolvedValue({ unwrap: () => Promise.resolve() });

vi.mock('../../api/erpApi', () => ({
  useGetVariantsQuery: () => ({ data: { content: [] }, isLoading: false }),
  useCreateVariantMutation: () => [createMock],
  useUpdateVariantMutation: () => [vi.fn()],
  useDeleteVariantMutation: () => [vi.fn()],
}));

test('creates variant via form', async () => {
  render(<VariantsDashboard />);
  fireEvent.change(screen.getByPlaceholderText('Product Slug'), {
    target: { value: 'p1', name: 'product' },
  });
  fireEvent.change(screen.getByPlaceholderText('Variant Name'), {
    target: { value: 'V1', name: 'variant_name' },
  });
  fireEvent.change(screen.getByPlaceholderText('Price'), {
    target: { value: '5', name: 'price' },
  });
  fireEvent.change(screen.getByPlaceholderText('Stock'), {
    target: { value: '1', name: 'stock' },
  });
  fireEvent.click(screen.getByLabelText('Available'));
  fireEvent.submit(
    screen.getByRole('button', { name: /create/i }).closest('form')
  );
  expect(createMock).toHaveBeenCalled();
});
</file>

<file path="src/pages/customers/Account.jsx">
import React from 'react';

export default function Account() {
  return <div className="pt-20 p-4 text-center">Coming Soon</div>;
}
</file>

<file path="src/pages/customers/Login.jsx">
import { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAppDispatch, useAppSelector } from '@/redux/hook';
import { loginUser, selectAuthStatus } from '@/redux/slice/authSlice';

export default function Login() {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const dispatch = useAppDispatch();
  const status = useAppSelector(selectAuthStatus);
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    try {
      await dispatch(loginUser({ username: email, password })).unwrap();
      navigate('/account', { replace: true });
    } catch (err) {
      setError(err || 'Login failed');
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-white px-4 py-6">
      <div className="w-full max-w-sm space-y-4">
        <div className="text-center">
          <h2
            className="text-xl font-semibold text-gray-800"
            style={{ marginTop: '15%' }}
          >
            Login
          </h2>
          <p className="text-sm text-gray-500">Access your account</p>
        </div>
        {error && <p className="text-red-500 text-center text-sm">{error}</p>}
        <form onSubmit={handleSubmit} className="space-y-3">
          <input
            type="email"
            placeholder="Email"
            value={email}
            onChange={(e) => setEmail(e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-keyline"
            required
          />
          <input
            type="password"
            placeholder="Password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            className="w-full px-3 py-2 border border-gray-300 rounded-md text-sm focus:outline-none focus:ring-1 focus:ring-keyline"
            required
          />
          <button
            type="submit"
            disabled={status === 'loading'}
            className="w-full bg-black text-white py-2 rounded-md text-sm font-medium hover:bg-gray-900 transition-colors disabled:opacity-50"
          >
            {status === 'loading' ? 'Logging in...' : 'Login'}
          </button>
        </form>
        <div className="text-center text-sm text-gray-600">
          Don't have an account?{' '}
          <Link
            to="/signup"
            className="text-gray-700 hover:text-keyline hover:underline font-medium"
          >
            Sign up
          </Link>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="src/pages/customers/Orders.jsx">
import React from 'react';

export default function Orders() {
  return <div className="pt-20 p-4 text-center">Coming Soon</div>;
}
</file>

<file path="src/pages/customers/Signup.jsx">
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useDispatch, useSelector } from 'react-redux';
import { registerUser } from '@/redux/slice/authSlice';
import {
  HiOutlineEye,
  HiOutlineEyeOff,
  HiOutlineMail,
  HiOutlineLockClosed,
  HiOutlineUser,
  HiOutlinePhone,
} from 'react-icons/hi';
import toast from 'react-hot-toast';

function Signup() {
  const [formData, setFormData] = useState({
    firstName: '',
    lastName: '',
    email: '',
    phone: '',
    password: '',
    confirmPassword: '',
    agreeToTerms: false,
  });

  const [showPassword, setShowPassword] = useState(false);
  const [showConfirmPassword, setShowConfirmPassword] = useState(false);
  const [errors, setErrors] = useState({});
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const { loading } = useSelector((state) => state.auth);

  const validateForm = () => {
    const newErrors = {};

    if (!formData.firstName.trim())
      newErrors.firstName = 'First name is required';
    else if (formData.firstName.length < 2)
      newErrors.firstName = 'Must be at least 2 characters';

    if (!formData.lastName.trim()) newErrors.lastName = 'Last name is required';
    else if (formData.lastName.length < 2)
      newErrors.lastName = 'Must be at least 2 characters';

    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    if (!formData.email.trim()) newErrors.email = 'Email is required';
    else if (!emailRegex.test(formData.email))
      newErrors.email = 'Invalid email';

    const phoneRegex = /^[0-9]{10}$/;
    if (!formData.phone.trim()) newErrors.phone = 'Phone number is required';
    else if (!phoneRegex.test(formData.phone))
      newErrors.phone = 'Invalid phone number';

    if (!formData.password) newErrors.password = 'Password is required';
    else if (formData.password.length < 8)
      newErrors.password = 'Password must be at least 8 characters';
    else if (!/(?=.*[a-z])(?=.*[A-Z])(?=.*\d)/.test(formData.password))
      newErrors.password =
        'Must contain at least 1 uppercase, 1 lowercase letter and a number';

    if (!formData.confirmPassword)
      newErrors.confirmPassword = 'Confirm your password';
    else if (formData.password !== formData.confirmPassword)
      newErrors.confirmPassword = 'Passwords do not match';

    if (!formData.agreeToTerms)
      newErrors.agreeToTerms = 'You must accept the terms';

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const handleInputChange = (field, value) => {
    setFormData((prev) => ({ ...prev, [field]: value }));
    if (errors[field]) {
      setErrors((prev) => ({ ...prev, [field]: '' }));
    }
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!validateForm()) {
      toast.error('Please fix the errors in the form');
      return;
    }

    try {
      await dispatch(
        registerUser({
          firstName: formData.firstName,
          lastName: formData.lastName,
          email: formData.email,
          phone: formData.phone,
          role: 'customer',
          password: formData.password,
        })
      ).unwrap();

      toast.success('Account created successfully!');
      navigate('/login');
    } catch (err) {
      toast.error(err.message || 'Registration failed. Try again.');
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-white px-4 py-6">
      <div className="w-full max-w-sm space-y-4">
        <div className="text-center">
          <h2
            className="text-xl font-semibold text-gray-800"
            style={{ marginTop: '15%' }}
          >
            Sign Up
          </h2>
          <p className="text-sm text-gray-500">
            Join us and start shopping today!
          </p>
        </div>

        <form onSubmit={handleSubmit} className="space-y-3">
          {/* First Name */}
          <div className="relative">
            <HiOutlineUser className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="text"
              placeholder="First Name *"
              value={formData.firstName}
              onChange={(e) => handleInputChange('firstName', e.target.value)}
              className={`w-full pl-10 pr-3 py-2 border rounded-md text-sm ${
                errors.firstName ? 'border-red-500' : 'border-gray-300'
              } focus:outline-none focus:ring-1 focus:ring-keyline`}
            />
            {errors.firstName && (
              <p className="text-red-500 text-xs mt-1">{errors.firstName}</p>
            )}
          </div>

          {/* Last Name */}
          <div className="relative">
            <HiOutlineUser className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="text"
              placeholder="Last Name *"
              value={formData.lastName}
              onChange={(e) => handleInputChange('lastName', e.target.value)}
              className={`w-full pl-10 pr-3 py-2 border rounded-md text-sm ${
                errors.lastName ? 'border-red-500' : 'border-gray-300'
              } focus:outline-none focus:ring-1 focus:ring-keyline`}
            />
            {errors.lastName && (
              <p className="text-red-500 text-xs mt-1">{errors.lastName}</p>
            )}
          </div>

          {/* Email */}
          <div className="relative">
            <HiOutlineMail className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="email"
              placeholder="Email *"
              value={formData.email}
              onChange={(e) => handleInputChange('email', e.target.value)}
              className={`w-full pl-10 pr-3 py-2 border rounded-md text-sm ${
                errors.email ? 'border-red-500' : 'border-gray-300'
              } focus:outline-none focus:ring-1 focus:ring-keyline`}
            />
            {errors.email && (
              <p className="text-red-500 text-xs mt-1">{errors.email}</p>
            )}
          </div>

          {/* Phone */}
          <div className="relative">
            <HiOutlinePhone className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type="tel"
              placeholder="Phone Number *"
              maxLength="10"
              value={formData.phone}
              onChange={(e) => handleInputChange('phone', e.target.value)}
              className={`w-full pl-10 pr-3 py-2 border rounded-md text-sm ${
                errors.phone ? 'border-red-500' : 'border-gray-300'
              } focus:outline-none focus:ring-1 focus:ring-keyline`}
            />
            {errors.phone && (
              <p className="text-red-500 text-xs mt-1">{errors.phone}</p>
            )}
          </div>

          {/* Password */}
          <div className="relative">
            <HiOutlineLockClosed className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type={showPassword ? 'text' : 'password'}
              placeholder="Password *"
              value={formData.password}
              onChange={(e) => handleInputChange('password', e.target.value)}
              className={`w-full pl-10 pr-10 py-2 border rounded-md text-sm ${
                errors.password ? 'border-red-500' : 'border-gray-300'
              } focus:outline-none focus:ring-1 focus:ring-keyline`}
            />
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
            >
              {showPassword ? <HiOutlineEyeOff /> : <HiOutlineEye />}
            </button>
            {errors.password && (
              <p className="text-red-500 text-xs mt-1">{errors.password}</p>
            )}
          </div>

          {/* Confirm Password */}
          <div className="relative">
            <HiOutlineLockClosed className="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5" />
            <input
              type={showConfirmPassword ? 'text' : 'password'}
              placeholder="Confirm Password *"
              value={formData.confirmPassword}
              onChange={(e) =>
                handleInputChange('confirmPassword', e.target.value)
              }
              className={`w-full pl-10 pr-10 py-2 border rounded-md text-sm ${
                errors.confirmPassword ? 'border-red-500' : 'border-gray-300'
              } focus:outline-none focus:ring-1 focus:ring-keyline`}
            />
            <button
              type="button"
              onClick={() => setShowConfirmPassword(!showConfirmPassword)}
              className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600"
            >
              {showConfirmPassword ? <HiOutlineEyeOff /> : <HiOutlineEye />}
            </button>
            {errors.confirmPassword && (
              <p className="text-red-500 text-xs mt-1">
                {errors.confirmPassword}
              </p>
            )}
          </div>

          {/* Terms */}
          <div className="flex items-start gap-2 text-xs">
            <input
              type="checkbox"
              checked={formData.agreeToTerms}
              onChange={(e) =>
                handleInputChange('agreeToTerms', e.target.checked)
              }
              className="mt-1 h-4 w-4 text-keyline focus:ring-keyline border-gray-300 rounded"
            />
            <span className="text-gray-600">
              I agree to the{' '}
              <Link
                to="/legal"
                className="text-gray-700 hover:text-keyline hover:underline"
              >
                Terms and Conditions
              </Link>{' '}
              and{' '}
              <Link
                to="/legal"
                className="text-gray-700 hover:text-keyline hover:underline"
              >
                Privacy Policy
              </Link>
            </span>
          </div>
          {errors.agreeToTerms && (
            <p className="text-red-500 text-xs mt-1">{errors.agreeToTerms}</p>
          )}

          {/* Submit */}
          <button
            type="submit"
            disabled={loading}
            className="w-full bg-black text-white py-2 rounded-md text-sm font-medium hover:bg-gray-900 transition-colors disabled:opacity-50"
          >
            {loading ? 'Creating Account...' : 'Create Account'}
          </button>
        </form>

        <div className="text-center text-sm text-gray-600">
          Already have an account?{' '}
          <Link
            to="/login"
            className="text-gray-700 hover:text-keyline hover:underline font-medium"
          >
            Sign in
          </Link>
        </div>
      </div>
    </div>
  );
}

export default Signup;
</file>

<file path="src/pages/ecommerce/CartPage.jsx">
import { useSelector, useDispatch } from 'react-redux';
import { useNavigate } from 'react-router-dom';
import {
  removeFromCart,
  updateQuantity,
  clearCart,
} from '@/redux/slice/cartSlice';
import {
  HiOutlineTrash,
  HiOutlineShoppingBag,
  HiOutlineArrowRight,
  HiOutlineArrowLeft,
} from 'react-icons/hi';
import Payment from '@/components/ecommerce/Payment';
import { useEffect, useState } from 'react';
import {
  useScrollMode,
  SECTION_SLIDER_MODE,
} from '@/components/layout/ScrollModeContext';

function CartPage() {
  const dispatch = useDispatch();
  const navigate = useNavigate();
  const { items, total, itemCount } = useSelector((state) => state.cart);
  const [showPayment, setShowPayment] = useState(false);
  const [orderId, setOrderId] = useState('');
  const { setMode } = useScrollMode();

  useEffect(() => {
    setMode(SECTION_SLIDER_MODE);
    return () => setMode('scroll');
  }, [setMode]);

  const formatPrice = (price) => {
    return new Intl.NumberFormat('en-IN', {
      style: 'currency',
      currency: 'INR',
      maximumFractionDigits: 0,
    }).format(price);
  };

  const handleRemoveItem = (productId) => {
    dispatch(removeFromCart(productId));
  };

  const handleUpdateQuantity = (productId, quantity) => {
    dispatch(updateQuantity({ productId, quantity }));
  };

  const handleClearCart = () => {
    dispatch(clearCart());
  };

  const handleCheckout = () => {
    if (items.length === 0) return;

    setOrderId(
      'ORD' + Date.now() + Math.random().toString(36).substr(2, 5).toUpperCase()
    );
    setShowPayment(true);
  };

  const handlePaymentSuccess = (transactionId) => {
    console.log('Payment successful:', transactionId);
    alert('Payment successful! Your order has been placed.');
    dispatch(clearCart());
    setShowPayment(false);
    navigate('/shop');
  };

  const handlePaymentFailure = (error) => {
    console.log('Payment failed:', error);
    alert('Payment failed: ' + error);
    setShowPayment(false);
  };

  if (showPayment) {
    return (
      <div className="min-h-screen bg-gray-50 pt-20">
        <div className="max-w-4xl mx-auto px-4 py-8">
          <button
            onClick={() => setShowPayment(false)}
            className="flex items-center gap-2 text-gray-700 hover:text-keyline mb-6"
          >
            <HiOutlineArrowLeft className="w-4 h-4" />
            Back to Cart
          </button>
          <Payment
            amount={total}
            orderId={orderId}
            onSuccess={handlePaymentSuccess}
            onFailure={handlePaymentFailure}
          />
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gray-50 pt-20">
      <div className="max-w-4xl mx-auto px-4 py-8">
          {/* Header */}
          <div className="flex items-center justify-between mb-8">
            <div className="flex items-center gap-3">
              <HiOutlineShoppingBag className="w-8 h-8 text-keyline" />
              <div>
                <h1 className="text-3xl font-bold text-gray-900">
                  Shopping Cart
                </h1>
                <p className="text-gray-600">{itemCount} items in your cart</p>
              </div>
            </div>
            <button
              onClick={() => navigate('/shop')}
              className="flex items-center gap-2 text-gray-700 hover:text-keyline"
            >
              <HiOutlineArrowLeft className="w-4 h-4" />
              Continue Shopping
            </button>
          </div>

          {items.length === 0 ? (
            <div className="text-center py-16">
              <HiOutlineShoppingBag className="w-24 h-24 text-gray-300 mx-auto mb-6" />
              <h2 className="text-2xl font-semibold text-gray-900 mb-4">
                Your cart is empty
              </h2>
              <p className="text-gray-600 mb-8">
                Looks like you haven't added any products to your cart yet.
              </p>
              <button
                onClick={() => navigate('/shop')}
                className="bg-black text-white px-8 py-3 rounded-lg hover:bg-gray-900 transition-colors font-semibold"
              >
                Start Shopping
              </button>
            </div>
          ) : (
            <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
              {/* Cart Items */}
              <div className="lg:col-span-2">
                <div className="bg-white rounded-lg shadow-sm p-6">
                  <h2 className="text-xl font-semibold text-gray-900 mb-6">
                    Cart Items
                  </h2>
                  <div className="space-y-6">
                    {items.map((item) => (
                      <div
                        key={item.id}
                        className="flex gap-4 p-4 border border-gray-200 rounded-lg"
                      >
                        {/* Product Image */}
                        <div className="w-24 h-24 flex-shrink-0">
                          <img
                            src={item.image}
                            alt={item.name}
                            className="w-full h-full object-cover rounded-lg"
                          />
                        </div>

                        {/* Product Details */}
                        <div className="flex-1 min-w-0">
                          <h3 className="font-semibold text-gray-900 mb-2">
                            {item.name}
                          </h3>
                          <p className="text-sm text-gray-600 mb-2 capitalize">
                            {item.category}
                          </p>
                          <p className="font-semibold text-gray-900 text-lg">
                            {formatPrice(item.price)}
                          </p>

                          {/* Quantity Controls */}
                          <div className="flex items-center gap-3 mt-4">
                            <span className="text-sm text-gray-600">
                              Quantity:
                            </span>
                            <div className="flex items-center gap-2">
                              <button
                                onClick={() =>
                                  handleUpdateQuantity(
                                    item.id,
                                    item.quantity - 1
                                  )
                                }
                                className="w-8 h-8 border border-gray-300 rounded flex items-center justify-center hover:bg-gray-50"
                              >
                                -
                              </button>
                              <span className="w-12 text-center font-medium">
                                {item.quantity}
                              </span>
                              <button
                                onClick={() =>
                                  handleUpdateQuantity(
                                    item.id,
                                    item.quantity + 1
                                  )
                                }
                                className="w-8 h-8 border border-gray-300 rounded flex items-center justify-center hover:bg-gray-50"
                              >
                                +
                              </button>
                            </div>
                          </div>
                        </div>

                        {/* Remove Button */}
                        <button
                          onClick={() => handleRemoveItem(item.id)}
                          className="text-red-500 hover:text-red-700 p-2"
                        >
                          <HiOutlineTrash className="w-5 h-5" />
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Order Summary */}
              <div className="lg:col-span-1">
                <div className="bg-white rounded-lg shadow-sm p-6 sticky top-24">
                  <h2 className="text-xl font-semibold text-gray-900 mb-6">
                    Order Summary
                  </h2>

                  <div className="space-y-4">
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-600">
                        Subtotal ({itemCount} items):
                      </span>
                      <span className="font-medium">{formatPrice(total)}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-600">Shipping:</span>
                      <span className="text-green-600 font-medium">Free</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-gray-600">Tax:</span>
                      <span className="font-medium">
                        {formatPrice(total * 0.18)}
                      </span>
                    </div>

                    <div className="border-t border-gray-200 pt-4">
                      <div className="flex justify-between text-lg font-semibold">
                        <span>Total:</span>
                        <span>{formatPrice(total + total * 0.18)}</span>
                      </div>
                    </div>
                  </div>

                  <div className="mt-6 space-y-3">
                    <button
                      onClick={handleCheckout}
                      className="w-full bg-black text-white py-3 px-4 rounded-lg font-semibold hover:bg-gray-900 transition-colors flex items-center justify-center gap-2"
                    >
                      <span>Proceed to Checkout</span>
                      <HiOutlineArrowRight className="w-5 h-5" />
                    </button>

                    <button
                      onClick={handleClearCart}
                      className="w-full border border-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-50 transition-colors"
                    >
                      Clear Cart
                    </button>
                  </div>

                  {/* Security Notice */}
                  <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                    <p className="text-sm text-gray-600">
                      🔒 Your payment information is secure and encrypted
                    </p>
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
  );
}

export default CartPage;
</file>

<file path="src/pages/ecommerce/CategoryPage.jsx">
import { Link, useParams } from 'react-router-dom';
import {
  useGetProductsQuery,
  useGetSubCategoriesQuery,
} from '../../api/erpApi';

function CategoryPage() {
  const { catSlug, subcatSlug } = useParams();
  const { data: subData } = useGetSubCategoriesQuery({ category: catSlug });
  const sub = subData?.content.find((s) => s.slug === subcatSlug);
  const { data: prodData } = useGetProductsQuery({ subcategory: subcatSlug });
  const products = prodData?.content ?? [];

  return (
    <div className="pt-20 max-w-7xl mx-auto px-4">
      <h1 className="text-2xl font-bold mb-4">{sub ? sub.name : ''}</h1>
      <ul className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        {products.map((p) => (
          <li key={p.id} className="p-4 bg-white rounded shadow">
            <Link to={`/product/${p.slug}`} className="block font-medium">
              {p.name}
            </Link>
          </li>
        ))}
      </ul>
    </div>
  );
}

export default CategoryPage;
</file>

<file path="src/pages/ecommerce/categoryPageMeta.js">
export const metadata = {
  title: 'Products',
  description: 'Browse products',
};
</file>

<file path="src/pages/ecommerce/DepartmentCategoriesPage.jsx">
import { Link, useParams } from 'react-router-dom';
import {
  useGetDepartmentsQuery,
  useGetCategoriesQuery,
  useGetSubCategoriesQuery,
} from '../../api/erpApi';

function DepartmentCategoriesPage() {
  const { deptSlug } = useParams();
  const { data: deptData } = useGetDepartmentsQuery();
  const department = deptData?.content.find((d) => d.slug === deptSlug);
  const { data: catData } = useGetCategoriesQuery({ department: deptSlug });
  const categories = catData?.content ?? [];
  const { data: subData } = useGetSubCategoriesQuery({});
  const subs = subData?.content ?? [];

  return (
    <div className="pt-20 max-w-7xl mx-auto px-4">
      <h1 className="text-2xl font-bold mb-4">
        {department ? department.name : ''}
      </h1>
      {categories.map((cat) => (
        <div key={cat.id} className="mb-6">
          <h2 className="text-xl font-semibold mb-2">{cat.name}</h2>
          <ul className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2">
            {subs
              .filter((s) => s.category.slug === cat.slug)
              .map((s) => (
                <li key={s.id} className="p-4 bg-white rounded shadow">
                  <Link
                    to={`/departments/${deptSlug}/${cat.slug}/${s.slug}/products`}
                  >
                    {s.name}
                  </Link>
                </li>
              ))}
          </ul>
        </div>
      ))}
    </div>
  );
}

export default DepartmentCategoriesPage;
</file>

<file path="src/pages/ecommerce/departmentCategoriesPageMeta.js">
export const metadata = {
  title: 'Categories',
  description: 'Browse categories',
};
</file>

<file path="src/pages/ecommerce/DepartmentsPage.jsx">
import { Link } from 'react-router-dom';
import { useGetDepartmentsQuery } from '../../api/erpApi';

function DepartmentsPage() {
  const { data } = useGetDepartmentsQuery();
  const departments = data?.content ?? [];
  return (
    <div className="pt-20 max-w-7xl mx-auto px-4">
      <h1 className="text-2xl font-bold mb-4">Departments</h1>
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
        {departments.map((d) => (
          <Link
            key={d.id}
            to={`/departments/${d.slug}/categories`}
            className="p-4 bg-white rounded shadow text-center"
          >
            {d.name}
          </Link>
        ))}
      </div>
    </div>
  );
}

export default DepartmentsPage;
</file>

<file path="src/pages/ecommerce/departmentsPageMeta.js">
export const metadata = {
  title: 'Departments',
  description: 'Browse departments',
};
</file>

<file path="src/pages/ecommerce/HelpCentre.jsx">
import { useState } from 'react';
import {
  HiOutlinePhone,
  HiOutlineClock,
  HiOutlineChat,
  HiOutlineQuestionMarkCircle,
  HiOutlineTruck,
  HiOutlineShieldCheck,
  HiOutlineRefresh,
} from 'react-icons/hi';

function HelpCentre() {
  const [activeTab, setActiveTab] = useState('contact');

  const contactInfo = {
    phone: '+91 97911 51863',
    address:
      'Cheran Plaza K.G Chavadi Road\nEttimadai, Pirivu\nnear KK MAHAAL\nCoimbatore - 641105, Tamil Nadu, India',
    workingHours:
      'Monday - Saturday: 9:00 AM - 8:00 PM\nSunday: 10:00 AM - 6:00 PM',
  };

  const faqs = [
    {
      category: 'Orders & Shipping',
      questions: [
        {
          question: 'How long does shipping take?',
          answer:
            'Standard shipping takes 3-5 business days. Express shipping (1-2 days) is available for select locations. International shipping takes 7-14 business days.',
        },
        {
          question: 'Do you ship internationally?',
          answer:
            'Yes, we ship to most countries worldwide. Shipping costs and delivery times vary by location. You can check availability during checkout.',
        },
        {
          question: 'Can I track my order?',
          answer:
            "Yes, you'll receive a tracking number via email once your order ships. You can also track your order in your account dashboard.",
        },
      ],
    },
    {
      category: 'Returns & Refunds',
      questions: [
        {
          question: 'What is your return policy?',
          answer:
            'We offer a 30-day return policy for most products. Items must be in original condition with all packaging. Some products have different return policies.',
        },
        {
          question: 'How do I return an item?',
          answer:
            "Log into your account, go to 'My Orders', select the order you want to return, and follow the return process. We'll provide a prepaid shipping label.",
        },
        {
          question: 'When will I get my refund?',
          answer:
            'Refunds are processed within 3-5 business days after we receive your return. The time to appear in your account depends on your bank.',
        },
      ],
    },
    {
      category: 'Payment & Security',
      questions: [
        {
          question: 'What payment methods do you accept?',
          answer:
            'We accept all major credit/debit cards, UPI, net banking, digital wallets (Paytm, PhonePe, Google Pay), and EMI options.',
        },
        {
          question: 'Is my payment information secure?',
          answer:
            'Yes, we use industry-standard SSL encryption and PCI DSS compliance to protect your payment information. We never store your card details.',
        },
        {
          question: 'Do you offer EMI options?',
          answer:
            'Yes, we offer EMI options through various banks and financial institutions. You can select EMI during checkout for eligible products.',
        },
      ],
    },
    {
      category: 'Product Support',
      questions: [
        {
          question: 'Do products come with warranty?',
          answer:
            'Yes, all products come with manufacturer warranty. Warranty period varies by product and brand. Check product details for specific warranty information.',
        },
        {
          question: 'How do I claim warranty?',
          answer:
            "For warranty claims, contact our support team with your order details and issue description. We'll guide you through the warranty process.",
        },
        {
          question: 'Do you provide technical support?',
          answer:
            'Yes, our technical support team is available to help with product setup, troubleshooting, and general questions about your purchases.',
        },
      ],
    },
  ];

  const supportOptions = [
    {
      icon: <HiOutlinePhone className="w-8 h-8" />,
      title: 'Call Us',
      description: 'Speak directly with our support team',
      action: `Call ${contactInfo.phone}`,
      color: 'bg-gray-500',
    },
    {
      icon: <HiOutlineChat className="w-8 h-8" />,
      title: 'Live Chat',
      description: 'Chat with our support team',
      action: 'Start Chat',
      color: 'bg-gray-500',
    },
    // {
    //   icon: <HiOutlineMapPin className="w-8 h-8" />,
    //   title: "Visit Store",
    //   description: "Visit our physical store",
    //   action: "Get Directions",
    //   color: "bg-orange-500"
    // }
  ];

  return (
    <div className="min-h-screen bg-gray-50 pt-20">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-900 mb-4">Help Centre</h1>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            We're here to help! Find answers to common questions, get in touch
            with our support team, or visit our store for personalized
            assistance.
          </p>
        </div>

        {/* Support Options */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6 mb-12">
          {supportOptions.map((option, index) => (
            <div
              key={index}
              className="bg-white rounded-lg shadow-sm p-6 text-center hover:shadow-md transition-shadow"
            >
              <div
                className={`${option.color} text-white rounded-full w-16 h-16 flex items-center justify-center mx-auto mb-4`}
              >
                {option.icon}
              </div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                {option.title}
              </h3>
              <p className="text-gray-600 text-sm mb-4">{option.description}</p>
              <button className="bg-black text-white px-4 py-2 rounded-lg hover:bg-gray-900 transition-colors text-sm">
                {option.action}
              </button>
            </div>
          ))}
        </div>

        {/* Contact Information */}
        <div className="bg-white rounded-lg shadow-sm p-8 mb-12">
          <h2 className="text-2xl font-bold text-gray-900 mb-6">
            Contact Information
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div className="flex items-start gap-3">
              <HiOutlinePhone className="w-6 h-6 text-keyline mt-1" />
              <div>
                <h3 className="font-semibold text-gray-900">Phone Support</h3>
                <p className="text-gray-600">{contactInfo.phone}</p>
                <p className="text-sm text-gray-500">
                  Available during business hours
                </p>
              </div>
            </div>

            <div className="flex items-start gap-3">
              {/* <HiOutlineMapPin className="w-6 h-6 text-orange-600 mt-1" /> */}
              <div>
                <h3 className="font-semibold text-gray-900">Store Address</h3>
                <p className="text-gray-600 whitespace-pre-line">
                  {contactInfo.address}
                </p>
              </div>
            </div>

            <div className="flex items-start gap-3">
              <HiOutlineClock className="w-6 h-6 text-keyline mt-1" />
              <div>
                <h3 className="font-semibold text-gray-900">Working Hours</h3>
                <p className="text-gray-600 whitespace-pre-line">
                  {contactInfo.workingHours}
                </p>
              </div>
            </div>
          </div>
        </div>

        {/* Tabs */}
        <div className="bg-white rounded-lg shadow-sm overflow-hidden">
          <div className="border-b border-gray-200">
            <nav className="flex">
              <button
                onClick={() => setActiveTab('contact')}
                className={`px-6 py-4 text-sm font-medium ${
                  activeTab === 'contact'
                    ? 'border-b-2 border-keyline text-keyline'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                Contact Details
              </button>
              <button
                onClick={() => setActiveTab('faq')}
                className={`px-6 py-4 text-sm font-medium ${
                  activeTab === 'faq'
                    ? 'border-b-2 border-keyline text-keyline'
                    : 'text-gray-500 hover:text-gray-700'
                }`}
              >
                Frequently Asked Questions
              </button>
            </nav>
          </div>

          <div className="p-6">
            {activeTab === 'contact' && (
              <div className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  <div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">
                      Customer Support
                    </h3>
                    <div className="space-y-3">
                      <div className="flex items-center gap-3">
                        <HiOutlinePhone className="w-5 h-5 text-keyline" />
                        <span className="text-gray-700">
                          {contactInfo.phone}
                        </span>
                      </div>
                      <div className="flex items-center gap-3">
                        <HiOutlineMail className="w-5 h-5 text-green-600" />
                        <span className="text-gray-700">
                          {contactInfo.email}
                        </span>
                      </div>
                      <div className="flex items-center gap-3">
                        <HiOutlineClock className="w-5 h-5 text-keyline" />
                        <span className="text-gray-700">
                          Mon-Sat: 9AM-8PM, Sun: 10AM-6PM
                        </span>
                      </div>
                    </div>
                  </div>

                  <div>
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">
                      Store Location
                    </h3>
                    <div className="space-y-3">
                      <div className="flex items-start gap-3">
                        {/* <HiOutlineMapPin className="w-5 h-5 text-orange-600 mt-1" /> */}
                        <div className="text-gray-700 whitespace-pre-line">
                          {contactInfo.address}
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="bg-gray-50 rounded-lg p-6">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">
                    Emergency Support
                  </h3>
                  <p className="text-gray-600 mb-4">
                    For urgent technical issues or order problems, please call
                    our emergency support line:
                  </p>
                  <div className="flex items-center gap-3">
                    <HiOutlinePhone className="w-5 h-5 text-red-600" />
                    <span className="font-semibold text-red-600">
                      +91-1800-999-8888
                    </span>
                    <span className="text-sm text-gray-500">
                      (24/7 Emergency Support)
                    </span>
                  </div>
                </div>
              </div>
            )}

            {activeTab === 'faq' && (
              <div className="space-y-8">
                {faqs.map((category, categoryIndex) => (
                  <div key={categoryIndex}>
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">
                      {category.category}
                    </h3>
                    <div className="space-y-4">
                      {category.questions.map((faq, faqIndex) => (
                        <div
                          key={faqIndex}
                          className="border border-gray-200 rounded-lg p-4"
                        >
                          <h4 className="font-medium text-gray-900 mb-2">
                            {faq.question}
                          </h4>
                          <p className="text-gray-600 text-sm">{faq.answer}</p>
                        </div>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>
        </div>

        {/* Additional Services */}
        <div className="mt-12 grid grid-cols-1 md:grid-cols-3 gap-6">
          <div className="bg-white rounded-lg shadow-sm p-6 text-center">
            <HiOutlineTruck className="w-12 h-12 text-keyline mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              Free Shipping
            </h3>
            <p className="text-gray-600 text-sm">
              Free shipping on orders above ₹999 across India
            </p>
          </div>

          <div className="bg-white rounded-lg shadow-sm p-6 text-center">
            <HiOutlineShieldCheck className="w-12 h-12 text-green-600 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              Secure Shopping
            </h3>
            <p className="text-gray-600 text-sm">
              100% secure payment with SSL encryption
            </p>
          </div>

          <div className="bg-white rounded-lg shadow-sm p-6 text-center">
            <HiOutlineRefresh className="w-12 h-12 text-orange-600 mx-auto mb-4" />
            <h3 className="text-lg font-semibold text-gray-900 mb-2">
              Easy Returns
            </h3>
            <p className="text-gray-600 text-sm">
              30-day return policy with hassle-free returns
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

export default HelpCentre;
</file>

<file path="src/pages/ecommerce/Partners.jsx">
import { HiOutlineGlobe, HiOutlinePhone, HiOutlineMail } from 'react-icons/hi';

function Partners() {
  const partners = [
    {
      id: 1,
      name: 'Apple Inc.',
      logo: 'https://images.unsplash.com/photo-1611186871348-b1ce696e52c9?w=200&h=200&fit=crop',
      description:
        'Official Apple Authorized Reseller. Premium Apple products with genuine warranty and support.',
      category: 'Premium Partner',
      website: 'https://www.apple.com',
      phone: '+1-800-275-2273',
      email: 'partnership@apple.com',
    },
    {
      id: 2,
      name: 'Samsung Electronics',
      logo: 'https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=200&h=200&fit=crop',
      description:
        'Authorized Samsung Partner. Latest smartphones, tablets, and smart devices with exclusive offers.',
      category: 'Premium Partner',
      website: 'https://www.samsung.com',
      phone: '+91-1800-40-7267864',
      email: 'partners@samsung.com',
    },
    {
      id: 3,
      name: 'Dell Technologies',
      logo: 'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=200&h=200&fit=crop',
      description:
        'Dell Authorized Partner. Business laptops, desktops, and enterprise solutions with corporate discounts.',
      category: 'Business Partner',
      website: 'https://www.dell.com',
      phone: '+91-1800-425-4026',
      email: 'partnership@dell.com',
    },
    {
      id: 4,
      name: 'Sony Corporation',
      logo: 'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=200&h=200&fit=crop',
      description:
        'Sony Authorized Dealer. Premium audio equipment, cameras, and entertainment systems.',
      category: 'Premium Partner',
      website: 'https://www.sony.com',
      phone: '+91-1800-103-7799',
      email: 'partners@sony.com',
    },
    {
      id: 5,
      name: 'Logitech',
      logo: 'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=200&h=200&fit=crop',
      description:
        'Official Logitech Partner. Gaming peripherals, office accessories, and smart home solutions.',
      category: 'Accessories Partner',
      website: 'https://www.logitech.com',
      phone: '+91-1800-425-4026',
      email: 'partnership@logitech.com',
    },
    {
      id: 6,
      name: 'ASUS',
      logo: 'https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=200&h=200&fit=crop',
      description:
        'ASUS Authorized Partner. Gaming laptops, motherboards, and computer components.',
      category: 'Gaming Partner',
      website: 'https://www.asus.com',
      phone: '+91-1800-209-0365',
      email: 'partners@asus.com',
    },
  ];

  const partnerCategories = [
    {
      name: 'Premium Partners',
      description:
        'Top-tier brands with exclusive products and premium support',
      count: 3,
    },
    {
      name: 'Business Partners',
      description: 'Enterprise solutions and corporate technology partners',
      count: 1,
    },
    {
      name: 'Accessories Partners',
      description: 'Specialized accessories and peripheral manufacturers',
      count: 1,
    },
    {
      name: 'Gaming Partners',
      description: 'Gaming hardware and esports equipment providers',
      count: 1,
    },
  ];

  return (
    <div className="min-h-screen bg-gray-50 pt-20">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-900 mb-4">
            Our Partners
          </h1>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            We collaborate with world-leading technology brands to bring you the
            best products with genuine warranties and exceptional customer
            support.
          </p>
        </div>

        {/* Partner Categories */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
          {partnerCategories.map((category, index) => (
            <div
              key={index}
              className="bg-white rounded-lg shadow-sm p-6 text-center"
            >
              <div className="text-3xl mb-3">
                {category.name === 'Premium Partners' && '⭐'}
                {category.name === 'Business Partners' && '🏢'}
                {category.name === 'Accessories Partners' && '🔧'}
                {category.name === 'Gaming Partners' && '🎮'}
              </div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                {category.name}
              </h3>
              <p className="text-sm text-gray-600 mb-3">
                {category.description}
              </p>
              <div className="text-2xl font-bold text-gray-900">
                {category.count}
              </div>
            </div>
          ))}
        </div>

        {/* Partners Grid */}
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
          {partners.map((partner) => (
            <div
              key={partner.id}
              className="bg-white rounded-lg shadow-sm overflow-hidden hover:shadow-md transition-shadow"
            >
              {/* Partner Header */}
              <div className="p-6 border-b border-gray-100">
                <div className="flex items-center gap-4 mb-4">
                  <div className="w-16 h-16 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center">
                    <img
                      src={partner.logo}
                      alt={partner.name}
                      className="w-full h-full object-cover"
                    />
                  </div>
                  <div>
                    <h3 className="text-xl font-semibold text-gray-900">
                      {partner.name}
                    </h3>
                    <span className="inline-block bg-gray-100 text-gray-700 text-xs font-medium px-2 py-1 rounded-full border border-keyline">
                      {partner.category}
                    </span>
                  </div>
                </div>
                <p className="text-gray-600 text-sm leading-relaxed">
                  {partner.description}
                </p>
              </div>

              {/* Partner Contact Info */}
              <div className="p-6 space-y-3">
                <div className="flex items-center gap-3 text-sm">
                  <HiOutlineGlobe className="w-4 h-4 text-gray-400" />
                  <a
                    href={partner.website}
                    target="_blank"
                    rel="noopener noreferrer"
                    className="text-gray-700 hover:text-keyline"
                  >
                    Visit Website
                  </a>
                </div>

                <div className="flex items-center gap-3 text-sm">
                  <HiOutlinePhone className="w-4 h-4 text-gray-400" />
                  <a
                    href={`tel:${partner.phone}`}
                    className="text-gray-600 hover:text-gray-900"
                  >
                    {partner.phone}
                  </a>
                </div>

                <div className="flex items-center gap-3 text-sm">
                  <HiOutlineMail className="w-4 h-4 text-gray-400" />
                  <a
                    href={`mailto:${partner.email}`}
                    className="text-gray-600 hover:text-gray-900"
                  >
                    {partner.email}
                  </a>
                </div>
              </div>
            </div>
          ))}
        </div>

        {/* Partnership Benefits */}
        <div className="mt-16 bg-white rounded-lg shadow-sm p-8">
          <h2 className="text-2xl font-bold text-gray-900 mb-6 text-center">
            Partnership Benefits
          </h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <div className="text-center">
              <div className="text-4xl mb-4">🛡️</div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Genuine Warranty
              </h3>
              <p className="text-gray-600">
                All products come with official manufacturer warranty and
                support
              </p>
            </div>
            <div className="text-center">
              <div className="text-4xl mb-4">🚚</div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Fast Delivery
              </h3>
              <p className="text-gray-600">
                Priority shipping and express delivery options available
              </p>
            </div>
            <div className="text-center">
              <div className="text-4xl mb-4">🎁</div>
              <h3 className="text-lg font-semibold text-gray-900 mb-2">
                Exclusive Offers
              </h3>
              <p className="text-gray-600">
                Special discounts and bundle deals from our partners
              </p>
            </div>
          </div>
        </div>

        {/* Become a Partner */}
        <div className="mt-12 bg-gradient-to-r from-gray-700 to-gray-800 rounded-lg p-8 text-white text-center">
          <h2 className="text-2xl font-bold mb-4">
            Interested in Partnership?
          </h2>
          <p className="text-gray-700 mb-6 max-w-2xl mx-auto">
            We're always looking for new technology partners to expand our
            product portfolio and provide better value to our customers.
          </p>
          <div className="flex flex-col sm:flex-row gap-4 justify-center">
            <a
              href="tel:+919791151863"
              className="border border-white text-white px-6 py-3 rounded-lg font-semibold hover:bg-white hover:text-keyline transition-colors"
            >
              Call Now
            </a>
          </div>
        </div>
      </div>
    </div>
  );
}

export default Partners;
</file>

<file path="src/pages/ecommerce/ProductDetail.jsx">
import { useParams } from 'react-router-dom';
import {
  useGetProductBySlugQuery,
  useGetVariantsQuery,
} from '../../api/erpApi';
import { buildProductMetadata } from './productDetailMeta';

function ProductDetail() {
  const { slug } = useParams();
  const { data: product, isLoading } = useGetProductBySlugQuery(slug);
  const { data: variantData } = useGetVariantsQuery({ product: slug });
  const variants = variantData?.content ?? [];

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (!product) return <div className="p-4">Product not found</div>;

  buildProductMetadata(product);

  return (
    <div className="p-4 space-y-4">
      <h1 className="text-2xl font-bold">{product.name}</h1>
      <p className="text-gray-600">{product.brand_name || product.brand}</p>
      <p className="text-xl">
        ₹{product.price}
        {product.unit_name ? ` per ${product.unit_name}` : ''}
      </p>
      <p>{product.availability ? 'In stock' : 'Out of stock'}</p>
      {variants.length > 0 && (
        <div>
          <h2 className="font-semibold mt-4">Variants</h2>
          <ul className="list-disc ml-5">
            {variants.map((v) => (
              <li key={v.id}>
                {`${v.variant_name} - ₹${v.price}${v.unit_name ? ` per ${v.unit_name}` : ''}`}
              </li>
            ))}
          </ul>
        </div>
      )}
    </div>
  );
}

export default ProductDetail;
</file>

<file path="src/pages/ecommerce/productDetailMeta.js">
export let metadata = {};

export function buildProductMetadata(product) {
  const metaTitle = `${product.name} - ${product.brand_name || product.brand}`;
  const metaDesc = `Buy ${product.name} from ${product.brand_name || product.brand}`;
  const jsonLd = {
    '@context': 'https://schema.org',
    '@type': 'Product',
    name: product.name,
    brand: { '@type': 'Brand', name: product.brand_name || product.brand },
    offers: {
      '@type': 'Offer',
      price: product.price,
      priceCurrency: 'INR',
      availability: product.availability
        ? 'https://schema.org/InStock'
        : 'https://schema.org/OutOfStock',
    },
    url: product.url,
  };

  metadata = {
    title: metaTitle,
    description: metaDesc,
    alternates: { canonical: product.url },
    openGraph: {
      title: metaTitle,
      description: metaDesc,
      url: product.url,
      images: [product.image || ''],
    },
    jsonLd,
  };

  return metadata;
}
</file>

<file path="src/pages/ecommerce/Shop.jsx">
import { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import {
  useGetProductsQuery,
  useGetBrandsQuery,
  useGetDepartmentsQuery,
  useGetCategoriesQuery,
  useGetSubCategoriesQuery,
} from '../../api/erpApi';
import { useScrollMode } from '@/components/layout/ScrollModeContext';

function Shop() {
  const { setMode } = useScrollMode();
  useEffect(() => {
    setMode('scroll');
  }, [setMode]);

  const [selectedBrands, setSelectedBrands] = useState([]);
  const [department, setDepartment] = useState('');
  const [category, setCategory] = useState('');
  const [subcategory, setSubcategory] = useState('');
  const [onlyAvailable, setOnlyAvailable] = useState(false);
  const [minPrice, setMinPrice] = useState(0);
  const [maxPrice, setMaxPrice] = useState(0);
  const [ordering, setOrdering] = useState('-date_created');

  const { data: brandData } = useGetBrandsQuery();
  const brandOptions = brandData?.content ?? brandData ?? [];

  const { data: deptData } = useGetDepartmentsQuery();
  const deptOptions = deptData?.content ?? [];

  const { data: catData } = useGetCategoriesQuery(
    department ? { department } : undefined
  );
  const catOptions = catData?.content ?? [];

  const { data: subData } = useGetSubCategoriesQuery(
    category ? { category } : undefined
  );
  const subOptions = subData?.content ?? [];

  const params = {
    ...(selectedBrands.length && { brand: selectedBrands.join(',') }),
    ...(onlyAvailable && { availability: true }),
    ...(department && { department }),
    ...(category && { category }),
    ...(subcategory && { subcategory }),
    ...(minPrice > 0 && { min_price: minPrice }),
    ...(maxPrice > 0 && { max_price: maxPrice }),
    ...(ordering && { ordering }),
  };

  const { data, isLoading } = useGetProductsQuery(params);
  const products = data?.content ?? [];

  const toggleBrand = (id) => {
    setSelectedBrands((prev) =>
      prev.includes(id) ? prev.filter((b) => b !== id) : [...prev, id]
    );
  };

  // clamp price sliders
  const handleMinPrice = (val) => {
    setMinPrice(Math.min(val, maxPrice));
  };
  const handleMaxPrice = (val) => {
    setMaxPrice(Math.max(val, minPrice));
  };

  if (isLoading) return <div className="p-4">Loading...</div>;

  return (
    <div className="space-y-6">
      {/* Filters */}
      <div className="p-4 space-y-6">
          {/* Sort */}
          <section className="space-y-3">
            <h3 className="font-medium text-sm">Sort</h3>
            <select
              value={ordering}
              onChange={(e) => setOrdering(e.target.value)}
              className="border p-2 rounded w-full"
            >
              <option value="-date_created">Newest</option>
              <option value="price">Price: Low to High</option>
              <option value="-price">Price: High to Low</option>
            </select>
          </section>

          {/* Categories */}
          <section className="space-y-3">
            <h3 className="font-medium text-sm">Categories</h3>
            <div className="space-y-2">
              <select
                value={department}
                onChange={(e) => {
                  setDepartment(e.target.value);
                  setCategory('');
                  setSubcategory('');
                }}
                className="border p-2 rounded w-full"
              >
                <option value="">All Departments</option>
                {deptOptions.map((d) => (
                  <option key={d.slug} value={d.slug}>
                    {d.name}
                  </option>
                ))}
              </select>
              <select
                value={category}
                onChange={(e) => {
                  setCategory(e.target.value);
                  setSubcategory('');
                }}
                className="border p-2 rounded w-full"
              >
                <option value="">All Categories</option>
                {catOptions.map((c) => (
                  <option key={c.slug} value={c.slug}>
                    {c.name}
                  </option>
                ))}
              </select>
              <select
                value={subcategory}
                onChange={(e) => setSubcategory(e.target.value)}
                className="border p-2 rounded w-full"
              >
                <option value="">All SubCategories</option>
                {subOptions.map((s) => (
                  <option key={s.slug} value={s.slug}>
                    {s.name}
                  </option>
                ))}
              </select>
            </div>
          </section>

          {/* Brands */}
          <section className="space-y-3">
            <h3 className="font-medium text-sm">Brands</h3>
            <div className="flex flex-wrap gap-2">
              {brandOptions.map((b) => (
                <label key={b.id} className="flex items-center gap-1 text-sm">
                  <input
                    type="checkbox"
                    checked={selectedBrands.includes(b.id)}
                    onChange={() => toggleBrand(b.id)}
                  />
                  {b.name}
                </label>
              ))}
            </div>
          </section>

          {/* Price & Availability */}
          <section className="space-y-3">
            <h3 className="font-medium text-sm">Price & Availability</h3>
            <div className="space-y-2">
              <div className="flex items-center gap-2">
                <input
                  type="range"
                  min="0"
                  max="100000"
                  value={minPrice}
                  onChange={(e) => handleMinPrice(Number(e.target.value))}
                />
                <input
                  type="range"
                  min="0"
                  max="100000"
                  value={maxPrice}
                  onChange={(e) => handleMaxPrice(Number(e.target.value))}
                />
              </div>
              <label className="flex items-center gap-2">
                <input
                  type="checkbox"
                  checked={onlyAvailable}
                  onChange={(e) => setOnlyAvailable(e.target.checked)}
                />
                Available
              </label>
            </div>
          </section>
        </div>

      {/* Products */}
      <div className="p-4">
        <ul className="grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
          {products.map((p) => (
            <li key={p.id} className="border rounded p-4">
              <Link to={`/product/${p.slug}`} className="font-semibold">
                {p.name}
              </Link>
              <p className="text-sm text-gray-500">{p.brand_name}</p>
              <p className="mt-2">₹{p.price}</p>
              {!p.availability && (
                <p className="text-red-500 text-sm">Out of stock</p>
              )}
            </li>
          ))}
        </ul>
      </div>
    </div>
  );
}

export default Shop;
</file>

<file path="src/pages/Index.jsx">
import { useCallback, useEffect, useRef, useState } from 'react';
import { devLog } from '@/utils/devLog';
import {
  useScrollMode,
  SECTION_SLIDER_MODE,
} from '@/components/layout/ScrollModeContext';
import HeroReel from '@/components/reels/HeroReel';
import QuickActionsReel from '@/components/reels/QuickActionsReel';
import TestimonialsReel from '@/components/reels/TestimonialsReel';

// SEO metadata moved to dedicated module per React 19 guidelines
export { metadata } from './IndexMeta';

/**
 * Cubic easing function for smooth scroll animations
 * @param {number} t - Progress value between 0 and 1
 * @returns {number} Eased progress value
 */
const easeInOutCubic = (t) =>
  t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;

/**
 * Configuration for landing page sections (reels)
 * Each reel represents a full-page section with horizontal sliding content
 */
const REEL_CONFIG = [
  { id: 'hero', component: HeroReel, enabled: true },
  { id: 'quickActions', component: QuickActionsReel, enabled: true },
  { id: 'testimonials', component: TestimonialsReel, enabled: true },
];

/**
 * Landing Page Component
 * 
 * Full-page sectioned landing page with vertical scroll-snap navigation.
 * Features:
 * - Vertical section snapping (proximity mode for smoother UX)
 * - Wheel, touch, and keyboard navigation support
 * - Desktop: Right-side navigation dots
 * - Mobile: Bottom progress bar indicator
 * - Responsive layouts for mobile/desktop
 * 
 * @component
 * @returns {React.Element} Landing page with multiple sections
 */
export default function Index() {
  const [currentSection, setCurrentSection] = useState(0);
  const [isScrolling, setIsScrolling] = useState(false);
  const wheelDelta = useRef(0);
  const { scrollElement, setMode } = useScrollMode();

  useEffect(() => {
    setMode(SECTION_SLIDER_MODE);
    return () => setMode('scroll');
  }, [setMode]);

  const activeReels = REEL_CONFIG.filter((reel) => reel.enabled);
  const sectionsCount = activeReels.length;

  useEffect(() => {
    if (currentSection >= sectionsCount) {
      setCurrentSection(Math.max(0, sectionsCount - 1));
    }
  }, [sectionsCount, currentSection]);

  const scrollToSection = useCallback(
    (sectionIndex, duration = 600) => {
      const container = scrollElement;

      devLog('[Index.jsx Scroll Debug]:', {
        from: currentSection,
        to: sectionIndex,
        reason: 'scrollToSection called',
        eventType: 'programmatic',
        timestamp: Date.now(),
      });

      if (!container) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: sectionIndex,
          reason: 'scroll blocked: no container',
          eventType: 'programmatic',
          timestamp: Date.now(),
        });
        return;
      }
      if (isScrolling) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: sectionIndex,
          reason: 'scroll blocked: isScrolling',
          eventType: 'programmatic',
          timestamp: Date.now(),
        });
        return;
      }
      if (sectionIndex < 0 || sectionIndex >= sectionsCount) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: sectionIndex,
          reason: 'scroll blocked: invalid section index',
          eventType: 'programmatic',
          timestamp: Date.now(),
          sectionsCount,
        });
        return;
      }


      setIsScrolling(true);

      // Preserve existing nav height calculation
      const navHeight =
        (parseInt(
          getComputedStyle(document.documentElement).getPropertyValue(
            '--topbar-h'
          )
        ) || 0) +
        (parseInt(
          getComputedStyle(document.documentElement).getPropertyValue(
            '--mainnav-h'
          )
        ) || 0);

      const sectionHeight = window.innerHeight - navHeight;
      const targetScroll = sectionIndex * sectionHeight;
      const startScroll = container.scrollTop;
      const distance = targetScroll - startScroll;
      const startTime = performance.now();

      // Accessibility support
      const prefersReducedMotion = window.matchMedia(
        '(prefers-reduced-motion: reduce)'
      ).matches;
      const animationDuration = prefersReducedMotion ? 0 : duration;

      devLog('Scrolling to section', {
        sectionIndex,
        sectionHeight,
        targetScroll,
        startScroll,
        navHeight,
      });

      // Smooth animation loop
      const animateScroll = (currentTime) => {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / animationDuration, 1);
        const easedProgress = easeInOutCubic(progress);

        container.scrollTop = startScroll + distance * easedProgress;

        if (progress < 1) {
          requestAnimationFrame(animateScroll);
        } else {
          setCurrentSection(sectionIndex);
          setIsScrolling(false);
          devLog('Scroll completed', { sectionIndex });
        }
      };

      requestAnimationFrame(animateScroll);
    },
    [scrollElement, isScrolling, sectionsCount]
  );

  useEffect(() => {
    const container = scrollElement;
    if (!container) return;

    const isDesktop = window.matchMedia(
      '(hover: hover) and (pointer: fine)'
    ).matches;
    if (!isDesktop) return;

    const handleWheel = (e) => {
      devLog('[Index.jsx Scroll Debug]:', {
        from: currentSection,
        to: null,
        reason: 'handleWheel triggered',
        eventType: e.type,
        timestamp: Date.now(),
        deltaY: e.deltaY,
      });
      // If the event target is inside a horizontal slider, ignore the event
      if (e.target.closest('.is-horizontal-scroll-container')) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: horizontal scroll container',
          eventType: e.type,
          timestamp: Date.now(),
        });
        return;
      }

      if (isScrolling) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: isScrolling',
          eventType: e.type,
          timestamp: Date.now(),
        });
        e.preventDefault();
        e.stopPropagation();
        return;
      }

      // Always prevent default to avoid bubbling conflicts
      e.preventDefault();
      e.stopPropagation();

      const deltaY = e.deltaY;
      wheelDelta.current += deltaY;

      // Cross-platform adaptive threshold
      const threshold = Math.max(10, Math.abs(deltaY) * 0.5);
      if (Math.abs(wheelDelta.current) < threshold) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: delta threshold not met',
          eventType: e.type,
          timestamp: Date.now(),
          wheelDelta: wheelDelta.current,
          threshold,
        });
        return;
      }

      const direction = wheelDelta.current > 0 ? 1 : -1;
      wheelDelta.current = 0;

      let nextSection = currentSection;
      if (direction > 0 && currentSection < sectionsCount - 1) {
        nextSection = currentSection + 1;
      } else if (direction < 0 && currentSection > 0) {
        nextSection = currentSection - 1;
      }

      if (nextSection !== currentSection) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: nextSection,
          eventType: e.type,
          timestamp: Date.now(),
          direction,
        });
        devLog('Wheel scroll triggered', {
          from: currentSection,
          to: nextSection,
        });
        scrollToSection(nextSection);
      }
    };

    container.addEventListener('wheel', handleWheel, {
      passive: false,
      capture: true,
    });

    return () =>
      container.removeEventListener('wheel', handleWheel, { capture: true });
  }, [
    scrollElement,
    currentSection,
    isScrolling,
    sectionsCount,
    scrollToSection,
  ]);

  useEffect(() => {
    const container = scrollElement;
    if (!container) return;

    let touchStartY = 0;
    let touchStartTime = 0;

    const handleTouchStart = (e) => {
      touchStartY = e.touches[0].clientY;
      touchStartTime = Date.now();
    };

    const handleTouchEnd = (e) => {
      devLog('[Index.jsx Scroll Debug]:', {
        from: currentSection,
        to: null,
        reason: 'handleTouchEnd triggered',
        eventType: e.type,
        timestamp: Date.now(),
      });
      // If the event target is inside a horizontal slider, ignore the event
      if (e.target.closest('.is-horizontal-scroll-container')) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: horizontal scroll container',
          eventType: e.type,
          timestamp: Date.now(),
        });
        return;
      }

      if (isScrolling) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: isScrolling',
          eventType: e.type,
          timestamp: Date.now(),
        });
        return;
      }

      const touchDuration = Date.now() - touchStartTime;
      if (touchDuration < 50) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: touch duration too short',
          eventType: e.type,
          timestamp: Date.now(),
          touchDuration,
        });
        return;
      }

      const touchEndY = e.changedTouches[0].clientY;
      const deltaY = touchStartY - touchEndY;
      const minSwipeDistance = 50;

      if (Math.abs(deltaY) > minSwipeDistance) {
        let nextSection = currentSection;

        if (deltaY > 0 && currentSection < sectionsCount - 1) {
          nextSection = currentSection + 1;
        } else if (deltaY < 0 && currentSection > 0) {
          nextSection = currentSection - 1;
        }

        if (nextSection !== currentSection) {
          devLog('[Index.jsx Scroll Debug]:', {
            from: currentSection,
            to: nextSection,
            eventType: e.type,
            timestamp: Date.now(),
            deltaY,
          });
          devLog('Touch scroll triggered', {
            from: currentSection,
            to: nextSection,
          });
          scrollToSection(nextSection);
        }
      } else {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: swipe distance too short',
          eventType: e.type,
          timestamp: Date.now(),
          deltaY,
          minSwipeDistance,
        });
      }
    };

    container.addEventListener('touchstart', handleTouchStart, {
      passive: true,
    });
    container.addEventListener('touchend', handleTouchEnd, {
      passive: true,
    });

    return () => {
      container.removeEventListener('touchstart', handleTouchStart);
      container.removeEventListener('touchend', handleTouchEnd);
    };
  }, [
    scrollElement,
    currentSection,
    isScrolling,
    sectionsCount,
    scrollToSection,
  ]);

  useEffect(() => {
    const handleKeyDown = (e) => {
      devLog('[Index.jsx Scroll Debug]:', {
        from: currentSection,
        to: null,
        reason: 'handleKeyDown triggered',
        eventType: e.type,
        timestamp: Date.now(),
        key: e.key,
      });
      if (isScrolling) {
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: null,
          reason: 'scroll ignored: isScrolling',
          eventType: e.type,
          timestamp: Date.now(),
        });
        return;
      }

      let nextSection = currentSection;

      if (e.key === 'ArrowDown' && currentSection < sectionsCount - 1) {
        nextSection = currentSection + 1;
      } else if (e.key === 'ArrowUp' && currentSection > 0) {
        nextSection = currentSection - 1;
      }

      if (nextSection !== currentSection) {
        e.preventDefault();
        devLog('[Index.jsx Scroll Debug]:', {
          from: currentSection,
          to: nextSection,
          eventType: e.type,
          timestamp: Date.now(),
          key: e.key,
        });
        devLog('Keyboard scroll triggered', {
          from: currentSection,
          to: nextSection,
        });
        scrollToSection(nextSection);
      }
    };

    window.addEventListener('keydown', handleKeyDown);

    return () => window.removeEventListener('keydown', handleKeyDown);
  }, [currentSection, isScrolling, sectionsCount, scrollToSection]);

  return (
    <>
      {/* Metadata is provided via IndexMeta.js */}
      {activeReels.map((reel) => {
        const Component = reel.component;
        return <Component key={reel.id} />;
      })}
      
      {/* Desktop: Section navigation dots */}
      <nav
        className="fixed right-6 top-1/2 transform -translate-y-1/2 z-50 hidden md:flex flex-col gap-3"
        role="tablist"
        aria-label="Page sections"
      >
        {activeReels.map((reel, index) => (
          <button
            key={reel.id}
            onClick={() => scrollToSection(index)}
            disabled={isScrolling}
            role="tab"
            aria-selected={currentSection === index}
            className={`section-indicator w-3 h-3 rounded-full border-2 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-keyline focus:ring-offset-2 ${
              currentSection === index
                ? 'bg-secondary border-keyline'
                : 'bg-transparent border-surface hover:border-keyline disabled:opacity-50'
            }`}
            aria-label={`Go to ${reel.id} section (${index + 1} of ${sectionsCount})`}
          />
        ))}
      </nav>

      {/* Mobile: Progress bar indicator */}
      <div 
        className="md:hidden fixed bottom-20 left-0 right-0 h-1 bg-gray-200 z-40"
        role="progressbar"
        aria-valuenow={((currentSection + 1) / sectionsCount) * 100}
        aria-valuemin="0"
        aria-valuemax="100"
        aria-label={`Section ${currentSection + 1} of ${sectionsCount}`}
      >
        <div 
          className="h-full bg-secondary transition-all duration-300 ease-out"
          style={{ width: `${((currentSection + 1) / sectionsCount) * 100}%` }}
        />
      </div>
    </>
  );
}
</file>

<file path="src/pages/IndexMeta.js">
export const metadata = {
  title: 'Home – Finetune',
  description: 'Expert Mobile & Laptop Repairs in Coimbatore & Palakkad',
  openGraph: {
    title: 'Home – Finetune',
    description: 'Expert Mobile & Laptop Repairs in Coimbatore & Palakkad',
  },
};
</file>

<file path="src/pages/internal/AdminDashboard.jsx">
import {
  HiOutlineClipboardCheck,
  HiOutlineQrcode,
  HiOutlineDatabase,
  HiOutlineCreditCard,
} from 'react-icons/hi';
import { HiOutlineClipboardDocumentList } from 'react-icons/hi2';
import GenericDashboard from './GenericDashboard';

const adminFeatures = [
  {
    title: 'Workledger',
    icon: <HiOutlineClipboardDocumentList size={28} />,
    status: 'live',
    to: '/workledger',
  },
  {
    title: 'Giveaway Redemption',
    icon: <HiOutlineClipboardCheck size={28} />,
    status: 'live',
    to: '/giveaway-redemption',
  },
  { title: 'Invoice', icon: <HiOutlineClipboardCheck size={28} /> },
  { title: 'Price Check', icon: <HiOutlineQrcode size={28} /> },
  { title: 'EMI Info' },
  { title: 'Backcase Info' },
  { title: 'Temper Manager' },
  { title: 'Service Entry', icon: <HiOutlineDatabase size={28} /> },
  { title: 'Inventory' },
  { title: 'RPay', icon: <HiOutlineCreditCard size={28} /> },
];

function AdminDashboard() {
  return <GenericDashboard title="Admin Dashboard" features={adminFeatures} />;
}

export default AdminDashboard;
</file>

<file path="src/pages/internal/AdvisorDashboard.jsx">
import GenericDashboard from './GenericDashboard';
import {
  HiOutlineClipboardCheck,
  HiOutlineQrcode,
  HiOutlineDatabase,
  HiOutlineCreditCard,
} from 'react-icons/hi';
import { HiOutlineClipboardDocumentList } from 'react-icons/hi2';

const advisorFeatures = [
  {
    title: 'Workledger',
    icon: <HiOutlineClipboardDocumentList size={28} />,
    status: 'live',
    to: '/workledger',
  },
  {
    title: 'Giveaway Redemption',
    icon: <HiOutlineClipboardCheck size={28} />,
    status: 'live',
    to: '/giveaway-redemption',
  },
  { title: 'Invoice', icon: <HiOutlineClipboardCheck size={28} /> },
  { title: 'Price Check', icon: <HiOutlineQrcode size={28} /> },
  { title: 'EMI Info' },
  { title: 'Backcase Info' },
  { title: 'Temper Manager' },
  { title: 'Service Entry', icon: <HiOutlineDatabase size={28} /> },
  { title: 'Inventory' },
  { title: 'RPay', icon: <HiOutlineCreditCard size={28} /> },
];

export default function AdvisorDashboard() {
  return (
    <GenericDashboard title="Advisor Dashboard" features={advisorFeatures} />
  );
}
</file>

<file path="src/pages/internal/Bookings.jsx">
import { useState, useRef, useEffect } from 'react';
import toast from 'react-hot-toast';
import Loader from '@/components/common/Loader';
import ReCaptchaWrapper from '@/components/common/ReCaptchaWrapper';
import MyBookings from '@/components/MyBookings';
import MultiSelectIssues from '@/components/repairs/MultiSelectIssues';
import Questionnaire from '@/components/repairs/Questionnaire';
import {
  useCreateBookingMutation,
  useGetBookingsQuery,
  useGetIssuesQuery,
  useGetQuestionsQuery,
} from '../../api/erpApi';

export default function Bookings() {
  const [form, setForm] = useState({
    name: '',
    email: '',
    date: '',
    time: '',
    message: '',
  });
  const [selectedIssues, setSelectedIssues] = useState([]);
  const [otherIssues, setOtherIssues] = useState('');
  const [responses, setResponses] = useState({});
  const [loading, setLoading] = useState(false);
  const [captcha, setCaptcha] = useState('');
  const [cooldown, setCooldown] = useState(false);
  const [result, setResult] = useState(null);
  const recaptchaRef = useRef(null);
  const [createBooking] = useCreateBookingMutation();
  const { data: bookingsData, refetch } = useGetBookingsQuery(undefined, {
    skip: !result,
  });
  const { data: issuesData } = useGetIssuesQuery();
  const { data: questionsData } = useGetQuestionsQuery({
    question_set_name: 'INTAKE_DEFAULT',
  });

  useEffect(() => {
    document.title = 'Book a Service – Finetune';
    const desc = 'Schedule a service booking with Finetune.';
    const setMeta = (key, val, property = false) => {
      const attr = property ? 'property' : 'name';
      let tag = document.head.querySelector(`meta[${attr}='${key}']`);
      if (!tag) {
        tag = document.createElement('meta');
        tag.setAttribute(attr, key);
        document.head.appendChild(tag);
      }
      tag.setAttribute('content', val);
    };
    setMeta('description', desc);
    setMeta('og:title', 'Book a Service – Finetune', true);
    setMeta('og:description', desc, true);
  }, []);

  const onChange = (e) => setForm({ ...form, [e.target.name]: e.target.value });

  const submit = async (e) => {
    e.preventDefault();
    if (cooldown) {
      toast.error('Please wait before submitting again');
      return;
    }
    if (!captcha) {
      toast.error('Captcha verification failed');
      return;
    }
    try {
      setLoading(true);
      const resp = await createBooking({
        booking: { name: form.name, email: form.email },
        details: {
          date: form.date,
          time: form.time,
          message: form.message,
        },
        issues: selectedIssues,
        other_issues: otherIssues
          .split(',')
          .map((o) => o.trim())
          .filter(Boolean),
        responses: Object.entries(responses).map(([question, answer]) => ({
          question,
          answer,
        })),
        captcha_token: captcha,
      }).unwrap();
      toast.success('Booking submitted');
      setResult(resp);
      setForm({ name: '', email: '', date: '', time: '', message: '' });
      setSelectedIssues([]);
      setOtherIssues('');
      setResponses({});
      recaptchaRef.current?.reset();
      setCaptcha('');
      setCooldown(true);
      setTimeout(() => setCooldown(false), 30000);
    } catch {
      toast.error('Submission failed');
      setResult(null);
    } finally {
      setLoading(false);
    }
  };

  if (result) {
    return (
      <div className="p-4 pt-24 max-w-xl mx-auto">
        <h1 className="text-2xl font-bold mb-4">Booking Submitted</h1>
        <p>
          Your booking ID is {result.id}. Current status: {result.status}.
        </p>
        <MyBookings bookings={bookingsData?.content || []} refetch={refetch} />
      </div>
    );
  }

  return (
    <div className="p-4 pt-24 max-w-xl mx-auto">
      {loading && <Loader />}
      <h1 className="text-2xl font-bold mb-4">Book a Service</h1>
      <form onSubmit={submit} className="space-y-4">
        <input
          name="name"
          value={form.name}
          onChange={onChange}
          placeholder="Name"
          className="input"
          required
        />
        <input
          type="email"
          name="email"
          value={form.email}
          onChange={onChange}
          placeholder="Email (optional)"
          className="input"
        />
        <input
          type="date"
          name="date"
          value={form.date}
          onChange={onChange}
          className="input"
          required
        />
        <input
          type="time"
          name="time"
          value={form.time}
          onChange={onChange}
          className="input"
          required
        />
        <MultiSelectIssues
          issues={issuesData || []}
          value={selectedIssues}
          onChange={setSelectedIssues}
        />
        <input
          name="otherIssues"
          value={otherIssues}
          onChange={(e) => setOtherIssues(e.target.value)}
          placeholder="Other issues (comma separated)"
          className="input"
        />
        <Questionnaire
          questions={questionsData || []}
          responses={responses}
          onChange={setResponses}
        />
        <textarea
          name="message"
          value={form.message}
          onChange={onChange}
          placeholder="Message (optional)"
          className="input"
        />
        <ReCaptchaWrapper ref={recaptchaRef} onChange={setCaptcha} />
        <button
          type="submit"
          disabled={loading}
          className="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 disabled:opacity-50"
        >
          Submit
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/BookingsDashboard.jsx">
import { useState, Fragment } from 'react';
import {
  useGetBookingsQuery,
  useUpdateBookingStatusMutation,
  useGetInvoicesQuery,
  useGetStockEntriesQuery,
} from '../../api/erpApi';
import InvoiceForm from '@/components/InvoiceForm';
import InvoiceTable from '@/components/InvoiceTable';
import PaymentsTable from '@/components/PaymentsTable';
import toast from 'react-hot-toast';
import SaleEntryForm from '@/components/inventory/SaleEntryForm';

export default function BookingsDashboard() {
  const { data, isLoading, error } = useGetBookingsQuery();
  const [updateBookingStatus] = useUpdateBookingStatusMutation();
  const [modal, setModal] = useState(null); // {id, status, reason}
  const [invoiceModal, setInvoiceModal] = useState(null); // booking id
  const bookings = data?.content || [];
  const { data: invoiceData } = useGetInvoicesQuery();
  const allInvoices = invoiceData?.results || invoiceData || [];
  const { data: stockEntryData } = useGetStockEntriesQuery();
  const allEntries = stockEntryData?.results || stockEntryData || [];

  const changeStatus = async (id, status) => {
    try {
      await updateBookingStatus({ id, status }).unwrap();
      toast.success('Status updated');
    } catch {
      toast.error('Update failed');
    }
  };

  const openModal = (id, status) => setModal({ id, status, reason: '' });
  const closeModal = () => setModal(null);

  const submitModal = async () => {
    if (!modal.reason.trim()) {
      toast.error('Reason required');
      return;
    }
    try {
      await updateBookingStatus({
        id: modal.id,
        status: modal.status,
        reason: modal.reason,
      }).unwrap();
      toast.success('Status updated');
      closeModal();
    } catch {
      toast.error('Update failed');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load bookings</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Bookings</h1>
      <table className="w-full text-left border">
        <thead>
          <tr>
            <th className="p-2 border">Name</th>
            <th className="p-2 border">Issues</th>
            <th className="p-2 border">Other Issues</th>
            <th className="p-2 border">Responses</th>
            <th className="p-2 border">Status</th>
            <th className="p-2 border">Reason</th>
            <th className="p-2 border">Actions</th>
            <th className="p-2 border">Invoice</th>
          </tr>
        </thead>
        <tbody>
          {bookings.map((b) => (
            <Fragment key={b.id}>
              <tr className="border-t">
                <td className="p-2 border">{b.name}</td>
                <td className="p-2 border">
                  {b.issues?.length
                    ? b.issues.map((i) => (
                        <span
                          key={i.id || i}
                          className="mr-1 inline-block rounded bg-gray-100 px-2 py-1"
                        >
                          {i.name || i}
                        </span>
                      ))
                    : '-'}
                </td>
                <td className="p-2 border">
                  {b.other_issues?.length
                    ? b.other_issues.map((o) => (
                        <span
                          key={o}
                          className="mr-1 inline-block rounded bg-gray-100 px-2 py-1"
                        >
                          {o}
                        </span>
                      ))
                    : '-'}
                </td>
                <td className="p-2 border">
                  {b.responses?.length
                    ? b.responses.map((r) => (
                        <div key={r.question} className="mb-1">
                          <span className="font-medium">{r.question}</span>:{' '}
                          {r.answer}
                        </div>
                      ))
                    : '-'}
                </td>
                <td className="p-2 border">{b.status}</td>
                <td className="p-2 border">{b.reason || '-'}</td>
                <td className="p-2 border space-x-2">
                  <button
                    onClick={() => changeStatus(b.id, 'approved')}
                    className="text-blue-600"
                  >
                    Approve
                  </button>
                  <button
                    onClick={() => changeStatus(b.id, 'in_progress')}
                    className="text-yellow-600"
                  >
                    In Progress
                  </button>
                  <button
                    onClick={() => changeStatus(b.id, 'completed')}
                    className="text-green-600"
                  >
                    Complete
                  </button>
                  <button
                    onClick={() => openModal(b.id, 'cancelled')}
                    className="text-red-600"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={() => openModal(b.id, 'rejected')}
                    className="text-gray-600"
                  >
                    Reject
                  </button>
                </td>
                <td className="p-2 border">
                  <button
                    onClick={() => setInvoiceModal(b.id)}
                    className="text-blue-600"
                  >
                    Create Invoice
                  </button>
                </td>
              </tr>
              {(() => {
                const invs = allInvoices.filter((i) => i.booking === b.id);
                const entries = allEntries.filter((e) => e.booking === b.id);
                if (!invs.length && !entries.length)
                  return (
                    <tr>
                      <td colSpan={8} className="p-2 border">
                        <SaleEntryForm bookingId={b.id} />
                      </td>
                    </tr>
                  );
                return (
                  <tr>
                    <td colSpan={8} className="p-2 border space-y-2">
                      {invs.length && (
                        <>
                          <InvoiceTable invoices={invs} />
                          {invs.map((inv) => (
                            <PaymentsTable
                              key={inv.id}
                              payments={inv.payments || []}
                            />
                          ))}
                        </>
                      )}
                      <div>
                        <SaleEntryForm bookingId={b.id} />
                        {entries.length > 0 && (
                          <ul className="mt-2 list-disc list-inside">
                            {entries.map((e) => (
                              <li key={e.id}>
                                {e.product_variant} x{e.quantity}
                              </li>
                            ))}
                          </ul>
                        )}
                      </div>
                    </td>
                  </tr>
                );
              })()}
            </Fragment>
          ))}
        </tbody>
      </table>

      {modal && (
        <div className="fixed inset-0 flex items-center justify-center bg-black/50">
          <div className="bg-white p-4 rounded w-80">
            <h3 className="text-lg font-bold mb-2">
              {modal.status === 'rejected' ? 'Reject' : 'Cancel'} Booking
            </h3>
            <textarea
              placeholder="Reason"
              className="input w-full mb-2"
              value={modal.reason}
              onChange={(e) => setModal({ ...modal, reason: e.target.value })}
            />
            <div className="text-right space-x-2">
              <button onClick={closeModal} className="px-3 py-1">
                Close
              </button>
              <button
                onClick={submitModal}
                className="bg-red-600 text-white px-3 py-1 rounded"
              >
                Submit
              </button>
            </div>
          </div>
        </div>
      )}
      {invoiceModal && (
        <div className="fixed inset-0 flex items-center justify-center bg-black/50">
          <div className="bg-white p-4 rounded w-[500px]">
            <InvoiceForm
              bookingId={invoiceModal}
              onSuccess={() => setInvoiceModal(null)}
            />
          </div>
        </div>
      )}
    </div>
  );
}
</file>

<file path="src/pages/internal/BranchHeadDashboard.jsx">
import GenericDashboard from './GenericDashboard';
import {
  HiOutlineClipboardCheck,
  HiOutlineQrcode,
  HiOutlineDatabase,
  HiOutlineCreditCard,
} from 'react-icons/hi';
import { HiOutlineClipboardDocumentList } from 'react-icons/hi2';

const branchHeadFeatures = [
  {
    title: 'Workledger',
    icon: <HiOutlineClipboardDocumentList size={28} />,
    status: 'live',
    to: '/workledger',
  },
  {
    title: 'Giveaway Redemption',
    icon: <HiOutlineClipboardCheck size={28} />,
    status: 'live',
    to: '/giveaway-redemption',
  },
  { title: 'Invoice', icon: <HiOutlineClipboardCheck size={28} /> },
  { title: 'Price Check', icon: <HiOutlineQrcode size={28} /> },
  { title: 'EMI Info' },
  { title: 'Backcase Info' },
  { title: 'Temper Manager' },
  { title: 'Service Entry', icon: <HiOutlineDatabase size={28} /> },
  { title: 'Inventory' },
  { title: 'RPay', icon: <HiOutlineCreditCard size={28} /> },
];

export default function BranchHeadDashboard() {
  return (
    <GenericDashboard
      title="Branch Head Dashboard"
      features={branchHeadFeatures}
    />
  );
}
</file>

<file path="src/pages/internal/BrandDashboard.jsx">
import { useState } from 'react';
import {
  useGetBrandsQuery,
  useCreateBrandMutation,
  useUpdateBrandMutation,
  useDeleteBrandMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function BrandDashboard() {
  const { data, isLoading, error } = useGetBrandsQuery();
  const [createBrand] = useCreateBrandMutation();
  const [updateBrand] = useUpdateBrandMutation();
  const [deleteBrand] = useDeleteBrandMutation();
  const [form, setForm] = useState({ id: null, name: '', logo: null });

  const handleChange = (e) => {
    const { name, value, files } = e.target;
    setForm((f) => ({ ...f, [name]: files ? files[0] : value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const fd = new FormData();
    fd.append('name', form.name);
    if (form.logo) fd.append('logo', form.logo);
    try {
      if (form.id) {
        await updateBrand({ id: form.id, body: fd }).unwrap();
        toast.success('Brand updated');
      } else {
        await createBrand(fd).unwrap();
        toast.success('Brand created');
      }
      setForm({ id: null, name: '', logo: null });
    } catch {
      toast.error('Failed to save brand');
    }
  };

  const handleEdit = (b) => {
    setForm({ id: b.id, name: b.name, logo: null });
  };

  const handleDelete = async (id) => {
    try {
      await deleteBrand(id).unwrap();
      toast.success('Brand deleted');
    } catch {
      toast.error('Failed to delete brand');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load brands</div>;
  const brands = data?.content || [];

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Brands</h1>
      <ul className="space-y-2 mb-6">
        {brands.map((b) => (
          <li
            key={b.id}
            className="flex items-center justify-between border p-2 rounded"
          >
            <span>{b.name}</span>
            <div className="space-x-2">
              <button className="text-blue-600" onClick={() => handleEdit(b)}>
                Edit
              </button>
              <button
                className="text-red-600"
                onClick={() => handleDelete(b.id)}
              >
                Delete
              </button>
            </div>
          </li>
        ))}
      </ul>
      <form onSubmit={handleSubmit} className="space-y-2 max-w-sm">
        <input
          type="text"
          name="name"
          value={form.name}
          onChange={handleChange}
          placeholder="Name"
          className="w-full border p-2 rounded"
          required
        />
        <input type="file" name="logo" onChange={handleChange} />
        <button type="submit" className="px-4 py-2 bg-black text-white rounded">
          {form.id ? 'Update' : 'Create'}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/GenericDashboard.jsx">
import React from 'react';
import CardItem from '@/components/dashboard/components/CardItem';

function Section({ label, items, disabled = false }) {
  if (!items.length) return null;
  return (
    <section className="space-y-3">
      <h2 className="text-body-sm font-medium text-primary/60 dark:text-surface/60">
        {label} ({items.length})
      </h2>
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4">
        {items.map((f, i) => (
          <CardItem
            key={i}
            title={f.title}
            icon={f.icon}
            disabled={disabled}
            to={f.to}
          />
        ))}
      </div>
    </section>
  );
}

function GenericDashboard({ title, features }) {
  const live = features.filter((f) => f.status === 'live');
  const upcoming = features.filter((f) => f.status !== 'live');
  return (
    <div className="px-4 space-y-4">
      <h1 className="text-heading-md font-bold text-primary dark:text-surface">
        {title}
      </h1>
      <Section label="Live" items={live} />
      <Section label="Upcoming" items={upcoming} disabled />
    </div>
  );
}

export default GenericDashboard;
</file>

<file path="src/pages/internal/GiveawayRedemption.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import QRScanSection from '@/components/qr/QRScanSection';

const BACKEND_URL =
  'https://script.google.com/macros/s/AKfycbxcANXk6gBddr0yIV_owEaxueJvxtvJX_Jkq8flGGVOL9hNCljPNyI-GdJ2A-jSZtcA/exec';
const API_KEY = 'ft2025122344)';

function GiveawayRedemption() {
  const [form, setForm] = useState({
    instagram_id: '',
    enrollment_no: '',
    customer_name: '',
    mobile: '',
    product: '',
    original_price: '',
    received: false,
  });

  const [step, setStep] = useState(1);
  const [loading, setLoading] = useState(false);
  const [refNo, setRefNo] = useState('');
  const [status, setStatus] = useState('init');
  const [error, setError] = useState('');
  const [remountKey, setRemountKey] = useState(0); // For QR scanner reset
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    if (!form.received) return;

    // Validate mobile number format
    const mobileRegex = /^[0-9]{10}$/;
    if (!mobileRegex.test(form.mobile)) {
      setError('Please enter a valid 10-digit mobile number');
      return;
    }

    setLoading(true);
    setError('');

    const payload = {
      api_key: API_KEY,
      action: 'redeem',
      ...form,
      discount: 100,
      final_price: Math.max(0, parseInt(form.original_price) - 100),
    };

    try {
      const response = await fetch(BACKEND_URL, {
        method: 'POST',
        body: JSON.stringify(payload),
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      });

      if (!response.ok)
        throw new Error(`HTTP error! status: ${response.status}`);

      const data = await response.json();
      if (data.error) throw new Error(data.error);
      if (!data.ref_no) throw new Error('No reference number received');

      setRefNo(data.ref_no);
    } catch (error) {
      setError(error.message || 'Something went wrong. Please try again.');
      console.error('Submission error:', error);
    } finally {
      setLoading(false);
    }
  };

  const handleLookup = async ({ instagram_id, enrollment_no }) => {
    setStatus('fetching');
    setError('');

    try {
      const response = await fetch(BACKEND_URL, {
        method: 'POST',
        body: JSON.stringify({
          api_key: API_KEY,
          action: 'lookup',
          instagram_id,
        }),
        headers: { 'Content-Type': 'text/plain;charset=utf-8' },
      });

      if (!response.ok)
        throw new Error(`HTTP error! status: ${response.status}`);

      const data = await response.json();
      if (data.error) throw new Error(data.error);

      const backendEnroll = data.enrollment_no;
      const alreadyRedeemed = data.redeemed;

      if (backendEnroll !== enrollment_no) {
        setStatus('invalid');
      } else if (alreadyRedeemed) {
        setStatus('redeemed');
      } else {
        setForm((prev) => ({ ...prev, instagram_id, enrollment_no }));
        setStatus('init');
        setStep(2);
      }
    } catch (error) {
      console.error('Lookup error:', error);
      setStatus('invalid');
      setError(error.message || 'Failed to verify QR code');
    }
  };

  const handleInputChange = (field, value) => {
    setForm((prev) => ({ ...prev, [field]: value }));
    if (error) setError(''); // Clear error on input
  };

  const closePopup = () => navigate('/dashboard');

  const resetToStep1 = () => {
    setStep(1);
    setStatus('init');
    setError('');
    setForm({
      instagram_id: '',
      enrollment_no: '',
      customer_name: '',
      mobile: '',
      product: '',
      original_price: '',
      received: false,
    });
    setRemountKey((prev) => prev + 1); // Force QR scanner remount
  };

  const calculateFinalPrice = () => {
    const price = parseInt(form.original_price) || 0;
    return Math.max(0, price - 100);
  };

  return (
    <div className="max-w-xl mx-auto mt-20 md:mt-8 bg-white p-6 rounded shadow">
      <h2 className="text-xl font-bold mb-4 text-center">
        🎁 Giveaway Redemption
      </h2>

      {error && (
        <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
          <span className="block sm:inline">{error}</span>
        </div>
      )}

      {refNo ? (
        // Success Screen
        <div className="bg-green-100 p-4 rounded text-center text-green-800 font-semibold space-y-2">
          <p>✅ Redemption Successful!</p>
          <p>
            Ref No: <span className="font-mono">{refNo}</span>
          </p>
          <div className="flex gap-2 justify-center">
            <button
              onClick={closePopup}
              className="mt-3 px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
            >
              Return to Dashboard
            </button>
            <button
              onClick={resetToStep1}
              className="mt-3 px-4 py-2 bg-black text-white rounded hover:bg-gray-900"
            >
              Process Another
            </button>
          </div>
        </div>
      ) : step === 1 ? (
        // QR Scan Step (with remount key)
        <QRScanSection
          key={remountKey}
          onScanComplete={handleLookup}
          status={status}
          setStatus={setStatus}
        />
      ) : (
        // Form Step
        <form onSubmit={handleSubmit} className="space-y-4">
          <div className="grid grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-1">
                Instagram ID
              </label>
              <input
                value={form.instagram_id}
                disabled
                className="w-full border px-3 py-2 bg-gray-100 rounded"
              />
            </div>
            <div>
              <label className="block text-sm font-medium mb-1">
                Enrollment No
              </label>
              <input
                value={form.enrollment_no}
                disabled
                className="w-full border px-3 py-2 bg-gray-100 rounded"
              />
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">
              Customer Name *
            </label>
            <input
              type="text"
              value={form.customer_name}
              onChange={(e) =>
                handleInputChange('customer_name', e.target.value)
              }
              required
              className="w-full border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-keyline"
              placeholder="Enter customer name"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">
              Mobile Number *
            </label>
            <input
              type="tel"
              value={form.mobile}
              onChange={(e) => handleInputChange('mobile', e.target.value)}
              required
              pattern="[0-9]{10}"
              className="w-full border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-keyline"
              placeholder="Enter 10-digit mobile number"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">
              Item Purchased *
            </label>
            <input
              type="text"
              value={form.product}
              onChange={(e) => handleInputChange('product', e.target.value)}
              required
              className="w-full border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-keyline"
              placeholder="Enter item name"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-1">
              Original Price (₹) *
            </label>
            <input
              type="number"
              value={form.original_price}
              onChange={(e) =>
                handleInputChange('original_price', e.target.value)
              }
              required
              min="100"
              className="w-full border px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-keyline"
              placeholder="Enter original price"
            />
          </div>

          <div className="bg-gray-50 p-3 rounded text-sm">
            ₹100 discount auto-applied. Final Price:{' '}
            <b>₹{calculateFinalPrice()}</b>
          </div>

          <div className="flex items-center space-x-2">
            <input
              type="checkbox"
              id="received-checkbox"
              checked={form.received}
              onChange={(e) => handleInputChange('received', e.target.checked)}
              className="rounded"
            />
            <label
              htmlFor="received-checkbox"
              className="text-sm cursor-pointer"
            >
              Amount received from customer
            </label>
          </div>

          <div className="flex gap-2">
            <button
              type="button"
              onClick={resetToStep1}
              className="flex-1 bg-gray-600 text-white py-2 rounded hover:bg-gray-700"
            >
              ← Back to QR Scan
            </button>
            <button
              type="submit"
              disabled={loading || !form.received}
              className="flex-1 bg-green-600 text-white py-2 rounded hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed"
            >
              {loading ? 'Submitting...' : 'Submit & Redeem'}
            </button>
          </div>
        </form>
      )}
    </div>
  );
}

export default GiveawayRedemption;
</file>

<file path="src/pages/internal/InventoryDashboard.jsx">
import React from 'react';
import { useGetStockLedgersQuery } from '../../api/erpApi';
import StockTable from '@/components/inventory/StockTable';
import StockEntryForm from '@/components/inventory/StockEntryForm';
import SerialManager from '@/components/inventory/SerialManager';
import PriceLogView from '@/components/inventory/PriceLogView';
import ConfigDashboard from '@/components/inventory/ConfigDashboard';

export default function InventoryDashboard() {
  const { data } = useGetStockLedgersQuery();
  return (
    <div className="p-4 space-y-4">
      <h1 className="text-xl font-bold">Inventory Dashboard</h1>
      <StockEntryForm />
      <StockTable ledgers={data ?? []} />
      <SerialManager />
      <PriceLogView />
      <ConfigDashboard />
    </div>
  );
}
</file>

<file path="src/pages/internal/InvoicesDashboard.jsx">
import { useGetInvoicesQuery } from '../../api/erpApi';
import InvoiceTable from '@/components/InvoiceTable';

export default function InvoicesDashboard() {
  const { data, isLoading, error } = useGetInvoicesQuery();
  const invoices = data?.results || data || [];

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load invoices</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Invoices</h1>
      {/* TODO(v1.1): Enable invoice PDF once Railway system libraries available */}
      <InvoiceTable invoices={invoices} />
    </div>
  );
}
</file>

<file path="src/pages/internal/IssuesDashboard.jsx">
import { useState } from 'react';
import {
  useGetIssuesQuery,
  useCreateIssueMutation,
  useUpdateIssueMutation,
  useDeleteIssueMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function IssuesDashboard() {
  const { data: issues = [], isLoading, error } = useGetIssuesQuery();
  const [createIssue] = useCreateIssueMutation();
  const [updateIssue] = useUpdateIssueMutation();
  const [deleteIssue] = useDeleteIssueMutation();
  const [name, setName] = useState('');

  const submit = async (e) => {
    e.preventDefault();
    if (!name.trim()) return;
    try {
      await createIssue({ name }).unwrap();
      setName('');
    } catch {
      toast.error('Failed to create');
    }
  };

  const edit = async (issue) => {
    const n = prompt('Issue', issue.name);
    if (!n) return;
    try {
      await updateIssue({ id: issue.id, body: { name: n } }).unwrap();
    } catch {
      toast.error('Update failed');
    }
  };

  const remove = async (id) => {
    try {
      await deleteIssue(id).unwrap();
    } catch {
      toast.error('Delete failed');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Issues</h1>
      <form onSubmit={submit} className="mb-4 flex gap-2">
        <input
          className="input"
          value={name}
          onChange={(e) => setName(e.target.value)}
          placeholder="New issue"
        />
        <button className="bg-black text-white px-3 py-1 rounded">Add</button>
      </form>
      <table className="w-full text-left border">
        <tbody>
          {issues.map((i) => (
            <tr key={i.id} className="border-t">
              <td className="p-2 border">{i.name}</td>
              <td className="p-2 border text-right space-x-2">
                <button onClick={() => edit(i)} className="text-blue-600">
                  Edit
                </button>
                <button onClick={() => remove(i.id)} className="text-red-600">
                  Delete
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
</file>

<file path="src/pages/internal/LogsDashboard.jsx">
import { useState } from 'react';
import { useGetLogsQuery } from '../../api/erpApi';
import { baseQueryWithReauth } from '../../api/baseQuery';
import store from '@/redux/store';
import toast from 'react-hot-toast';

function LogsDashboard() {
  const [filters, setFilters] = useState({
    entity_type: '',
    actor: '',
    start: '',
    end: '',
  });
  const { data = [] } = useGetLogsQuery(filters);
  const logs = Array.isArray(data.results) ? data.results : data;

  const handleChange = (e) => {
    setFilters({ ...filters, [e.target.name]: e.target.value });
  };

  const handleExport = async (format) => {
    const params = { ...filters, format };
    const api = { dispatch: store.dispatch, getState: store.getState };
    const result = await baseQueryWithReauth(
      {
        url: '/api/logs/export/',
        params,
        responseHandler: format === 'csv' ? 'text' : undefined,
      },
      api
    );
    if (result.error) {
      toast.error('Export failed');
      return;
    }
    const content =
      format === 'csv' ? result.data : JSON.stringify(result.data);
    const blob = new Blob([content], {
      type: format === 'csv' ? 'text/csv' : 'application/json',
    });
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `event_logs.${format}`;
    link.click();
  };

  return (
    <div className="p-4">
      <div className="flex justify-between items-center mb-4">
        <h1 className="text-xl font-semibold">Event Logs</h1>
        <select
          onChange={(e) => e.target.value && handleExport(e.target.value)}
          className="border p-1"
        >
          <option value="">Export</option>
          <option value="csv">Export CSV</option>
          <option value="json">Export JSON</option>
        </select>
      </div>
      <div className="flex flex-wrap gap-2 mb-4">
        <input
          type="text"
          name="entity_type"
          placeholder="Entity Type"
          value={filters.entity_type}
          onChange={handleChange}
          className="border p-1"
        />
        <input
          type="text"
          name="actor"
          placeholder="Actor ID"
          value={filters.actor}
          onChange={handleChange}
          className="border p-1"
        />
        <input
          type="date"
          name="start"
          value={filters.start}
          onChange={handleChange}
          className="border p-1"
        />
        <input
          type="date"
          name="end"
          value={filters.end}
          onChange={handleChange}
          className="border p-1"
        />
      </div>
      <table className="w-full text-sm">
        <thead>
          <tr>
            <th className="text-left">Actor</th>
            <th className="text-left">Entity</th>
            <th className="text-left">Action</th>
            <th className="text-left">Reason</th>
            <th className="text-left">Timestamp</th>
          </tr>
        </thead>
        <tbody>
          {logs.map((log) => (
            <tr key={log.id} className="border-t border-keyline">
              <td>{log.actor || '-'}</td>
              <td>{log.entity_type}</td>
              <td>{log.action}</td>
              <td>{log.reason || '-'}</td>
              <td>{new Date(log.timestamp).toLocaleString()}</td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

export default LogsDashboard;
</file>

<file path="src/pages/internal/OtherIssuesDashboard.jsx">
import { useState } from 'react';
import {
  useGetOtherIssuesQuery,
  useCreateOtherIssueMutation,
  useUpdateOtherIssueMutation,
  useDeleteOtherIssueMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function OtherIssuesDashboard() {
  const { data: issues = [], isLoading, error } = useGetOtherIssuesQuery();
  const [createIssue] = useCreateOtherIssueMutation();
  const [updateIssue] = useUpdateOtherIssueMutation();
  const [deleteIssue] = useDeleteOtherIssueMutation();
  const [name, setName] = useState('');

  const submit = async (e) => {
    e.preventDefault();
    if (!name.trim()) return;
    try {
      await createIssue({ name }).unwrap();
      setName('');
    } catch {
      toast.error('Failed to create');
    }
  };

  const edit = async (issue) => {
    const n = prompt('Other Issue', issue.name);
    if (!n) return;
    try {
      await updateIssue({ id: issue.id, body: { name: n } }).unwrap();
    } catch {
      toast.error('Update failed');
    }
  };

  const remove = async (id) => {
    try {
      await deleteIssue(id).unwrap();
    } catch {
      toast.error('Delete failed');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Other Issues</h1>
      <form onSubmit={submit} className="mb-4 flex gap-2">
        <input
          className="input"
          value={name}
          onChange={(e) => setName(e.target.value)}
          placeholder="New other issue"
        />
        <button className="bg-black text-white px-3 py-1 rounded">Add</button>
      </form>
      <table className="w-full text-left border">
        <tbody>
          {issues.map((i) => (
            <tr key={i.id} className="border-t">
              <td className="p-2 border">{i.name}</td>
              <td className="p-2 border text-right space-x-2">
                <button onClick={() => edit(i)} className="text-blue-600">
                  Edit
                </button>
                <button onClick={() => remove(i.id)} className="text-red-600">
                  Delete
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
</file>

<file path="src/pages/internal/PaymentsDashboard.jsx">
import { useGetPaymentsQuery } from '../../api/erpApi';
import PaymentsTable from '@/components/PaymentsTable';

export default function PaymentsDashboard() {
  const { data, isLoading, error } = useGetPaymentsQuery();
  const payments = data?.results || data || [];

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load payments</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Payments</h1>
      <PaymentsTable payments={payments} />
    </div>
  );
}
</file>

<file path="src/pages/internal/ProductsDashboard.jsx">
import { useState } from 'react';
import {
  useGetProductsQuery,
  useCreateProductMutation,
  useUpdateProductMutation,
  useDeleteProductMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function ProductsDashboard() {
  const { data, isLoading, error } = useGetProductsQuery();
  const [createProduct] = useCreateProductMutation();
  const [updateProduct] = useUpdateProductMutation();
  const [deleteProduct] = useDeleteProductMutation();
  const [form, setForm] = useState({
    slug: null,
    name: '',
    brand: '',
    category: '',
    price: '',
    stock: '',
    availability: false,
  });

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setForm((f) => ({ ...f, [name]: type === 'checkbox' ? checked : value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const body = {
      name: form.name,
      brand: form.brand,
      category: form.category,
      price: parseFloat(form.price),
      stock: parseInt(form.stock, 10),
      availability: form.availability,
    };
    try {
      if (form.slug) {
        await updateProduct({ slug: form.slug, body }).unwrap();
        toast.success('Product updated');
      } else {
        await createProduct(body).unwrap();
        toast.success('Product created');
      }
      setForm({
        slug: null,
        name: '',
        brand: '',
        category: '',
        price: '',
        stock: '',
        availability: false,
      });
    } catch {
      toast.error('Failed to save product');
    }
  };

  const handleEdit = (p) => {
    setForm({
      slug: p.slug,
      name: p.name,
      brand: p.brand,
      category: p.category,
      price: p.price,
      stock: p.stock,
      availability: p.availability,
    });
  };

  const handleDelete = async (slug) => {
    try {
      await deleteProduct(slug).unwrap();
      toast.success('Product deleted');
    } catch {
      toast.error('Failed to delete product');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load products</div>;
  const products = data?.content || [];

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Products</h1>
      <div className="overflow-x-auto mb-6">
        <table className="min-w-full border text-sm">
          <thead className="bg-gray-100">
            <tr>
              <th className="p-2 border">Name</th>
              <th className="p-2 border">Brand</th>
              <th className="p-2 border">Price</th>
              <th className="p-2 border">Stock</th>
              <th className="p-2 border">Available</th>
              <th className="p-2 border">Actions</th>
            </tr>
          </thead>
          <tbody>
            {products.map((p) => (
              <tr key={p.id} className="text-center">
                <td className="p-2 border">{p.name}</td>
                <td className="p-2 border">{p.brand_name}</td>
                <td className="p-2 border">{p.price}</td>
                <td className="p-2 border">{p.stock}</td>
                <td className="p-2 border">{p.availability ? 'Yes' : 'No'}</td>
                <td className="p-2 border space-x-2">
                  <button
                    className="text-blue-600"
                    onClick={() => handleEdit(p)}
                  >
                    Edit
                  </button>
                  <button
                    className="text-red-600"
                    onClick={() => handleDelete(p.slug)}
                  >
                    Delete
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      <form onSubmit={handleSubmit} className="space-y-2 max-w-md">
        <input
          type="text"
          name="name"
          value={form.name}
          onChange={handleChange}
          placeholder="Name"
          className="input"
          required
        />
        <input
          type="number"
          name="brand"
          value={form.brand}
          onChange={handleChange}
          placeholder="Brand ID"
          className="input"
          required
        />
        <input
          type="number"
          name="category"
          value={form.category}
          onChange={handleChange}
          placeholder="Category ID"
          className="input"
          required
        />
        <input
          type="number"
          name="price"
          value={form.price}
          onChange={handleChange}
          placeholder="Price"
          className="input"
          required
        />
        <input
          type="number"
          name="stock"
          value={form.stock}
          onChange={handleChange}
          placeholder="Stock"
          className="input"
          required
        />
        <label className="flex items-center gap-2">
          <input
            type="checkbox"
            name="availability"
            checked={form.availability}
            onChange={handleChange}
          />
          Available
        </label>
        <button type="submit" className="px-4 py-2 bg-black text-white rounded">
          {form.slug ? 'Update' : 'Create'}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/QualitiesDashboard.jsx">
import { useState } from 'react';
import {
  useGetQualitiesQuery,
  useCreateQualityMutation,
  useUpdateQualityMutation,
  useDeleteQualityMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function QualitiesDashboard() {
  const { data, isLoading, error } = useGetQualitiesQuery();
  const [createQuality] = useCreateQualityMutation();
  const [updateQuality] = useUpdateQualityMutation();
  const [deleteQuality] = useDeleteQualityMutation();
  const [form, setForm] = useState({ slug: null, name: '' });

  const handleChange = (e) =>
    setForm({ ...form, [e.target.name]: e.target.value });

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      if (form.slug) {
        await updateQuality({
          slug: form.slug,
          body: { name: form.name },
        }).unwrap();
        toast.success('Quality updated');
      } else {
        await createQuality({ name: form.name }).unwrap();
        toast.success('Quality created');
      }
      setForm({ slug: null, name: '' });
    } catch {
      toast.error('Failed to save quality');
    }
  };

  const handleEdit = (q) => setForm({ slug: q.slug, name: q.name });

  const handleDelete = async (slug) => {
    try {
      await deleteQuality(slug).unwrap();
      toast.success('Quality deleted');
    } catch {
      toast.error('Failed to delete quality');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load qualities</div>;
  const qualities = data?.content || [];

  return (
    <div className="p-4 space-y-6">
      <h1 className="text-2xl font-bold">Qualities</h1>
      <div className="overflow-x-auto">
        <table className="min-w-full text-sm">
          <thead>
            <tr className="border-b">
              <th className="p-2 text-left">ID</th>
              <th className="p-2 text-left">Name</th>
              <th className="p-2 text-left">Slug</th>
              <th className="p-2 text-left">Actions</th>
            </tr>
          </thead>
          <tbody>
            {qualities.map((q) => (
              <tr key={q.id} className="border-b">
                <td className="p-2">{q.id}</td>
                <td className="p-2">{q.name}</td>
                <td className="p-2">{q.slug}</td>
                <td className="p-2 space-x-2">
                  <button
                    className="text-blue-600"
                    onClick={() => handleEdit(q)}
                  >
                    Edit
                  </button>
                  <button
                    className="text-red-600"
                    onClick={() => handleDelete(q.slug)}
                  >
                    Delete
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      <form onSubmit={handleSubmit} className="space-y-2 max-w-sm">
        <input
          type="text"
          name="name"
          value={form.name}
          onChange={handleChange}
          placeholder="Name"
          className="w-full border p-2 rounded"
          required
        />
        <button type="submit" className="px-4 py-2 bg-black text-white rounded">
          {form.slug ? 'Update' : 'Create'}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/QuestionsDashboard.jsx">
import { useState } from 'react';
import {
  useGetQuestionsQuery,
  useCreateQuestionMutation,
  useUpdateQuestionMutation,
  useDeleteQuestionMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function QuestionsDashboard() {
  const { data: questions = [], isLoading, error } = useGetQuestionsQuery();
  const [createQuestion] = useCreateQuestionMutation();
  const [updateQuestion] = useUpdateQuestionMutation();
  const [deleteQuestion] = useDeleteQuestionMutation();
  const [form, setForm] = useState({ text: '', type: 'text', set: '' });

  const onChange = (e) => setForm({ ...form, [e.target.name]: e.target.value });
  const submit = async (e) => {
    e.preventDefault();
    if (!form.text.trim()) return;
    try {
      await createQuestion({
        text: form.text,
        type: form.type,
        question_set_name: form.set,
      }).unwrap();
      setForm({ text: '', type: 'text', set: '' });
    } catch {
      toast.error('Failed to create');
    }
  };

  const edit = async (q) => {
    const text = prompt('Question', q.text);
    if (!text) return;
    try {
      await updateQuestion({ id: q.id, body: { text } }).unwrap();
    } catch {
      toast.error('Update failed');
    }
  };

  const remove = async (id) => {
    try {
      await deleteQuestion(id).unwrap();
    } catch {
      toast.error('Delete failed');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Questions</h1>
      <form onSubmit={submit} className="mb-4 flex flex-wrap gap-2">
        <input
          name="text"
          className="input"
          value={form.text}
          onChange={onChange}
          placeholder="Question"
        />
        <select
          name="type"
          className="input"
          value={form.type}
          onChange={onChange}
        >
          <option value="text">Text</option>
          <option value="choice">Choice</option>
        </select>
        <input
          name="set"
          className="input"
          value={form.set}
          onChange={onChange}
          placeholder="Set name"
        />
        <button className="bg-black text-white px-3 py-1 rounded">Add</button>
      </form>
      <table className="w-full text-left border">
        <tbody>
          {questions.map((q) => (
            <tr key={q.id} className="border-t">
              <td className="p-2 border">{q.text}</td>
              <td className="p-2 border text-right space-x-2">
                <button onClick={() => edit(q)} className="text-blue-600">
                  Edit
                </button>
                <button onClick={() => remove(q.id)} className="text-red-600">
                  Delete
                </button>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}
</file>

<file path="src/pages/internal/ScheduleCall.jsx">
import { useState, useRef, useEffect } from 'react';
import axios from 'axios';
import toast from 'react-hot-toast';
import END_POINTS from '@/utils/Endpoints';
import Loader from '@/components/common/Loader';
import ReCaptchaWrapper from '@/components/common/ReCaptchaWrapper';

export default function ScheduleCall() {
  const [form, setForm] = useState({
    name: '',
    date: '',
    time: '',
    message: '',
  });
  const [loading, setLoading] = useState(false);
  const [captcha, setCaptcha] = useState('');
  const [cooldown, setCooldown] = useState(false);
  const recaptchaRef = useRef(null);

  useEffect(() => {
    document.title = 'Schedule a Call – Finetune';
    const desc = 'Request a callback from our support team.';
    const setMeta = (key, val, property = false) => {
      const attr = property ? 'property' : 'name';
      let tag = document.head.querySelector(`meta[${attr}='${key}']`);
      if (!tag) {
        tag = document.createElement('meta');
        tag.setAttribute(attr, key);
        document.head.appendChild(tag);
      }
      tag.setAttribute('content', val);
    };
    setMeta('description', desc);
    setMeta('og:title', 'Schedule a Call – Finetune', true);
    setMeta('og:description', desc, true);
  }, []);

  const onChange = (e) => setForm({ ...form, [e.target.name]: e.target.value });

  const submit = async (e) => {
    e.preventDefault();
    if (cooldown) {
      toast.error('Please wait before submitting again');
      return;
    }
    if (!captcha) {
      toast.error('Captcha verification failed');
      return;
    }
    try {
      setLoading(true);
      await axios.post(`${END_POINTS.API_BASE_URL}/marketing/schedule-call/`, {
        ...form,
        captcha_token: captcha,
      });
      toast.success('We will reach out soon');
      setForm({ name: '', date: '', time: '', message: '' });
      recaptchaRef.current?.reset();
      setCaptcha('');
      setCooldown(true);
      setTimeout(() => setCooldown(false), 30000);
    } catch {
      toast.error('Submission failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="p-4 pt-24 max-w-xl mx-auto">
      {loading && <Loader />}
      <h1 className="text-2xl font-bold mb-4">Schedule a Call</h1>
      <form onSubmit={submit} className="space-y-4">
        <input
          name="name"
          value={form.name}
          onChange={onChange}
          placeholder="Name"
          className="input"
          required
        />
        <input
          type="date"
          name="date"
          value={form.date}
          onChange={onChange}
          className="input"
          required
        />
        <input
          type="time"
          name="time"
          value={form.time}
          onChange={onChange}
          className="input"
          required
        />
        <textarea
          name="message"
          value={form.message}
          onChange={onChange}
          placeholder="Message (optional)"
          className="input"
        />
        <ReCaptchaWrapper ref={recaptchaRef} onChange={setCaptcha} />
        <button
          type="submit"
          disabled={loading}
          className="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 disabled:opacity-50"
        >
          Submit
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/Settings.jsx">
const Settings = () => {
  return (
    <h1>
      <b>Settings</b>
    </h1>
  );
};

export default Settings;
</file>

<file path="src/pages/internal/Spares.jsx">
import { useState, useEffect } from 'react';
import {
  useGetSparesQuery,
  useCreateSpareMutation,
  useUpdateSpareMutation,
  useDeleteSpareMutation,
} from '../../api/erpApi';
import { useAppSelector } from '@/redux/hook';
import { selectAuthRole } from '@/redux/slice/authSlice';
import toast from 'react-hot-toast';

export default function Spares() {
  const role = useAppSelector(selectAuthRole);
  const isAdmin = role === 'system_admin';
  const { data, isLoading, error } = useGetSparesQuery();
  const [createSpare] = useCreateSpareMutation();
  const [updateSpare] = useUpdateSpareMutation();
  const [deleteSpare] = useDeleteSpareMutation();
  const [form, setForm] = useState({ id: null, name: '', sku: '', price: '' });

  const spares = data?.content || [];

  useEffect(() => {
    document.title = 'Spares – Finetune';
    const desc = 'View and manage spare parts pricing.';
    const setMeta = (key, val, property = false) => {
      const attr = property ? 'property' : 'name';
      let tag = document.head.querySelector(`meta[${attr}='${key}']`);
      if (!tag) {
        tag = document.createElement('meta');
        tag.setAttribute(attr, key);
        document.head.appendChild(tag);
      }
      tag.setAttribute('content', val);
    };
    setMeta('description', desc);
    setMeta('og:title', 'Spares – Finetune', true);
    setMeta('og:description', desc, true);
  }, []);

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((f) => ({ ...f, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      if (form.id) {
        await updateSpare({ id: form.id, ...form }).unwrap();
        toast.success('Spare updated');
      } else {
        await createSpare(form).unwrap();
        toast.success('Spare created');
      }
      setForm({ id: null, name: '', sku: '', price: '' });
    } catch {
      toast.error('Failed to save spare');
    }
  };

  const handleEdit = (s) => {
    setForm({ id: s.id, name: s.name, sku: s.sku, price: s.price });
  };

  const handleDelete = async (id) => {
    try {
      await deleteSpare(id).unwrap();
      toast.success('Spare deleted');
    } catch {
      toast.error('Failed to delete spare');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load spares</div>;

  return (
    <div className="p-4 pt-24">
      <h1 className="text-2xl font-bold mb-4 text-center text-keyline">
        Spares
      </h1>
      {spares.length === 0 ? (
        <div className="text-center text-gray-600 mb-6">
          No spares available.
        </div>
      ) : (
        <ul className="space-y-4 max-w-xl mx-auto mb-6">
          {spares.map((s) => (
            <li key={s.id} className="p-4 border rounded-lg shadow-sm">
              <div className="font-semibold">{s.name}</div>
              <div className="text-sm text-gray-600">SKU: {s.sku}</div>
              {s.quality_name && (
                <div className="text-sm text-gray-600">
                  Quality: {s.quality_name}
                </div>
              )}
              {isAdmin && (
                <div className="text-sm text-gray-600">₹{s.price}</div>
              )}
              {isAdmin && (
                <div className="mt-2 space-x-2">
                  <button
                    className="text-blue-600"
                    onClick={() => handleEdit(s)}
                  >
                    Edit
                  </button>
                  <button
                    className="text-red-600"
                    onClick={() => handleDelete(s.id)}
                  >
                    Delete
                  </button>
                </div>
              )}
            </li>
          ))}
        </ul>
      )}
      {isAdmin && (
        <form onSubmit={handleSubmit} className="max-w-xl mx-auto space-y-4">
          <input
            type="text"
            name="name"
            placeholder="Name"
            value={form.name}
            onChange={handleChange}
            className="input"
            required
          />
          <input
            type="text"
            name="sku"
            placeholder="SKU"
            value={form.sku}
            onChange={handleChange}
            className="input"
            required
          />
          <input
            type="number"
            name="price"
            placeholder="Price"
            value={form.price}
            onChange={handleChange}
            className="input"
            required
          />
          <button
            type="submit"
            className="w-full bg-keyline text-white py-2 rounded"
          >
            {form.id ? 'Update Spare' : 'Add Spare'}
          </button>
        </form>
      )}
    </div>
  );
}
</file>

<file path="src/pages/internal/Store.jsx">
import { useState } from 'react';
import {
  useGetStoresQuery,
  useCreateStoreMutation,
  useUpdateStoreMutation,
  useDeleteStoreMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function Store() {
  const { data, isLoading, error } = useGetStoresQuery();
  const [createStore] = useCreateStoreMutation();
  const [updateStore] = useUpdateStoreMutation();
  const [deleteStore] = useDeleteStoreMutation();
  const [form, setForm] = useState({
    id: null,
    store_name: '',
    address: '',
    code: '',
  });

  const stores = data?.content || [];

  const handleChange = (e) => {
    const { name, value } = e.target;
    setForm((f) => ({ ...f, [name]: value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      if (form.id) {
        await updateStore({ id: form.id, ...form }).unwrap();
        toast.success('Store updated');
      } else {
        await createStore(form).unwrap();
        toast.success('Store created');
      }
      setForm({ id: null, store_name: '', address: '', code: '' });
    } catch {
      toast.error('Failed to save store');
    }
  };

  const handleEdit = (s) => {
    setForm({
      id: s.id,
      store_name: s.store_name,
      address: s.address || '',
      code: s.code,
    });
  };

  const handleDelete = async (id) => {
    try {
      await deleteStore(id).unwrap();
      toast.success('Store deleted');
    } catch {
      toast.error('Failed to delete store');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load stores</div>;

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Stores</h1>
      <ul className="space-y-2 mb-6">
        {stores.map((s) => (
          <li
            key={s.id}
            className="flex items-center justify-between border p-2 rounded"
          >
            <span>{s.store_name}</span>
            <div className="space-x-2">
              <button className="text-blue-600" onClick={() => handleEdit(s)}>
                Edit
              </button>
              <button
                className="text-red-600"
                onClick={() => handleDelete(s.id)}
              >
                Delete
              </button>
            </div>
          </li>
        ))}
      </ul>
      <form onSubmit={handleSubmit} className="space-y-2 max-w-sm">
        <input
          type="text"
          name="store_name"
          value={form.store_name}
          onChange={handleChange}
          placeholder="Name"
          className="w-full border p-2 rounded"
          required
        />
        <input
          type="text"
          name="code"
          value={form.code}
          onChange={handleChange}
          placeholder="Code"
          className="w-full border p-2 rounded"
          required
        />
        <input
          type="text"
          name="address"
          value={form.address}
          onChange={handleChange}
          placeholder="Address"
          className="w-full border p-2 rounded"
        />
        <button type="submit" className="px-4 py-2 bg-black text-white rounded">
          {form.id ? 'Update' : 'Create'}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/StoreDetails.jsx">
import { useEffect, useState } from 'react';
import { useParams } from 'react-router-dom';
import axios from 'axios';
import Loader from '@/components/common/Loader';
import END_POINTS from '@/utils/Endpoints';

export default function StoreDetails() {
  const { id } = useParams();
  const [store, setStore] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);

  useEffect(() => {
    const fetchStore = async () => {
      try {
        const res = await axios.get(
          `${END_POINTS.API_BASE_URL}${END_POINTS.GET_STORES}/${id}`
        );
        setStore(res.data);
      } catch {
        setError(true);
      } finally {
        setLoading(false);
      }
    };
    fetchStore();
  }, [id]);

  useEffect(() => {
    const name = store?.store_name
      ? `${store.store_name} – Finetune`
      : 'Store – Finetune';
    document.title = name;
    const desc = store?.store_name
      ? `Details for ${store.store_name}.`
      : 'Store details.';
    const setMeta = (key, val, property = false) => {
      const attr = property ? 'property' : 'name';
      let tag = document.head.querySelector(`meta[${attr}='${key}']`);
      if (!tag) {
        tag = document.createElement('meta');
        tag.setAttribute(attr, key);
        document.head.appendChild(tag);
      }
      tag.setAttribute('content', val);
    };
    setMeta('description', desc);
    setMeta('og:title', name, true);
    setMeta('og:description', desc, true);
  }, [store]);

  if (loading) {
    return (
      <div className="p-4 pt-24 text-center">
        <Loader />
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4 pt-24 text-center text-red-600">
        Failed to load store.
      </div>
    );
  }

  if (!store) {
    return (
      <div className="p-4 pt-24 text-center text-gray-600">
        Store not found.
      </div>
    );
  }

  return (
    <div className="p-4 pt-24 max-w-xl mx-auto space-y-2">
      <h1 className="text-2xl font-bold text-keyline">{store.store_name}</h1>
      <p>
        <span className="font-semibold">Code:</span> {store.code}
      </p>
      <p>
        <span className="font-semibold">Address:</span> {store.address}
      </p>
    </div>
  );
}
</file>

<file path="src/pages/internal/Stores.jsx">
import { useEffect, useState } from 'react';
import { Link } from 'react-router-dom';
import axios from 'axios';
import Loader from '@/components/common/Loader';
import END_POINTS from '@/utils/Endpoints';

export default function Stores() {
  const [stores, setStores] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);

  useEffect(() => {
    document.title = 'Stores – Finetune';
    const desc = 'Browse Finetune service branches.';
    const setMeta = (key, val, property = false) => {
      const attr = property ? 'property' : 'name';
      let tag = document.head.querySelector(`meta[${attr}='${key}']`);
      if (!tag) {
        tag = document.createElement('meta');
        tag.setAttribute(attr, key);
        document.head.appendChild(tag);
      }
      tag.setAttribute('content', val);
    };
    setMeta('description', desc);
    setMeta('og:title', 'Stores – Finetune', true);
    setMeta('og:description', desc, true);
  }, []);

  useEffect(() => {
    const fetchStores = async () => {
      try {
        const res = await axios.get(
          `${END_POINTS.API_BASE_URL}${END_POINTS.GET_STORES}?store_type=BRANCH`
        );
        setStores(res.data?.content || []);
      } catch {
        setError(true);
      } finally {
        setLoading(false);
      }
    };
    fetchStores();
  }, []);

  if (loading) {
    return (
      <div className="p-4 pt-24 text-center">
        <Loader />
      </div>
    );
  }

  if (error) {
    return (
      <div className="p-4 pt-24 text-center text-red-600">
        Failed to load stores.
      </div>
    );
  }

  if (stores.length === 0) {
    return (
      <div className="p-4 pt-24 text-center text-gray-600">
        No stores available.
      </div>
    );
  }

  return (
    <div className="p-4 pt-24">
      <h1 className="text-2xl font-bold mb-4 text-center text-keyline">
        Stores
      </h1>
      <ul className="space-y-4 max-w-xl mx-auto">
        {stores.map((s) => (
          <li
            key={s.id}
            className="p-4 border rounded-lg shadow-sm hover:shadow-md transition-shadow"
          >
            <Link to={`/stores/${s.id}`} className="font-semibold text-lg">
              {s.store_name}
            </Link>
            <p className="text-sm text-gray-600">
              {s.address}
              {s.phone && (
                <>
                  <br />
                  {s.phone}
                </>
              )}
            </p>
          </li>
        ))}
      </ul>
    </div>
  );
}
</file>

<file path="src/pages/internal/TaxonomyDashboard.jsx">
import { useState } from 'react';
import {
  useGetDepartmentsQuery,
  useCreateDepartmentMutation,
  useUpdateDepartmentMutation,
  useDeleteDepartmentMutation,
  useGetCategoriesQuery,
  useCreateCategoryMutation,
  useUpdateCategoryMutation,
  useDeleteCategoryMutation,
  useGetSubCategoriesQuery,
  useCreateSubCategoryMutation,
  useUpdateSubCategoryMutation,
  useDeleteSubCategoryMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function TaxonomyDashboard() {
  const {
    data: deptData,
    isLoading: deptLoading,
    error: deptError,
  } = useGetDepartmentsQuery();
  const [createDept] = useCreateDepartmentMutation();
  const [updateDept] = useUpdateDepartmentMutation();
  const [deleteDept] = useDeleteDepartmentMutation();
  const [deptForm, setDeptForm] = useState({ slug: null, name: '' });

  const {
    data: catData,
    isLoading: catLoading,
    error: catError,
  } = useGetCategoriesQuery();
  const [createCat] = useCreateCategoryMutation();
  const [updateCat] = useUpdateCategoryMutation();
  const [deleteCat] = useDeleteCategoryMutation();
  const [catForm, setCatForm] = useState({
    slug: null,
    name: '',
    department: '',
  });

  const {
    data: subData,
    isLoading: subLoading,
    error: subError,
  } = useGetSubCategoriesQuery();
  const [createSub] = useCreateSubCategoryMutation();
  const [updateSub] = useUpdateSubCategoryMutation();
  const [deleteSub] = useDeleteSubCategoryMutation();
  const [subForm, setSubForm] = useState({
    slug: null,
    name: '',
    category: '',
  });

  const handleDeptChange = (e) => {
    setDeptForm({ ...deptForm, [e.target.name]: e.target.value });
  };
  const handleDeptSubmit = async (e) => {
    e.preventDefault();
    try {
      if (deptForm.slug) {
        await updateDept({
          slug: deptForm.slug,
          body: { name: deptForm.name },
        }).unwrap();
        toast.success('Department updated');
      } else {
        await createDept({ name: deptForm.name }).unwrap();
        toast.success('Department created');
      }
      setDeptForm({ slug: null, name: '' });
    } catch {
      toast.error('Failed to save department');
    }
  };
  const handleDeptEdit = (d) => setDeptForm({ slug: d.slug, name: d.name });
  const handleDeptDelete = async (slug) => {
    try {
      await deleteDept(slug).unwrap();
      toast.success('Department deleted');
    } catch {
      toast.error('Failed to delete department');
    }
  };

  const handleCatChange = (e) => {
    setCatForm({ ...catForm, [e.target.name]: e.target.value });
  };
  const handleCatSubmit = async (e) => {
    e.preventDefault();
    const body = { name: catForm.name, department: catForm.department };
    try {
      if (catForm.slug) {
        await updateCat({ slug: catForm.slug, body }).unwrap();
        toast.success('Category updated');
      } else {
        await createCat(body).unwrap();
        toast.success('Category created');
      }
      setCatForm({ slug: null, name: '', department: '' });
    } catch {
      toast.error('Failed to save category');
    }
  };
  const handleCatEdit = (c) =>
    setCatForm({ slug: c.slug, name: c.name, department: c.department });
  const handleCatDelete = async (slug) => {
    try {
      await deleteCat(slug).unwrap();
      toast.success('Category deleted');
    } catch {
      toast.error('Failed to delete category');
    }
  };

  const handleSubChange = (e) => {
    setSubForm({ ...subForm, [e.target.name]: e.target.value });
  };
  const handleSubSubmit = async (e) => {
    e.preventDefault();
    const body = { name: subForm.name, category: subForm.category };
    try {
      if (subForm.slug) {
        await updateSub({ slug: subForm.slug, body }).unwrap();
        toast.success('SubCategory updated');
      } else {
        await createSub(body).unwrap();
        toast.success('SubCategory created');
      }
      setSubForm({ slug: null, name: '', category: '' });
    } catch {
      toast.error('Failed to save subcategory');
    }
  };
  const handleSubEdit = (s) =>
    setSubForm({ slug: s.slug, name: s.name, category: s.category });
  const handleSubDelete = async (slug) => {
    try {
      await deleteSub(slug).unwrap();
      toast.success('SubCategory deleted');
    } catch {
      toast.error('Failed to delete subcategory');
    }
  };

  if (deptLoading || catLoading || subLoading)
    return <div className="p-4">Loading...</div>;
  if (deptError || catError || subError)
    return <div className="p-4">Failed to load taxonomy</div>;

  const departments = deptData?.content || [];
  const categories = catData?.content || [];
  const subcategories = subData?.content || [];

  return (
    <div className="p-4 space-y-8">
      <section>
        <h2 className="text-xl font-bold mb-2">Departments</h2>
        <ul className="space-y-2 mb-4">
          {departments.map((d) => (
            <li key={d.id} className="flex justify-between border p-2 rounded">
              <span>{d.name}</span>
              <div className="space-x-2">
                <button
                  className="text-blue-600"
                  onClick={() => handleDeptEdit(d)}
                >
                  Edit
                </button>
                <button
                  className="text-red-600"
                  onClick={() => handleDeptDelete(d.slug)}
                >
                  Delete
                </button>
              </div>
            </li>
          ))}
        </ul>
        <form onSubmit={handleDeptSubmit} className="space-y-2 max-w-sm">
          <input
            type="text"
            name="name"
            value={deptForm.name}
            onChange={handleDeptChange}
            placeholder="Name"
            className="w-full border p-2 rounded"
            required
          />
          <button
            type="submit"
            className="px-4 py-2 bg-black text-white rounded"
          >
            {deptForm.slug ? 'Update' : 'Create'}
          </button>
        </form>
      </section>

      <section>
        <h2 className="text-xl font-bold mb-2">Categories</h2>
        <ul className="space-y-2 mb-4">
          {categories.map((c) => (
            <li key={c.id} className="flex justify-between border p-2 rounded">
              <span>{c.name}</span>
              <div className="space-x-2">
                <button
                  className="text-blue-600"
                  onClick={() => handleCatEdit(c)}
                >
                  Edit
                </button>
                <button
                  className="text-red-600"
                  onClick={() => handleCatDelete(c.slug)}
                >
                  Delete
                </button>
              </div>
            </li>
          ))}
        </ul>
        <form onSubmit={handleCatSubmit} className="space-y-2 max-w-sm">
          <input
            type="text"
            name="name"
            value={catForm.name}
            onChange={handleCatChange}
            placeholder="Name"
            className="w-full border p-2 rounded"
            required
          />
          <select
            name="department"
            value={catForm.department}
            onChange={handleCatChange}
            className="w-full border p-2 rounded"
            required
          >
            <option value="">Select department</option>
            {departments.map((d) => (
              <option key={d.id} value={d.id}>
                {d.name}
              </option>
            ))}
          </select>
          <button
            type="submit"
            className="px-4 py-2 bg-black text-white rounded"
          >
            {catForm.slug ? 'Update' : 'Create'}
          </button>
        </form>
      </section>

      <section>
        <h2 className="text-xl font-bold mb-2">SubCategories</h2>
        <ul className="space-y-2 mb-4">
          {subcategories.map((s) => (
            <li key={s.id} className="flex justify-between border p-2 rounded">
              <span>{s.name}</span>
              <div className="space-x-2">
                <button
                  className="text-blue-600"
                  onClick={() => handleSubEdit(s)}
                >
                  Edit
                </button>
                <button
                  className="text-red-600"
                  onClick={() => handleSubDelete(s.slug)}
                >
                  Delete
                </button>
              </div>
            </li>
          ))}
        </ul>
        <form onSubmit={handleSubSubmit} className="space-y-2 max-w-sm">
          <input
            type="text"
            name="name"
            value={subForm.name}
            onChange={handleSubChange}
            placeholder="Name"
            className="w-full border p-2 rounded"
            required
          />
          <select
            name="category"
            value={subForm.category}
            onChange={handleSubChange}
            className="w-full border p-2 rounded"
            required
          >
            <option value="">Select category</option>
            {categories.map((c) => (
              <option key={c.id} value={c.id}>
                {c.name}
              </option>
            ))}
          </select>
          <button
            type="submit"
            className="px-4 py-2 bg-black text-white rounded"
          >
            {subForm.slug ? 'Update' : 'Create'}
          </button>
        </form>
      </section>
    </div>
  );
}
</file>

<file path="src/pages/internal/TeamLogin.jsx">
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAppDispatch, useAppSelector } from '@/redux/hook';
import { loginUser, selectAuthStatus } from '@/redux/slice/authSlice';

function TeamLogin() {
  const [username, setUsername] = useState('');
  const [password, setPassword] = useState('');
  const [showPassword, setShowPassword] = useState(false);
  const [error, setError] = useState('');

  const dispatch = useAppDispatch();
  const status = useAppSelector(selectAuthStatus);
  const navigate = useNavigate();

  const handleLogin = async (e) => {
    e.preventDefault();
    setError('');

    try {
      await dispatch(loginUser({ username, password })).unwrap();
      navigate('/dashboard', { replace: true });
    } catch (err) {
      console.error('TeamLogin: Login error:', err);
      setError(err || 'Login failed');
    }
  };

  useEffect(() => {
    if (error) {
      const timer = setTimeout(() => setError(''), 3000);
      return () => clearTimeout(timer);
    }
  }, [error]);

  // Add this for development quick login
  const isDev = import.meta.env.DEV;

  const handleDevLogin = async (role = 'system_admin') => {
    try {
      const mockData = {
        username: `dev-${role}`,
        password: 'password',
      };
      await dispatch(loginUser(mockData)).unwrap();
      navigate('/dashboard', { replace: true });
    } catch (err) {
      console.error('Dev login error:', err);
      setError('Dev login failed');
    }
  };

  return (
    <div className="min-h-screen flex items-center justify-center bg-gray-100 px-4 pt-20">
      <div className="w-full max-w-md bg-white border border-gray-200 shadow-lg rounded-lg p-8">
        <h2 className="text-2xl font-bold mb-2 text-center">Team Login</h2>
        <p className="text-center text-gray-500 mb-6 text-sm">
          Sign in with your credentials
        </p>
        {error && (
          <p className="text-red-500 text-center text-sm mb-4">{error}</p>
        )}

        <form onSubmit={handleLogin}>
          <input
            type="text"
            placeholder="Username"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            className="w-full mb-4 px-4 py-3 border border-gray-300 rounded text-sm shadow-sm focus:outline-none focus:ring"
            disabled={status === 'loading'}
            required
          />

          <div className="relative mb-4">
            <input
              type={showPassword ? 'text' : 'password'}
              placeholder="Password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              className="w-full px-4 py-3 border border-gray-300 rounded text-sm shadow-sm focus:outline-none focus:ring"
              disabled={status === 'loading'}
              required
            />
            <button
              type="button"
              onClick={() => setShowPassword(!showPassword)}
              className="absolute inset-y-0 right-3 flex items-center text-sm text-gray-600"
            >
              {showPassword ? 'Hide' : 'Show'}
            </button>
          </div>

          <div className="flex items-center justify-between text-sm mb-6">
            <label className="inline-flex items-center">
              <input
                type="checkbox"
                className="form-checkbox h-4 w-4 text-keyline mr-2"
              />
              Remember me
            </label>
            <a
              href="#"
              className="text-gray-700 hover:text-keyline hover:underline"
            >
              Forgot password?
            </a>
          </div>

          <button
            type="submit"
            className={`w-full bg-black text-white text-sm font-bold uppercase px-4 py-3 rounded shadow hover:bg-gray-800 transition ${status === 'loading' ? 'opacity-70 cursor-not-allowed' : ''}`}
            disabled={status === 'loading'}
          >
            {status === 'loading' ? (
              <span className="flex items-center justify-center">
                <svg
                  className="animate-spin -ml-1 mr-2 h-4 w-4 text-white"
                  xmlns="http://www.w3.org/2000/svg"
                  fill="none"
                  viewBox="0 0 24 24"
                >
                  <circle
                    className="opacity-25"
                    cx="12"
                    cy="12"
                    r="10"
                    stroke="currentColor"
                    strokeWidth="4"
                  ></circle>
                  <path
                    className="opacity-75"
                    fill="currentColor"
                    d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
                  ></path>
                </svg>
                Logging in...
              </span>
            ) : (
              'Login'
            )}
          </button>
        </form>
      </div>
      {/* Add dev login buttons if in development mode */}
      {isDev && (
        <div className="mt-4 border-t pt-4">
          <p className="text-center text-gray-500 mb-2 text-xs">
            Development Quick Login
          </p>
          <div className="flex gap-2">
            <button
              type="button"
              onClick={() => handleDevLogin('system_admin')}
              className="flex-1 bg-black text-white text-xs px-2 py-1 rounded"
            >
              System Admin
            </button>
            <button
              type="button"
              onClick={() => handleDevLogin('branch_head')}
              className="flex-1 bg-black text-white text-xs px-2 py-1 rounded"
            >
              Branch Head
            </button>
            <button
              type="button"
              onClick={() => handleDevLogin('advisor')}
              className="flex-1 bg-green-600 text-white text-xs px-2 py-1 rounded"
            >
              Advisor
            </button>
          </div>
        </div>
      )}
    </div>
  );
}

export default TeamLogin;
</file>

<file path="src/pages/internal/UnitsDashboard.jsx">
import { useState } from 'react';
import {
  useGetUnitsQuery,
  useCreateUnitMutation,
  useUpdateUnitMutation,
  useDeleteUnitMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function UnitsDashboard() {
  const { data, isLoading, error } = useGetUnitsQuery();
  const [createUnit] = useCreateUnitMutation();
  const [updateUnit] = useUpdateUnitMutation();
  const [deleteUnit] = useDeleteUnitMutation();
  const [form, setForm] = useState({ slug: null, name: '' });

  const handleChange = (e) =>
    setForm({ ...form, [e.target.name]: e.target.value });

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      if (form.slug) {
        await updateUnit({
          slug: form.slug,
          body: { name: form.name },
        }).unwrap();
        toast.success('Unit updated');
      } else {
        await createUnit({ name: form.name }).unwrap();
        toast.success('Unit created');
      }
      setForm({ slug: null, name: '' });
    } catch {
      toast.error('Failed to save unit');
    }
  };

  const handleEdit = (u) => setForm({ slug: u.slug, name: u.name });

  const handleDelete = async (slug) => {
    try {
      await deleteUnit(slug).unwrap();
      toast.success('Unit deleted');
    } catch {
      toast.error('Failed to delete unit');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load units</div>;
  const units = data?.content || [];

  return (
    <div className="p-4 space-y-6">
      <h1 className="text-2xl font-bold">Units</h1>
      <div className="overflow-x-auto">
        <table className="min-w-full text-sm">
          <thead>
            <tr className="border-b">
              <th className="p-2 text-left">ID</th>
              <th className="p-2 text-left">Name</th>
              <th className="p-2 text-left">Slug</th>
              <th className="p-2 text-left">Actions</th>
            </tr>
          </thead>
          <tbody>
            {units.map((u) => (
              <tr key={u.id} className="border-b">
                <td className="p-2">{u.id}</td>
                <td className="p-2">{u.name}</td>
                <td className="p-2">{u.slug}</td>
                <td className="p-2 space-x-2">
                  <button
                    className="text-blue-600"
                    onClick={() => handleEdit(u)}
                  >
                    Edit
                  </button>
                  <button
                    className="text-red-600"
                    onClick={() => handleDelete(u.slug)}
                  >
                    Delete
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      <form onSubmit={handleSubmit} className="space-y-2 max-w-sm">
        <input
          type="text"
          name="name"
          value={form.name}
          onChange={handleChange}
          placeholder="Name"
          className="w-full border p-2 rounded"
          required
        />
        <button type="submit" className="px-4 py-2 bg-black text-white rounded">
          {form.slug ? 'Update' : 'Create'}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/User.jsx">
import { useEffect, useState } from 'react';
import {
  modifyUserStatus,
  softDeleteUser,
  updateUser,
  createUser,
} from '../../api/user';
import NoDataFound from '@/assets/images/NoDataFound.png';
import toast from 'react-hot-toast';
import { useAppDispatch, useAppSelector } from '@/redux/hook';
import { getStores } from '../../api/store';
import { MESSAGE } from '@/utils/Constants';
import Loader from '@/components/common/Loader';
import { MdToggleOff, MdToggleOn } from 'react-icons/md';
import ToggleStatusModal from '@/components/ToggleStatusModal';
import DeleteConfirmationModal from '@/components/DeleteConfirmationModal';
import ResponsivePaginationHandler from '@/components/ResponsivePaginationHandler';
import { FaEdit, FaUserTie } from 'react-icons/fa';
import { FaBuildingUser } from 'react-icons/fa6';
import StoreAssignModal from '@/components/Store/StoreAssignModal';
import { useGetUsersQuery } from '@/api/erpApi';

const UserList = () => {
  const dispatch = useAppDispatch();
  const { isLoading } = useAppSelector((state) => state?.user);
  const [isEdit, setIsEdit] = useState(false);
  const [isSubmitting, setIsSubmitting] = useState(false);
  const [showPassword, setShowPassword] = useState(false);
  // const { stores } = useAppSelector((state) => state?.store);
  const [showToggle, setShowToggle] = useState(false);
  const [showDeleteModal, setShowDeleteModal] = useState(false);
  const [storeAssignModal, setStoreAssignModal] = useState(false);

  const [user, setUser] = useState({
    id: '',
    first_name: '',
    last_name: '',
    username: '',
    email: '',
    password: '',
    phone: '',
    role: '',
  });

  const [pagination, setPagination] = useState({
    page: 0,
    size: 10,
    search: '',
  });

  const {
    data: usersResponse,
    isFetching,
    refetch,
  } = useGetUsersQuery(pagination);
  const userData = usersResponse?.content ?? [];
  const totalPages = usersResponse?.totalPages ?? 0;
  const currentPage = usersResponse?.pageable?.pageNumber
    ? usersResponse.pageable.pageNumber + 1
    : 0;
  const totalElements = usersResponse?.totalElements ?? 0;
  const pageSize = usersResponse?.pageable?.pageSize ?? pagination.size;

  useEffect(() => {
    dispatch(getStores());
  }, [dispatch, storeAssignModal]);

  useEffect(() => {
    if (!storeAssignModal) {
      refetch();
    }
  }, [storeAssignModal, refetch]);

  const generateRandomString = (length) => {
    const chars = 'abcdefghijklmnopqrstuvwxyz';
    let result = '';
    for (let i = 0; i < length; i++) {
      result += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return result;
  };

  const handleChange = (e) => {
    const { name, value } = e.target;
    setUser((prev) => {
      const updatedUser = {
        ...prev,
        [name]: value,
      };

      if (name === 'first_name' || name === 'last_name') {
        const firstNamePart = updatedUser.first_name
          .toLowerCase()
          .slice(0, 3)
          .padEnd(3, 'a');
        const lastNamePart =
          updatedUser.last_name.toLowerCase().slice(0, 1) || 'a';
        const randomPart = generateRandomString(2);
        updatedUser.username =
          `${firstNamePart}${lastNamePart}${randomPart}`.slice(0, 6);
      }

      return updatedUser;
    });
  };

  const validateForm = () => {
    if (!user.first_name || !user.email || !user.role || !user.phone) {
      toast.error('Please fill all required fields');
      return false;
    }

    if (!user.id && user.password.length < 8) {
      toast.error('Password must be at least 8 characters');
      return false;
    }

    if (!/^\S+@\S+\.\S+$/.test(user.email)) {
      toast.error('Please enter a valid email address');
      return false;
    }

    return true;
  };

  const handleSubmit = async (e) => {
    e.preventDefault();

    if (!validateForm()) return;

    setIsSubmitting(true);

    if (user.id) {
      await dispatch(updateUser(user))
        .then((response) => {
          if (response.meta.requestStatus === 'fulfilled') {
            toast.success(MESSAGE.USER_UPDATED);
            handleClose();
            refetch();
            dispatch(getStores());
          } else {
            toast.error('BAD REQUEST');
          }
        })
        .catch((error) => {
          toast.error(error?.message);
        })
        .finally(() => {
          setIsSubmitting(false);
        });
    } else {
      await dispatch(createUser(user))
        .then((response) => {
          if (response.meta.requestStatus === 'fulfilled') {
            toast.success(MESSAGE.USER_CREATED);
            handleClose();
            refetch();
            dispatch(getStores());
          } else {
            toast.error('BAD REQUEST');
          }
        })
        .catch((error) => {
          toast.error(error?.message);
        })
        .finally(() => {
          setIsSubmitting(false);
        });
    }
  };

  const onEdit = (obj) => {
    const {
      id,
      first_name,
      last_name,
      username,
      email,
      password,
      phone,
      role,
    } = obj;
    setUser({
      id: id,
      first_name: first_name,
      last_name: last_name,
      username: username,
      email: email,
      password: password,
      phone: phone,
      role: role,
    });
    setIsEdit(true);
  };

  const handleClose = () => {
    setIsEdit(false);
    setShowToggle(false);
    setShowDeleteModal(false);
    setStoreAssignModal(false);
    setUser({
      id: '',
      first_name: '',
      last_name: '',
      username: '',
      email: '',
      password: '',
      phone: '',
      role: '',
      // store: '',
    });
  };

  const handleToggleStatus = (user) => {
    dispatch(modifyUserStatus({ id: user.id, is_active: !user.is_active }))
      .then((response) => {
        if (response.meta.requestStatus === 'fulfilled') {
          toast.success(MESSAGE.USER_STATUS_UPDATED);
          dispatch(getStores());
          refetch();
          handleClose();
        } else {
          toast.error('BAD REQUEST');
        }
      })
      .catch((error) => {
        toast.error(error?.message);
      });
  };

  const handleToggleClick = (user) => {
    setUser(user);
    setShowToggle(true);
  };

  const handleDeleteAction = (id) => {
    dispatch(softDeleteUser(id))
      .then((response) => {
        if (response.meta.requestStatus === 'fulfilled') {
          toast.success(MESSAGE.USER_DELETED);
          dispatch(getStores());
          refetch();
          handleClose();
        } else {
          toast.error('BAD REQUEST');
        }
      })
      .catch((error) => {
        toast.error(error?.message);
      });
  };

  const handleDeleteClick = (user) => {
    setUser(user);
    setShowDeleteModal(true);
  };

  const handleSearch = (value) => {
    setPagination((prev) => ({
      ...prev,
      search: value,
    }));
  };

  const handlePageChange = (page) => {
    setPagination((prev) => ({
      ...prev,
      ['page']: page,
    }));
  };

  const handleStoreAssignClick = (user) => {
    setStoreAssignModal(true);
    setUser(user);
  };

  const handleMobilePageChange = (size) => {
    setPagination((prev) => ({
      ...prev,
      ['size']: size,
    }));
  };

  return (
    <div className="relative">
      {!isEdit && (
        <div className="p-6">
          {(isLoading || isFetching) && <Loader />}
          <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-3">
            <div className="flex flex-col sm:flex-row sm:items-center gap-3 w-full sm:w-auto">
              <div className="flex items-center justify-between sm:justify-start w-full sm:w-auto">
                <h1 className="text-2xl font-bold text-gray-800">Users</h1>
                {/* Mobile-only ADD button */}
                <button
                  className="sm:hidden px-4 py-2 bg-black text-white rounded hover:bg-gray-900 ml-auto"
                  onClick={() => setIsEdit(true)}
                >
                  ADD
                </button>
              </div>

              {/* Search Input */}
              <div className="w-full sm:w-64">
                <input
                  type="text"
                  placeholder="Search stores"
                  className="w-full px-3 py-2 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-keyline"
                  onChange={(e) => handleSearch(e.target.value)}
                  value={pagination.search}
                />
              </div>
            </div>

            {/* Desktop-only ADD button */}
            <button
              className="hidden sm:inline-block px-4 py-2 bg-black text-white rounded hover:bg-gray-900"
              onClick={() => setIsEdit(true)}
            >
              ADD
            </button>
          </div>

          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
            {userData.length === 0 ? (
              <div className="col-span-full flex flex-col items-center justify-center py-12">
                <img
                  src={NoDataFound}
                  alt="No data found"
                  className="w-48 h-auto"
                />
                <p className="mt-4 text-gray-500">No data found</p>
              </div>
            ) : (
              userData.map((user, index) => (
                <div
                  key={index}
                  className="relative p-5 rounded-xl bg-white/70 shadow-lg backdrop-blur-lg border border-gray-200 transition hover:shadow-xl flex flex-col justify-between"
                >
                  <div className="mb-4">
                    <h3 className="text-lg font-semibold text-gray-800">
                      {user.first_name} {user.last_name}
                    </h3>
                    <p className="text-m text-gray-500 mt-2">
                      <strong>Email:</strong> {user.email || '-'}
                    </p>
                    <p className="text-m text-gray-500">
                      <strong>Phone:</strong> {user.phone || '-'}
                    </p>
                    <p className="text-m text-gray-500">
                      <strong>Role:</strong> {user.role || '-'}
                    </p>
                    <p className="text-m text-gray-500">
                      <strong>Store:</strong>{' '}
                      {user.store_name || (
                        <span className="text-m text-gray-400">unassigned</span>
                      )}
                    </p>
                  </div>

                  <div className="flex items-center justify-between mt-auto pt-4 border-t border-gray-100">
                    <span
                      onClick={() => handleToggleClick(user)}
                      className="cursor-pointer"
                    >
                      {user.is_active ? (
                        <MdToggleOn
                          className="text-green-500 hover:scale-110 transition-transform"
                          size={26}
                        />
                      ) : (
                        <MdToggleOff
                          className="text-red-500 hover:scale-110 transition-transform"
                          size={26}
                        />
                      )}
                    </span>
                    <div className="flex gap-3 items-center">
                      <button
                        onClick={() => handleStoreAssignClick(user)}
                        title="Assign Store"
                        className="text-gray-700 hover:text-keyline transition-transform hover:scale-110"
                      >
                        <FaBuildingUser size={20} />
                      </button>
                      <button
                        onClick={() => onEdit(user)}
                        className="text-yellow-500 hover:text-yellow-600"
                      >
                        {/* <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" className="bi bi-pencil-square" viewBox="0 0 16 16">
                          <path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293z" />
                          <path fillRule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z" />
                        </svg> */}
                        <FaEdit size={20} />
                      </button>
                      <button
                        onClick={() => handleDeleteClick(user)}
                        data-bs-toggle="modal"
                        data-bs-target="#staticDeletedPopup"
                        className="text-red-500 hover:text-red-600"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="18"
                          height="18"
                          fill="currentColor"
                          className="bi bi-trash3"
                          viewBox="0 0 16 16"
                        >
                          <path d="M6.5 1h3a.5.5 0 0 1 .5.5v1H6v-1a.5.5 0 0 1 .5-.5M11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3A1.5 1.5 0 0 0 5 1.5v1H1.5a.5.5 0 0 0 0 1h.538l.853 10.66A2 2 0 0 0 4.885 16h6.23a2 2 0 0 0 1.994-1.84l.853-10.66h.538a.5.5 0 0 0 0-1z" />
                          <path d="M5.03 4.97a.5.5 0 0 1 .47-.53.5.5 0 0 1 .528.47l.5 8.5a.5.5 0 1 1-.998.06l-.5-8.5zM10.03 4.97a.5.5 0 0 1 .47-.53.5.5 0 0 1 .528.47l-.5 8.5a.5.5 0 0 1-.998.06l.5-8.5zM8 4.5a.5.5 0 0 1 .5.5v8.5a.5.5 0 0 1-1 0V5a.5.5 0 0 1 .5-.5z" />
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              ))
            )}
          </div>
          <ResponsivePaginationHandler
            currentPage={currentPage}
            totalPages={totalPages}
            size={pageSize}
            totalElements={totalElements}
            onPageChange={(page) => handlePageChange(page)}
            onMobilePageChange={handleMobilePageChange}
          />
        </div>
      )}

      {isEdit && (
        <div className="min-h-screen bg-gray-50 py-6 px-4 sm:px-6 lg:px-8">
          <div className="max-w-3xl mx-auto bg-white rounded-xl shadow-md overflow-hidden">
            <div className="p-6 sm:p-8">
              {/* Header */}
              <div className="flex items-center justify-between mb-6">
                <h2 className="text-xl sm:text-2xl font-semibold text-gray-800">
                  {user?.id ? 'Update User' : 'Create User'}
                </h2>
                <button
                  onClick={handleClose}
                  className="text-gray-500 hover:text-gray-700"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    className="h-6 w-6"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke="currentColor"
                  >
                    <path
                      strokeLinecap="round"
                      strokeLinejoin="round"
                      strokeWidth={2}
                      d="M6 18L18 6M6 6l12 12"
                    />
                  </svg>
                </button>
              </div>

              {/* Form */}
              <form onSubmit={handleSubmit} className="space-y-6">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4 sm:gap-6">
                  {/* Name */}
                  <div>
                    <label
                      htmlFor="first_name"
                      className="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Name <span className="text-red-500">*</span>
                    </label>
                    <input
                      id="first_name"
                      name="first_name"
                      type="text"
                      placeholder="Enter full name"
                      value={user.first_name}
                      onChange={handleChange}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                      required
                    />
                  </div>

                  {/* Initial */}
                  <div>
                    <label
                      htmlFor="last_name"
                      className="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Initial (Parent Name)
                    </label>
                    <input
                      id="last_name"
                      name="last_name"
                      type="text"
                      placeholder="Enter parent name or initial"
                      value={user.last_name}
                      onChange={handleChange}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                    />
                  </div>

                  {/* Username */}
                  <div>
                    <label
                      htmlFor="username"
                      className="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Username (Auto-generated)
                    </label>
                    <input
                      id="username"
                      name="username"
                      type="text"
                      value={user.username}
                      readOnly
                      className="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 cursor-not-allowed"
                    />
                  </div>

                  {/* Email */}
                  <div>
                    <label
                      htmlFor="email"
                      className="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Email <span className="text-red-500">*</span>
                    </label>
                    <input
                      id="email"
                      name="email"
                      type="email"
                      placeholder="Enter email address"
                      value={user.email}
                      onChange={handleChange}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                      required
                    />
                  </div>

                  {/* Password (only for create) */}
                  {!user.id && (
                    <div className="relative">
                      <label
                        htmlFor="password"
                        className="block text-sm font-medium text-gray-700 mb-1"
                      >
                        Password <span className="text-red-500">*</span>
                      </label>
                      <input
                        id="password"
                        name="password"
                        type={showPassword ? 'text' : 'password'}
                        placeholder="Enter password (min 8 chars)"
                        value={user.password}
                        onChange={handleChange}
                        className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                        required
                        minLength="8"
                      />
                      <button
                        type="button"
                        onClick={() => setShowPassword(!showPassword)}
                        className="absolute inset-y-0 right-0 pr-3 flex items-center pt-5"
                      >
                        {showPassword ? (
                          <svg
                            className="h-5 w-5 text-gray-500"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              strokeLinecap="round"
                              strokeLinejoin="round"
                              strokeWidth={2}
                              d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"
                            />
                          </svg>
                        ) : (
                          <svg
                            className="h-5 w-5 text-gray-500"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                          >
                            <path
                              strokeLinecap="round"
                              strokeLinejoin="round"
                              strokeWidth={2}
                              d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                            />
                            <path
                              strokeLinecap="round"
                              strokeLinejoin="round"
                              strokeWidth={2}
                              d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                            />
                          </svg>
                        )}
                      </button>
                    </div>
                  )}

                  {/* Phone */}
                  <div>
                    <label
                      htmlFor="phone"
                      className="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Phone Number <span className="text-red-500">*</span>
                    </label>
                    <input
                      id="phone"
                      name="phone"
                      type="tel"
                      placeholder="Enter phone number"
                      value={user.phone}
                      onChange={handleChange}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                      required
                    />
                  </div>

                  {/* Role */}
                  <div>
                    <label
                      htmlFor="role"
                      className="block text-sm font-medium text-gray-700 mb-1"
                    >
                      Role <span className="text-red-500">*</span>
                    </label>
                    <select
                      id="role"
                      name="role"
                      value={user.role}
                      onChange={handleChange}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                      required
                    >
                      <option value="">Select Role</option>
                      <option value="branch_head">Branch Head</option>
                      <option value="advisor">Advisor</option>
                      <option value="system_admin">System Admin</option>
                    </select>
                  </div>

                  {/* Store assignment */}
                  {/* <div>
                    <label htmlFor="store" className="block text-sm font-medium text-gray-700 mb-1">
                      Assign to Store
                    </label>
                    <select
                      id="store"
                      name="store"
                      value={user.store}
                      onChange={handleChange}
                      className="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-keyline"
                    >
                      <option value="">Select Store (Optional)</option>
                      {stores.map((store) => (
                        <option key={store.id} value={store.id}>
                          {store.store_name} ({store.code})
                        </option>
                      ))}
                    </select>
                  </div> */}
                </div>

                {/* Buttons */}
                <div className="flex flex-col sm:flex-row sm:justify-end gap-4 pt-4">
                  <button
                    type="button"
                    onClick={handleClose}
                    className="w-full sm:w-auto px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-keyline"
                  >
                    Cancel
                  </button>
                  <button
                    type="submit"
                    disabled={isSubmitting}
                    className={`w-full sm:w-auto px-4 py-2 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-keyline ${
                      isSubmitting
                        ? 'bg-gray-400'
                        : 'bg-black hover:bg-gray-900'
                    }`}
                  >
                    {user?.id ? 'Update' : 'Create'}
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      )}

      <StoreAssignModal
        isOpen={storeAssignModal}
        onClose={() => handleClose()}
        user={user}
      />

      <ToggleStatusModal
        isOpen={showToggle}
        onClose={() => handleClose()}
        handleToggleStatus={handleToggleStatus}
        value={user}
      />

      <DeleteConfirmationModal
        isOpen={showDeleteModal}
        onClose={() => handleClose()}
        handleDeleteAction={handleDeleteAction}
        value={user}
      />
    </div>
  );
};

export default UserList;
</file>

<file path="src/pages/internal/VariantsDashboard.jsx">
import { useState } from 'react';
import {
  useGetVariantsQuery,
  useCreateVariantMutation,
  useUpdateVariantMutation,
  useDeleteVariantMutation,
} from '../../api/erpApi';
import toast from 'react-hot-toast';

export default function VariantsDashboard() {
  const { data, isLoading, error } = useGetVariantsQuery();
  const [createVariant] = useCreateVariantMutation();
  const [updateVariant] = useUpdateVariantMutation();
  const [deleteVariant] = useDeleteVariantMutation();
  const [form, setForm] = useState({
    slug: null,
    product: '',
    variant_name: '',
    price: '',
    stock: '',
    availability: false,
  });

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setForm((f) => ({ ...f, [name]: type === 'checkbox' ? checked : value }));
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    const body = {
      product: form.product,
      variant_name: form.variant_name,
      price: parseFloat(form.price),
      stock: parseInt(form.stock, 10),
      availability: form.availability,
    };
    try {
      if (form.slug) {
        await updateVariant({ slug: form.slug, body }).unwrap();
        toast.success('Variant updated');
      } else {
        await createVariant(body).unwrap();
        toast.success('Variant created');
      }
      setForm({
        slug: null,
        product: '',
        variant_name: '',
        price: '',
        stock: '',
        availability: false,
      });
    } catch {
      toast.error('Failed to save variant');
    }
  };

  const handleEdit = (v) => {
    setForm({
      slug: v.slug,
      product: v.product,
      variant_name: v.variant_name,
      price: v.price,
      stock: v.stock,
      availability: v.availability,
    });
  };

  const handleDelete = async (slug) => {
    try {
      await deleteVariant(slug).unwrap();
      toast.success('Variant deleted');
    } catch {
      toast.error('Failed to delete variant');
    }
  };

  if (isLoading) return <div className="p-4">Loading...</div>;
  if (error) return <div className="p-4">Failed to load variants</div>;
  const variants = data?.content || [];

  return (
    <div className="p-4">
      <h1 className="text-2xl font-bold mb-4">Variants</h1>
      <div className="overflow-x-auto mb-6">
        <table className="min-w-full border text-sm">
          <thead className="bg-gray-100">
            <tr>
              <th className="p-2 border">Name</th>
              <th className="p-2 border">Price</th>
              <th className="p-2 border">Stock</th>
              <th className="p-2 border">Available</th>
              <th className="p-2 border">Product</th>
              <th className="p-2 border">Actions</th>
            </tr>
          </thead>
          <tbody>
            {variants.map((v) => (
              <tr key={v.id} className="text-center">
                <td className="p-2 border">{v.variant_name}</td>
                <td className="p-2 border">{v.price}</td>
                <td className="p-2 border">{v.stock}</td>
                <td className="p-2 border">{v.availability ? 'Yes' : 'No'}</td>
                <td className="p-2 border">
                  <a
                    href={`/product/${v.product}`}
                    className="text-blue-600 underline"
                  >
                    {v.product}
                  </a>
                </td>
                <td className="p-2 border space-x-2">
                  <button
                    className="text-blue-600"
                    onClick={() => handleEdit(v)}
                  >
                    Edit
                  </button>
                  <button
                    className="text-red-600"
                    onClick={() => handleDelete(v.slug)}
                  >
                    Delete
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
      <form onSubmit={handleSubmit} className="space-y-2 max-w-md">
        <input
          type="text"
          name="product"
          value={form.product}
          onChange={handleChange}
          placeholder="Product Slug"
          className="input"
          required
        />
        <input
          type="text"
          name="variant_name"
          value={form.variant_name}
          onChange={handleChange}
          placeholder="Variant Name"
          className="input"
          required
        />
        <input
          type="number"
          name="price"
          value={form.price}
          onChange={handleChange}
          placeholder="Price"
          className="input"
          required
        />
        <input
          type="number"
          name="stock"
          value={form.stock}
          onChange={handleChange}
          placeholder="Stock"
          className="input"
          required
        />
        <label className="flex items-center gap-2">
          <input
            type="checkbox"
            name="availability"
            checked={form.availability}
            onChange={handleChange}
          />
          Available
        </label>
        <button type="submit" className="px-4 py-2 bg-black text-white rounded">
          {form.slug ? 'Update' : 'Create'}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="src/pages/internal/Workledger.jsx">
import { useAppSelector } from '@/redux/hook';
import { selectAuthRole } from '@/redux/slice/authSlice';
import CardItem from '@/components/dashboard/components/CardItem';
import { HiOutlineClipboardDocumentList } from 'react-icons/hi2';

const tiles = {
  system_admin: [
    {
      title: 'System admin action coming soon',
      icon: <HiOutlineClipboardDocumentList size={28} />,
      disabled: true,
    },
  ],
  branch_head: [
    {
      title: 'Branch head action coming soon',
      icon: <HiOutlineClipboardDocumentList size={28} />,
      disabled: true,
    },
  ],
  advisor: [
    {
      title: 'Advisor action coming soon',
      icon: <HiOutlineClipboardDocumentList size={28} />,
      disabled: true,
    },
  ],
};

function Workledger() {
  const role = useAppSelector(selectAuthRole);
  const items = tiles[role] || [];

  return (
    <div className="p-4 space-y-4">
      <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 xl:grid-cols-4 gap-4">
        {items.map((item, i) => (
          <CardItem key={i} {...item} />
        ))}
      </div>
    </div>
  );
}

export default Workledger;
</file>

<file path="src/pages/internal/WorkledgerDetails.jsx">
import { useParams } from 'react-router-dom';

function WorkledgerDetails() {
  const { id } = useParams();
  return (
    <div className="p-4">
      <p className="text-gray-800">Details for {id} coming soon.</p>
    </div>
  );
}

export default WorkledgerDetails;
</file>

<file path="src/pages/public/About.jsx">
import { useEffect } from 'react';

export default function About() {
  useEffect(() => {
    const desc = 'Where we started and our mission to finetune every device.';
    document.title = 'About – Finetune';
    let tag = document.head.querySelector("meta[name='description']");
    if (!tag) {
      tag = document.createElement('meta');
      tag.setAttribute('name', 'description');
      document.head.appendChild(tag);
    }
    tag.setAttribute('content', desc);
  }, []);

  return (
    <>
      <title>About – Finetune</title>
      <meta
        name="description"
        content="Where we started and our mission to finetune every device."
      />
      <meta property="og:title" content="About – Finetune" />
      <meta
        property="og:description"
        content="Where we started and our mission to finetune every device."
      />
      <div className="p-4 pt-24 space-y-16">
        <section className="max-w-3xl mx-auto text-center space-y-4">
          <h1 className="text-3xl font-bold">We always do Finetune</h1>
          <p className="text-keyline text-xl font-bold">About us</p>
          <p className="text-gray-700">
            We started a decade ago with a motto to simplify handset service
            with high quality in minimal time, satisfying our precious
            customers.
          </p>
        </section>
        <section className="max-w-5xl mx-auto grid md:grid-cols-2 gap-8 items-center">
          <div>
            <p>
              We are selling multi branded mobiles, accessories, computer
              accessories with best quality.
            </p>
            <address className="not-italic">
              Cheran Plaza K.G Chavadi Road, Ettimadai, Pirivu, near KK MAHAAL,
              Coimbatore, Tamil Nadu 641105.
            </address>
            <p>
              We pledge to take the best quality service to every individual.
            </p>
            <p className="mt-4 font-semibold text-center text-keyline">
              Book your service from anywhere and anytime.
            </p>
          </div>
        </section>
        <section className="max-w-5xl mx-auto grid md:grid-cols-2 gap-8 items-center">
          <div>
            <p>
              We are professionals working with a passion as a team. We take
              every service as our challenge and complete it with utmost care.
              The digital platform we are entering expands our service.
            </p>
          </div>
        </section>
      </div>
    </>
  );
}
</file>

<file path="src/pages/public/Careers.jsx">
import React from 'react';

export default function Careers() {
  return <div className="pt-20 p-4 text-center">Coming Soon</div>;
}
</file>

<file path="src/pages/public/Contact.jsx">
import { useState, useEffect } from 'react';
import toast from 'react-hot-toast';

export default function Contact() {
  const [form, setForm] = useState({ name: '', email: '', message: '' });
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    const desc = 'Reach out for device repair or support.';
    document.title = 'Contact – Finetune';
    let tag = document.head.querySelector("meta[name='description']");
    if (!tag) {
      tag = document.createElement('meta');
      tag.setAttribute('name', 'description');
      document.head.appendChild(tag);
    }
    tag.setAttribute('content', desc);
  }, []);

  const onChange = (e) => setForm({ ...form, [e.target.name]: e.target.value });

  const submit = async (e) => {
    e.preventDefault();
    try {
      setLoading(true);
      await fetch('/api/contact', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(form),
      });
      toast.success('Message sent');
      setForm({ name: '', email: '', message: '' });
    } catch {
      toast.error('Submission failed');
    } finally {
      setLoading(false);
    }
  };

  return (
    <>
      <title>Contact – Finetune</title>
      <meta
        name="description"
        content="Reach out for device repair or support."
      />
      <meta property="og:title" content="Contact – Finetune" />
      <meta
        property="og:description"
        content="Reach out for device repair or support."
      />
      <div className="p-4 pt-24 max-w-xl mx-auto">
        <h1 className="text-2xl font-bold mb-4">Contact Us</h1>
        <address className="not-italic mb-4 text-gray-700">
          Cheran Plaza K.G Chavadi Road, Ettimadai, Pirivu, near KK MAHAAL,
          Coimbatore, Tamil Nadu 641105.
          <br />
          Phone:{' '}
          <a href="tel:+919791151863" className="text-keyline">
            +91 97911 51863
          </a>
        </address>
        <form onSubmit={submit} className="space-y-4">
          <input
            name="name"
            value={form.name}
            onChange={onChange}
            placeholder="Name"
            className="input"
            required
          />
          <input
            type="email"
            name="email"
            value={form.email}
            onChange={onChange}
            placeholder="Email"
            className="input"
            required
          />
          <textarea
            name="message"
            value={form.message}
            onChange={onChange}
            placeholder="Message"
            className="input"
            required
          />
          <div className="input h-24 flex items-center justify-center text-gray-500">
            Captcha placeholder
          </div>
          <button
            type="submit"
            disabled={loading}
            className="bg-black text-white px-4 py-2 rounded hover:bg-gray-800 disabled:opacity-50"
          >
            {loading ? 'Sending...' : 'Send'}
          </button>
        </form>
      </div>
    </>
  );
}
</file>

<file path="src/pages/public/Legal.jsx">
import { useState, useEffect } from 'react';
import {
  HiOutlineDocumentText,
  HiOutlineShieldCheck,
  HiOutlineEye,
  HiOutlineLockClosed,
  HiOutlineCreditCard,
  HiOutlineTruck,
} from 'react-icons/hi';

function Legal() {
  const [activeSection, setActiveSection] = useState('terms');

  useEffect(() => {
    document.title = 'Legal Information – Finetune';
    const desc =
      'Important legal information about our services, policies, and your rights as a customer.';
    let tag = document.head.querySelector("meta[name='description']");
    if (!tag) {
      tag = document.createElement('meta');
      tag.setAttribute('name', 'description');
      document.head.appendChild(tag);
    }
    tag.setAttribute('content', desc);
  }, []);

  const legalSections = [
    {
      id: 'terms',
      title: 'Terms & Conditions',
      icon: <HiOutlineDocumentText className="w-6 h-6" />,
    },
    {
      id: 'privacy',
      title: 'Privacy Policy',
      icon: <HiOutlineShieldCheck className="w-6 h-6" />,
    },
    {
      id: 'shipping',
      title: 'Shipping Policy',
      icon: <HiOutlineTruck className="w-6 h-6" />,
    },
    {
      id: 'returns',
      title: 'Return Policy',
      icon: <HiOutlineEye className="w-6 h-6" />,
    },
    {
      id: 'payment',
      title: 'Payment Terms',
      icon: <HiOutlineCreditCard className="w-6 h-6" />,
    },
    {
      id: 'security',
      title: 'Security Policy',
      icon: <HiOutlineLockClosed className="w-6 h-6" />,
    },
  ];

  const legalContent = {
    terms: {
      title: 'Terms and Conditions',
      lastUpdated: 'Last updated: January 15, 2024',
      content: [
        {
          section: '1. Acceptance of Terms',
          text: "By accessing and using Finetune's website and services, you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.",
        },
        {
          section: '2. Use License',
          text: "Permission is granted to temporarily download one copy of the materials (information or software) on Finetune's website for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title.",
        },
        {
          section: '3. User Account',
          text: 'You are responsible for maintaining the confidentiality of your account and password. You agree to accept responsibility for all activities that occur under your account or password.',
        },
        {
          section: '4. Product Information',
          text: 'We strive to display accurate product information, including prices and availability. However, we do not warrant that product descriptions or other content is accurate, complete, reliable, current, or error-free.',
        },
        {
          section: '5. Pricing and Payment',
          text: 'All prices are in Indian Rupees (INR) and are subject to change without notice. Payment must be made at the time of order placement. We accept various payment methods as listed on our website.',
        },
        {
          section: '6. Order Acceptance',
          text: 'All orders are subject to acceptance and availability. We reserve the right to refuse service to anyone for any reason at any time.',
        },
        {
          section: '7. Limitation of Liability',
          text: 'In no event shall Finetune, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential, or punitive damages.',
        },
        {
          section: '8. Governing Law',
          text: 'These terms and conditions are governed by and construed in accordance with the laws of India. Any disputes relating to these terms and conditions will be subject to the exclusive jurisdiction of the courts of Coimbatore, Tamil Nadu.',
        },
      ],
    },
    privacy: {
      title: 'Privacy Policy',
      lastUpdated: 'Last updated: January 15, 2024',
      content: [
        {
          section: '1. Information We Collect',
          text: 'We collect information you provide directly to us, such as when you create an account, make a purchase, or contact us. This may include your name, email address, phone number, shipping address, and payment information.',
        },
        {
          section: '2. How We Use Your Information',
          text: 'We use the information we collect to process your orders, communicate with you, provide customer support, improve our services, and send you marketing communications (with your consent).',
        },
        {
          section: '3. Information Sharing',
          text: 'We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy or as required by law.',
        },
        {
          section: '4. Data Security',
          text: 'We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.',
        },
        {
          section: '5. Cookies and Tracking',
          text: 'We use cookies and similar tracking technologies to enhance your browsing experience, analyze site traffic, and understand where our visitors are coming from.',
        },
        {
          section: '6. Your Rights',
          text: 'You have the right to access, update, or delete your personal information. You can also opt out of marketing communications at any time.',
        },
        {
          section: '7. Data Retention',
          text: 'We retain your personal information for as long as necessary to provide our services and comply with legal obligations.',
        },
      ],
    },
    shipping: {
      title: 'Shipping Policy',
      lastUpdated: 'Last updated: January 15, 2024',
      content: [
        {
          section: '1. Shipping Methods',
          text: 'We offer standard shipping (3-5 business days) and express shipping (1-2 business days) for domestic orders. International shipping is available to select countries.',
        },
        {
          section: '2. Shipping Costs',
          text: 'Free shipping is available on orders above ₹999. Standard shipping costs ₹99 for orders below ₹999. Express shipping costs ₹199.',
        },
        {
          section: '3. Delivery Areas',
          text: 'We ship to all major cities and towns across India. Remote areas may have additional delivery charges or longer delivery times.',
        },
        {
          section: '4. Order Processing',
          text: 'Orders are typically processed within 24 hours of placement. You will receive a confirmation email with tracking information once your order ships.',
        },
        {
          section: '5. Delivery Confirmation',
          text: "All deliveries require signature confirmation. If you're not available, our delivery partner will attempt redelivery or leave a notice for pickup.",
        },
        {
          section: '6. Shipping Delays',
          text: 'We are not responsible for delays caused by weather, natural disasters, or other circumstances beyond our control.',
        },
      ],
    },
    returns: {
      title: 'Return Policy',
      lastUpdated: 'Last updated: January 15, 2024',
      content: [
        {
          section: '1. Return Period',
          text: 'We offer a 30-day return policy for most products. Items must be returned in original condition with all packaging and accessories included.',
        },
        {
          section: '2. Return Process',
          text: "To initiate a return, log into your account, go to 'My Orders', select the order you want to return, and follow the return process. We'll provide a prepaid shipping label.",
        },
        {
          section: '3. Non-Returnable Items',
          text: 'Certain items are non-returnable, including software, digital downloads, personalized items, and items marked as non-returnable on the product page.',
        },
        {
          section: '4. Refund Processing',
          text: 'Refunds are processed within 3-5 business days after we receive your return. The time to appear in your account depends on your bank or payment provider.',
        },
        {
          section: '5. Return Shipping',
          text: 'We provide free return shipping for items returned due to defects or our error. For other returns, return shipping costs may apply.',
        },
        {
          section: '6. Damaged Items',
          text: "If you receive a damaged item, please contact us within 48 hours of delivery. We'll arrange for a replacement or refund.",
        },
      ],
    },
    payment: {
      title: 'Payment Terms',
      lastUpdated: 'Last updated: January 15, 2024',
      content: [
        {
          section: '1. Accepted Payment Methods',
          text: 'We accept all major credit/debit cards (Visa, MasterCard, American Express), UPI, net banking, digital wallets (Paytm, PhonePe, Google Pay), and EMI options.',
        },
        {
          section: '2. Payment Security',
          text: 'All payments are processed through secure payment gateways with SSL encryption. We do not store your card details on our servers.',
        },
        {
          section: '3. EMI Options',
          text: "EMI options are available for eligible products through various banks and financial institutions. EMI terms and conditions apply as per the bank's policy.",
        },
        {
          section: '4. Payment Processing',
          text: 'Payments are processed immediately upon order placement. In case of payment failure, your order will be cancelled automatically.',
        },
        {
          section: '5. Currency',
          text: 'All prices are displayed in Indian Rupees (INR). International customers may see prices converted to their local currency during checkout.',
        },
        {
          section: '6. Payment Disputes',
          text: "If you have any issues with your payment, please contact our customer support team. We'll work with you to resolve any payment-related problems.",
        },
      ],
    },
    security: {
      title: 'Security Policy',
      lastUpdated: 'Last updated: January 15, 2024',
      content: [
        {
          section: '1. Data Protection',
          text: 'We implement industry-standard security measures to protect your personal and financial information. This includes SSL encryption, secure servers, and regular security audits.',
        },
        {
          section: '2. Secure Transactions',
          text: 'All transactions are processed through PCI DSS compliant payment gateways. Your payment information is encrypted and transmitted securely.',
        },
        {
          section: '3. Account Security',
          text: 'We recommend using strong passwords and enabling two-factor authentication for your account. Never share your login credentials with others.',
        },
        {
          section: '4. Fraud Prevention',
          text: 'We use advanced fraud detection systems to prevent unauthorized transactions. Suspicious activities may result in order cancellation or account suspension.',
        },
        {
          section: '5. Security Monitoring',
          text: 'Our systems are monitored 24/7 for security threats. We regularly update our security measures to protect against new threats.',
        },
        {
          section: '6. Incident Response',
          text: 'In case of a security incident, we will notify affected users promptly and take appropriate measures to protect their information.',
        },
      ],
    },
  };

  return (
    <div className="min-h-screen bg-gray-50 pt-20">
      <div className="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        {/* Header */}
        <div className="text-center mb-12">
          <h1 className="text-4xl font-bold text-gray-900 mb-4">
            Legal Information
          </h1>
          <p className="text-xl text-gray-600 max-w-3xl mx-auto">
            Important legal information about our services, policies, and your
            rights as a customer.
          </p>
        </div>

        <div className="flex flex-col lg:flex-row gap-8">
          {/* Sidebar Navigation */}
          <div className="lg:w-80 flex-shrink-0">
            <div className="bg-white rounded-lg shadow-sm p-6 sticky top-24">
              <h3 className="text-lg font-semibold text-gray-900 mb-4">
                Legal Documents
              </h3>
              <nav className="space-y-2">
                {legalSections.map((section) => (
                  <button
                    key={section.id}
                    onClick={() => setActiveSection(section.id)}
                    className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg text-left transition-colors ${
                      activeSection === section.id
                        ? 'bg-gray-50 text-keyline border border-keyline'
                        : 'text-gray-700 hover:bg-gray-50'
                    }`}
                  >
                    {section.icon}
                    <span className="font-medium">{section.title}</span>
                  </button>
                ))}
              </nav>
            </div>
          </div>

          {/* Main Content */}
          <div className="flex-1">
            <div className="bg-white rounded-lg shadow-sm overflow-hidden">
              <div className="p-8">
                <div className="mb-6">
                  <h2 className="text-2xl font-bold text-gray-900 mb-2">
                    {legalContent[activeSection].title}
                  </h2>
                  <p className="text-sm text-gray-500">
                    {legalContent[activeSection].lastUpdated}
                  </p>
                </div>

                <div className="prose prose-gray max-w-none">
                  {legalContent[activeSection].content.map((item, index) => (
                    <div key={index} className="mb-6">
                      <h3 className="text-lg font-semibold text-gray-900 mb-3">
                        {item.section}
                      </h3>
                      <p className="text-gray-600 leading-relaxed">
                        {item.text}
                      </p>
                    </div>
                  ))}
                </div>

                {/* Contact Information */}
                <div className="mt-8 pt-6 border-t border-gray-200">
                  <h3 className="text-lg font-semibold text-gray-900 mb-4">
                    Questions?
                  </h3>
                  <p className="text-gray-600 mb-4">
                    If you have any questions about our legal policies, please
                    contact us:
                  </p>
                  <div className="space-y-2 text-sm text-gray-600">
                    <p>📞 Phone: +91 97911 51863</p>
                    <p>
                      📍 Address: Cheran Plaza K.G Chavadi Road, Ettimadai,
                      Pirivu, near KK MAHAAL, Coimbatore, Tamil Nadu 641105
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

export default Legal;
</file>

<file path="src/pages/public/Locate.jsx">
import { useEffect, useState } from 'react';
import axios from 'axios';
import Loader from '@/components/common/Loader';
import END_POINTS from '@/utils/Endpoints';

export default function Locate() {
  const [hqs, setHqs] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState(false);

  useEffect(() => {
    const desc = 'Find our service branches and directions.';
    document.title = 'Locate – Finetune';
    let tag = document.head.querySelector("meta[name='description']");
    if (!tag) {
      tag = document.createElement('meta');
      tag.setAttribute('name', 'description');
      document.head.appendChild(tag);
    }
    tag.setAttribute('content', desc);
  }, []);

  useEffect(() => {
    const fetchHqs = async () => {
      try {
        const res = await axios.get(
          `${END_POINTS.API_BASE_URL}${END_POINTS.GET_STORES}?store_type=HQ`
        );
        setHqs(res.data?.content || []);
      } catch {
        setError(true);
      } finally {
        setLoading(false);
      }
    };
    fetchHqs();
  }, []);

  return (
    <>
      <title>Locate – Finetune</title>
      <meta
        name="description"
        content="Find our service branches and directions."
      />
      <meta property="og:title" content="Locate – Finetune" />
      <meta
        property="og:description"
        content="Find our service branches and directions."
      />
      <div className="p-4 pt-24 space-y-16">
        <section className="text-center max-w-3xl mx-auto">
          <h1 className="text-3xl font-bold">Locate us</h1>
          <p className="text-gray-700 mt-4">Find our head offices below.</p>
        </section>

        {loading && (
          <div className="text-center">
            <Loader />
          </div>
        )}

        {error && (
          <p className="text-center text-red-600">Failed to load locations.</p>
        )}

        {!loading && !error && (
          <section className="max-w-5xl mx-auto space-y-8">
            {hqs.map((hq) => (
              <address key={hq.id} className="not-italic">
                <h3 className="text-xl font-bold text-keyline">
                  {hq.store_name}
                </h3>
                <p className="text-gray-700">
                  {hq.address}
                  {hq.phone && (
                    <>
                      <br />
                      {hq.phone}
                    </>
                  )}
                </p>
              </address>
            ))}
          </section>
        )}
      </div>
    </>
  );
}
</file>

<file path="src/pages/public/Offers.jsx">
import React from 'react';

export default function Offers() {
  return <div className="pt-20 p-4 text-center">Coming Soon</div>;
}
</file>

<file path="src/pages/public/Repair.jsx">
import { useEffect } from 'react';
import { useScrollMode } from '@/components/layout/ScrollModeContext';

export default function Repair() {
  const { setMode } = useScrollMode();

  useEffect(() => {
    setMode('scroll');
  }, [setMode]);

  return (
    <>
      <title>Repair – Finetune</title>
      <meta name="description" content="Online repair bookings coming soon." />
      <div className="p-4">Online repair bookings coming soon.</div>
    </>
  );
}
</file>

<file path="src/pages/public/Search.jsx">
export default function SearchPage() {
  return (
    <>
      <title>Search – Finetune</title>
      <meta
        name="description"
        content="Search finetune.store products and services."
      />
      <div className="p-4 pt-24">Search functionality coming soon.</div>
    </>
  );
}
</file>

<file path="src/pages/public/Support.jsx">
export default function Support() {
  return (
    <>
      <title>Support – Finetune</title>
      <meta
        name="description"
        content="Get help with finetune.store services."
      />
      <div className="p-4 pt-24 space-y-2">
        <h1 className="text-2xl font-bold">Support</h1>
        <p>
          For assistance, please contact{' '}
          <a href="mailto:support@finetune.store" className="text-blue-600">
            support@finetune.store
          </a>
          .
        </p>
        <p>More resources coming soon.</p>
      </div>
    </>
  );
}
</file>

<file path="src/params/LayoutContext.jsx">
import { createContext, useState, useEffect } from 'react';

// eslint-disable-next-line react-refresh/only-export-components
export const LayoutContext = createContext({
  navbarHeight: 64,
  viewportHeight: window.innerHeight,
});

export const LayoutProvider = ({ children }) => {
  const [layout, setLayout] = useState({
    navbarHeight: 64,
    viewportHeight: window.innerHeight,
  });

  useEffect(() => {
    const updateLayout = () => {
      const navbar = document.getElementById('dashboard-navbar');
      const height = navbar?.offsetHeight || 64;
      setLayout({
        navbarHeight: height,
        viewportHeight: window.innerHeight,
      });
    };

    updateLayout();
    window.addEventListener('resize', updateLayout);
    return () => window.removeEventListener('resize', updateLayout);
  }, []);

  return (
    <LayoutContext.Provider value={layout}>{children}</LayoutContext.Provider>
  );
};
</file>

<file path="src/redux/__tests__/notificationsSlice.test.js">
import { describe, it, expect } from 'vitest';
import notificationsReducer, {
  addNotification,
  markRead,
  clearNotifications,
} from '../slice/notificationsSlice';

describe('notifications slice', () => {
  it('should handle add and markRead', () => {
    let state = { items: [] };
    state = notificationsReducer(
      state,
      addNotification({ id: 1, message: 'Hi', read: false })
    );
    expect(state.items.length).toBe(1);
    state = notificationsReducer(state, markRead(1));
    expect(state.items[0].read).toBe(true);
    state = notificationsReducer(state, clearNotifications());
    expect(state.items.length).toBe(0);
  });
});
</file>

<file path="src/redux/hook.js">
import { useDispatch, useSelector } from 'react-redux';

export const useAppDispatch = () => useDispatch();
export const useAppSelector = useSelector;
</file>

<file path="src/redux/slice/authSlice.js">
import { createSlice, createAsyncThunk } from '@reduxjs/toolkit';
import Cookies from 'js-cookie';
import { baseQueryWithReauth } from '../../api/baseQuery';
import END_POINTS from '@/utils/Endpoints';

export const registerUser = createAsyncThunk(
  'auth/registerUser',
  async (userData, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: '/api/auth/register', method: 'POST', body: userData },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(
        result.error.data?.message || 'Registration failed'
      );
    }
    return result.data;
  }
);

export const loginUser = createAsyncThunk(
  'auth/loginUser',
  async (credentials, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: END_POINTS.LOGIN, method: 'POST', body: credentials },
      thunkAPI
    );
    if (result.error) {
      return thunkAPI.rejectWithValue(
        result.error.data?.message || 'Login failed'
      );
    }
    const data = result.data || {};
    const user =
      data.user ||
      (data.username && data.role
        ? { username: data.username, role: data.role, store: data.store }
        : null);

    if (!user || !data.access || !data.refresh) {
      return thunkAPI.rejectWithValue('Invalid login response');
    }

    return {
      user,
      token: data.access,
      refreshToken: data.refresh,
    };
  }
);

export const logoutUser = createAsyncThunk(
  'auth/logoutUser',
  async (_, thunkAPI) => {
    const result = await baseQueryWithReauth(
      { url: END_POINTS.LOGOUT, method: 'POST' },
      thunkAPI
    );
    thunkAPI.dispatch(logout());
    if (result.error) {
      return thunkAPI.rejectWithValue(
        result.error.data?.message || 'Logout failed'
      );
    }
    return result.data;
  }
);

const getCookie = (key) => Cookies.get(key);
const parseCookieJSON = (key) => {
  try {
    const value = getCookie(key);
    return value ? JSON.parse(value) : null;
  } catch {
    return null;
  }
};

const initialState = {
  user: parseCookieJSON('user'),
  token: getCookie('token') || null,
  refreshToken: getCookie('refreshToken') || null,
  status: 'idle',
  error: null,
  isAuthenticated: !!getCookie('token'),
};

const authSlice = createSlice({
  name: 'auth',
  initialState,
  reducers: {
    clearError: (state) => {
      state.error = null;
    },
    logout: (state) => {
      state.user = null;
      state.token = null;
      state.refreshToken = null;
      state.isAuthenticated = false;
      Cookies.remove('token');
      Cookies.remove('refreshToken');
      Cookies.remove('user');
    },
    setCredentials: (state, action) => {
      const { user, token, refreshToken } = action.payload;
      state.user = user;
      state.token = token;
      state.refreshToken = refreshToken;
      state.isAuthenticated = true;
      // NOTE: Consider HttpOnly cookies for enhanced XSS protection
      // Current implementation allows JS access for SPA token refresh
      Cookies.set('token', token, {
        secure: true,
        sameSite: 'strict',
        expires: 1,
        // TODO: Migrate to HttpOnly cookies with refresh endpoint
      });
      Cookies.set('refreshToken', refreshToken, {
        secure: true,
        sameSite: 'strict',
        expires: 7,
      });
      Cookies.set('user', JSON.stringify(user), {
        secure: true,
        sameSite: 'strict',
        expires: 7,
      });
    },
  },
  extraReducers: (builder) => {
    builder
      .addCase(registerUser.pending, (state) => {
        state.status = 'loading';
        state.error = null;
      })
      .addCase(registerUser.fulfilled, (state) => {
        state.status = 'succeeded';
        state.error = null;
      })
      .addCase(registerUser.rejected, (state, action) => {
        state.status = 'failed';
        state.error = action.payload;
      })
      .addCase(loginUser.pending, (state) => {
        state.status = 'loading';
        state.error = null;
      })
      .addCase(loginUser.fulfilled, (state, action) => {
        state.status = 'succeeded';
        state.error = null;
        state.user = action.payload.user;
        state.token = action.payload.token;
        state.refreshToken = action.payload.refreshToken;
        state.isAuthenticated = true;
        // NOTE: Consider HttpOnly cookies for enhanced XSS protection
        // Current implementation allows JS access for SPA token refresh
        Cookies.set('token', action.payload.token, {
          secure: true,
          sameSite: 'strict',
          expires: 1,
          // TODO: Migrate to HttpOnly cookies with refresh endpoint
        });
        Cookies.set('refreshToken', action.payload.refreshToken, {
          secure: true,
          sameSite: 'strict',
          expires: 7,
        });
        Cookies.set('user', JSON.stringify(action.payload.user), {
          secure: true,
          sameSite: 'strict',
          expires: 7,
        });
      })
      .addCase(loginUser.rejected, (state, action) => {
        state.status = 'failed';
        state.error = action.payload;
      })
      .addCase(logoutUser.pending, (state) => {
        state.status = 'loading';
        state.error = null;
      })
      .addCase(logoutUser.fulfilled, (state) => {
        state.status = 'succeeded';
        state.error = null;
      })
      .addCase(logoutUser.rejected, (state, action) => {
        state.status = 'failed';
        state.error = action.payload;
      });
  },
});

export const { clearError, logout, setCredentials } = authSlice.actions;

export const selectAuthToken = (state) =>
  state.auth.token || getCookie('token');
export const selectAuthUser = (state) =>
  state.auth.user || parseCookieJSON('user');
export const selectAuthStatus = (state) => state.auth.status;
export const selectAuthRole = (state) =>
  (state.auth.user || parseCookieJSON('user'))?.role;

export default authSlice.reducer;
</file>

<file path="src/redux/slice/cartSlice.js">
import { createSlice } from '@reduxjs/toolkit';

const initialState = {
  items: [],
  total: 0,
  itemCount: 0,
  isOpen: false,
};

const cartSlice = createSlice({
  name: 'cart',
  initialState,
  reducers: {
    addToCart: (state, action) => {
      const { product, quantity = 1 } = action.payload;
      const existingItem = state.items.find((item) => item.id === product.id);

      if (existingItem) {
        existingItem.quantity += quantity;
      } else {
        state.items.push({
          ...product,
          quantity,
        });
      }

      // Update totals
      state.total = state.items.reduce(
        (sum, item) => sum + item.price * item.quantity,
        0
      );
      state.itemCount = state.items.reduce(
        (sum, item) => sum + item.quantity,
        0
      );
    },

    removeFromCart: (state, action) => {
      const productId = action.payload;
      state.items = state.items.filter((item) => item.id !== productId);

      // Update totals
      state.total = state.items.reduce(
        (sum, item) => sum + item.price * item.quantity,
        0
      );
      state.itemCount = state.items.reduce(
        (sum, item) => sum + item.quantity,
        0
      );
    },

    updateQuantity: (state, action) => {
      const { productId, quantity } = action.payload;
      const item = state.items.find((item) => item.id === productId);

      if (item) {
        if (quantity <= 0) {
          state.items = state.items.filter((item) => item.id !== productId);
        } else {
          item.quantity = quantity;
        }

        // Update totals
        state.total = state.items.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );
        state.itemCount = state.items.reduce(
          (sum, item) => sum + item.quantity,
          0
        );
      }
    },

    clearCart: (state) => {
      state.items = [];
      state.total = 0;
      state.itemCount = 0;
    },

    toggleCart: (state) => {
      state.isOpen = !state.isOpen;
    },

    closeCart: (state) => {
      state.isOpen = false;
    },
  },
});

export const {
  addToCart,
  removeFromCart,
  updateQuantity,
  clearCart,
  toggleCart,
  closeCart,
} = cartSlice.actions;

export default cartSlice.reducer;
</file>

<file path="src/redux/slice/notificationsSlice.js">
import { createSlice } from '@reduxjs/toolkit';

const notificationsSlice = createSlice({
  name: 'notifications',
  initialState: { items: [] },
  reducers: {
    addNotification: (state, action) => {
      state.items.unshift(action.payload);
    },
    markRead: (state, action) => {
      const note = state.items.find((n) => n.id === action.payload);
      if (note) note.read = true;
    },
    clearNotifications: (state) => {
      state.items = [];
    },
  },
});

export const { addNotification, markRead, clearNotifications } =
  notificationsSlice.actions;
export default notificationsSlice.reducer;
</file>

<file path="src/redux/slice/storeSlice.js">
import { createSlice } from '@reduxjs/toolkit';
import {
  assignBranchHeadToStore,
  createStore,
  getStores,
  modifyStoreStatus,
  softDeleteStore,
  unassignBranchHeadFromStore,
  updateStore,
} from '../../api/store';

const initialState = {
  isLoading: false,
  error: null,
  stores: [],
  totalPages: 0,
  currentPage: 0,
  totalElements: 0,
  pageSize: 0,
};

const storeSlice = createSlice({
  name: 'storeSlice',
  initialState,
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(createStore.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(createStore.fulfilled, (state) => {
        state.isLoading = false;
      })
      .addCase(createStore.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(updateStore.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(updateStore.fulfilled, (state) => {
        state.isLoading = false;
      })
      .addCase(updateStore.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(getStores.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(getStores.fulfilled, (state, action) => {
        state.isLoading = false;
        state.stores = action?.payload.content;
        state.totalPages = action.payload.totalPages;
        state.currentPage = action.payload.pageable.pageNumber + 1;
        state.pageSize = action.payload.pageable.pageSize;
        state.totalElements = action.payload.totalElements;
      })
      .addCase(getStores.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(modifyStoreStatus.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(modifyStoreStatus.fulfilled, (state) => {
        state.isLoading = false;
      })
      .addCase(modifyStoreStatus.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(softDeleteStore.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(softDeleteStore.fulfilled, (state, action) => {
        state.isLoading = false;
        state.stores = state.stores.filter(
          (store) => store.id !== action.payload.id
        );
      })
      .addCase(softDeleteStore.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(assignBranchHeadToStore.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(assignBranchHeadToStore.fulfilled, (state, action) => {
        state.isLoading = false;
        const index = state.stores.findIndex(
          (store) => store.id === action.payload.id
        );
        if (index !== -1) {
          state.stores[index] = action.payload;
        }
      })
      .addCase(assignBranchHeadToStore.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(unassignBranchHeadFromStore.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(unassignBranchHeadFromStore.fulfilled, (state, action) => {
        state.isLoading = false;
        const index = state.stores.findIndex(
          (store) => store.id === action.payload.id
        );
        if (index !== -1) {
          state.stores[index] = action.payload;
        }
      })
      .addCase(unassignBranchHeadFromStore.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });
  },
});

export default storeSlice.reducer;
</file>

<file path="src/redux/slice/userSlice.js">
import { createSlice } from '@reduxjs/toolkit';
import { assignStoreToUser, unassignStoreFromUser } from '../../api/user';

const initialState = {
  isLoading: false,
  error: null,
};

const UserSlice = createSlice({
  name: 'UserSlice',
  initialState,
  reducers: {},
  extraReducers: (builder) => {
    builder
      .addCase(assignStoreToUser.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(assignStoreToUser.fulfilled, (state) => {
        state.isLoading = false;
      })
      .addCase(assignStoreToUser.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });

    builder
      .addCase(unassignStoreFromUser.pending, (state) => {
        state.isLoading = true;
      })
      .addCase(unassignStoreFromUser.fulfilled, (state) => {
        state.isLoading = false;
      })
      .addCase(unassignStoreFromUser.rejected, (state, action) => {
        state.isLoading = false;
        state.error = action.error.message;
      });
  },
});

export default UserSlice.reducer;
</file>

<file path="src/redux/store.js">
import { configureStore } from '@reduxjs/toolkit';
import userSlice from './slice/userSlice';
import storeSlice from './slice/storeSlice';
import authSlice from './slice/authSlice';
import cartSlice from './slice/cartSlice';
import notificationsSlice from './slice/notificationsSlice';
import { erpApi } from '../api/erpApi';

const store = configureStore({
  reducer: {
    user: userSlice,
    store: storeSlice,
    auth: authSlice,
    cart: cartSlice,
    notifications: notificationsSlice,
    [erpApi.reducerPath]: erpApi.reducer,
  },
  middleware: (getDefault) => getDefault().concat(erpApi.middleware),
});

export default store;
</file>

<file path="src/utils/animation.js">
/**
 * @param {number} t
 * @returns {number}
 */
export function easeInOutCubic(t) {
  return t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2;
}

/**
 * @param {{
 *  element: HTMLElement,
 *  to: number,
 *  duration: number,
 *  axis: 'x' | 'y',
 *  onComplete?: () => void
 * }} options
 * @returns {{cancel: () => void}}
 */
export function animateScroll({ element, to, duration, axis, onComplete }) {
  const start = axis === 'y' ? element.scrollTop : element.scrollLeft;
  const change = to - start;
  let startTime = null;
  let animationFrameId = null;
  let cancelled = false;

  const animate = (currentTime) => {
    if (cancelled) return;

    if (startTime === null) {
      startTime = currentTime;
    }

    const elapsed = currentTime - startTime;
    const progress = Math.min(elapsed / duration, 1);
    const easedProgress = easeInOutCubic(progress);

    if (axis === 'y') {
      element.scrollTop = start + change * easedProgress;
    } else {
      element.scrollLeft = start + change * easedProgress;
    }

    if (elapsed < duration) {
      animationFrameId = requestAnimationFrame(animate);
    } else if (onComplete) {
      onComplete();
    }
  };

  animationFrameId = requestAnimationFrame(animate);

  return {
    cancel: () => {
      cancelled = true;
      if (animationFrameId) {
        cancelAnimationFrame(animationFrameId);
      }
    },
  };
}
</file>

<file path="src/utils/Constants.js">
export const MESSAGE = {
  STORE_CREATED: 'Store created Successfully',
  STORE_UPDATED: 'Store updated Successfully',
  USER_UPDATED: 'User updated Successfully',
  USER_CREATED: 'User created successfully!',
  STORE_STATUS_UPDATED: 'Store status updated successfully',
  STORE_DELETED: 'Store deleted successfully',
  USER_STATUS_UPDATED: 'User status updated successfully',
  USER_DELETED: 'User deleted successfully',
};
</file>

<file path="src/utils/debugLog.js">
// src/utils/debugLog.js

export function generateDebugLog() {
  // Viewport / window measurements
  const vh = window.innerHeight;
  const svh = window.visualViewport ? window.visualViewport.height : vh;
  const dvh = window.visualViewport ? window.visualViewport.height : vh;
  const inner = window.innerHeight;
  const visual = window.visualViewport?.height ?? inner;
  const screenH = window.screen.height;

  // CSS variables we care about
  const styles = getComputedStyle(document.documentElement);
  const cssVars = {
    '--addressbar-fill':
      styles.getPropertyValue('--addressbar-fill')?.trim() || '0px',
    '--topbar-h': styles.getPropertyValue('--topbar-h')?.trim() || '0px',
    '--mainnav-h': styles.getPropertyValue('--mainnav-h')?.trim() || '0px',
  };

  // Safe-area insets (iOS notch / home indicator)
  const safeArea = {
    top: styles.getPropertyValue('env(safe-area-inset-top)') || '0px',
    bottom: styles.getPropertyValue('env(safe-area-inset-bottom)') || '0px',
  };

  // Check if keyboard is open (simple heuristic)
  const keyboard = document.documentElement.classList.contains('keyboard-open')
    ? 'open'
    : 'closed';

  // Applied paddings on <main>
  const mainEl = document.querySelector('main');
  const mainStyles = mainEl ? getComputedStyle(mainEl) : {};
  const mainOffsets = {
    paddingTop: mainStyles.paddingTop || 'n/a',
    paddingBottom: mainStyles.paddingBottom || 'n/a',
  };

  // Build a single log string
  const log = [
    `[${new Date().toLocaleTimeString()}]`,
    `vh=${vh} svh=${svh} dvh=${dvh.toFixed ? dvh.toFixed(2) : dvh}`,
    `| inner=${inner} visual=${visual} screen=${screenH}`,
    `| ${Object.entries(cssVars)
      .map(([k, v]) => `${k}=${v}`)
      .join(' ')}`,
    `| safe-area-top=${safeArea.top} safe-area-bottom=${safeArea.bottom}`,
    `| main-padding-top=${mainOffsets.paddingTop} main-padding-bottom=${mainOffsets.paddingBottom}`,
    `| keyboard=${keyboard}`,
  ].join(' ');

  // Copy to clipboard
  if (navigator.clipboard?.writeText) {
    navigator.clipboard.writeText(log).catch((err) => {
      console.error('Failed to copy debug log:', err);
    });
  }

  return log;
}
</file>

<file path="src/utils/devLog.js">
/* global process */

export const devLog = (message, data) => {
  if (process.env.NODE_ENV === 'development') {
    console.log(`[Fullpage] ${message}`, data || '');
  }
};
</file>

<file path="src/utils/Endpoints.js">
// Environment-based API URL with Replit support
const getApiBaseUrl = () => {
  // If explicitly set via env, use that
  if (import.meta.env.VITE_API_BASE_URL) {
    return import.meta.env.VITE_API_BASE_URL;
  }
  
  // In Replit environment, use HTTPS via Replit proxy
  if (typeof window !== 'undefined' && window.location.hostname.includes('replit.dev')) {
    const hostname = window.location.hostname;
    // Replit proxies HTTPS to Django dev server, use port 8000
    return `https://${hostname}:8000`;
  }
  
  // Default to production Railway URL
  return 'https://finetunetechcrafterp-dev.up.railway.app';
};

const API_BASE_URL = getApiBaseUrl();

const END_POINTS = {
  API_BASE_URL,

  // USER
  MODIFY_USER: '/api/users',
  GET_USERS: '/api/users',

  // STORE
  MODIFY_STORE: '/api/stores',
  GET_STORES: '/api/stores',

  // BRAND
  MODIFY_BRAND: '/api/brands',
  GET_BRANDS: '/api/brands',

  // SPARES
  MODIFY_SPARE: '/api/spares',
  GET_SPARES: '/api/spares',

  // BOOKINGS
  MODIFY_BOOKING: '/api/bookings',
  GET_PRODUCTS: '/api/products',
  GET_VARIANTS: '/api/variants',
  GET_BOOKINGS: '/api/bookings',
  MODIFY_DEPARTMENT: '/api/departments',
  GET_DEPARTMENTS: '/api/departments',
  MODIFY_CATEGORY: '/api/categories',
  GET_CATEGORIES: '/api/categories',
  MODIFY_SUBCATEGORY: '/api/subcategories',
  GET_SUBCATEGORIES: '/api/subcategories',
  GET_UNITS: '/api/units',
  GET_QUALITIES: '/api/qualities',

  // REPAIRS
  MODIFY_ISSUE: '/api/issues',
  GET_ISSUES: '/api/issues',
  MODIFY_OTHER_ISSUE: '/api/other-issues',
  GET_OTHER_ISSUES: '/api/other-issues',
  MODIFY_QUESTION: '/api/questions',
  GET_QUESTIONS: '/api/questions',

  // INVENTORY
  GET_STOCK_LEDGERS: '/api/stock-ledgers',
  GET_STOCK_ENTRIES: '/api/stock-entries',
  MODIFY_STOCK_ENTRY: '/api/stock-entries',
  GET_SERIALS: '/api/serials',
  MODIFY_SERIAL: '/api/serials',
  GET_PRICE_LOGS: '/api/price-logs',
  GET_INVENTORY_CONFIG: '/api/inventory-config',
  MODIFY_INVENTORY_CONFIG: '/api/inventory-config',

  // SALES
  GET_SALE_INVOICES: '/api/sales/invoices',
  CREATE_SALE_INVOICE: '/api/sales/invoices',
  GET_SALE_INVOICE_PDF: '/api/sales/invoices',
  SEARCH_SALE_PRODUCTS: '/api/sales/products',

  // AUTHENTICATION
  LOGIN: '/api/auth/login',
  REFRESH_TOKEN: '/api/token/refresh',
  LOGOUT: '/api/auth/logout',
};

export default END_POINTS;
</file>

<file path="src/utils/gst.js">
export function computeGST(subtotal, { cgst = 0, sgst = 0, igst = 0 } = {}) {
  const s = Number(subtotal) || 0;
  const cgstAmt = (s * cgst) / 100;
  const sgstAmt = (s * sgst) / 100;
  const igstAmt = (s * igst) / 100;
  const total = s + cgstAmt + sgstAmt + igstAmt;
  return {
    cgst: Number(cgstAmt.toFixed(2)),
    sgst: Number(sgstAmt.toFixed(2)),
    igst: Number(igstAmt.toFixed(2)),
    total: Number(total.toFixed(2)),
  };
}
</file>

<file path="src/utils/math.test.js">
import { describe, it, expect } from 'vitest';

describe('math', () => {
  it('adds numbers', () => {
    expect(1 + 1).toBe(2);
  });
});
</file>

<file path="src/utils/mockData.js">
export const products = [
  // Mobiles
  {
    id: 1,
    name: 'iPhone 15 Pro',
    category: 'Mobiles',
    price: 129999,
    originalPrice: 149999,
    image:
      'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=300&h=300&fit=crop',
    rating: 4.8,
    reviews: 1247,
    description:
      'Latest iPhone with A17 Pro chip, titanium design, and advanced camera system',
    specs: {
      storage: '256GB',
      color: 'Natural Titanium',
      screen: '6.1 inch',
      battery: 'Up to 23 hours',
    },
    inStock: true,
    stockCount: 10,
    discount: 13,
  },
  {
    id: 2,
    name: 'Samsung Galaxy S24 Ultra',
    category: 'Mobiles',
    price: 119999,
    originalPrice: 139999,
    image:
      'https://images.unsplash.com/photo-1610945265064-0e34e5519bbf?w=300&h=300&fit=crop',
    rating: 4.7,
    reviews: 892,
    description:
      'Premium Android flagship with S Pen, AI features, and exceptional camera',
    specs: {
      storage: '512GB',
      color: 'Titanium Gray',
      screen: '6.8 inch',
      battery: 'Up to 24 hours',
    },
    inStock: true,
    discount: 14,
    stockCount: 10,
  },
  {
    id: 3,
    name: 'OnePlus 12',
    category: 'Mobiles',
    price: 69999,
    originalPrice: 79999,
    image:
      'https://images.unsplash.com/photo-1592899677977-9c10ca588bbd?w=300&h=300&fit=crop',
    rating: 4.6,
    reviews: 567,
    description: 'Fast performance with Hasselblad camera and 100W charging',
    specs: {
      storage: '256GB',
      color: 'Silk Black',
      screen: '6.82 inch',
      battery: 'Up to 20 hours',
    },
    inStock: true,
    discount: 12,
    stockCount: 10,
  },
  {
    id: 4,
    name: 'Google Pixel 8 Pro',
    category: 'Mobiles',
    price: 89999,
    originalPrice: 99999,
    image:
      'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=300&h=300&fit=crop',
    rating: 4.5,
    reviews: 423,
    description:
      'Best camera phone with Google AI and clean Android experience',
    specs: {
      storage: '128GB',
      color: 'Obsidian',
      screen: '6.7 inch',
      battery: 'Up to 21 hours',
    },
    inStock: true,
    discount: 10,
    stockCount: 10,
  },

  // Laptops
  {
    id: 5,
    name: 'MacBook Pro 16-inch',
    category: 'laptops',
    price: 249999,
    originalPrice: 279999,
    image:
      'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=300&h=300&fit=crop',
    rating: 4.9,
    reviews: 2341,
    description:
      'Professional laptop with M3 Pro chip, Liquid Retina XDR display',
    specs: {
      storage: '1TB SSD',
      memory: '18GB RAM',
      processor: 'M3 Pro',
      screen: '16.2 inch',
    },
    inStock: true,
    discount: 11,
    stockCount: 10,
  },
  {
    id: 6,
    name: 'Dell XPS 15',
    category: 'Laptops',
    price: 189999,
    originalPrice: 219999,
    image:
      'https://images.unsplash.com/photo-1588872657578-7efd1f1555ed?w=300&h=300&fit=crop',
    rating: 4.7,
    reviews: 1567,
    description: 'Premium Windows laptop with OLED display and RTX graphics',
    specs: {
      storage: '1TB SSD',
      memory: '32GB RAM',
      processor: 'Intel i9-13900H',
      screen: '15.6 inch OLED',
    },
    inStock: true,
    discount: 14,
    stockCount: 10,
  },
  {
    id: 7,
    name: 'ASUS ROG Strix G16',
    category: 'Laptops',
    price: 159999,
    originalPrice: 179999,
    image:
      'https://images.unsplash.com/photo-1603302576837-37561b2e2302?w=300&h=300&fit=crop',
    rating: 4.6,
    reviews: 892,
    description: 'Gaming laptop with RTX 4070, high refresh rate display',
    specs: {
      storage: '1TB SSD',
      memory: '16GB RAM',
      processor: 'Intel i7-13650H',
      screen: '16 inch 165Hz',
    },
    inStock: true,
    discount: 11,
    stockCount: 10,
  },
  {
    id: 8,
    name: 'Lenovo ThinkPad X1 Carbon',
    category: 'Laptops',
    price: 169999,
    originalPrice: 189999,
    image:
      'https://images.unsplash.com/photo-1496181133206-80ce9b88a853?w=300&h=300&fit=crop',
    rating: 4.8,
    reviews: 1234,
    description:
      'Business laptop with premium build quality and long battery life',
    specs: {
      storage: '512GB SSD',
      memory: '16GB RAM',
      processor: 'Intel i7-1355U',
      screen: '14 inch 2.8K',
    },
    inStock: true,
    discount: 11,
    stockCount: 10,
  },

  // Accessories
  {
    id: 9,
    name: 'Apple AirPods Pro',
    category: 'accessories',
    price: 24999,
    originalPrice: 29999,
    image:
      'https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=300&h=300&fit=crop',
    rating: 4.7,
    reviews: 3456,
    description:
      'Active noise cancellation, spatial audio, sweat and water resistant',
    specs: {
      type: 'Wireless Earbuds',
      battery: 'Up to 6 hours',
      case: 'MagSafe Charging Case',
    },
    inStock: true,
    discount: 17,
    stockCount: 10,
  },
  {
    id: 10,
    name: 'Samsung Galaxy Watch 6',
    category: 'Accessories',
    price: 29999,
    originalPrice: 34999,
    image:
      'https://images.unsplash.com/photo-1579586337278-3befd40fd17a?w=300&h=300&fit=crop',
    rating: 4.6,
    reviews: 1234,
    description:
      'Advanced health monitoring, rotating bezel, long battery life',
    specs: {
      type: 'Smartwatch',
      battery: 'Up to 40 hours',
      screen: '1.5 inch AMOLED',
    },
    inStock: true,
    discount: 14,
    stockCount: 10,
  },
  {
    id: 11,
    name: 'Logitech MX Master 3S',
    category: 'Accessories',
    price: 8999,
    originalPrice: 10999,
    image:
      'https://images.unsplash.com/photo-1527864550417-7fd91fc51a46?w=300&h=300&fit=crop',
    rating: 4.8,
    reviews: 2341,
    description:
      'Premium wireless mouse with MagSpeed scrolling and precision tracking',
    specs: {
      type: 'Wireless Mouse',
      battery: 'Up to 70 days',
      dpi: '8000 DPI',
    },
    inStock: true,
    discount: 18,
    stockCount: 10,
  },
  {
    id: 12,
    name: 'Apple Magic Keyboard',
    category: 'Accessories',
    price: 12999,
    originalPrice: 14999,
    image:
      'https://images.unsplash.com/photo-1541140532154-b024d705b90a?w=300&h=300&fit=crop',
    rating: 4.5,
    reviews: 987,
    description: 'Slim design with scissor mechanism, perfect for Mac users',
    specs: {
      type: 'Wireless Keyboard',
      battery: 'Up to 1 month',
      layout: 'US English',
    },
    inStock: true,
    discount: 13,
    stockCount: 10,
  },

  // Headphones
  {
    id: 13,
    name: 'Sony WH-1000XM5',
    category: 'headphones',
    price: 29999,
    originalPrice: 34999,
    image:
      'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop',
    rating: 4.9,
    reviews: 4567,
    description:
      'Industry-leading noise cancellation with exceptional sound quality',
    specs: {
      type: 'Over-ear Wireless',
      battery: 'Up to 30 hours',
      noise: 'Active Noise Cancellation',
    },
    inStock: true,
    discount: 14,
    stockCount: 10,
  },
  {
    id: 14,
    name: 'Bose QuietComfort 45',
    category: 'Headphones',
    price: 27999,
    originalPrice: 31999,
    image:
      'https://images.unsplash.com/photo-1484704849700-f032a568e944?w=300&h=300&fit=crop',
    rating: 4.7,
    reviews: 2341,
    description: 'Comfortable design with excellent noise cancellation',
    specs: {
      type: 'Over-ear Wireless',
      battery: 'Up to 24 hours',
      noise: 'Active Noise Cancellation',
    },
    inStock: true,
    discount: 12,
    stockCount: 10,
  },
  {
    id: 15,
    name: 'Sennheiser HD 660S',
    category: 'Headphones',
    price: 39999,
    originalPrice: 44999,
    image:
      'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=300&fit=crop',
    rating: 4.8,
    reviews: 1234,
    description: 'Open-back headphones for audiophiles with detailed sound',
    specs: {
      type: 'Over-ear Wired',
      impedance: '150 ohms',
      sensitivity: '104 dB',
    },
    inStock: true,
    discount: 11,
    stockCount: 10,
  },
  {
    id: 16,
    name: 'Audio-Technica ATH-M50x',
    category: 'Headphones',
    price: 15999,
    originalPrice: 18999,
    image:
      'https://images.unsplash.com/photo-1484704849700-f032a568e944?w=300&h=300&fit=crop',
    rating: 4.6,
    reviews: 3456,
    description: 'Studio-quality headphones with exceptional clarity',
    specs: {
      type: 'Over-ear Wired',
      impedance: '38 ohms',
      sensitivity: '99 dB',
    },
    inStock: true,
    discount: 16,
    stockCount: 10,
  },
];

export const categories = [
  {
    id: 'mobiles',
    name: 'Mobiles',
    icon: '📱',
    description: 'Latest smartphones from top brands',
    productCount: 4,
    image:
      'https://images.unsplash.com/photo-1592750475338-74b7b21085ab?w=300&h=200&fit=crop',
  },
  {
    id: 'laptops',
    name: 'Laptops',
    icon: '💻',
    description: 'High-performance laptops for work and gaming',
    productCount: 4,
    image:
      'https://images.unsplash.com/photo-1517336714731-489689fd1ca8?w=300&h=200&fit=crop',
  },
  {
    id: 'accessories',
    name: 'Accessories',
    icon: '🔧',
    description: 'Essential tech accessories and peripherals',
    productCount: 4,
    image:
      'https://images.unsplash.com/photo-1606220945770-b5b6c2c55bf1?w=300&h=200&fit=crop',
  },
  {
    id: 'headphones',
    name: 'Headphones',
    icon: '🎧',
    description: 'Premium audio experience with noise cancellation',
    productCount: 4,
    image:
      'https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=300&h=200&fit=crop',
  },
];

export const getProductsByCategory = (category) => {
  // Handle both lowercase and title case category names
  const normalizedCategory = category.toLowerCase();
  return products.filter(
    (product) => product.category.toLowerCase() === normalizedCategory
  );
};

export const getProductById = (id) => {
  return products.find((product) => product.id === parseInt(id));
};

export const searchProducts = (query) => {
  const lowercaseQuery = query.toLowerCase();
  return products.filter(
    (product) =>
      product.name.toLowerCase().includes(lowercaseQuery) ||
      product.description.toLowerCase().includes(lowercaseQuery) ||
      product.category.toLowerCase().includes(lowercaseQuery)
  );
};
</file>

<file path="src/utils/viewport.js">
function getCSSValue(value) {
  const el = document.createElement('div');
  el.style.height = value;
  document.body.appendChild(el);
  const px = el.offsetHeight;
  document.body.removeChild(el);
  return px;
}

export function updateViewportVars() {
  const lvh = getCSSValue('100lvh');
  const dvh = getCSSValue('100dvh');
  const filler = lvh - dvh; // address bar height

  document.documentElement.style.setProperty(
    '--addressbar-fill',
    filler + 'px'
  );

  // define default bar heights if missing
  if (
    !getComputedStyle(document.documentElement).getPropertyValue('--topbar-h')
  ) {
    document.documentElement.style.setProperty('--topbar-h', '0px');
  }
  if (
    !getComputedStyle(document.documentElement).getPropertyValue('--mainnav-h')
  ) {
    document.documentElement.style.setProperty('--mainnav-h', '56px');
  }
}

export function handleKeyboard() {
  const vv = window.visualViewport;
  if (!vv) return;

  const open = window.innerHeight - vv.height > 150;
  document.documentElement.classList.toggle('keyboard-open', open);
}
</file>

<file path="tailwind.config.js">
/** @type {import('tailwindcss').Config} */
export default {
  darkMode: 'class',
  content: ['./index.html', './src/**/*.{js,ts,jsx,tsx}'],
  theme: {
    extend: {
      backdropBlur: {
        lg: '20px',
      },
      colors: {
        primary: '#000000',
        secondary: '#E2C33D',
        surface: '#F5F7FA',
        keyline: '#E2C33D',
        success: '#16A34A',
        error: '#DC2626',
      },
      fontSize: {
        'display-xl': ['3.75rem', { lineHeight: '1' }],
        'display-lg': ['3rem', { lineHeight: '1' }],
        'display-md': ['2.25rem', { lineHeight: '2.5rem' }],
        'heading-xl': ['1.875rem', { lineHeight: '2.25rem' }],
        'heading-lg': ['1.5rem', { lineHeight: '2rem' }],
        'heading-md': ['1.25rem', { lineHeight: '1.75rem' }],
        'body-lg': ['1.125rem', { lineHeight: '1.75rem' }],
        'body-md': ['1rem', { lineHeight: '1.5rem' }],
        'body-sm': ['0.875rem', { lineHeight: '1.25rem' }],
        caption: ['0.75rem', { lineHeight: '1rem' }],
      },
    },
  },
  plugins: [],
};
</file>

<file path="vercel.json">
{
  "$schema": "https://openapi.vercel.sh/vercel.json",
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}
</file>

<file path="vite.config.js">
import path from 'path';
import { fileURLToPath } from 'url';
import { defineConfig } from 'vite';
import react from '@vitejs/plugin-react';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    host: true, // Allow all hosts including dynamic Replit hosts
    port: 5000,
    strictPort: true,
    hmr: {
      clientPort: 443,
      protocol: 'wss',
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
</file>

<file path="vitest.config.js">
import path from 'path';
import { fileURLToPath } from 'url';
import { defineConfig } from 'vitest/config';
import react from '@vitejs/plugin-react';

const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom', // emulate DOM APIs for component tests
    setupFiles: './setupTests.js',
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
    },
  },
});
</file>

</files>
